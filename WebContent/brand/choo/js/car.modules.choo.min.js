/*!
 * CTM-Platform v0.8.3
 * Copyright 2015 Compare The Market Pty Ltd
 * http://www.comparethemarket.com.au/
 */


!function(a){function b(){a(document).ready(function(){if("car"!==l.site.vertical)return!1;if(d(),"confirmation"===l.site.pageAction)return!1;c(),("amend"===l.site.pageAction||"latest"===l.site.pageAction||"load"===l.site.pageAction||"start-again"===l.site.pageAction)&&l.modules.form.markInitialFieldsWithValue(a("#mainform"));var b=a("#quote-accessories-template");b.length>0&&(k=_.template(b.html())),b=a("#more-info-template"),b.length>0&&(templateMoreInfo=_.template(b.html())),b=a("#calldirect-template"),b.length>0&&(templateCallDirect=_.template(b.html()))})}function c(){}function d(){if("confirmation"===l.site.pageAction)l.modules.journeyEngine.configure(null);else{e(!1);var b=null;b=l.site.isFromBrochureSite===!0?o.startStep.navigationId:l.site.journeyStage.length>0&&"latest"===l.site.pageAction?o.resultsStep.navigationId:l.site.journeyStage.length>0&&"amend"===l.site.pageAction?o.startStep.navigationId:l.modules.emailLoadQuote.getStartStepOverride(b),a(document).ready(function(){_.defer(function(){l.modules.journeyEngine.configure({startStepId:b,steps:_.toArray(o)});var a=l.modules.transactionId.get();l.site.isNewQuote===!1?l.messaging.publish(m.tracking.EXTERNAL,{method:"trackQuoteEvent",object:{action:"Retrieve",transactionID:parseInt(a,10),vertical:l.site.vertical}}):l.messaging.publish(m.tracking.EXTERNAL,{method:"trackQuoteEvent",object:{action:"Start",transactionID:parseInt(a,10),vertical:l.site.vertical}})})})}}function e(a){f(),g(),a&&l.modules.journeyProgressBar.render(!0)}function f(){var b={title:"Your Car",navigationId:"start",slideIndex:0,externalTracking:{method:"trackQuoteForms",object:l.modules.car.getTrackingFieldsObject},onInitialise:function(){var b=a(".slide-feature-emailquote");a("#quote_privacyoptin").is(":checked")&&b.addClass("privacyOptinChecked"),a("#quote_privacyoptin").on("change",function(){a(this).is(":checked")?b.addClass("privacyOptinChecked"):b.removeClass("privacyOptinChecked")})},validation:{validate:!0,customValidation:function(b){a("#quote_vehicle_selection").find("select").each(function(){return a(this).is("[disabled]")?void b(!1):void 0}),b(!0)}}},c={title:"Car Details",navigationId:"options",slideIndex:1,externalTracking:{method:"trackQuoteForms",object:l.modules.car.getTrackingFieldsObject},tracking:{touchType:"H",touchComment:"OptionsAccs",includeFormData:!0},onInitialise:function(){l.modules.carYoungDrivers.initCarYoungDrivers()},onAfterEnter:function(){l.modules.contentPopulation.render(".journeyEngineSlide:eq(1) .snapshot"),$annualKilometers=a(".annual_kilometres_number"),$annualKilometers.on("keyup",function(b){$this=a(this),i($this,b)}),$annualKilometers.trigger("keyup")},onBeforeLeave:function(){if($annualKilometers=a(".annual_kilometres_number"),$annualKilometers.length>0){var b=j($annualKilometers.val());$annualKilometers.val(b)}}},d={title:"Driver Details",navigationId:"details",slideIndex:2,externalTracking:{method:"trackQuoteForms",object:l.modules.car.getTrackingFieldsObject},tracking:{touchType:"H",touchComment:"DriverDtls",includeFormData:!0},onAfterEnter:function(){l.modules.contentPopulation.render(".journeyEngineSlide:eq(2) .snapshot"),$annualKilometersYoungest=a(".annual_kilometres_number_youngest"),$annualKilometersYoungest.on("keyup",function(b){$this=a(this),i($this,b)}),$annualKilometersYoungest.trigger("keyup")},onBeforeLeave:function(){if($annualKilometersYoungest=a(".annual_kilometres_number_youngest"),$annualKilometersYoungest.length>0){var b=j($annualKilometersYoungest.val());$annualKilometersYoungest.val(b)}}},e={title:"Address & Contact",navigationId:"address",slideIndex:3,externalTracking:{method:"trackQuoteForms",object:l.modules.car.getTrackingFieldsObject},tracking:{touchType:"H",touchComment:"AddressCon",includeFormData:!0},onInitialise:function(){var b=a("#quote_drivers_regular_firstname"),c=a("#quote_drivers_regular_surname"),d=a("#quote_contact_phoneinput"),e=a("#quote_contact_email"),f=a("#quote_contact_competition_optin"),g=l.modules.splitTest.isActive(2);f.length&&g&&f.on("change",function(){a(this).is(":checked")?(b.rules("add",{required:!0,messages:{required:"Please enter your First Name to be eligible for the competition"}}),c.rules("add",{required:!0,messages:{required:"Please enter your Last Name to be eligible for the competition"}}),d.rules("add",{required:!0,messages:{required:"Please enter your Contact Number to be eligible for the competition"}}),e.rules("add",{required:!0,messages:{required:"Please enter your Email Address to be eligible for the competition"}})):(b.rules("remove","required"),c.rules("remove","required"),d.rules("remove","required"),e.rules("remove","required"),b.valid(),c.valid(),d.valid(),e.valid())})},onAfterEnter:function(){l.modules.contentPopulation.render(".journeyEngineSlide:eq(3) .snapshot")},onBeforeLeave:function(){}},f={title:"Results",navigationId:"results",slideIndex:4,externalTracking:{method:"trackQuoteForms",object:l.modules.car.getTrackingFieldsObject},onInitialise:function(){l.modules.carResults.initPage(),l.modules.carMoreInfo.initMoreInfo(),l.modules.carEditDetails.initEditDetails()},onBeforeEnter:function(){l.modules.journeyProgressBar.hide(),a("#resultsPage").addClass("hidden"),l.modules.carFilters.updateFilters()},onAfterEnter:function(){l.modules.carResults.get(),l.modules.carFilters.show()},onBeforeLeave:function(a){a.isBackward===!0&&l.modules.transactionId.getNew(3)},onAfterLeave:function(){l.modules.journeyProgressBar.show(),l.modules.carFilters.hide(),l.modules.carEditDetails.hide()}};o={startStep:b,optionsStep:c,detailsStep:d,addressStep:e,resultsStep:f}}function g(){l.modules.journeyProgressBar.configure([{label:"Your Car",navigationId:o.startStep.navigationId},{label:"Car Details",navigationId:o.optionsStep.navigationId},{label:"Driver Details",navigationId:o.detailsStep.navigationId},{label:"Address & Contact",navigationId:o.addressStep.navigationId},{label:"Your Quotes",navigationId:o.resultsStep.navigationId}])}function h(b){try{b=b||!1;var c=a("#quote_drivers_regular_dob").val();c.length>4&&(c=c.substring(c.length-4));var d=null,e=a("input[name=quote_drivers_regular_gender]:checked").val();if(!_.isUndefined(e))switch(e){case"M":d="Male";break;case"F":d="Female"}var f=null,g=a("input[name=quote_contact_marketing]:checked").val();_.isUndefined(g)||(f=g);var h=null,i=a("input[name=quote_contact_oktocall]:checked").val();_.isUndefined(i)||(h=i);var j=a("#quote_riskAddress_postCode").val(),k=a("#quote_riskAddress_state").val(),m=a("#quote_vehicle_year").val(),n=a("#quote_vehicle_make option:selected").text(),o=a("#quote_contact_email").val(),p=a("#quote_options_commencementDate").val(),q=l.modules.transactionId.get(),r=l.modules.journeyEngine.getCurrentStepIndex(),s=l.modules.journeyEngine.getFurtherestStepIndex(),t="";switch(r){case 0:t="your car";break;case 1:t="car details";break;case 2:t="driver details";break;case 3:t="address contact";break;case 4:t=b===!0?"more info":"car results"}var u={vertical:l.site.vertical,actionStep:t,transactionID:q,quoteReferenceNumber:q,yearOfManufacture:null,makeOfCar:null,gender:null,yearOfBirth:null,postCode:null,state:null,email:null,emailID:null,marketOptIn:null,okToCall:null,commencementDate:null};return s>l.modules.journeyEngine.getStepIndex("start")&&_.extend(u,{yearOfManufacture:m,makeOfCar:n}),s>l.modules.journeyEngine.getStepIndex("details")&&_.extend(u,{yearOfBirth:c,gender:d}),s>l.modules.journeyEngine.getStepIndex("address")&&_.extend(u,{postCode:j,state:k,email:o,marketOptIn:f,okToCall:h,commencementDate:p}),u}catch(v){return!1}}function i(a){var b=a.val(),c=j(b),d=c.length;if(b.length>7)a.val(b.substring(0,7));else if(d>3){var e=c.substring(d-3,d),f=c.substring(0,d-3);a.val(f+","+e)}else a.val(c)}function j(a){return a.replace(/\D/g,"")}var k,l=window.meerkat,m=l.modules.events,n=(l.logging.info,{car:{},WEBAPP_LOCK:"WEBAPP_LOCK",WEBAPP_UNLOCK:"WEBAPP_UNLOCK"}),o=null;l.modules.register("car",{init:b,events:n,initProgressBar:e,getTrackingFieldsObject:h})}(jQuery),function(a){function b(){a(document).ready(function(){return"car"!==i.site.vertical?!1:(i.messaging.subscribe(n.COMMENCEMENT_DATE_UPDATED,c),void i.messaging.subscribe(j.emailLoadQuote.TRIGGERS_MODAL,e))}),a("#quote_options_commencementDate").attr("data-attach","true")}function c(b){a("#quote_options_commencementDate").datepicker("update",b),_.defer(function(){d(b)})}function d(b){var c=a("#expired-commencement-date-template");c.length>0&&(templateCallback=_.template(c.html()));var d={updatedDate:b},e=templateCallback(d),f={htmlContent:e,hashId:"call",className:"expired-commencement-date-modal",closeOnHashChange:!0,openOnHashChange:!1,onOpen:function(){}};_.defer(function(){callbackModalId=i.modules.dialogs.show(f)})}function e(b){_.extend(b,{youngDriver:a("input[name=quote_drivers_young_exists]:checked").val()}),_.defer(_.bind(f,this,b))}function f(b){i.messaging.subscribe(j.device.STATE_ENTER_XS,_.bind(h,this,!0)),i.messaging.subscribe(j.device.STATE_LEAVE_XS,_.bind(h,this,!1));var c=a("#edit-details-template");c.length>0&&(templateCallback=_.template(c.html()));var d=a("#quote_options_commencementDate").val(),e=templateCallback(b),f={htmlContent:'<div class="edit-details-wrapper expired-quote"></div>',hashId:"expiredCommencementDate",className:"edit-details-modal",closeOnHashChange:!1,openOnHashChange:!1,onOpen:function(b){l=b,k=!0;var c=a(".edit-details-wrapper",a("#"+b));c.html(e),i.modules.contentPopulation.render("#"+b+" .edit-details-wrapper"),a(".accordion-collapse").on("show.bs.collapse",function(){a(this).prev(".accordion-heading").addClass("active-panel")}).on("hide.bs.collapse",function(){a(this).prev(".accordion-heading").removeClass("active-panel")}),$form=a("#modal-commencement-date-form"),setupDefaultValidationOnForm($form),a("#quote_options_commencementDate_mobile").attr("data-msg-required","Commencement date required"),a("#quote_options_commencementDate_mobile option:first").remove(),a("#modal-commencement-date-get-quotes").on("click",function(b){b.preventDefault();var c=a(this);$form.valid()&&(a("#quote_options_commencementDate").datepicker("update",a("#quote_options_commencementDate_mobile").val()),i.modules.dialogs.close(l),"results"===i.modules.journeyEngine.getCurrentStep().navigationId&&d!=a("#quote_options_commencementDate").val()&&(_.isUndefined(Results.getAjaxRequest())||Results.getAjaxRequest()===!1||4===Results.getAjaxRequest().readyState||200===Results.getAjaxRequest().status?i.modules.carResults.get():(c.addClass("disabled"),m=i.messaging.subscribe(j.carResults.RESULTS_RENDER_COMPLETED,g))))}),c.find("a.btn-edit").on("click",function(b){b.preventDefault(),"results"!==i.modules.journeyEngine.getCurrentStep().navigationId||_.isUndefined(Results.getAjaxRequest())||Results.getAjaxRequest()===!1||4===Results.getAjaxRequest().readyState||200===Results.getAjaxRequest().status||Results.getAjaxRequest().abort(),i.modules.dialogs.close(l),i.modules.journeyEngine.gotoPath(a(this).attr("href").substring(1))}),"xs"===i.modules.deviceMediaState.get()?c.show():c.find(".accordion-collapse").addClass("in").end().show()},onClose:function(){a("#quote_options_commencementDate").datepicker("update",a("#quote_options_commencementDate_mobile").val()),l=!1}};i.modules.dialogs.show(f)}function g(){i.messaging.unsubscribe(j.carResults.RESULTS_RENDER_COMPLETED,m),_.defer(i.modules.carResults.get)}function h(b){if(b=b||!1,l!==!1&&i.modules.dialogs.isDialogOpen(l)){var c=a(".edit-details-wrapper",a("#"+l));b===!0?(c.find(".accordion-collapse").not(".expired-panel").removeClass("in"),c.find(".accordion-heading.active-panel").next(".accordion-collapse").addClass("in")):c.find(".accordion-collapse").each(function(){$that=a(this),$that.addClass("in").css({height:"auto"})})}}var i=window.meerkat,j=i.modules.events,k=(i.logging.info,!1),l=!1,m=!1,n={COMMENCEMENT_DATE_UPDATED:"COMMENCEMENT_DATE_UPDATED"};i.modules.register("carCommencementDate",{init:b,events:n})}(jQuery),function(a){function b(){var b=m.modules.performanceProfiling.isMobile(),c=-1!==_.indexOf(["lg","md"],m.modules.deviceMediaState.get());!b&&c&&(a(o.marketing).rules("remove","validateOkToEmailRadio"),a(o.marketing).rules("add","required"),a(o.oktocall).rules("remove","validateOkToCallRadio"),a(o.oktocall).rules("add","required"))}function c(){$mkt=a(o.marketing),$otc=a(o.oktocall),$mkt.is(":checked")||$mkt.filter("input[value=N]").prop("checked",!0).change(),$otc.is(":checked")||$otc.filter("input[value=N]").prop("checked",!0).change()}function d(){a(o.oktocall).on("change",f),a(o.marketing).on("change",h),a(o.privacy).on("change",i),a(o.phone).on("change",e),a(o.email).on("change",g)}function e(){a(o.oktocall).closest(".row-content").hasClass("has-error")&&_.defer(function(){a(o.oktocall).valid()})}function f(){"Y"!==k(o.oktocall)&&($row=a(o.phoneRow),$row.find(".has-error").removeClass("has-error"),$row.find(".error-field").empty().hide())}function g(){a(o.marketing).closest(".row-content").hasClass("has-error")&&_.defer(function(){a(o.marketing).valid()})}function h(){"Y"!==k(o.marketing)&&($row=a(o.emailRow),$row.find(".has-error").removeClass("has-error"),$row.find(".error-field").empty().hide())}function i(){var b=k(o.privacy);a(o.fsg).val(b),a(o.terms).val(b)}function j(){m.logging.debug("optin data",{oktocall:k(o.oktocall),privacy:k(o.privacy),marketing:k(o.marketing),fsg:a(o.fsg).val(),terms:a(o.terms).val()})}function k(b){var c=a(b);return"radio"===c.first().attr("type")?"Y"===c.filter(":checked").val()?"Y":"N":c.is(":checked")?"Y":"N"}function l(){a(document).ready(function(){return"car"!==m.site.vertical?!1:(d(),b(),void j())})}var m=window.meerkat,n=(m.modules.events,m.logging.info,{}),o={fsg:"#quote_fsg",marketing:"#quote_contactFieldSet input[name='quote_contact_marketing']",oktocall:"#quote_contactFieldSet input[name='quote_contact_oktocall']",privacy:"#quote_privacyoptin",terms:"#quote_terms",phone:"#quote_contact_phoneinput",phoneRow:"#contactNoRow",emailRow:"#contactEmailRow",email:"#quote_contact_email"};m.modules.register("carContactOptins",{init:l,events:n,validateOptins:c,dump:j})}(jQuery),function(a){function b(){c(),d()}function c(){p.on("show.bs.dropdown",function(){var b=a("#edit-details-template");b.length>0&&(templateCallback=_.template(b.html()));var c={youngDriver:a("input[name=quote_drivers_young_exists]:checked").val()};e(templateCallback(c))}).on("click",".closeDetailsDropdown",function(a){f(),a.stopPropagation()}).on("click",".dropdown-container",function(a){a.stopPropagation()})}function d(){m.messaging.subscribe(n.WEBAPP_LOCK,function(){f(),p.children(".activator").addClass("inactive").addClass("disabled")}),m.messaging.subscribe(n.WEBAPP_UNLOCK,function(){p.children(".activator").removeClass("inactive").removeClass("disabled")}),m.messaging.subscribe(n.device.STATE_ENTER_XS,function(){f()}),m.messaging.subscribe(n.device.STATE_LEAVE_XS,function(){f()})}function e(a){"xs"==m.modules.deviceMediaState.get()?q=g(a):h(a)}function f(){p.hasClass("open")&&p.find(".activator").dropdown("toggle").end().find(".edit-details-wrapper").empty(),null!==q&&a("#"+q).modal("hide")}function g(b){var c=m.modules.dialogs.show({htmlContent:'<div class="edit-details-wrapper"></div>',hashId:"edit-details",className:"edit-details-modal",closeOnHashChange:!0,onOpen:function(c){var d=a(".edit-details-wrapper",a("#"+c));d.html(b),m.modules.contentPopulation.render("#"+c+" .edit-details-wrapper"),a(".accordion-collapse").on("show.bs.collapse",function(){a(this).prev(".accordion-heading").addClass("active-panel")}).on("hide.bs.collapse",function(){a(this).prev(".accordion-heading").removeClass("active-panel")}),d.show()}});return c}function h(b){var c=a("#edit-details-dropdown .edit-details-wrapper");c.html(b),m.modules.contentPopulation.render("#edit-details-dropdown .edit-details-wrapper"),c.find(".accordion-collapse").addClass("in").end().show()}function i(a){var b,c=a.val();switch(c){case"5":b=1;break;case"4":b=2;break;case"3":b=3;break;case"2":b=4;break;case"1":b=5;break;case"0":b=6}return 6==b?"Rating 6 No NCD":"undefined"==typeof b?"":"Rating "+b+" ("+c+" Years) NCD"}function j(a){var b,c=a.val(),d="";switch(c){case"H":b=21;break;case"7":b=25;break;case"A":b=30;break;case"D":b=40}return"3"==c?d="No Restrictions":"undefined"!=typeof b&&(d="Restricted to "+b+" or older"),d}function k(a){var b=a.find(":checked").val(),c=" Accident/Hail Damage";return"Y"===b?c:"N"===b?"No"+c:""}function l(a){var b="";return b=m.modules.carVehicleSelection.isSplitTest()?a.find("input:checked").parent().text():a.text()}var m=window.meerkat,n=m.modules.events,o=(m.logging.info,{carEditDetails:{}}),p=(o.carEditDetails,a("#edit-details-dropdown")),q=null;m.modules.register("carEditDetails",{initEditDetails:b,events:o,driverOptin:j,formatNcd:i,formatDamage:k,formatRedbookCode:l,hide:f})}(jQuery),function(a){function b(){if(r.removeClass("active"),s.removeClass("active"),"undefined"!=typeof Results.settings&&Results.settings.hasOwnProperty("displayMode")===!0){switch(Results.getDisplayMode()){case"price":r.addClass("active");break;case"features":s.addClass("active")}v.messaging.publish(y.DISPLAY_MODE_CHANGED,{newDisplayMode:Results.getDisplayMode()})}var b=a("#quote_paymentType").val();t.find(".dropdown-toggle span").text("undefined"==typeof b?t.find(".dropdown-menu a:first").text():t.find('.dropdown-menu a[data-value="'+b+'"]').text());var c=a("#quote_excess").val();u.find(".dropdown-toggle span").text("undefined"==typeof c?u.find(".dropdown-menu a:first").text():u.find('.dropdown-menu a[data-value="'+c+'"]').text())}function c(b){b.preventDefault();var c=a(b.target),d=c.parents(".dropdown"),e=c.attr("data-value");d.find(".dropdown-toggle span").text(c.text()),c.parent().siblings().removeClass("active"),c.parent().addClass("active"),d.hasClass("filter-frequency")?e!==C.frequency&&(C.frequency=e,a("#quote_paymentType").val(C.frequency),Results.setFrequency(e),v.messaging.publish(y.CHANGED)):d.hasClass("filter-excess")&&e!==C.excess&&(C.excess=e,a("#quote_excess").val(e),v.messaging.publish(y.CHANGED,{excess:e}))}function d(){C={display:Results.getDisplayMode(),frequency:a("#quote_paymentType").val(),excess:a("#quote_excess").val()}}function e(){t.find("li.active").removeClass("active"),t.find("a[data-value="+C.frequency+"]").each(function(){a(this).parent().addClass("active")}),u.find("li.active").removeClass("active"),_.isEmpty(C.excess)||u.find("a[data-value="+C.excess+"]").each(function(){a(this).parent().addClass("active")})}function f(){q.slideUp(200,function(){q.addClass("hidden")})}function g(){q.removeClass("hidden").hide().slideDown(200),d(),e()}function h(){q.find("li.dropdown, .dropdown-toggle").addClass("disabled"),r.addClass("disabled"),r.find("a").addClass("disabled"),s.addClass("disabled"),s.find("a").addClass("disabled"),a(".slide-feature-filters").find("a").addClass("disabled").addClass("inactive")}function i(){v.modules.compare.isCompareOpen()===!1&&(q.find("li.dropdown.filter-excess, .filter-excess .dropdown-toggle").removeClass("disabled"),r.removeClass("disabled"),r.find("a").removeClass("disabled"),s.removeClass("disabled"),s.find("a").removeClass("disabled"),a(".slide-feature-filters").find("a").removeClass("inactive").removeClass("disabled")),q.find("li.dropdown.filter-frequency, .filter-frequency .dropdown-toggle").removeClass("disabled")}function j(){v.messaging.subscribe(w.affix.AFFIXED,function(){headerAffixed=!0}),v.messaging.subscribe(w.affix.UNAFFIXED,function(){headerAffixed=!1}),a(document).on("resultsFetchStart",function(){h()}),a(document).on("pagination.scrolling.start",function(){v.modules.carResults.calculateDockedHeader("startPaginationScroll"),B=!0,h()}),a(document).on("resultsFetchFinish",function(){i()}),a(document).on("pagination.scrolling.end",function(){v.modules.carResults.calculateDockedHeader("endPaginationScroll"),B=!1,i()}),v.messaging.subscribe(w.compare.EXIT_COMPARE,i),a(document.body).on("mousewheel DOMMouseScroll onmousewheel",function(a){B&&(a.preventDefault(),a.stopPropagation())}),r.on("click",function(c){c.preventDefault(),a(this).hasClass("disabled")||(v.modules.carResults.switchToPriceMode(!0),b(),v.modules.session.poke())}),s.on("click",function(c){c.preventDefault(),a(this).hasClass("disabled")||(v.modules.carResults.switchToFeaturesMode(!0),b(),v.modules.session.poke())}),q.on("click",".dropdown-menu a",c)}function k(){var b=_.template(a("#car-xsFilterBar-template").html()),c=a("#quote_excess").val(),d=b({startingValue:_.isEmpty(c)?0:c});return A=v.modules.dialogs.show({title:a(this).attr("title"),htmlContent:d,hashId:"xsFilterBar",rightBtn:{label:"Save Changes",className:"btn-sm btn-save",callback:m},closeOnHashChange:!0,onOpen:l}),!1}function l(){"undefined"!=typeof Results.settings&&Results.settings.hasOwnProperty("displayMode")===!0&&(a("#xsFilterBarSortRow input:checked").prop("checked",!1),a("#xsFilterBarSortRow #xsFilterBar_sort_"+Results.getDisplayMode()).prop("checked",!0).change()),a("#xsFilterBarFreqRow input:checked").prop("checked",!1),a("#xsFilterBarFreqRow #xsFilterBar_freq_"+a("#quote_paymentType").val()).prop("checked",!0).change();try{v.modules.sliders.init()}catch(b){}}function m(){var c=a("#quote_paymentType"),d=a("#quote_excess"),e={display:a("#xsFilterBarSortRow input:checked").val(),freq:a("#xsFilterBarFreqRow input:checked").val(),excess:a("#xsFilterBarExcessRow input[name=xsFilterBar_excess]").val()};0===Number(e.excess)&&(e.excess=""),c.val(e.freq),d.val(e.excess),e.display!==C.display&&("features"===e.display?v.modules.carResults.switchToFeaturesMode(!0):"price"===e.display&&v.modules.carResults.switchToPriceMode(!0)),v.modules.dialogs.close(A),v.modules.navMenu.close(),b(),C.frequency!==e.freq&&(C.frequency=e.freq,Results.setFrequency(C.frequency),v.messaging.publish(y.CHANGED)),C.excess!==e.excess&&(C.excess=e.excess,v.messaging.publish(y.CHANGED,{excess:e.excess}))}function n(){var b=!a("#navbar-filter").hasClass("hidden");b&&z===!0&&(d(),k())}function o(a){z=_.isUndefined(a)?"xs"===v.modules.deviceMediaState.get():a.isXS===!0,z===!1&&v.modules.dialogs.isDialogOpen(A)&&v.modules.dialogs.close(A)}function p(){q=a("#navbar-filter"),0!==q.length&&(r=q.find(".filter-pricemode"),s=q.find(".filter-featuresmode"),t=q.find(".filter-frequency"),u=q.find(".filter-excess"),j(),a(document).ready(function(){var b;b=u.find(".dropdown-menu"),a("#filter_excessOptions option").each(function(){b.append('<li><a href="javascript:;" data-value="'+this.value+'">'+this.text+"</a></li>")}),b=t.find(".dropdown-menu"),a("#filter_paymentType option").each(function(){b.append('<li><a href="javascript:;" data-value="'+this.value+'">'+this.text+"</a></li>")}),a("#navbar-main .slide-feature-filters a").on("click",function(b){b.preventDefault(),a(this).hasClass("disabled")||n()}),v.messaging.subscribe(w.device.STATE_ENTER_XS,_.bind(o,this,{isXS:!0})),v.messaging.subscribe(w.device.STATE_LEAVE_XS,_.bind(o,this,{isXS:!1})),o()}))}var q,r,s,t,u,v=window.meerkat,w=v.modules.events,x=(v.logging.info,{carFilters:{CHANGED:"CAR_FILTERS_CHANGED",DISPLAY_MODE_CHANGED:"DISPLAY_MODE_CHANGED"}}),y=x.carFilters,z=!1,A=!1,B=!1,C={display:!1,frequency:!1,excess:!1};v.modules.register("carFilters",{init:p,events:x,updateFilters:b,hide:f,show:g,disable:h,enable:i,onRequestModal:n})}(jQuery),function(a){function b(){var b={container:I,hideAction:"fadeOut",showAction:"fadeIn",modalOptions:{className:"modal-breakpoint-wide modal-tight bridgingContainer",openOnHashChange:!1,leftBtn:{label:"All Products",icon:'<span class="icon icon-arrow-left"></span>',callback:function(b){a(b.currentTarget).closest(".modal").modal("hide")}}},runDisplayMethod:p,onBeforeShowBridgingPage:m,onBeforeShowTemplate:z,onBeforeShowModal:z,onAfterShowModal:y,onAfterShowTemplate:n,onBeforeHideTemplate:null,onAfterHideTemplate:o,onClickApplyNow:r,onBeforeApply:null,onApplySuccess:A,retrieveExternalCopy:q,additionalTrackingData:{productName:null}};F.modules.moreInfo.initMoreInfo(b),h(),c()}function c(){a(document).on("click",".bridgingContainer .btn-call-actions",function(b){var c=a(this);i(b,c)}).on("click",".call-modal .btn-call-actions",function(b){var c=a(this);j(b,c)}).on("click",".btn-submit-callback",function(b){var c=a(this);k(b,c)}),a(".slide-feature-closeMoreInfo a").off().on("click",function(){F.modules.moreInfo.close()})}function d(){setupDefaultValidationOnForm(a("#getcallback"));var b=a("#quote_CrClientName");b.length&&!b.val().length&&b.val(a("#quote_drivers_regular_firstname").val()+" "+a("#quote_drivers_regular_surname").val());var c=a("#quote_CrClientTelinput");c.length&&!c.val().length&&c.val(a("#quote_contact_phone").val()),c.attr("data-msg-required","Please enter your contact number")}function e(b,c,d){if("xs"!=F.modules.deviceMediaState.get()&&a(c,d).length){var e=a(b,d).outerHeight(),f=a(c,d).outerHeight();e>=f?(a(c,d).css("min-height",e+"px"),a(b,d).css("min-height",e+"px")):(a(c,d).css("min-height",f+"px"),a(b,d).css("min-height",f+"px"))}}function f(a,b){t(b);var c=b;if("undefined"==typeof J[c.productId]){var d=F.site.tracking.brandCode.toUpperCase();return g(a,{message:d+" - Car Vertical - Call direct",phonecallme:"CallDirect"},b)}}function g(b,c,d){"undefined"!=typeof d&&null!==d&&"undefined"!=typeof d.vdn&&!_.isEmpty(d.vdn)&&d.vdn>0&&(c.vdn=d.vdn);var e=F.site.tracking.brandCode.toUpperCase(),f={state:a("#quote_riskAddress_state").val(),brand:d.productId.split("-")[0]};F.site.leadfeed[c.phonecallme].use_disc_props?a.extend(f,{source:e+"CAR",leadNo:d.leadNo,client:a("#quote_CrClientName").val()||"",clientTel:a("#quote_CrClientTelinput").val()||"",transactionId:F.modules.transactionId.get()}):a.extend(f,{clientNumber:d.leadNo,clientName:a("#quote_CrClientName").val()||"",phoneNumber:a("#quote_CrClientTelinput").val()||"",partnerReference:F.modules.transactionId.get()});var g=a.extend(f,c),h=a(b.target);return F.modules.loadingAnimation.showInside(h,!0),F.modules.comms.post({url:F.site.leadfeed[c.phonecallme].url,data:g,dataType:"json",cache:!1,errorLevel:"GetaCall"===c.phonecallme?"warning":"silent",onSuccess:function(){if("GetaCall"==c.phonecallme){F.modules.dialogs.show({title:"Call back request recorded",htmlContent:"<p><strong>Thank you!</strong></p><p>Your Call request has been sent to the insurer's message centre who will be in touch as soon as possible.</p>",hashId:"call-back-success",openOnHashChange:!1,closeOnHashChange:!0,onOpen:function(){var a=F.modules.sessionCamHelper.getMoreInfoStep(E+"-submitted");F.modules.sessionCamHelper.updateVirtualPage(a)},onClose:function(){var b=F.modules.sessionCamHelper.getMoreInfoStep(E);F.modules.sessionCamHelper.updateVirtualPage(b),a(".modal").modal("hide"),F.modules.moreInfo.isBridgingPageOpen()&&F.modules.moreInfo.close()}})}},onComplete:function(){"CallDirect"==c.phonecallme&&(J[d.productId]=!0),F.modules.loadingAnimation.hide(h)}})}function h(){F.messaging.subscribe(G.ADDRESS_CHANGE,function(a){"xs"!=F.modules.deviceMediaState.get()&&-1==a.hash.indexOf("results/moreinfo")&&F.modules.moreInfo.hideTemplate(I)}),F.messaging.subscribe(G.device.STATE_ENTER_XS,function(){F.modules.moreInfo.isBridgingPageOpen()&&F.modules.moreInfo.close(),"undefined"!=typeof C&&a("#"+C).modal("hide")}),F.messaging.subscribe(G.device.STATE_LEAVE_XS,function(){F.modules.moreInfo.isModalOpen()&&F.modules.moreInfo.close(),"undefined"!=typeof C&&a("#"+C).modal("hide")}),F.messaging.subscribe(G.errorHandling.OK_CLICKED,function(){(F.modules.moreInfo.isBridgingPageOpen()||F.modules.moreInfo.isModalOpen())&&F.modules.moreInfo.close()}),F.messaging.subscribe(G.transactionId.CHANGED,function(){M=!0}),F.messaging.subscribe(G.carResults.FEATURES_CALL_ACTION,function(a){i(a.event,a.element)}),F.messaging.subscribe(G.carResults.FEATURES_CALL_ACTION_MODAL,function(a){j(a.event,a.element)}),F.messaging.subscribe(G.carResults.FEATURES_SUBMIT_CALLBACK,function(a){k(a.event,a.element)})}function i(b,c){b.preventDefault(),b.stopPropagation();var g=c,h=a("#car-call-modal-template");h.length>0&&(templateCallback=_.template(h.html()));var i=Results.getResultByProductId(g.attr("data-productId"));if("Y"===i.available){E=g.attr("data-callback-toggle");var j=F.modules.sessionCamHelper.getMoreInfoStep(E),k=templateCallback(i),l={htmlContent:k,hashId:"call",className:"call-modal "+i.brandCode,closeOnHashChange:!0,openOnHashChange:!1,onOpen:function(c){a("."+E).show(),e(".paragraphedContent:visible",".sidebar-right",a("#"+c)),d(),g.hasClass("btn-calldirect")?f(b,i):u(i),F.modules.sessionCamHelper.updateVirtualPage(j)},onClose:function(){F.modules.sessionCamHelper.setMoreInfoModal()}};"xs"==F.modules.deviceMediaState.get()&&(l.title="Reference no. "+i.leadNo),C=F.modules.dialogs.show(l)}}function j(b,c){"xs"!=F.modules.deviceMediaState.get()&&b.preventDefault(),b.stopPropagation();var d=c,g=Results.getResultByProductId(d.attr("data-productId"));E=d.attr("data-callback-toggle");var h=F.modules.sessionCamHelper.getMoreInfoStep(E);switch(E){case"calldirect":a(".callback").hide(),a(".calldirect").show(),f(b,g);break;case"callback":a(".calldirect").hide(),a(".callback").show(),u(g)}e(".paragraphedContent:visible",".sidebar-right",d.closest(".modal.in")),F.modules.sessionCamHelper.updateVirtualPage(h)}function k(a,b){a.preventDefault();var c=b,d=Results.getResultByProductId(c.attr("data-productId"));if(c.closest("form").valid()){var f=F.site.tracking.brandCode.toUpperCase();g(a,{message:f+" - Car Vertical - Call me now",phonecallme:"GetaCall"},d),v(d)}else _.delay(function(){e(".paragraphedContent:visible",".sidebar-right",c.closest(".modal.in"))},200);return!1}function l(){D=a(window).scrollTop()}function m(){l(),"xs"!=F.modules.deviceMediaState.get()&&a(".resultsContainer, #navbar-filter, #navbar-compare").hide()}function n(){y(),("lg"==F.modules.deviceMediaState.get()||"md"==F.modules.deviceMediaState.get())&&e(".paragraphedContent",".moreInfoRightColumn",I)}function o(){a(".resultsContainer, #navbar-filter, #navbar-compare").show(),a(window).scrollTop(D)}function p(){"xs"!=F.modules.deviceMediaState.get()?F.modules.moreInfo.showTemplate(I):F.modules.moreInfo.showModal(),F.modules.address.appendToHash("moreinfo")}function q(a){return F.modules.comms.get({url:"ajax/json/get_scrapes.jsp",cache:!0,data:{type:"carBrandScrapes",code:a.productId,group:"car"},errorLevel:"silent",onSuccess:function(a){F.modules.moreInfo.setDataResult(a)}})}function r(b,c){var d=0===b.service.search(/agis_/i);if(L===!0&&K.length>0&&!d){var e=a("#special-conditions-template");e.length>0&&(templateCallback=_.template(e.html()));var f=F.modules.moreInfo.getOpenProduct();f.specialConditionsRule=K;{var g=templateCallback(f);F.modules.dialogs.show({htmlContent:g,hashId:"special-conditions",title:"Special Conditions Confirmation",closeOnHashChange:!0,openOnHashChange:!1,onOpen:function(d){a(".btn-proceed-to-insurer",a("#"+d)).off("click.proceed").on("click.proceed",function(a){return a.preventDefault(),s(b,d,c)}),a(".btn-back",a("#"+d)).off("click.goback").on("click.goback",function(){a(".modal").modal("hide"),F.modules.moreInfo.isBridgingPageOpen()&&F.modules.moreInfo.close()})},onClose:function(){F.modules.moreInfo.applyCallback(!1)}})}return!1}return s(b,!1,c)}function s(b,c,d){return c&&a("#"+c).modal("hide"),C&&a("#"+C).modal("hide"),_.isEmpty(b.quoteUrl)?(F.modules.errorHandling.error({errorLevel:"warning",message:"An error occurred. Sorry about that!<br /><br /> To purchase this policy, please contact the provider "+(""!==b.telNo?" on "+b.telNo:"directly")+" quoting "+b.leadNo+", or select another policy.",page:"carMoreInfo.js:proceedToInsurer",description:"Insurer did not provide quoteUrl in results object.",data:b}),!1):(F.modules.partnerTransfer.transferToPartner({encodeTransferURL:!0,product:b,applyNowCallback:d,productName:b.headline.name,productBrandCode:b.brandCode,brand:b.productDes}),!0)}function t(a){M===!0&&(M=!1,w("CrCallDir",a))}function u(a){w("CrCallBac",a)}function v(a){w("CrCallBacSub",a)}function w(a,b){F.modules.partnerTransfer.trackHandoverEvent({product:b,type:a,quoteReferenceNumber:b.leadNo,productID:b.productId,productName:b.headline.name,productBrandCode:b.brandCode},!1,!1)
}function x(){F.messaging.publish(G.tracking.EXTERNAL,{method:"trackQuoteForms",object:_.bind(F.modules.car.getTrackingFieldsObject,this,!0)})}function y(){var a={additionalTrackingData:{productName:F.modules.moreInfo.getOpenProduct().headline.name}};F.modules.moreInfo.updateSettings(a),x()}function z(b){"undefined"!=typeof b&&"undefined"!=typeof b.scrapes&&b.scrapes.length>0&&a.each(b.scrapes,function(b,c){""!==c.html&&a(c.cssSelector).html(c.html)}),a(".contentRow li").each(function(){a(this).prepend('<span class="icon icon-angle-right"></span>')})}function A(){}function B(a,b){L=a,K=b}var C,D,E,F=window.meerkat,G=F.modules.events,H={carMoreInfo:{}},I=(H.carMoreInfo,a(".bridgingContainer")),J={},K="",L=!1,M=!0;F.modules.register("carMoreInfo",{initMoreInfo:b,events:H,setSpecialConditionDetail:B,runDisplayMethod:p,setScrollPosition:l})}(jQuery),function(a){function b(){d(),Features.init(),u.modules.compare.initCompare(),e(),h()}function c(){h(),y!==u.modules.deviceMediaState.get()&&(Results.view.calculateResultsContainerWidth(),Features.clearSetHeights(),Features.balanceVisibleRowsHeight()),Results.pagination.refresh()}function d(){A=a("#deviceType").attr("data-deviceType");try{var b="price";"ctm"==u.site.tracking.brandCode&&(b="features"),u.modules.splitTest.isActive(17)&&(b="price"),Results.init({url:"ajax/json/car_quote_results.jsp",runShowResultsPage:!1,paths:{productId:"productId",productName:"headline.name",productBrandCode:"brandCode",price:{annually:"headline.lumpSumTotal",annual:"headline.lumpSumTotal",monthly:"headline.instalmentTotal"},availability:{product:"available",price:{annually:"headline.lumpSumTotal",annual:"headline.lumpSumTotal",monthly:"headline.instalmentTotal"}}},show:{savings:!1,featuresCategories:!1,nonAvailablePrices:!0,nonAvailableProducts:!1,unavailableCombined:!0},availability:{product:["equals","Y"],price:["notEquals",-1]},render:{templateEngine:"_",features:{mode:"populate",headers:!1,numberOfXSColumns:1},dockCompareBar:!1},displayMode:b,pagination:{mode:"page",touchEnabled:Modernizr.touch},sort:{sortBy:"price.annually"},frequency:"annual",animation:{results:{individual:{active:!1},delay:500,options:{easing:"swing",duration:1e3}},shuffle:{active:!0,options:{easing:"swing",duration:1e3}},filter:{reposition:{options:{easing:"swing"}}}},elements:{features:{values:".content",extras:".children"}},templates:{pagination:{pageText:"Product {{=currentPage}} of {{=totalPages}}"}},dictionary:{valueMap:[{key:"Y",value:"<span class='icon icon-tick'></span>"},{key:"N",value:"<span class='icon icon-cross'></span>"},{key:"R",value:"Restricted / Conditional"},{key:"AI",value:"Additional Information"},{key:"O",value:"Optional"},{key:"L",value:"Limited"},{key:"SCH",value:"As shown in schedule"},{key:"NA",value:"Non Applicable"},{key:"E",value:"Excluded"},{key:"NE",value:"No Exclusion"},{key:"NS",value:"No Sub Limit"},{key:"OTH",value:""}]},rankings:{paths:{rank_productId:"productId",rank_premium:"headline.lumpSumTotal"},filterUnavailableProducts:!1},incrementTransactionId:!1})}catch(c){Results.onError("Sorry, an error occurred initialising page","results.tag","meerkat.modules.carResults.initResults(); "+c.message,c)}}function e(){a(document.body).on("click","a.offerTerms",p),a(Results.settings.elements.resultsContainer).on("click",".result-row",s),u.messaging.subscribe(v.affix.AFFIXED,function(){a("#resultsPage").css("margin-top","35px"),B=!0,f("affixed")}),u.messaging.subscribe(v.affix.UNAFFIXED,function(){a("#resultsPage").css("margin-top","0"),B=!1,f("unaffixed")}),u.messaging.subscribe(v.carFilters.DISPLAY_MODE_CHANGED,function(){f("displayModeChanged")}),u.messaging.subscribe(v.device.STATE_CHANGE,function(){f("deviceMediaStateChange")}),u.messaging.subscribe(v.compare.EXIT_COMPARE,function(){f("startPaginationScroll")}),a(document).on("results.view.animation.start",function(){f("startPaginationScroll")}),a(document).on("results.view.animation.end",function(){a(".result-row").css({position:""}),f("filterAnimationEnded")}),u.messaging.subscribe(v.carFilters.CHANGED,function(a){a&&a.hasOwnProperty("excess")?(Results.settings.incrementTransactionId=!0,l(),Results.settings.incrementTransactionId=!1):u.modules.resultsTracking.setResultsEventMode("Refresh"),u.modules.session.poke()}),u.messaging.subscribe(w.RESULTS_ERROR,function(){_.delay(function(){u.modules.journeyEngine.gotoPath("previous")},1e3)}),a(Results.settings.elements.resultsContainer).on("featuresDisplayMode",function(){Features.buildHtml()}),a(Results.settings.elements.resultsContainer).on("noFilteredResults",function(){Results.view.show()}),a(document).on("resultsLoaded",m),a(document).on("resultsReturned",function(){u.modules.utilities.scrollPageTo(a("header")),a(".featuresHeaders .expandable.expanded").removeClass("expanded").addClass("collapsed")}),a(document).on("resultsFetchStart",function(){u.modules.journeyEngine.loadingShow("getting your quotes"),a("#resultsPage, .loadingDisclaimerText").removeClass("hidden"),"ctm"==u.site.tracking.brandCode&&u.modules.splitTest.isActive(4)?a("#resultsPage, .loadingQuoteText").removeClass("hidden"):a("#resultsPage, .loadingDisclaimerText").addClass("originalDisclaimer"),Results.pagination.hide()}),a(document).on("resultsFetchFinish",function(){a(Results.settings.elements.page).show(),u.modules.journeyEngine.loadingHide(),a(".loadingDisclaimerText").addClass("hidden"),"ctm"==u.site.tracking.brandCode&&u.modules.splitTest.isActive(4)?a(".loadingQuoteText").addClass("hidden"):a(".loadingDisclaimerText").addClass("originalDisclaimer"),"price"!==Results.getDisplayMode()?Results.pagination.show():a(document.body).removeClass("priceMode").addClass("priceMode");var b=0;a.each(Results.model.returnedProducts,function(){"Y"===this.available&&"CURR"!==this.productId&&b++}),0===b&&_.isArray(Results.model.returnedProducts)&&Results.model.returnedProducts.length>0&&n(),u.messaging.publish(v.carResults.RESULTS_RENDER_COMPLETED)}),a(document).on("populateFeaturesStart",function(){u.modules.performanceProfiling.startTest("results")}),a(Results.settings.elements.resultsContainer).on("populateFeaturesEnd",function(){var a,b=u.modules.performanceProfiling.endTest("results");a=800>b?u.modules.performanceProfiling.PERFORMANCE.HIGH:8e3>b&&u.modules.performanceProfiling.isIE8()===!1?u.modules.performanceProfiling.PERFORMANCE.MEDIUM:u.modules.performanceProfiling.PERFORMANCE.LOW,Results.setPerformanceMode(a)}),a(document).on("resultPageChange",function(a){var b=a.pageData;if(null===b.measurements)return!1;{var c=Results.getFilteredResults().length,d=b.measurements.columnsPerPage;d*b.measurements.numberOfPages-c}}),a(document).on("FeaturesRendered",function(){a(Features.target+" .expandable > "+Results.settings.elements.features.values).on("mouseenter",function(){var b=a(this).attr("data-featureId"),c=a(Features.target+' [data-featureId="'+b+'"]');c.addClass(Results.settings.elements.features.expandableHover.replace(/[#\.]/g,""))}).on("mouseleave",function(){var b=a(this).attr("data-featureId"),c=a(Features.target+' [data-featureId="'+b+'"]');c.removeClass(Results.settings.elements.features.expandableHover.replace(/[#\.]/g,""))})}),a(document.body).on("click","#resultsBridgeLess .btnContainer .btn-call-actions",function(b){var c=a(this);u.messaging.publish(v.carResults.FEATURES_CALL_ACTION,{event:b,element:c})}),a(document.body).on("click","#resultsBridgeLess .call-modal .btn-call-actions",function(b){var c=a(this);u.messaging.publish(v.carResults.FEATURES_CALL_ACTION_MODAL,{event:b,element:c})}),a(document.body).on("click","#resultsBridgeLess .btn-submit-callback",function(b){var c=a(this);u.messaging.publish(v.carResults.FEATURES_SUBMIT_CALLBACK,{event:b,element:c})})}function f(b){if("TABLET"!=A){var c="features"==Results.getDisplayMode()?!0:!1,d=!0,e="startPaginationScroll"==b||"endPaginationScroll"==b||"filterAnimationEnded"==b,f=a(".featuresDockedHeader"),h=a(".headers");if(c){var i=a(".fixedDockedHeader");if(B){h.hide();var j=a(".currentPage"),k=a("#navbar-filter").height()+a("#navbar-main").outerHeight(),l="startPaginationScroll"==b?"0":k+"px",m=a(".result-row").first().width(),n=a("#pageContent").offset(),o=a("#navbar-filter").offset(),p=o.top-n.top+7,q="startPaginationScroll"==b?"absolute":"fixed",r="startPaginationScroll"==b?p+"px":"0px";e?(d=!1,f.css({position:q,top:l,width:m,"padding-top":r}).show(),("endPaginationScroll"==b||"filterAnimationEnded"==b)&&(j.length>=1?j.siblings(":not(.currentPage)").find(f).hide():f.hide(),d=!0)):j.find(f).css({top:l,width:m}).show(),g(d)}else f.hide(),i.hide(),h.show()}else h.show(),f.hide()}}function g(b){var c=a(".fixedDockedHeader"),d=a(".currentPage"),e=a("#navbar-filter").height()+a("#navbar-main").outerHeight();if(b){var f=a(".cell.feature").width()+2+"px",g="100px";d.length>=1&&(g=a(".resultInsert.featuresMode:visible").first().innerHeight()+1+"px"),c.css({top:e,width:f,height:g}).show()}}function h(){i(),u.messaging.subscribe(v.device.STATE_ENTER_XS,function(){"results"===u.modules.journeyEngine.getCurrentStep().navigationId&&i()}),u.messaging.subscribe(v.device.STATE_LEAVE_XS,function(){j(),Results.pagination.setCurrentPageNumber(1),Results.pagination.resync()})}function i(){"xs"===u.modules.deviceMediaState.get()&&"features"===Results.getDisplayMode()&&(Results.view.startColumnWidthTracking(a(window),Results.settings.render.features.numberOfXSColumns,!1),Results.pagination.setCurrentPageNumber(1),Results.pagination.resync())}function j(){Results.view.stopColumnWidthTracking()}function k(){y=u.modules.deviceMediaState.get()}function l(){u.modules.carContactOptins.validateOptins(),Results.get()}function m(){switch(i(),Results.getDisplayMode()){case"features":r(!1);break;default:z=!0,q(!1)}}function n(){u.modules.hasOwnProperty("carFilters")&&u.modules.carFilters.disable()}function o(){var b=a("#navbar-filter .dropdown.filter-excess span:first-child"),c="default";b.length&&(c=b.text().toLowerCase(),c=-1!==c.indexOf("please")?null:c),u.messaging.publish(v.resultsTracking.TRACK_QUOTE_RESULTS_LIST,{additionalData:{paymentPlan:a("#navbar-filter .dropdown.filter-frequency span:first-child").text(),preferredExcess:c},onAfterEventMode:"Load"})}function p(b){u.modules.carMoreInfo.setScrollPosition(),b.preventDefault();var c=a(b.target),d=c.next(".offerTerms-content"),e=c.closest(".resultInsert, .more-info-content, .call-modal").find(".companyLogo"),f=c.closest(".resultInsert, .more-info-content, .call-modal").find(".productTitle, .productName");u.modules.dialogs.show({title:e.clone().wrap("<p>").addClass("hidden-xs").parent().html()+"<div class='hidden-xs heading'>"+f.html()+"</div><div class='heading'>Offer terms</div>",hashId:"offer-terms",className:"offer-terms-modal",openOnHashChange:!1,closeOnHashChange:!0,htmlContent:e.clone().wrap("<p>").removeClass("hidden-xs").addClass("hidden-sm hidden-md hidden-lg").parent().html()+"<h2 class='visible-xs heading'>"+f.html()+"</h2>"+d.html()})}function q(b){"undefined"==typeof b&&(b=!0),null!==Results.getDisplayMode()&&"price"!==Results.getDisplayMode()&&(Results.pagination.hide(),a("header .xs-results-pagination").addClass("hidden"),Results.setDisplayMode("price"),j(),a(document.body).addClass("priceMode"),a(window).scrollTop(0),b&&(u.modules.resultsTracking.setResultsEventMode("Refresh"),o()))}function r(b){if("undefined"==typeof b&&(b=!0),null!==Results.getDisplayMode()&&"features"!==Results.getDisplayMode()){var c=z===!0;Results.setDisplayMode("features",c),i(),_.defer(function(){Results.pagination.gotoPage(1),"xs"===u.modules.deviceMediaState.get()&&Results.view.setColumnWidth(a(window),Results.settings.render.features.numberOfXSColumns,!1),Results.pagination.setupNativeScroll()}),Results.pagination.show(!0),a("header .xs-results-pagination").removeClass("hidden"),z=!1,a(document.body).removeClass("priceMode"),a(window).scrollTop(0),b&&(u.modules.resultsTracking.setResultsEventMode("Refresh"),o())}}function s(b){if(a(Results.settings.elements.resultsContainer).hasClass("priceMode")!==!1&&"xs"===u.modules.deviceMediaState.get()){var c=a(b.target);c.hasClass("result-row")===!1&&(c=c.parents(".result-row")),"undefined"!=typeof c.attr("data-available")&&"Y"===c.attr("data-available")&&(u.modules.moreInfo.setProduct(Results.getResult("productId",c.attr("data-productId"))),u.modules.carMoreInfo.runDisplayMethod())}}function t(){x=a("#resultsPage"),u.messaging.subscribe(v.RESULTS_RANKING_READY,o),u.messaging.subscribe(v.compare.AFTER_ENTER_COMPARE_MODE,function(){a(".filter-excess, .filter-excess a").addClass("disabled"),a(".filter-featuresmode, .filter-pricemode").addClass("hidden")}),u.messaging.subscribe(v.compare.EXIT_COMPARE,function(){a(".filter-excess, .filter-excess a").removeClass("disabled"),a(".filter-featuresmode, .filter-pricemode").removeClass("hidden")})}var u=window.meerkat,v=u.modules.events,w=(u.logging.info,{RESULTS_ERROR:"RESULTS_ERROR"});v.carResults={FEATURES_CALL_ACTION:"FEATURES_CALL_ACTION",FEATURES_CALL_ACTION_MODAL:"FEATURES_CALL_ACTION_MODAL",FEATURES_SUBMIT_CALLBACK:"FEATURES_SUBMIT_CALLBACK"};var x,y,z=!1,A=null,B=!1;u.modules.register("carResults",{init:t,initPage:b,onReturnToPage:c,get:l,stopColumnWidthTracking:j,recordPreviousBreakpoint:k,switchToPriceMode:q,switchToFeaturesMode:r,calculateDockedHeader:f,showNoResults:n,publishExtraSuperTagEvents:o})}(jQuery),function(){function a(a){var c=!1;switch(a){case"buttonLabel":c="Save Quote";break;case"saveAgain":c='Click \'Save Quote\' to update your saved quote <a href="javascript:;" class="btn btn-save saved-continue-link btn-save-quote">Save Quote</a>';break;case"saveSuccess":c='<div class="col-xs-12"><h4>Your quote has been saved.</h4><p>To retrieve your quote <a href="'+b.site.urls.base+'retrieve_quotes.jsp" class="btn-cancel saved-continue-link btn-link">click here</a>.</p><a href="javascript:;" class="btn btn-cancel">Close</a></div>'}return c}var b=window.meerkat,c=(b.modules.events,b.logging.info,b.messaging,{});b.modules.register("carSaveQuote",{events:c,getCopy:a})}(jQuery),function(a){function b(b){a(g.selector).remove();var c="N",e=!_.isEmpty(b.alarm),f=!_.isEmpty(b.immobiliser);if(e&&f?c="B":e?c="A":f&&(c="I"),"N"!==c)a(g.selectorParent).empty(),a(g.visibleRow).hide(),a(g.hiddenRow).empty().append(a("<input/>",{type:"hidden",name:"quote_vehicle_securityOption",id:"quote_vehicle_securityOption",value:c})).append(a("<input/>",{type:"hidden",name:"quote_vehicle_securityOptionCheck",id:"quote_vehicle_securityOptionCheck",value:"Y"})).show();else{if(a(g.hiddenRow).empty(),i.find("option:selected").removeAttr("selected"),i.find("select:first").attr("selectedIndex",0),a(g.selectorParent).empty().append(i),h===!0){h=!1;var j=d.site.vehicleSelectionDefaults.securityOption;_.isEmpty(j)||a(g.selector).find("option").each(function(){var b=a(this);b.val()==j&&b.prop("selected",!0)})}a(g.visibleRow).show()}}function c(){a(document).ready(function(){return"car"!==d.site.vertical?!1:(i=a(g.selector).clone(),i.find("option:selected").removeAttr("selected"),i.find("select:first").prop("selectedIndex",0),void d.messaging.subscribe(e.carVehicleOptions.UPDATED_VEHICLE_DATA,b))})}var d=window.meerkat,e=d.modules.events,f=(d.logging.info,{carVehicleOptions:{UPDATED_VEHICLE_DATA:"UPDATED_VEHICLE_DATA"}}),g={selector:"#securityOptionRow .select:first, #securityOptionRow .fieldrow_legend:first",selectorParent:"#securityOptionRow .row-content",visibleRow:"#securityOptionRow",hiddenRow:"#securityOptionHiddenRow"},h=!0,i=null;d.modules.register("carSecurityOptions",{init:c,events:f,onUpdatedVehicleData:b})}(jQuery),function(a){function b(){d.messaging.subscribe(e.car.DROPDOWN_CHANGED,function(){c()})}function c(){var b=a("#quote_vehicle_make");if(""!==b.val()){var c=a(".quoteSnapshot");c.removeClass("hidden")}d.modules.contentPopulation.render(".journeyEngineSlide:eq(0) .snapshot")}{var d=window.meerkat,e=d.modules.events,f=(d.logging.info,{carSnapshot:{}});f.carSnapshot}d.modules.register("carSnapshot",{init:b,events:f})}(jQuery),function(a){function b(b){if(N===!1){var e=a(F.factory.button);C.modules.loadingAnimation.showAfter(e);var f=C.modules.carVehicleSelection.isSplitTest()?a(F.redbook).find("input:checked"):a(F.redbook),g={redbookCode:f?f.val():null};N=!0,C.modules.comms.get({url:"ajax/json/car_vehicle_options.jsp",data:g,cache:!0,useDefaultErrorHandling:!1,numberOfAttempts:3,errorLevel:"fatal",onSuccess:function(a){I=a,d(),C.messaging.publish(E.carVehicleOptions.UPDATED_VEHICLE_DATA,I),w(),_.isFunction(b)&&b()},onError:c,onComplete:function(){N=!1,C.modules.loadingAnimation.hide(e)}})}}function c(a,b,c,d,e){C.modules.errorHandling.error({message:"Sorry, we cannot seem to retrieve a list of accessories for your vehicles at this time. Please come back to us later and try again.",page:"carVehicleOptions.js:getVehicleData()",errorLevel:"warning",description:"Failed to retrieve a list of accessories for RedBook Code: "+c,data:e})}function d(){var a=["alarm","immobiliser","options","standard"];_.isObject(I)||(I={});for(var b=0;b<a.length;b++)I.hasOwnProperty(a[b])&&_.isArray(I[a[b]])||(I[a[b]]=[])}function e(){var b=j(I.options),c=k(I.standard),d=_.template(a(F.factory.template).html()),e=d({optionalAccessories:b,standardAccessories:c});return H.factory=C.modules.dialogs.show({title:a(this).attr("title"),htmlContent:e,hashId:"factory-options",tabs:[{title:"Add Factory/Dealer Options",xsTitle:"Factory/Dealer Options",targetSelector:".quote-factory-options"},{title:"View Included Standard Accessories",xsTitle:"Standard Accessories",targetSelector:".quote-standard-accessories"}],buttons:[{label:"Save Changes",className:"btn-save",action:_.bind(t,this,{type:"factory"})}],rightBtn:{label:"Save Changes",className:"btn-sm btn-save",callback:_.bind(t,this,{type:"factory"})},closeOnHashChange:!0,openOnHashChange:!1,onClose:function(){C.modules.sessionCamHelper.updateVirtualPage(B()),x({type:"factory"})},onOpen:function(b){_.isArray(I.options)&&I.options.length?a(".quote-factory-options .no-items-found").addClass("hidden"):a(".quote-factory-options .items-found").addClass("hidden"),_.isArray(I.standard)&&I.standard.length?a(".quote-standard-accessories .no-items-found").addClass("hidden"):a(".quote-standard-accessories .items-found").addClass("hidden"),a("#"+b).on("click",".nav-tabs a",function(c){c.preventDefault(),c.stopPropagation();var d=B();d.navigationId+="-FactoryDealerOptions-"+a(this).attr("data-target").split("-")[2],C.modules.sessionCamHelper.updateVirtualPage(d),a(this).tab("show"),a("#"+b+" .modal-title-label").html(a(this).attr("title"))}),a(".nav-tabs a:first").click(),G&&_.defer(function(){a(function(){a("html.lt-ie9 form#quote_vehicle_factoryOptionsDialogForm").on("change.checkedForIE",".checkbox input, .compareCheckbox input",function(){var b=a(this);b.is(":checked")?b.addClass("checked"):b.removeClass("checked")}),a("html.lt-ie9 form#quote_vehicle_factoryOptionsDialogForm .checkbox input").change()})})}}),!1}function f(){var b=k(I.standard),c=(l(),_.template(a(F.accessories.template).html())),d=(K.accessories.accs,a(F.accessories.saveditems).children()),e=[],f=[];a.each(d,function(b,c){c=a(this);var d=c.attr("itemIndex"),g=c.attr("itemPrice");e.push(parseInt(d)),f.push(g)}),a.each(J,function(a,b){var c=e.indexOf(a),d=!1;c>=0&&(d=!0),b.checked=d,b.priceDropdown='<option value="">Please choose&hellip;</option>',selectedDropdown="","0"==f[c]&&(selectedDropdown="selected"),b.priceDropdown+='<option value="" disabled="true">---</option>',b.priceDropdown+='<option value="0" '+selectedDropdown+">Included in purchase price</option>",b.priceDropdown+='<option value="" disabled="true">---</option>';for(var g=Math.ceil(b.standard*(b.min/100)),h=g,i=Math.floor(b.standard*(b.max/100));i>=h;)selectedDropdown="",f[c]==h&&(selectedDropdown="selected"),b.priceDropdown+='<option value="'+h+'" '+selectedDropdown+">$"+h+"</option>",h+=g;h-=g,h!=i&&(selectedDropdown="",f[c]==i&&(selectedDropdown="selected"),b.priceDropdown+='<option value="'+i+'" '+selectedDropdown+">$"+i+"</option>")});var h=c({standardAccessories:b,vehicleNonStandardAccessories:J}),i=".quote-optional-accessories-listed",j=".quote-standard-accessories";return H.accessories=C.modules.dialogs.show({title:a(this).attr("title"),htmlContent:h,hashId:"accessories",tabs:[{title:"Add Non-Standard Accessories",xsTitle:"Non-Standard Accessories",targetSelector:i},{title:"View Included Standard Accessories",xsTitle:"Standard Accessories",targetSelector:j}],buttons:[{label:"Save Changes",className:"btn-save",action:_.bind(t,this,{type:"accessories"})}],rightBtn:{label:"Save Changes",className:"btn-sm btn-save",callback:_.bind(t,this,{type:"accessories"})},closeOnHashChange:!0,openOnHashChange:!1,onClose:function(){C.modules.sessionCamHelper.updateVirtualPage(B()),x({type:"accessories"})},onOpen:function(b){var c=a("#injectIntoHeader");c.remove(),a(".modal-header").append(c),a("#quote_vehicle_accessoriesDialog").parent().css({"padding-top":"5px"}),_.isArray(J)&&J.length?a(".quote-optional-accessories-listed .no-items-found").addClass("hidden"):a(".quote-optional-accessories-listed .items-found").addClass("hidden"),_.isArray(I.standard)&&I.standard.length?a(".quote-standard-accessories .no-items-found").addClass("hidden"):a(".quote-standard-accessories .items-found").addClass("hidden"),a("#"+b).on("click",".nav-tabs a",function(d){a(this).attr("data-target")==j?c.hide():c.show(),d.preventDefault(),d.stopPropagation();var e=B();e.navigationId+="-NonStandardAccessories-"+a(this).attr("data-target").split("-")[1],C.modules.sessionCamHelper.updateVirtualPage(e),a(this).tab("show"),a("#"+b+" .modal-title-label").html(a(this).attr("title"))}),a(".nav-tabs a:first").click(),g()}}),!1}function g(){a(".nonStandardAccessoryCheckbox").on("change",function(){var b=a(this),c=b.attr("itemIndex"),d=a('select[itemIndex="'+c+'"]');b.prop("checked")?d.prop("disabled",!1):(d.prop("disabled",!0),d.val(""))}),a(".nonStandardAccessorySelect").on("change",function(){var b=a(this);""===b.val()?b.parent().addClass("has-error"):b.parent().removeClass("has-error")});for(var b=0;b<L.accessories.length;b++){var c=L.accessories[b],d=a(F.accessories.addeditems),e=d.find("li.added-item-"+c.position).first();e.data("info",c),e.find("a:first").on("click",_.bind(i,this,c))}}function h(b){return a("<li/>").addClass("added-item-"+b.position).data("info",b).append(a("<span/>").append(b.label)).append(a("<a/>",{title:"remove accessory"}).addClass("icon-cross").on("click",_.bind(i,this,b))).append(a("<span/>").append(b.price===!1?"Included":"$"+b.price))}function i(b){a(F.accessories.addeditems).find(".added-item-"+b.position).remove(),a(F.accessories.type).find("option").each(function(){return parseInt(a(this).val(),10)>b.position?(a(this).before(a("<option/>",{text:b.label,value:b.position+"_"+b.code})),!1):void 0})}function j(b){for(var c=a("<ul/>"),d=0;d<b.length;d++){var e=b[d],f="tmp_fact_"+d+"_chk",g="tmp_quote_opts_opt"+("0"+d).slice(-2),h=a("<input/>",{type:"checkbox",name:g,id:f,value:e.code});-1!==_.indexOf(L.factory,f)&&h.attr("checked",!0),c.append(a("<li/>").append(a("<div/>").addClass("checkbox").append(h).append(a("<label/>").attr("for",f).append(y(e.label)))))}return c.html()}function k(b){for(var c=a("<ul/>"),d=0;d<b.length;d++){var e=b[d];c.append(a("<li/>",{text:y(e.label)}))}return c.html()}function l(){for(var b=a("<ul/>"),c=0;c<L.accessories.length;c++)b.append(h(L.accessories[c]));return b.html()}function m(a){for(var b=0;b<J.length;b++)if(J[b].code===a)return J[b];return!1}function n(a){return I.options.hasOwnProperty(a)?I.options[a]:!1}function o(){a(F.factory.inputs).empty(),a(F.factory.saveditems).empty(),a(F.accessories.inputs).empty(),a(F.accessories.saveditems).empty();var b=K.factory,c=K.accessories;if(!_.isUndefined(b)&&!_.isEmpty(b))for(var d in b.opts)if(b.opts.hasOwnProperty(d)){var e=String(parseInt(d.substring(3),10)),f="tmp_fact_"+e+"_chk",g=n(e);g.position=("0"+e).slice(-2),g!==!1&&(L.factory.push("tmp_fact_"+e+"_chk"),a(F.factory.inputs).append(v({id:f.slice(4),name:"quote_opts_opt"+("0"+e).slice(-2),value:g.code})),r({type:"factory",item:g}))}if(!_.isUndefined(c)&&!_.isEmpty(c))for(var h in c.accs)if(c.accs.hasOwnProperty(h)){var i=c.accs[h],j=m(i.sel),k={included:"Y"===i.inc,position:parseInt(h.substring(3),10),price:i.hasOwnProperty("prc")?String(i.prc):"0",code:i.sel,label:j.label};L.accessories.push(k),u(k)}x({type:"factory"}),x({type:"accessories"})}function p(b){if(a(".saved-item-"+b.type+"-"+b.position).remove(),"factory"==b.type){for(var c=0;c<L.factory.length;c++)L.factory[c]=="tmp_fact_"+parseInt(b.position,10)+"_chk"&&L.factory.splice(c,1);_.isEmpty(L.factory)&&x({type:"factory"})}else{for(var d=0;d<L.accessories.length;d++)L.accessories[d].code==b.code&&L.accessories.splice(d,1);_.isEmpty(L.accessories)&&x({type:"accessories"})}}function q(b){var c=a("<li/>").addClass("saved-item-"+b.type+"-"+b.position).attr("itemIndex",b.position).attr("itemPrice",b.price).append(a("<span/>").append(b.label)).append(a("<a/>",{title:"remove "+("factory"==b.type?"factory option":"accessory")}).addClass("icon-cross").on("click",_.bind(p,this,b)));return _.isNull(b.price)||c.append(a("<span/>").append("0"===b.price?"Included":"$"+b.price)),c}function r(b){var c={type:b.type,position:"",label:"",price:null,code:"",item:null};"accessories"==b.type?(c.position=b.item.position,c.label=b.item.label,c.price=b.item.price,c.code=b.item.code,c.item=b.item,a(F.accessories.saveditems).append(q(c))):(c.position=b.item.position,c.label=b.item.label,c.code=b.item.code,c.item=b.item,a(F.factory.saveditems).append(q(c)))}function s(){M===!1?(L.factory=[],L.accessories=[],L.accessories=[],a(F.factory.inputs).empty(),a(F.factory.saveditems).empty(),a(F.accessories.inputs).empty(),a(F.accessories.saveditems).empty(),x({type:"factory"}),x({type:"accessories"}),b()):(M=!1,b(o))}function t(b){if("accessories"==b.type){var c=[],d=!0;a(".nonStandardAccessoryCheckbox:checked").each(function(b,e){e=a(this);var f=e.attr("itemIndex"),g=e.siblings().text(),h=a('select[itemIndex="'+f+'"]'),i=h.val();""===i?(d=!1,h.parent().addClass("has-error")):h.parent().removeClass("has-error");var j={position:f,label:g,code:e.val(),included:"0"==h.val()?!0:!1,price:i};c.push(j)}),d?(L[b.type]=[],a(F[b.type].inputs).empty(),a(F[b.type].saveditems).empty(),c.forEach(function(a){L.accessories.push(a),u(a)}),C.modules.dialogs.close(H[b.type])):a(".has-error select").first().focus()}else L[b.type]=[],a(F[b.type].inputs).empty(),a(F[b.type].saveditems).empty(),a(F[b.type].checkboxes).find(":checked").each(function(){var b=a(this);L.factory.push(b.attr("id"));var c=b.attr("name").slice(4),d=b.attr("id").slice(4),e=d.split("_")[1],f=n(e);f.position=("0"+e).slice(-2),a(F.factory.inputs).append(v({id:d,name:c,value:b.val()}).addClass("saved-item-factory-"+("0"+f.position).slice(-2))),r({type:"factory",item:f})}),C.modules.dialogs.close(H[b.type])}function u(b){a(F.accessories.inputs).append(v({name:"quote_accs_acc"+b.position+"_sel",id:"acc_"+b.position+"_chk",value:b.code}).addClass("saved-item-accessories-"+("0"+b.position).slice(-2))).append(v({name:"quote_accs_acc"+b.position+"_inc",value:b.included===!0?"Y":"N"}).addClass("saved-item-accessories-"+("0"+b.position).slice(-2))),b.included===!1&&a(F.accessories.inputs).append(v({name:"quote_accs_acc"+b.position+"_prc",value:b.price}).addClass("saved-item-accessories-"+("0"+b.position).slice(-2))),r({type:"accessories",item:b})}function v(b){var c={type:"hidden"};return _.extend(c,b),a("<input/>",c)}function w(){_.isArray(I.options)&&I.options.length?a("#quote_vehicle_factoryOptionsFieldSet").removeClass("hidden"):a("#quote_vehicle_factoryOptionsFieldSet").addClass("hidden")}function x(b){var c=a(F[b.type].radio+" input:radio").is(":checked");_.isEmpty(L[b.type])?(a(F[b.type].button).css({display:"none"}),a(F[b.type].radio).css({display:"block"}),a(F[b.type].radio+" input:radio").prop("checked",!1).change(),c===!0&&(a(F[b.type].radio+" input:radio:last").prop("checked",!0).change(),a(F[b.type].yn).val("N"))):(a(F[b.type].radio+" input:radio").prop("checked",!1),a(F[b.type].radio+" input:radio:first").prop("checked",!0).change(),a(F[b.type].yn).val("Y"),a(F[b.type].radio).css({display:"none"}),a(F[b.type].button).css({display:"block"}))}function y(b){return a("<div />").html(b).text()}function z(a,b){b.preventDefault(),b.stopPropagation(),a.callback()}function A(){a(document).ready(function(){if("car"!==C.site.vertical)return!1;G=C.modules.performanceProfiling.isIE8(),C.messaging.subscribe(D.car.VEHICLE_CHANGED,s),J=[],_.isObject(C.site.nonStandardAccessoriesList)&&C.site.nonStandardAccessoriesList.hasOwnProperty("items")&&_.isArray(C.site.nonStandardAccessoriesList.items)&&(J=C.site.nonStandardAccessoriesList.items),_.extend(K,userOptionPreselections);for(var b=["factory","accessories"],c=0;c<b.length;c++){var d=b[c],g=a(F[d].yn).val();_.isEmpty(g)&&!_.isEmpty(K[d])&&(a(F[d].yn).val("Y"),g="Y"),_.isEmpty(g)||(a(F[d].radio+" input:radio").prop("checked",!1).change(),a(F[d].radio+" input:radio[value="+g+"]").prop("checked",!0).change())}a(F.factory.radio+" label:first").on("click",_.bind(z,this,{type:"factory",callback:e})),a(F.accessories.radio+" label:first").on("click",_.bind(z,this,{type:"accessories",callback:f})),a(F.factory.radio+" label:last").on("click",function(){a(F.factory.yn).val("N")}),a(F.accessories.radio+" label:last").on("click",function(){a(F.accessories.yn).val("N")}),a(F.factory.button).on("click",e),a(F.accessories.button).on("click",f)})}function B(){return null==O&&(O=C.modules.journeyEngine.getCurrentStep()),_.extend({},O)}var C=window.meerkat,D=C.modules.events,E=(C.logging.info,{car:{VEHICLE_CHANGED:"VEHICLE_CHANGED"},carVehicleOptions:{UPDATED_VEHICLE_DATA:"UPDATED_VEHICLE_DATA"}}),F={factory:{radio:"#quote_vehicle_factoryOptionsRadioBtns",yn:"#quote_vehicle_factoryOptions",button:"#quote_vehicle_factoryOptionsButton",template:"#quote-factoryoptions-template",checkboxes:"#quote_vehicle_factoryOptionsDialog .quote-factory-options",inputs:"#quote_vehicle_options_inputs_container .factory:first",saveditems:"#quote_vehicle_factoryOptionsSelections .added-items ul"},accessories:{radio:"#quote_vehicle_accessoriesRadioBtns",yn:"#quote_vehicle_accessories",button:"#quote_vehicle_accessoriesButton",template:"#quote-nonstandard-accessories-template",inputs:"#quote_vehicle_options_inputs_container .accessories:first",wrapper:"#quote_vehicle_accessoriesDialog .quote-optional-accessories-listed",type:"#quote_vehicle_accessoriesDialog .ac-type",included:"#quote_vehicle_accessoriesDialog .ac-included",price:"#quote_vehicle_accessoriesDialog .ac-price",add:"#quote_vehicle_accessoriesDialog .ac-add",clear:"#quote_vehicle_accessoriesDialog .ac-clear",addeditems:"#quote_vehicle_accessoriesDialog .quote-optional-accessories-listed .added-items ul",saveditems:"#quote_vehicle_accessoriesSelections .added-items ul"},redbook:"#quote_vehicle_redbookCode"};F.accessories.wrapper="#quote_vehicle_accessoriesDialog .quote-optional-accessories-listed";var G=!1,H={factory:{},accessories:{}},I={},J=[],K={},L={factory:[],accessories:[]},M=!0,N=!1,O=null;C.modules.register("carVehicleOptions",{init:A,events:E,onVehicleChanged:s})}(jQuery),function(a){function b(b){if(C===!1){B=b;var e=a(w[b]),g=e;g.closest(".form-group").hasClass("hidden")?(g=g.closest(".form-group").prev().find("select"),u.modules.loadingAnimation.showAfter(g)):u.modules.loadingAnimation.showAfter(g);for(var h={},k=0;k<_.indexOf(z,b);k++){var l=z[k];_.indexOf(z,b)>_.indexOf(z,"bodies")&&"bodies"==l?h.body=a(w[l]).val():h[l.substring(0,l.length-1)]=a(w[l]).val()}n(e),t()&&s(b)?e.empty():(e.attr("selectedIndex",0),e.empty().append(a("<option/>",{value:""}).append(x.resetOptionHTML))),j(b,!0),C=!0,_.defer(function(){u.modules.comms.get({url:"car/"+b+"/list.json",data:h,cache:!0,useDefaultErrorHandling:!1,numberOfAttempts:3,errorLevel:"fatal",onSuccess:function(a){return d(b,a),f(b),!0},onError:c,onComplete:function(){return C=!1,u.modules.loadingAnimation.hide(g),q(),i(b),!0
}})})}}function c(b,c,d,e,f){C=!1,u.modules.loadingAnimation.hide(a(w[B]));var h=g(B);if(h!==!1){var i=a(w[h]);i.find("option:selected").prop("selected",!1)}return j(B,!1),a(w[B]).empty().append(a("<option/>",{text:x.errorInOptionHTML+B,value:""})).prop("disabled",!1).blur(),u.modules.errorHandling.error({message:"Sorry, we cannot seem to retrieve a list of "+B+" for your vehicles at this time. Please come back to us later and try again.",page:"vehicleSelection.js:getVehicleSelectorData()",errorLevel:"warning",description:"Failed to retrieve a list of "+B+": "+d,data:f}),!1}function d(a,b){e(a);for(var c=_.indexOf(z,a);c<z.length;c++)b.hasOwnProperty(z[c])&&A.hasOwnProperty(z[c])&&(A[z[c]]=b[z[c]])}function e(a){for(var b=_.isUndefined(a)?0:_.indexOf(z,a),c=b;c<z.length;c++)A[z[c]]={}}function f(c){if(A.hasOwnProperty(c)){B=c;var d=!1,e=u.modules.performanceProfiling.isIos()&&"xs"==u.modules.deviceMediaState.get();if(A[c]&&_.isArray(A[c])){var g=null;D===!0&&y.hasOwnProperty(c)&&""!==y[c]&&(g=y[c]),d=1===A[c].length,$selector=a(w[c]),$selector.empty();var k=[];(!t()||t()&&!s(c))&&k.push(a("<option/>",{text:x.pleaseChooseOptionHTML,value:""}));var l=!1;if("models"==c&&A[c][0].hasOwnProperty("isTopModel")&&A[c][0].isTopModel===!0&&(l=!0),"makes"==c||l){var p=c.charAt(0).toUpperCase()+c.slice(1);k.push(a("<optgroup/>",{label:"Top "+p})),k.push(a("<optgroup/>",{label:"All "+p}))}else(!t()||t()&&!s(c))&&e&&d!==!0&&k.push(a("<optgroup/>",{label:c.charAt(0).toUpperCase()+c.slice(1)}));for(var q in A[c])if(A[c].hasOwnProperty(q)){if("function"==typeof A[c][q])continue;var r=A[c][q],z=null;if(t()&&s(c)){var E="quote_vehicle_redbookCode";z=a("<div/>",{"class":"radioCustom"}).append(a("<input/>",{type:"radio",id:E+"_"+r.code,name:E,value:r.code,required:"required","data-autosave":"true","data-msg-required":"Please select a vehicle type"})).append(a("<label/>",{"for":E+"_"+r.code,text:r.label}))}else z=a("<option/>",{text:r.label,value:r.code});g===!0||d!==!0&&(_.isNull(g)||g!=r.code)||(t()&&s(c)?z.find("input").prop("checked",!0):z.prop("selected",!0),g=!0),"makes"==c||"models"==c&&l?r[l?"isTopModel":"isTopMake"]===!0?z.appendTo(k[1],k[2]):k[2].append(z):(!t()||t()&&!s(c))&&e&&d!==!0?k[1].append(z):k.push(z)}for(var F=0;F<k.length;F++)$selector.append(k[F]);t()&&s(c)&&m($selector,c),$selector.prop("disabled",!1),$selector.is(":visible")||a(w[c+"Row"]).removeClass("hidden"),"makes"===c&&i(c),n($selector),d!==!0&&_.isNull(g)||(o($selector),$selector.blur()),j(c,!1);var G=h(c);u.messaging.publish(v.car.DROPDOWN_CHANGED),G!==!1&&(_.isArray(A[G])&&!_.isEmpty(A[G])?f(G):d===!0&&(C=!1,b(G)))}else t()&&s(c)?(a(w[B+"Row"]).addClass("hidden"),a(w[B]).empty()):a(w[B]).empty().append(a("<option/>",{text:x.notFoundOptionHTML,value:""}))}}function g(a){var b=_.indexOf(z,a)-1;return z.hasOwnProperty(b)?z[b]:!1}function h(a){var b=_.indexOf(z,a)+1;return z.hasOwnProperty(b)?z[b]:!1}function i(b){var c=_.indexOf(z,b);if(c>-1)for(var d=0;d<z.length;d++)if(w.hasOwnProperty(z[d])){var e=a(w[z[d]]);d>c&&(t()&&s(z[d])?(a(w[z[d]+"Row"]).addClass("hidden"),e.empty()):(e.attr("selectedIndex",0),e.empty().append(a("<option/>",{value:""}).append(x.resetOptionHTML))),n(e),e.prop("disabled",!0),1===c&&(a(w.marketValue).val(""),a(w.variant).val(""),a(w.modelDes).val(""),a(w.registrationYear).val("")))}}function j(b,c){c=c||!1;for(var d=0;d<=_.indexOf(z,b);d++)a(w[z[d]]).prop("disabled",c)}function k(c){D=!1;var d=h(c.field),e=_.isEmpty(a(w[c.field]).val());e===!0&&(n(a(w[c.field])),i(c.field));var f=p("makes",a(w.makes).val());f!==!1?a(w.makeDes).val(f.label):a("span[data-source='#quote_vehicle_make']").text("");var g=p("models",a(w.models).val());g!==!1&&a(w.modelDes).val(g.label);var j=p("years",a(w.years).val());if(j!==!1&&a(w.registrationYear).val(j.code),e===!1&&d!==!1&&(i(d),b(d)),"types"===c.field){var k=a(w.types);(t()&&k.find("input:checked")||!t()&&!_.isEmpty(k.val()))&&(o(k),q())}u.messaging.publish(v.car.DROPDOWN_CHANGED)}function l(){for(var b=0;b<z.length;b++)z.hasOwnProperty(b)&&(t()&&s(z[b])?m(a(w[z[b]]),z[b]):a(w[z[b]]).off().on("change",_.bind(k,this,{field:z[b]})))}function m(a,b){a.find("input[type=radio]").off().on("change",_.bind(k,this,{field:b}))}function n(a){a.removeClass("has-success has-error"),a.closest(".form-group").find(".row-content").removeClass("has-success has-error").end().find(".error-field").remove()}function o(a){a.addClass("has-success"),a.closest(".form-group").find(".row-content").addClass("has-success")}function p(a,b){if(!_.isEmpty(b))for(var c=0;c<A[a].length;c++)if(b==A[a][c].code)return A[a][c];return!1}function q(){var b=t()?a(w.types).find("input:checked"):a(w.types),c=b?b.val():null;if(!_.isEmpty(c)){var d=p("makes",a(w.makes).val());d!==!1&&a(w.makeDes).val(d.label);var e=p("models",a(w.models).val());e!==!1&&a(w.modelDes).val(e.label);var f=p("years",a(w.years).val());f!==!1&&a(w.registrationYear).val(f.code);var g=p("types",c);g!==!1&&(a(w.marketValue).val(g.value),a(w.variant).val(g.label)),t()?_.defer(function(){u.messaging.publish(v.car.VEHICLE_CHANGED)}):u.messaging.publish(v.car.VEHICLE_CHANGED)}}function r(){a(document).ready(function(){if("car"!==u.site.vertical)return!1;F=u.modules.splitTest.isActive(8);for(var b=0;b<z.length;b++)a(w[z[b]]).attr("tabindex",b+1);e(),_.extend(y,u.site.vehicleSelectionDefaults),_.extend(A,u.site.vehicleSelectionDefaults.data),l(),f("makes"),q(),!t()&&u.modules.performanceProfiling.isIE8()&&a(document).on("focus","#quote_vehicle_redbookCode",function(){var b=a(this);b.data("width",b.width()),b.width("auto"),b.data("width-auto",a(this).width()),b.width(b.data("width-auto")<b.data("width")?b.data("width"):b.data("width-auto")+15)}).on("blur","#quote_vehicle_redbookCode",function(){var b=a(this);b.width(b.data("width"))})})}function s(a){return _.indexOf(E,a)>-1}function t(){return F}var u=window.meerkat,v=(u.modules.events,u.logging.info,{car:{VEHICLE_CHANGED:"VEHICLE_CHANGED",DROPDOWN_CHANGED:"DROPDOWN_CHANGED"}}),w={makes:"#quote_vehicle_make",makeDes:"#quote_vehicle_makeDes",makesRow:"#quote_vehicle_makeRow",models:"#quote_vehicle_model",modelDes:"#quote_vehicle_modelDes",modelsRow:"#quote_vehicle_modelRow",years:"#quote_vehicle_year",registrationYear:"#quote_vehicle_registrationYear",yearsRow:"#quote_vehicle_yearRow",bodies:"#quote_vehicle_body",bodiesDes:"#quote_vehicle_bodyDes",bodiesRow:"#quote_vehicle_bodyRow",transmissions:"#quote_vehicle_trans",transmissionsRow:"#quote_vehicle_transRow",fuels:"#quote_vehicle_fuel",fuelsRow:"#quote_vehicle_fuelRow",types:"#quote_vehicle_redbookCode",typesRow:"#quote_vehicle_redbookCodeRow",marketValue:"#quote_vehicle_marketValue",variant:"#quote_vehicle_variant"},x={pleaseChooseOptionHTML:"Please choose...",resetOptionHTML:"&nbsp;",notFoundOptionHTML:"No match for above choices",errorInOptionHTML:"Error finding "},y={},z=["makes","models","years","bodies","transmissions","fuels","types"],A={},B=!1,C=!1,D=!0,E=["types"],F=!1;u.modules.register("carVehicleSelection",{init:r,events:v,isSplitTest:t})}(jQuery),function(a){function b(){var b=i.modules.utilities.returnAge(a(l.reg_dob).val(),!0),d=i.modules.utilities.returnAge(a(l.yng_dob).val(),!0),e=Math.min(b,d);20>=e?a(l.age_row).slideUp():24>=e?(a(l.age_row).slideDown(),c(["H"])):29>=e?(a(l.age_row).slideDown(),c(["H","7"])):39>=e?(a(l.age_row).slideDown(),c(["H","7","A"])):(a(l.age_row).slideDown(),c(["H","7","A","D"]))}function c(b){var c=a(l.restrict),d=c.val();c.empty();for(var e=0;e<n.length;e++){var f=n[e];if(m.hasOwnProperty(f)&&("0"===f||"3"===f||_.indexOf(b,f)>=0)){var g=m[f].clone();f===d&&g.prop("selected",!0),c.append(g)}}}function d(){var b=a(l.restrict);b.find("option").each(function(){var b=a(this),c=_.isEmpty(b.val())?0:b.val();m[c]=b.clone(),m[c].prop("selected",!1)})}function e(){var b=a(l.labels).find("input:checked");return _.isEmpty(b)?!1:"Y"===b.val()}function f(b){b=b||!1;var c=a(l.labels).find("input:checked");_.isEmpty(c)||(e()?a(l.toggle).slideDown("fast",function(){if(b){var a=h();a.navigationId+="-youngdriver",i.modules.sessionCamHelper.updateVirtualPage(a)}}):a(l.toggle).slideUp("fast",function(){var c=a(this);c.find(":text").val(""),c.find(":radio").prop("checked",!1).change(),a(l.yng_dob).val("").change(),c.find(".has-success").removeClass("has-success"),c.find(".has-error").removeClass("has-error"),c.find(".error-field").remove(),b&&i.modules.sessionCamHelper.updateVirtualPage(h())}))}function g(){i.modules.sessionCamHelper.addStepToIgnoreList("details"),i.messaging.subscribe(j.journeyEngine.STEP_CHANGED,function(a){"details"==a.navigationId&&_.defer(_.bind(f,this,!0))}),a(document).ready(function(){return"car"!==i.site.vertical?!1:(a(l.labels+" label input").on("click",function(){_.defer(_.bind(f,this,!0))}),a(l.reg_dob+","+l.yng_dob).on("change",b),d(),f(),setTimeout(function(){if("details"==i.modules.journeyEngine.getCurrentStep().navigationId){var a=h();e()&&(a.navigationId+="-youngdriver"),i.modules.sessionCamHelper.updateVirtualPage(a)}},250),void b())})}function h(){return null==o&&(o=i.modules.journeyEngine.getCurrentStep()),_.extend({},o)}var i=window.meerkat,j=i.modules.events,k=(i.logging.info,{}),l={toggle:"#quote_drivers_youngToggleArea",labels:"#quote_drivers_youngDriverRow .row-content",restrict:"#quote_options_driverOption",reg_dob:"#quote_drivers_regular_dob",yng_dob:"#quote_drivers_young_dob",age_row:"#quote_restricted_ageRow"},m={},n=["0","3","H","7","A","D"],o=null;i.modules.register("carYoungDrivers",{initCarYoungDrivers:g,events:k,getSessionCamStep:h})}(jQuery);
//# sourceMappingURL=car.modules.choo.min.map