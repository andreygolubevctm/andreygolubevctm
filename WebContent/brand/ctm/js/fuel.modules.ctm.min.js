/*!
 * CTM-Platform v0.8.3
 * Copyright 2015 Compare The Market Pty Ltd
 * http://www.comparethemarket.com.au/
 */


!function(a,b){function c(){a(document).ready(function(){return"fuel"!==j.site.vertical?!1:(j.modules.fuelPrefill.setHashArray(),e(),d(),void(("amend"===j.site.pageAction||"latest"===j.site.pageAction||"load"===j.site.pageAction||"start-again"===j.site.pageAction)&&j.modules.form.markInitialFieldsWithValue(a("#mainform"))))})}function d(){}function e(){f(!1);var b=null;j.site.isFromBrochureSite===!0&&1===j.modules.address.getWindowHashAsArray().length?(b=m.startStep.navigationId,n=!0):j.site.journeyStage.length>0&&"latest"===j.site.pageAction?b=m.resultsStep.navigationId:j.site.journeyStage.length>0&&"amend"===j.site.pageAction&&(b=m.startStep.navigationId),a(document).ready(function(){j.modules.journeyEngine.configure({startStepId:b,steps:_.toArray(m)});var a=j.modules.transactionId.get();j.site.isNewQuote===!1?j.messaging.publish(k.tracking.EXTERNAL,{method:"trackQuoteEvent",object:{action:"Retrieve",transactionID:parseInt(a,10),vertical:j.site.vertical}}):j.messaging.publish(k.tracking.EXTERNAL,{method:"trackQuoteEvent",object:{action:"Start",transactionID:parseInt(a,10),vertical:j.site.vertical}})})}function f(a){g(),h(),a&&j.modules.journeyProgressBar.render(!0)}function g(){var b={title:"Fuel Details",navigationId:"start",slideIndex:0,validation:{validate:!0},externalTracking:{method:"trackQuoteForms",object:j.modules.fuel.getTrackingFieldsObject},onInitialise:function(){j.modules.fuelPrefill.initFuelPrefill()},onAfterEnter:function(){n&&(j.modules.journeyEngine.gotoPath("next"),n=!1)}},c={title:"Fuel Prices",navigationId:"results",slideIndex:1,externalTracking:{method:"trackQuoteForms",object:j.modules.fuel.getTrackingFieldsObject},additionalHashInfo:function(){var b=a("#fuel_hidden").val(),c=a("#fuel_location").val().replace(/\s/g,"+");return c+"/"+b},onInitialise:function(a){j.modules.fuelResults.initPage(),j.modules.fuelSorting.initSorting(),j.modules.fuelResultsMap.initFuelResultsMap(),j.modules.fuelCharts.initFuelCharts()},onAfterEnter:function(a){j.modules.fuelResults.get(),j.modules.fuelResultsMap.resetMap()}};m={startStep:b,resultsStep:c}}function h(){j.modules.journeyProgressBar.configure([{label:"Fuel Details",navigationId:m.startStep.navigationId},{label:"Fuel Prices",navigationId:m.resultsStep.navigationId}])}function i(b){try{var c=j.modules.journeyEngine.getCurrentStepIndex(),d=j.modules.journeyEngine.getFurtherestStepIndex(),e=a("#fuel_location").val().split(" "),f="";switch(c){case 0:f="fuel details";break;case 1:f=b===!0?"fuel more info":"fuel results"}var g={actionStep:f,quoteReferenceNumber:j.modules.transactionId.get()};return d>j.modules.journeyEngine.getStepIndex("start")&&_.extend(g,{state:e[e.length-1],postcode:e[e.length-2]}),g}catch(h){return{}}}var j=window.meerkat,k=j.modules.events,l=(j.logging.info,{fuel:{},WEBAPP_LOCK:"WEBAPP_LOCK",WEBAPP_UNLOCK:"WEBAPP_UNLOCK"}),m=null,n=!1;j.modules.register("fuel",{init:c,events:l,initProgressBar:f,getTrackingFieldsObject:i})}(jQuery),function(a,b){function c(){google.load("visualization","1",{packages:["corechart","line"],callback:i})}function d(){return n}function e(){a(document).ready(function(){f(),l=_.template(a("#price-chart-template").html())})}function f(){a(".openPriceHistory").click(function(){c()}),q.messaging.subscribe(r.device.RESIZE_DEBOUNCED,function(){"undefined"!=typeof google&&o&&p&&a(".fuelChart").length&&(n=new google.visualization.LineChart(document.getElementById("linechart_material")),n.draw(o,p))})}function g(a){return a.filter(function(a,b,c){for(var d=0;d<c.length;d++){if("undefined"==typeof c[d].amountObj&&(c[d].amountObj={},c[d].amountObj[c[d].type]=c[d].amount),d==b)return!0;if(c[d].period==a.period)return c[d].amountObj[a.type]=a.amount,!1}return!0})}function h(){var b="Average daily prices <span class='hidden-xs'>for selected fuel types in and</span> around ",c=a("#fuel_location").val();return b+=isNaN(c.substring(1,5))?c:"the postcode: "+c}function i(){k(function(b){q.modules.loadingAnimation.showInside(a("#linechart_material"),!0);var c=a("#fuel_hidden").val().split(",");-1!=c.indexOf("3")&&-1==c.indexOf("9")&&c.push("9"),q.modules.comms.post({url:"ajax/json/fuel_price_monthly_averages.jsp",cache:!0,data:q.modules.form.getSerializedData(a("#mainform")),errorLevel:"warning",onSuccess:function(a){o=new google.visualization.DataTable,o.addColumn("date","Date"),o.addColumn("number",t(c[0])),c[1]&&o.addColumn("number",t(c[1])),c[2]&&o.addColumn("number",t(c[2]));for(var b=g(a.results.prices),d=[],e=0;e<b.length;e++){var f=[new Date(b[e].period),Number(b[e].amountObj[c[0]])/10];c[1]&&f.push(Number(b[e].amountObj[c[1]])/10),c[2]&&f.push(Number(b[e].amountObj[c[2]])/10),d.push(f)}o.addRows(d),p={height:400,legend:{position:"bottom"},axisTitlesPosition:"out",hAxis:{title:"Collected Date",format:"EEE, MMM d"},tooltip:{trigger:"focus"},fontName:"Source Sans Pro",explorer:{axis:"horizontal",actions:["dragToZoom","rightClickToReset"],keepInBounds:!0},vAxis:{title:"Price Per Litre",format:"###.#",gridlines:{color:"#b2b2b2",count:-1}},chartArea:{top:0},colors:["#1c3e93","#0db14b","#b2b2b2"]},n=new google.visualization.LineChart(document.getElementById("linechart_material")),n.draw(o,p),j(c)}})})}function j(b){for(var c=a("#fuel_location").val().split(" "),d="",e=0;e<b.length;e++)d+=":"+t(b[e]);q.messaging.publish(r.tracking.EXTERNAL,{method:"trackCustomPage",object:{customPage:"Fuel:PriceHistory"+d,state:c[c.length-1],postcode:c[c.length-2]}})}function k(a){var b={htmlContent:l({}),hashId:"chart",className:"fuelChart",onOpen:a,title:h()};m=q.modules.dialogs.show(b)}var l,m,n,o,p,q=window.meerkat,r=q.modules.events,s=(q.logging.info,{fuelCharts:{}}),t=(s.fuelCharts,function(a){var b=["Unknown","Unknown","Unleaded","Diesel","LPG","Premium Unleaded 95","E10","Premium Unleaded 98","Bio-Diesel 20","Premium Diesel"];return b[a]});q.modules.register("fuelCharts",{initFuelCharts:e,events:s,getChart:d})}(jQuery),function(a,b){function c(){a(document).ready(function(){f=a("#checkboxes-all input"),d()})}function d(){a(document).on("change","#checkboxes-all input",e)}function e(b){var c=f.filter(":not(:checked)"),d=f.filter(":checked");d.length>=2?c.attr("disabled","disabled"):f.removeAttr("disabled");var e=d.map(function(){return this.value}).get().join(",");a("#fuel_hidden").val(e),a("label[for='fuel_hidden']").remove(),f.removeClass("has-error")}var f,g=window.meerkat,h=g.modules;h.events,g.logging.info;g.modules.register("fuelDetails",{init:c})}(jQuery),function(a,b){function c(){e(),f()}function d(){k=l.modules.address.getWindowHashAsArray()}function e(){h()}function f(){a(document).on("resultsAnimated",g)}function g(){if(n===!1&&k.length>=4&&k[3].match(/^(map-)/g)){var b=k[3].replace("map-","");l.modules.fuelResultsMap.openMap(a(document).find("a[data-siteid='"+b+"']").first()),n=!0}}function h(){("undefined"!=typeof l.site.formData||k.length>=3)&&(i(),j())}function i(){var b;if("undefined"!=typeof k[2]?b=k[2]:"undefined"!=typeof l.site.formData&&"undefined"!=typeof l.site.formData.fuelType&&(b=l.site.formData.fuelType),"undefined"!=typeof b){var c=b.match(/\d,?\d?/g);if(c){var d=b.split(",").slice(0,2);a("#checkboxes-all .checkbox-custom").each(function(){for(var b=0;b<d.length;b++){var c=a(this);c.val()===d[b]&&c.trigger("click")}})}else{var e;switch(b){case"P":e="petrol";break;case"D":e="diesel";break;case"L":e="lpg";break;default:return}a("#checkboxes-"+e).find(".checkbox-custom").slice(0,2).trigger("click")}}}function j(){var b;"undefined"!=typeof k[1]&&"?stage="!==k[1].substr(0,7)?b=k[1].replace(/\+/g," "):"undefined"!=typeof l.site.formData&&"undefined"!=typeof l.site.formData.location&&(b=l.site.formData.location),"undefined"!==b&&a("#fuel_location").val(b)}var k,l=window.meerkat,m=l.modules,n=(m.events,l.logging.info,!1);l.modules.register("fuelPrefill",{initFuelPrefill:c,setHashArray:d})}(jQuery),function(a,b){function c(){d(),f()}function d(){try{var a="price";Results.init({url:"ajax/json/fuel_price_results.jsp",runShowResultsPage:!1,paths:{results:{list:"results.price",general:"results.general"},productId:"productId",productName:"name",productBrandCode:"provider",price:{premium:"priceText"},availability:{product:"available"},sort:{city:"city"}},show:{nonAvailableProducts:!1,unavailableCombined:!0},availability:{product:["equals","Y"],price:["notEquals",-1]},render:{templateEngine:"_",dockCompareBar:!1},displayMode:a,pagination:{mode:"page",touchEnabled:Modernizr.touch},sort:{sortBy:"price.premium",city:"sort.city"},animation:{results:{individual:{active:!1},delay:500,options:{easing:"swing",duration:1e3}},shuffle:{active:!0,options:{easing:"swing",duration:1e3}},filter:{reposition:{options:{easing:"swing"}}}},elements:{features:{values:".content",extras:".children"}},templates:{pagination:{pageText:"Product {{=currentPage}} of {{=totalPages}}"}},rankings:{triggers:["RESULTS_DATA_READY"],callback:e,forceIdNumeric:!1,filterUnavailableProducts:!0},incrementTransactionId:!1})}catch(b){Results.onError("Sorry, an error occurred initialising page","results.tag","meerkat.modules.fuel.initResults(); "+b.message,b)}}function e(a,b){var c={};return c["rank_premium"+b]=a.price,c["rank_productId"+b]=a.productId,c}function f(){q.messaging.subscribe(s.affix.AFFIXED,function(){a("#resultsPage").css("margin-top","35px")}),q.messaging.subscribe(s.affix.UNAFFIXED,function(){a("#resultsPage").css("margin-top","0")}),q.messaging.subscribe(t.RESULTS_ERROR,function(){_.delay(function(){q.modules.journeyEngine.gotoPath("previous")},1e3)}),a(Results.settings.elements.resultsContainer).on("noFilteredResults",function(){Results.view.show()}),a(document).on("resultsReturned",function(){q.modules.utils.scrollPageTo(a("header")),i()}),a(document).on("resultsFetchStart",function(){a("#resultsPage, .loadingDisclaimerText").removeClass("hidden")}),a(document).on("resultsFetchFinish",function(){a(".loadingDisclaimerText").addClass("hidden"),a(document.body).removeClass("priceMode").addClass("priceMode");var b=0;return a.each(Results.model.returnedProducts,function(){"Y"===this.available&&"CURR"!==this.productId&&b++}),0===b&&!Results.model.hasValidationErrors&&Results.model.isBlockedQuote?void n():0===b&&_.isArray(Results.model.returnedProducts)?(m(),void _.delay(function(){q.modules.journeyEngine.gotoPath("previous")},1e3)):"regional"==Results.getReturnedGeneral().source?(Results.view.showNoResults(),void l()):void a(Results.settings.elements.page).show()}),a(Results.settings.elements.resultsContainer).on("click",".result-row",g)}function g(b){if(a(Results.settings.elements.resultsContainer).hasClass("priceMode")!==!1&&"xs"===q.modules.deviceMediaState.get()){var c=a(b.target);c.hasClass("result-row")===!1&&(c=c.parents(".result-row"));var d=c.find(".map-open");q.modules.fuelResultsMap.openMap(d)}}function h(){Results.get(),j()}function i(){var b=Results.getReturnedGeneral();"undefined"!=typeof b.timeDiff&&a("#provider-disclaimer .time").text(b.timeDiff)}function j(){var b=[];a("#checkboxes-all :checked").each(function(){var c="<strong>"+a.trim(a(this).next("label").text())+"</strong>";b.push(c)});var c=b.join(" &amp; "),d=a("#fuel_location").val(),e={fuelTypes:c,location:d},f=_.template(a("#snapshot-template").html(),e,{variable:"data"});a("#resultsSummaryPlaceholder").html(f)}function k(){}function l(){var b=a("#regional-results-template"),c="";if(b.length>0){var d=_.template(b.html());Results.sortBy(Results.settings.sort.city,"asc"),c=d(Results.getSortedResults())}c.length?q.modules.dialogs.show({title:"Regional Price Average",htmlContent:c}):m(),_.delay(function(){q.modules.journeyEngine.gotoPath("previous")},1e3)}function m(){q.modules.dialogs.show({htmlContent:a("#no-results-content")[0].outerHTML})}function n(){q.modules.dialogs.show({htmlContent:a("#blocked-ip-address")[0].outerHTML})}function o(a){return"Last updated "+q.modules.utils.getTimeAgo(a)+" ago"}function p(b){b="undefined"==typeof b?{}:b,q.messaging.publish(s.resultsTracking.TRACK_QUOTE_RESULTS_LIST,{additionalData:a.extend({sortBy:Results.getSortBy()+"-"+Results.getSortDir()},b),onAfterEventMode:"Refresh"})}var q=window.meerkat,r=q.modules,s=r.events,t=(q.logging.info,{});q.modules.register("fuelResults",{init:k,initPage:c,events:t,publishExtraSuperTagEvents:p,get:h,getFormattedTimeAgo:o})}(jQuery),function(a,b){function c(){if("undefined"==typeof u){var a=document.createElement("script");a.type="text/javascript",a.src="https://maps.googleapis.com/maps/api/js?key="+G+"&v=3.exp&signed_in=false&callback=meerkat.modules.fuelResultsMap.initCallback",a.onerror=function(a,b,c){t(a+":"+c,"fuelResultsMap.js:initGoogleAPI")},document.body.appendChild(a)}}function d(){try{var a={zoom:15,minZoom:11,center:i(w,x),mapTypeId:google.maps.MapTypeId.ROAD,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}};n(),u=new google.maps.Map(document.getElementById("map-canvas"),a),v=new google.maps.InfoWindow,j()}catch(b){t(b,"fuelResultsMap.js:initCallback")}}function e(){a(document).ready(function(a){f(),y=_.template(a("#map-marker-template").html()),B=_.template(a("#google-map-canvas-template").html())})}function f(){a(document).on("click",".map-open",function(){g(a(this))})}function g(b){if(w=b.data("lat"),x=b.data("lng"),Results.setSelectedProduct(b.attr("data-productid")),"undefined"==typeof u)c();else{_.keys(H).length||j(),a("#"+z).modal("show"),v.close();var d=Results.getSelectedProduct();A=d.siteid,D.modules.address.appendToHash("map-"+A),d&&(m(H[d.siteid],d),h(i(w,x)))}D.messaging.publish(E.tracking.EXTERNAL,{method:"trackQuoteForms",object:_.bind(D.modules.fuel.getTrackingFieldsObject,this,!0)})}function h(a){u.panTo(a)}function i(a,b){return new google.maps.LatLng(parseFloat(a),parseFloat(b))}function j(){for(var a,b,c,d=k(Results.getFilteredResults()),e=new google.maps.LatLngBounds,f=Results.getSelectedProduct(),g=0;g<d.length;g++){var j=i(d[g].lat,d[g]["long"]),n=l(j,d[g]);H[d[g].siteid]=n,d[g].siteid==f.siteid&&(m(n,d[g]),a=n,b=j,c=d[g]),e.extend(j)}u.fitBounds(e),a&&b&&c&&(h(b),m(a,c))}function k(a){return a.filter(function(a,b,c){for(var d=0;d<c.length;d++){if(d==b)return!0;if(c[d].siteid==a.siteid)return c[d].price2Text?(c[d].price3Text=a.priceText,c[d].price3=a.price,c[d].fuel3Text=a.fuelText):(c[d].price2Text=a.priceText,c[d].price2=a.price,c[d].fuel2Text=a.fuelText),!1}return!0})}function l(a,b,c){var d=new google.maps.Marker({map:u,position:a,icon:"brand/ctm/graphics/fuel/map-pin.png",animation:google.maps.Animation.DROP});return google.maps.event.addListener(d,"click",function(){m(d,b)}),d}function m(a,b){var c="";y?(c=y(b),v.setContent(c),v.open(u,a),D.messaging.publish(E.tracking.EXTERNAL,{method:"trackProductView",object:{productID:b.productId||null,productBrandCode:b.provider||null,productName:(b.name||"")+" "+(b.fuelText||"")}})):t("","An error occurred displaying information for this fuel provider.")}function n(){var b={htmlContent:B(Results.getSelectedProduct()),hashId:"map-"+Results.getSelectedProduct().siteid,className:"googleMap",closeOnHashChange:!1,destroyOnClose:!1,onClose:o,onOpen:p,fullHeight:!0};z=D.modules.dialogs.show(b),C&&google.maps.event.removeListener(C),C=google.maps.event.addDomListener(window,"resize",function(){"undefined"!=typeof google&&a("#"+z).length&&(D.modules.dialogs.resizeDialog(z),p(),google.maps.event.trigger(u,"resize"),u.setCenter(i(w,x)))})}function o(){A&&D.modules.address.removeFromHash("map-"+A)}function p(){_.defer(function(){var b="xs"===D.modules.deviceMediaState.get()?!0:!1,c=a(".googleMap .modal-body"),d=b?c.css("height"):c.css("max-height");a("#google-map-container").css("height",d)})}function q(){v&&v.close(),r()}function r(){var a=_.keys(H);if(a.length){for(var b=0;b<a.length;b++)H[a[b]].setMap(null);H={}}}function s(){return u}function t(a,b){D.modules.errorHandling.error({errorLevel:"warning",message:"An error occurred with loading the Google Map. Please reload the page and try again.",page:b,description:"[Google Maps] Error Initialising Map",data:{error:a.toString()},id:D.modules.transactionId.get()})}var u,v,w,x,y,z,A,B,C,D=window.meerkat,E=D.modules.events,F=(D.logging.info,{fuelResultsMap:{}}),G=(F.fuelResultsMap,"AIzaSyC8ygWPujOpSI1O-7jsiyG3_YIDlPoIP6U"),H={};D.modules.register("fuelResultsMap",{initFuelResultsMap:e,events:F,initCallback:d,resetMap:q,getMap:s,openMap:g})}(jQuery),function(a,b){function c(){d(),a(document).ready(function(){i=a("#sign-up-form"),j.modules.validation.setupDefaultValidationOnForm(i)})}function d(){a(document).on("click","#fuel_signup_terms, #fuel_signup_privacyoptin",e).on("click",".fuel-sign-up",f)}function e(b){var c=a(b.target),d=c.prop("checked")?"Y":"";a("#"+c.attr("id")+"Hidden").val(d).valid()}function f(){if(i.valid()){var b=j.modules.comms.post({errorLevel:"warning",url:"ajax/write/fuel_signup.jsp",dataType:"xml",data:i.serialize()});b.done(function(b){var c=a(b).find("resultcode").text();"0"===c?g():h()}).fail(h)}}function g(){for(var b=i.serializeArray(),c={},d=0;d<b.length;d++){var e=b[d],f=e.name.match(/[a-zA-Z]{1,}$/g)[0];c[f]=e.value}var g=_.template(a("#signup-success-template").html(),c,{variable:"data"});i.html(g)}function h(){i.find(".form-submit-error-message").removeClass("hidden")}var i,j=window.meerkat,k=j.modules;k.events,j.logging.info;j.modules.register("fuelSignup",{init:c})}(jQuery),function(a,b){function c(a){var b=a.attr("data-sort-type"),c=a.attr("data-sort-dir");if("undefined"!=typeof b&&"undefined"!=typeof c){b===Results.getSortBy()&&c===Results.getSortDir()&&(c="asc"===c?"desc":"asc",a.attr("data-sort-dir",c)),Results.setSortByMethod(m[b]);var d=Results.sortBy(b,c);d?(h.parent("li").removeClass("active"),a.parent("li").addClass("active"),i.modules.resultsTracking.setResultsEventMode("Refresh"),i.modules.fuelResults.publishExtraSuperTagEvents({products:[],recordRanking:"N"})):k("[fuelSorting]","The sortBy or sortDir could not be set",setSortByReturn,setSortDirReturn)}else k("[fuelSorting]","No data on sorting element"),i.messaging.publish(j.WEBAPP_UNLOCK)}function d(){i.messaging.subscribe(j.RESULTS_SORTED,function(a){i.messaging.publish(j.WEBAPP_UNLOCK)}),h.on("click",function(b){var d=a(b.target);d.is("a")||(d=d.closest("a")),d.hasClass("disabled")||(i.messaging.publish(j.WEBAPP_LOCK),_.defer(function(){d.parent().hasClass("active")||e(d),c(d)}))}),i.messaging.subscribe(j.WEBAPP_LOCK,function(a){h.addClass("inactive disabled")}),i.messaging.subscribe(j.WEBAPP_UNLOCK,function(a){h.removeClass("inactive disabled")})}function e(a){var b=a.attr("data-sort-type");a.attr("data-sort-dir",l[b])}function f(){a(document).ready(function(){h=a("[data-sort-type]")})}function g(){var b=a("[data-sort-type='price.premium']"),c=Results.getSortBy(),d="price.premium";(c!=d||"desc"==b.attr("data-sort-dir")&&c==d)&&(b.parent("li").siblings().removeClass("active").end().addClass("active").end().attr("data-sort-dir","desc"),Results.setSortBy("price.premium"),Results.setSortDir("desc"))}var h,i=window.meerkat,j=i.modules.events,k=(i.logging.info,i.logging.error),l={"price.premium":"asc"},m={"price.premium":null},n={fuelSorting:{CHANGED:"FUEL_SORTING_CHANGED"}};n.fuelSorting;i.modules.register("fuelSorting",{init:f,initSorting:d,events:n,resetToDefaultSort:g})}(jQuery);
//# sourceMappingURL=fuel.modules.ctm.min.map