/*!
 * CTM-Platform v0.8.3
 * Copyright 2015 Compare The Market Pty Ltd
 * http://www.comparethemarket.com.au/
 */


!function(a,b){function c(){a(document).ready(function(){return"utilities"!==l.site.vertical?!1:(e(),"confirmation"===l.site.pageAction?!1:(l.modules.utilitiesForwardPopulation.configure(),d(),void(("amend"===l.site.pageAction||"latest"===l.site.pageAction||"load"===l.site.pageAction||"start-again"===l.site.pageAction)&&l.modules.form.markInitialFieldsWithValue(a("#mainform")))))})}function d(){}function e(){if("confirmation"===l.site.pageAction)l.modules.journeyEngine.configure(null);else{f(!1);var b=null;l.site.isFromBrochureSite===!0?b=o.startStep.navigationId:l.site.journeyStage.length>0&&"latest"===l.site.pageAction?b=o.resultsStep.navigationId:l.site.journeyStage.length>0&&"amend"===l.site.pageAction&&(b=o.startStep.navigationId),a(document).ready(function(){l.modules.journeyEngine.configure({startStepId:b,steps:_.toArray(o)}),l.site.isNewQuote===!1?l.messaging.publish(m.tracking.EXTERNAL,{method:"trackQuoteEvent",object:{action:"Retrieve"}}):l.messaging.publish(m.tracking.EXTERNAL,{method:"trackQuoteEvent",object:{action:"Start"}})})}}function f(a){g(),h(),a&&l.modules.journeyProgressBar.render(!0)}function g(){var b={title:"Household details",navigationId:"start",slideIndex:0,externalTracking:{method:"trackQuoteForms",object:l.modules.utilities.getTrackingFieldsObject},onInitialise:function(b){a("#utilities_resultsDisplayed_competition_optin").trigger("change.applyValidationRules")},validation:{validate:!0,customValidation:function(b){var c=a("#utilities_householdDetails_whatToCompare").find("input[type=radio]"),d=0;c.each(function(){a(this).prop("disabled")&&d++});var e=3!=d;e||l.modules.utilitiesHouseholdDetailsFields.showErrorOccurred(),b(e)}}},c={title:"Choose a plan",navigationId:"results",slideIndex:1,externalTracking:{method:"trackQuoteForms",object:l.modules.utilities.getTrackingFieldsObject},onInitialise:function(a){l.modules.utilitiesResults.initPage(),l.modules.utilitiesSorting.initSorting(),l.modules.utilitiesMoreInfo.initMoreInfo(),l.modules.utilitiesSnapshot.initUtilitiesSnapshot()},onBeforeEnter:function(b){Results.removeSelectedProduct(),b.isForward===!0&&(l.modules.resultsTracking.setResultsEventMode("Load"),a("#resultsPage").addClass("hidden"),l.modules.utilitiesSorting.resetToDefaultSort(),l.modules.utilitiesSorting.toggleColumns(),l.modules.utilitiesSnapshot.onEnterResults())},onAfterEnter:function(a){a.isForward===!0&&l.modules.utilitiesResults.get()},onAfterLeave:function(a){}},d={title:"Fill out your details",navigationId:"enquiry",slideIndex:2,externalTracking:{method:"trackQuoteForms",object:l.modules.utilities.getTrackingFieldsObject},onInitialise:function(){l.modules.utilitiesEnquirySubmit.initUtilitiesEnquirySubmit()},onBeforeEnter:function(){l.modules.utilitiesSnapshot.onEnterEnquire(),l.modules.utilitiesEnquiryFields.setContent()},onAfterEnter:function(){a("#utilities_application_details_email").trigger("change")}};o={startStep:b,resultsStep:c,enquiryStep:d}}function h(){l.modules.journeyProgressBar.configure([{label:"Household details",navigationId:o.startStep.navigationId},{label:"Choose a plan",navigationId:o.resultsStep.navigationId},{label:"Fill out your details",navigationId:o.enquiryStep.navigationId}])}function i(){var a=Results.getSelectedProduct(),b=l.modules.transactionId.get();l.modules.partnerTransfer.trackHandoverEvent({product:a,type:"ONLINE",quoteReferenceNumber:b,productID:a.productId,productName:a.retailerName,productBrandCode:a.brandCode},{type:"A",productId:a.productId})}function j(b){try{var c="Y"===a("#utilities_resultsDisplayed_optinMarketing").val()?"Y":"N",d="Y"===a("#utilities_resultsDisplayed_optinPhone").val()?"Y":"N",e=l.modules.journeyEngine.getCurrentStepIndex(),f=l.modules.journeyEngine.getFurtherestStepIndex(),g=a("#utilities_resultsDisplayed_email").val(),h=a("#utilities_householdDetails_postcode").val(),i=a("#utilities_householdDetails_state").val(),j="";switch(e){case 0:j="energy household";break;case 1:j=b===!0?"energy more info":"energy choose";break;case 2:j="energy your details"}var k={actionStep:j,quoteReferenceNumber:l.modules.utilitiesResults.getThoughtWorldReferenceNumber()||l.modules.transactionId.get(),email:null,emailID:null,marketOptIn:null,okToCall:null,state:null,postCode:null};return f>l.modules.journeyEngine.getStepIndex("start")&&_.extend(k,{email:g,state:i,postCode:h,marketOptIn:c,okToCall:d}),k}catch(m){return!1}}function k(){return a(".what-to-compare").find("input[type='radio']:checked").val()||null}var l=window.meerkat,m=l.modules.events,n=(l.logging.info,{utilities:{},WEBAPP_LOCK:"WEBAPP_LOCK",WEBAPP_UNLOCK:"WEBAPP_UNLOCK"}),o=null;l.modules.register("utilities",{init:c,events:n,initProgressBar:f,getTrackingFieldsObject:j,getVerticalFilter:k,trackHandover:i})}(jQuery),function(a,b){function c(){a(document).ready(function(a){if("undefined"!=typeof e.site&&"confirmation"===e.site.pageAction)if(confirmationData.hasOwnProperty("confirmation")===!1||confirmationData.confirmation.hasOwnProperty("uniquePurchaseId")===!1){var b="Trying to load the confirmation page failed";confirmationData.hasOwnProperty("confirmation")&&confirmationData.confirmation.hasOwnProperty("message")&&(b=confirmationData.confirmation.message),e.modules.errorHandling.error({message:b,page:"utilitiesConfirmation.js:init",description:"Invalid data",data:confirmationData,errorLevel:"warning"})}else{var c=confirmationData.confirmation;c.product||(c.product={}),d(c),e.messaging.publish(f.tracking.EXTERNAL,{method:"completedApplication",object:{productID:c.product.id||null,productBrandCode:c.product.retailerName||null,productName:c.product.planName||null,quoteReferenceNumber:c.uniquePurchaseId,verticalFilter:c.hasOwnProperty("whatToCompare")?c.whatToCompare:null,transactionID:confirmationTranId||null}})}})}function d(b){var c=a("#confirmation-template");if(c.length){var d=_.template(c.html()),e=d(b);a("#confirmation").html(e)}}var e=window.meerkat,f=e.modules.events;e.modules.register("homeloanConfirmation",{init:c})}(jQuery),function(a){function b(){c()}function c(){a(document).on("change keyup","#utilities_application_details_email",h).on("change","#utilities_application_details_receiveInfoCheck",g).on("change","#utilities_application_details_postalMatch",e).on("change","#utilities_application_details_address_postCode, #utilities_application_details_address_suburbName",d).on("change.residentialAddress",".elasticsearch_container_utilities_application_details_address input, .elasticsearch_container_utilities_application_details_address select",f),a("#utilities_application_details_firstName, #utilities_application_details_lastName").on("change",function(){n.modules.contentPopulation.render(".journeyEngineSlide:eq(2) .snapshot-title")})}function d(b){a(b.target).valid()}function e(b){f(b),a(".elasticsearch_container_utilities_application_details_postal").toggle(!a(b.target).prop("checked"))}function f(b){"utilities_application_details_address_nonStd"===a(b.target).attr("id")&&a(".elasticsearch_container_utilities_application_details_address .error-field label").remove(),a("#utilities_application_details_postalMatch").prop("checked")&&a(".elasticsearch_container_utilities_application_details_postal").find("input, select").each(function(){a(this).val("")})}function g(b){var c=a(b.target),d=c[0].checked?"Y":"N";a("#utilities_application_thingsToKnow_receiveInfo").val(d)}function h(){var b=a("#utilities_resultsDisplayed_email").val(),c=a("#utilities_application_details_email").val(),d=b===c,e=a("#receiveInfoCheckContainer");d&&o?o=!1:d||o||(o=!0),e.toggle(o)}function i(){m(),l(),k();var b=j(a(".elasticsearch_container_utilities_application_details_address")),c=j(a(".elasticsearch_container_utilities_application_details_postal"));b==c&&a("#utilities_application_details_postalMatch").trigger("click")}function j(a){return a.find("input[type='text'], select").serialize().replace(/([a-zA-Z_]{1,})=/g,"").replace(/[&]/g,"")}function k(){var b="Y"===a("#utilities_householdDetails_movingIn").find(":checked").val();a("#enquiry_move_in_date_container").toggle(b)}function l(){var b=Results.getSelectedProduct();if(b){var c="#utilities_application_thingsToKnow_hidden_";a(c+"productId").val(b.productId),a(c+"retailerName").val(b.retailerName),a(c+"planName").val(b.planName)}}function m(){var b=a("#terms-text-template").html(),c=Results.getSelectedProduct(),d=_.template(b,c,{variable:"data"});a("#terms-text-container").html(d)}var n=window.meerkat,o=(n.modules.events,n.logging.info,!1);n.modules.register("utilitiesEnquiryFields",{init:b,setContent:i})}(jQuery),function(a){function b(){a(document).ready(function(){h=a("#submit_btn"),c()})}function c(){h.on("click",function(b){a(".tt-hint").addClass("hidden");var c=j.modules.journeyEngine.isCurrentStepValid();c&&f()}),j.messaging.subscribe(k.WEBAPP_LOCK,d),j.messaging.subscribe(k.WEBAPP_UNLOCK,e)}function d(b){var c="undefined"!=typeof b&&b.source&&"utilitiesEnquiry"===b.source,d="undefined"!=typeof b&&b.disableFields&&b.disableFields===!0;if(h.addClass("disabled"),d===!0){var e=a("#enquiryForm");e.find(":input").prop("disabled",!0),e.find(".select").addClass("disabled"),e.find(".btn-group label").addClass("disabled")}c===!0&&j.modules.loadingAnimation.showAfter(h)}function e(b){a(".tt-hint").removeClass("hidden"),h.removeClass("disabled"),j.modules.loadingAnimation.hide(h);var c=a("#enquiryForm");c.find(":input").prop("disabled",!1),c.find(".select").removeClass("disabled"),c.find(".btn-group label").removeClass("disabled")}function f(){if(i&&"function"==typeof i.status&&"pending"==i.status())return void alert("This page is still being processed. Please wait.");var a=j.modules.journeyEngine.getFormData();j.messaging.publish(l.WEBAPP_LOCK,{source:"utilitiesEnquiry",disableFields:!0}),i=j.modules.comms.post({url:"ajax/json/utilities_submit.jsp",data:a,cache:!1,useDefaultErrorHandling:!1,errorLevel:"fatal",timeout:3e4,onSuccess:function(a){if(a.hasOwnProperty("confirmationkey")===!1)return void g(!1,"","Missing confirmationkey",!1,a);j.messaging.publish(k.tracking.EXTERNAL,{method:"trackQuoteForms",object:j.modules.utilities.getTrackingFieldsObject});var b=a.confirmationkey;j.modules.leavePageWarning.disable(),window.location.href="viewConfirmation?key="+encodeURI(b)},onError:g})}function g(a,b,c,d,e){j.messaging.publish(l.WEBAPP_UNLOCK,{source:"utilitiesEnquiry"}),j.modules.errorHandling.error({message:"<p>An error occurred when attempting to submit your enquiry.</p><p>Please click OK to try again, or call <strong>"+j.site.content.callCentreNumber+"</strong> quoting your reference number <strong>"+j.modules.utilitiesResults.getThoughtWorldReferenceNumber()+"</strong>.</p>",page:"utilitiesEnquirySubmit.js:submitEnquiry()",errorLevel:"warning",description:"Ajax request to "+d.url+" failed to return a valid response: "+c,data:e})}var h,i,j=window.meerkat,k=j.modules.events,l=(j.logging.info,{WEBAPP_LOCK:"WEBAPP_LOCK",WEBAPP_UNLOCK:"WEBAPP_UNLOCK"});j.modules.register("utilitiesEnquirySubmit",{initUtilitiesEnquirySubmit:b,lockSlide:d})}(jQuery),function(a){function b(){}function c(){var b={name:[{$field:a("#utilities_resultsDisplayed_firstName")},{$field:a("#utilities_application_details_firstName")}],email:[{$field:a("#utilities_resultsDisplayed_email")},{$field:a("#utilities_application_details_email")}],moveInDate:[{$field:a("#utilities_householdDetails_movingInDate"),$fieldInput:a("#utilities_householdDetails_movingInDate")},{$field:a("#utilities_application_details_movingDate"),$fieldInput:a("#utilities_application_details_movingDate")}],alternatePhone:[{$field:a("#utilities_resultsDisplayed_phoneinput")},{$field:a("#utilities_application_details_mobileNumberinput"),$fieldInput:a("#utilities_application_details_mobileNumberinput"),$otherField:a("#utilities_application_details_otherPhoneNumberinput"),$otherFieldInput:a("#utilities_application_details_otherPhoneNumberinput")}]};d.modules.contactDetails.configure(b)}var d=window.meerkat;d.modules.events,d.logging.info;d.modules.register("utilitiesForwardPopulation",{init:b,configure:c})}(jQuery),function(a){function b(){"confirmation"!==q.site.pageAction&&(o="undefined"!=typeof providerResults.gasProviders&&providerResults.gasProviders.length||"undefined"!=typeof providerResults.electricityProviders&&providerResults.electricityProviders.length,e(),a(document).ready(function(){p=a("#utilities_resultsDisplayed_phoneinput, #utilities_resultsDisplayed_phone, #utilities_resultsDisplayed_email"),l(),n();var b=q.modules.performanceProfiling.isIos()&&"xs"==q.modules.deviceMediaState.get();b&&c(a("#utilities_householdDetails_howToEstimate"),"How would you like us to estimate how much energy you use?");var e=a("#utilities_householdDetails_location");e.length&&e.val().length&&k(null,{value:e.val()}),d()}))}function c(a,b){if(a.is("select")){var c=a.val();a.find("option").wrapAll('<optgroup label="'+b+'"></optgroup>').end().find("option:first").remove().end().prepend('<option value="">Please choose...</option>').val(c)}}function d(){q.messaging.subscribe(r.journeyEngine.READY,function(){a("#utilities_householdDetails_movingInDate").datepicker("setDaysOfWeekDisabled",[0,6])})}function e(){a(".what-to-compare, .how-to-estimate").change(n),a(".moving-in").change(l),a("#utilities_privacyoptin").change(g),a("#utilities_householdDetails_location").on("typeahead:selected",k),a("#utilities_resultsDisplayed_competition_optin").on("change.applyValidationRules",f),q.modules.ie8SelectMenuAutoExpand.bindEvents(a("#startForm"),"#utilities_householdDetails_howToEstimate")}function f(b){p&&(a(this).prop("checked")?p.attr("required","required"):p.removeAttr("required").each(function(){a(this).valid()}))}function g(b){var c=a(b.target),d=c[0].checked,e=d?"Y":"N";a("#utilities_resultsDisplayed_optinPhone, #utilities_resultsDisplayed_optinMarketing").val(e)}function h(a,b){a.length&&(b?a.removeAttr("disabled").closest("label").removeClass("disabled"):a.removeAttr("checked").attr("disabled","disabled").closest("label").removeClass("active").addClass("disabled"))}function i(a,b){if(b.length){for(var c="",d=0;d<b.length;d++){var e=b[d];c+='<option value="'+e.id+'">'+e.name+"</option>"}a.html(c)}}function j(b){var c=b.electricityProviders,d=b.gasProviders,e=a(".what-to-compare");if(h(e.find("input[value='E']"),c.length),h(e.find("input[value='G']"),d.length),h(e.find("input[value='EG']"),c.length&&d.length),!c.length&&!d.length)return void m();var f=a("#utilities_estimateDetails_usage_electricity_currentSupplier"),g=a("#utilities_estimateDetails_usage_gas_currentSupplier");i(f,c),i(g,d);var j=f.data("default");""!==j&&f.find("option[value='"+j+"']").length&&f.val(j);var k=g.data("default");""!==k&&g.find("option[value='"+k+"']").length&&g.val(k),_.isString(b.electricityTariff)&&a("#utilities_householdDetails_tariff").val(b.electricityTariff)}function k(b,c,d){if("undefined"==typeof c||"undefined"==typeof c.value)return m(),!1;var e=a.trim(String(c.value)),f=e.split(" "),g=f.pop(),h=f.pop(),i=f.join(" ");if(a("#utilities_householdDetails_state").val(g),a("#utilities_householdDetails_postcode").val(h),a("#utilities_householdDetails_suburb").val(i),o)j(providerResults),o=!1;else{var k=q.modules.comms.post({url:"utilities/providers/get.json",data:{postcode:h},errorLevel:"silent"});k.done(function(a){j(a)}).fail(function(){m()})}}function l(){var b=a(".moving-in").find("input[type='radio']:checked").val();a(".moving-in-date").toggle("Y"===b)}function m(){q.modules.dialogs.show({htmlContent:a("#blocked-ip-address")[0].outerHTML})}function n(){var b=a(".additional-estimate-details"),c=a(".additional-estimate-details"),d=c.find(".electricity"),e=c.find(".gas"),f=a(".what-to-compare").find("input[type='radio']:checked").val(),g=a(".how-to-estimate").val();if(f&&g){b.show(),d.toggle("E"===f||"EG"===f),e.toggle("G"===f||"EG"===f),a("#current-electricity-provider-field").toggle("E"===f||"EG"===f),a("#current-gas-provider-field").toggle("G"===f||"EG"===f),g||b.hide();var h=".additional-estimate-details-row";a(h).hide(),"S"===g?a(h+".spend").show():"U"===g?a(h+".usage").show():b.hide()}else b.hide()}var o,p,q=window.meerkat,r=q.modules.events;q.logging.info;q.modules.register("utilitiesHouseholdDetailsFields",{init:b,showErrorOccurred:m})}(jQuery),function(a,b){function c(){var b={container:D,hideAction:"fadeOut",showAction:"fadeIn",modalOptions:{className:"modal-breakpoint-wide modal-tight bridgingContainer",openOnHashChange:!1,leftBtn:{label:"All Products",icon:'<span class="icon icon-arrow-left"></span>',callback:function(b){a(b.currentTarget).closest(".modal").modal("hide")}}},runDisplayMethod:o,onBeforeShowBridgingPage:l,onBeforeShowTemplate:v,onBeforeShowModal:v,onAfterShowModal:u,onAfterShowTemplate:m,onBeforeHideTemplate:null,onAfterHideTemplate:n,onClickApplyNow:q,onBeforeApply:null,onApplySuccess:w,retrieveExternalCopy:p,additionalTrackingData:{productName:null},onBreakpointChangeCallback:_.bind(e,this,".paragraphedContent",".moreInfoRightColumn",D)};A.modules.moreInfo.initMoreInfo(b),h(),d()}function d(){a(document).on("click",".bridgingContainer .btn-call-actions",function(b){var c=a(this);i(b,c)}).on("click",".call-modal .btn-call-actions",function(b){var c=a(this);j(b,c)})}function e(a,b,c){("lg"==A.modules.deviceMediaState.get()||"md"==A.modules.deviceMediaState.get())&&f(a,b,c)}function f(b,c,d){if("xs"!=A.modules.deviceMediaState.get()){var e=a(c,d),f=a(b,d);if(e.length){f.css("min-height","0px"),e.css("min-height","0px");var g=f.outerHeight(),h=e.outerHeight();g>=h?(e.css("min-height",g+"px"),f.css("min-height",g+"px")):(e.css("min-height",h+"px"),f.css("min-height",h+"px"))}}}function g(a,b){r(b)}function h(){A.messaging.subscribe(B.ADDRESS_CHANGE,function(a){"xs"!=A.modules.deviceMediaState.get()&&-1==a.hash.indexOf("results/moreinfo")&&A.modules.moreInfo.hideTemplate(D)}),A.messaging.subscribe(B.device.STATE_ENTER_XS,function(){A.modules.moreInfo.isBridgingPageOpen()&&A.modules.moreInfo.close(),"undefined"!=typeof x&&a("#"+x).modal("hide")}),A.messaging.subscribe(B.device.STATE_LEAVE_XS,function(){A.modules.moreInfo.isModalOpen()&&A.modules.moreInfo.close(),"undefined"!=typeof x&&a("#"+x).modal("hide")}),A.messaging.subscribe(B.errorHandling.OK_CLICKED,function(){(A.modules.moreInfo.isBridgingPageOpen()||A.modules.moreInfo.isModalOpen())&&A.modules.moreInfo.close()}),A.messaging.subscribe(B.transactionId.CHANGED,function(){E=!0})}function i(b,c){b.preventDefault(),b.stopPropagation();var d=c,e=a("#utilities-call-modal-template");e.length>0&&(templateCallback=_.template(e.html()));var h=Results.getResultByProductId(d.attr("data-productId"));if("undefined"!=typeof h&&"Y"===h.available){z=d.attr("data-callback-toggle");var i=A.modules.sessionCamHelper.getMoreInfoStep(z),j=templateCallback(h),k={htmlContent:j,hashId:"call",className:"call-modal "+h.brandCode,closeOnHashChange:!0,openOnHashChange:!1,onOpen:function(c){a("."+z).show(),f(".paragraphedContent:visible",".sidebar-right",a("#"+c)),d.hasClass("btn-calldirect")&&g(b,h),A.modules.sessionCamHelper.updateVirtualPage(i)},onClose:function(a){A.modules.sessionCamHelper.setMoreInfoModal()}};"xs"==A.modules.deviceMediaState.get()&&(k.title="Reference no. "+A.modules.utilitiesResults.getThoughtWorldReferenceNumber()),x=A.modules.dialogs.show(k)}}function j(b,c){"xs"!=A.modules.deviceMediaState.get()&&b.preventDefault(),b.stopPropagation();var d=c,e=Results.getResultByProductId(d.attr("data-productId"));z=d.attr("data-callback-toggle");var h=A.modules.sessionCamHelper.getMoreInfoStep(z);switch(z){case"calldirect":a(".callback").hide(),a(".calldirect").show(),g(b,e)}f(".paragraphedContent:visible",".sidebar-right",d.closest(".modal.in")),A.modules.sessionCamHelper.updateVirtualPage(h)}function k(){y=a(window).scrollTop()}function l(){k(),"xs"!=A.modules.deviceMediaState.get()&&(a(".resultsContainer").hide(),a(".sortbar-container").addClass("hidden"))}function m(){u(),("lg"==A.modules.deviceMediaState.get()||"md"==A.modules.deviceMediaState.get())&&f(".paragraphedContent",".moreInfoRightColumn",D)}function n(){a(".resultsContainer").show(),a(".sortbar-container").removeClass("hidden"),a(window).scrollTop(y)}function o(a){"xs"!=A.modules.deviceMediaState.get()?A.modules.moreInfo.showTemplate(D):A.modules.moreInfo.showModal(),A.modules.address.appendToHash("moreinfo")}function p(a){return A.modules.comms.post({url:"utilities/moreinfo/get.json",cache:!0,data:{productId:a.productId},errorLevel:"silent",onSuccess:function(a){A.modules.moreInfo.setDataResult(a)}})}function q(b,c){Results.model.setSelectedProduct(a(".btn-more-info-apply").attr("data-productId")),A.modules.utilities.trackHandover(),A.modules.journeyEngine.gotoPath("next")}function r(a){E===!0&&(E=!1,s("CrCallDir",a))}function s(a,b){A.modules.partnerTransfer.trackHandoverEvent({product:b,type:a,quoteReferenceNumber:A.modules.utilitiesResults.getThoughtWorldReferenceNumber()||A.modules.transactionId.get(),productID:b.productId,productName:b.planName,productBrandCode:b.brandCode},{type:"CD",productId:b.productId})}function t(){A.messaging.publish(B.tracking.EXTERNAL,{method:"trackQuoteForms",object:_.bind(A.modules.utilities.getTrackingFieldsObject,this,!0)})}function u(){var a={additionalTrackingData:{productName:Results.getSelectedProduct().planName}};A.modules.moreInfo.updateSettings(a),t()}function v(b){if(null!==b&&"undefined"!=typeof b){for(var c in b)b.hasOwnProperty(c)&&a("#"+c).length&&a("#"+c).html(b[c]);a(".contentRow li").each(function(){a(this).prepend('<span class="icon icon-angle-right"></span>')}),"undefined"!=typeof b.termsUrl&&a(".termsUrl").attr("href",b.termsUrl),"undefined"!=typeof b.privacyPolicyUrl&&a(".privacyPolicyUrl").attr("href",b.privacyPolicyUrl)}}function w(a){}var x,y,z,A=window.meerkat,B=A.modules.events,C={utilitiesMoreInfo:{}},D=(C.utilitiesMoreInfo,a(".bridgingContainer")),E=!0;A.modules.register("utilitiesMoreInfo",{initMoreInfo:c,events:C,runDisplayMethod:o,setScrollPosition:k,retrieveExternalCopy:p})}(jQuery),function(a){function b(){c(),g()}function c(){try{Results.init({url:"ajax/json/utilities_quote_results.jsp",runShowResultsPage:!1,paths:{results:{list:"results.plans",general:"results.uniqueCustomerId"},productId:"productId",productName:"planName",productBrandCode:"retailerName",contractPeriodValue:"contractPeriodValue",totalDiscountValue:"totalDiscountValue",yearlySavingsValue:"yearlySavingsValue",availability:{product:"productAvailable"}},show:{nonAvailableProducts:!1,unavailableCombined:!0},availability:{product:["equals","Y"]},render:{templateEngine:"_",dockCompareBar:!1},displayMode:"price",pagination:{touchEnabled:!1},sort:{sortBy:"totalDiscountValue",sortByMethod:q.modules.utilitiesSorting.sortDiscounts,sortDir:"desc"},animation:{results:{individual:{active:!1},delay:500,options:{easing:"swing",duration:1e3}},shuffle:{active:!0,options:{easing:"swing",duration:1e3}},filter:{reposition:{options:{easing:"swing"}}}},rankings:{triggers:["RESULTS_DATA_READY"],callback:f,forceIdNumeric:!1,filterUnavailableProducts:!0}})}catch(a){Results.onError("Sorry, an error occurred initialising page","results.tag","meerkat.modules.utilitiesResults.initResults(); "+a.message,a)}}function d(b){if(_.isArray(b)&&b.length>0&&_.isArray(b[0]))return b=[{productAvailable:"N"}];var c=a(".what-to-compare").find("input[type='radio']:checked").val()||null;return _.each(b,function(a,b){a.productAvailable="Y",a.brandCode=a.retailerName,a.productId=a.planId,"EG"==c?(a.discountElectricity=0,a.discountGas=0,a.discountOther=0,a.totalDiscountValue=e(a,a.payontimeDiscounts)+e(a,a.ebillingDiscounts)+e(a,a.guaranteedDiscounts)+e(a,a.otherDiscounts)):a.totalDiscountValue=Number(a.payontimeDiscounts)+Number(a.ebillingDiscounts)+Number(a.guaranteedDiscounts)+Number(a.otherDiscounts),a.contractPeriodValue=-1!=a.contractPeriod.indexOf("Year")?parseInt(a.contractPeriod.replace(/[^\d]/g,""),10):0,a.yearlySavingsValue="undefined"==typeof a.yearlySavings||null===a.yearlySavings?0:a.yearlySavings,a.yearlySavingsValue=Number(a.yearlySavingsValue.toFixed(2))}),b}function e(a,b){var c=Number(b);if(!isNaN(c))return a.discountOther+=c,c;var d=b.match(/(Electricity)\s\-\s([0-9]{1,2})\%\sand\s(Gas)\s\-\s([0-9]{1,2})\%/);if(5===d.length){a.discountElectricity+=Number(d[2]),a.discountGas+=Number(d[4]);var e=a.discountElectricity+a.discountGas;return isNaN(e)?0:e}return 0}function f(a,b){var c={};return c["rank_productId"+b]=a.productId,c}function g(){q.messaging.subscribe(Results.model.moduleEvents.RESULTS_MODEL_UPDATE_BEFORE_FILTERSHOW,function(){Results.model.returnedProducts=d(Results.model.returnedProducts),Results.model.sortedProducts=Results.model.returnedProducts}),q.messaging.subscribe(r.affix.AFFIXED,function(){p.css("margin-top","8px")}),q.messaging.subscribe(r.affix.UNAFFIXED,function(){p.css("margin-top","0")}),a(Results.settings.elements.resultsContainer).on("noFilteredResults",function(){Results.view.show()}),q.messaging.subscribe(s.RESULTS_ERROR,function(){_.delay(function(){q.modules.journeyEngine.gotoPath("previous")},1e3)}),a(document).on("resultsReturned",function(){q.modules.utils.scrollPageTo(a("header"))}),a(document).on("resultsFetchStart",function(){q.modules.journeyEngine.loadingShow("...getting your quotes..."),p.removeClass("hidden"),Results.pagination.hide()}),a(document).on("resultsFetchFinish",function(){a(Results.settings.elements.page).show(),q.modules.journeyEngine.loadingHide(),a(document.body).addClass("priceMode")}),a(Results.settings.elements.resultsContainer).on("noResults",function(){k()}),a(document).on("generalReturned",function(){t=Results.getReturnedGeneral(),a(".thoughtWorldRefNoContainer").html("Reference no. "+t),a("#utilities_partner_uniqueCustomerId").val(t)}),a(Results.settings.elements.resultsContainer).on("click",".result-row",i),a(document.body).on("click",".btn-apply",h)}function h(b){b.preventDefault();var c=a(b.target);c.hasClass("result-row")===!1&&(c=c.parents(".result-row")),"undefined"!=typeof c.attr("data-available")&&"Y"===c.attr("data-available")&&(c.attr("data-productId")&&Results.setSelectedProduct(c.attr("data-productId")),q.modules.utilities.trackHandover(),q.modules.moreInfo.setProduct(Results.getResult("productId",c.attr("data-productId"))),q.modules.utilitiesMoreInfo.retrieveExternalCopy(Results.getSelectedProduct()).done(function(){q.modules.journeyEngine.gotoPath("next",c.find(".btn-apply"))}))}function i(b){if(a(Results.settings.elements.resultsContainer).hasClass("priceMode")!==!1&&"xs"===q.modules.deviceMediaState.get()){var c=a(b.target);c.hasClass("result-row")===!1&&(c=c.parents(".result-row")),"undefined"!=typeof c.attr("data-available")&&"Y"===c.attr("data-available")&&(q.modules.moreInfo.setProduct(Results.getResult("productId",c.attr("data-productId"))),q.modules.utilitiesMoreInfo.runDisplayMethod())}}function j(){Results.get()}function k(){q.modules.dialogs.show({htmlContent:a("#no-results-content")[0].outerHTML})}function l(b){b="undefined"==typeof b?{}:b,q.messaging.publish(r.resultsTracking.TRACK_QUOTE_RESULTS_LIST,{additionalData:a.extend({sortBy:Results.getSortBy()+"-"+Results.getSortDir()},b),onAfterEventMode:"Refresh"})}function m(){a(document).ready(function(){p=a("#resultsPage"),q.messaging.subscribe(r.RESULTS_RANKING_READY,l)})}function n(){return a("#utilities_householdDetails_movingIn_N").prop("checked")}function o(){return t}var p,q=window.meerkat,r=q.modules.events,s=(q.logging.info,{RESULTS_ERROR:"RESULTS_ERROR"}),t="";q.modules.register("utilitiesResults",{init:m,initPage:b,get:j,showNoResults:k,publishExtraSuperTagEvents:l,showYearlySavings:n,getThoughtWorldReferenceNumber:o})}(jQuery),function(a,b){function c(){i=a(".snapshotSituation"),j=a(".product-snapshot")}function d(){g(),h()}function e(){f()}function f(){var b=a("#results-summary-template").html(),c={};c.postcode="Postcode "+a("#utilities_householdDetails_location").val().match(/\d+/)[0];var d=a(".what-to-compare :checked").val(),e="S"===a(".how-to-estimate").val();if("E"===d||"EG"===d)if(e)c.electricitySpend="$"+a("#utilities_estimateDetails_spend_electricity_amount").val()+" / "+a("#utilities_estimateDetails_spend_electricity_period").children("option").filter(":selected").text();else{var f=a("#utilities_estimateDetails_usage_electricity_peak_amount").val(),g=a("#utilities_estimateDetails_usage_electricity_peak_period").children("option").filter(":selected").text(),h=a("#utilities_estimateDetails_usage_electricity_offpeak_amount").val(),i=a("#utilities_estimateDetails_usage_electricity_offpeak_period").children("option").filter(":selected").text();c.electricityPeak=f+"kWh/"+g,c.electricityOffPeak=(""!==h?h:0)+"kWh/"+i}if("G"===d||"EG"===d)if(e)c.gasSpend="$"+a("#utilities_estimateDetails_spend_gas_amount").val()+" / "+a("#utilities_estimateDetails_spend_gas_period").children("option").filter(":selected").text();else{var j=a("#utilities_estimateDetails_usage_gas_peak_amount").val(),k=a("#utilities_estimateDetails_usage_gas_peak_period").children("option").filter(":selected").text(),l=a("#utilities_estimateDetails_usage_gas_offpeak_amount").val(),m=a("#utilities_estimateDetails_usage_gas_offpeak_period").children("option").filter(":selected").text();c.gasPeak=j+"MJ/"+k,c.gasOffPeak=(""!==l?l:0)+"MJ/"+m}c.isSpendEstimate=e,c.segmentClass=e?"spend":"usage";var n=_.template(b,c,{variable:"data"});return a("#results-summary-container").html(n),n}function g(){i.html(f()),k.modules.contentPopulation.render(".journeyEngineSlide:eq(2) .snapshot")}function h(){var b=Results.getSelectedProduct();if(b!==!1){var c=a("#enquire-snapshot-template").html(),d=_.template(c),e=d(b);j.html(e)}else j.empty()}var i,j,k=window.meerkat,l=(k.modules.events,k.logging.info,{utilitiesSnapshot:{}});k.modules.register("utilitiesSnapshot",{initUtilitiesSnapshot:c,events:l,onEnterEnquire:d,onEnterResults:e})}(jQuery),function(a,b){function c(a){var b=a.attr("data-sort-type"),c=a.attr("data-sort-dir");if("undefined"!=typeof b&&"undefined"!=typeof c){b===Results.getSortBy()&&c===Results.getSortDir()&&(c="asc"===c?"desc":"asc",a.attr("data-sort-dir",c)),Results.setSortByMethod(q[b]);var d=Results.sortBy(b,c);d?(l.parent("li").removeClass("active"),a.parent("li").addClass("active"),m.modules.resultsTracking.setResultsEventMode("Refresh"),m.modules.utilitiesResults.publishExtraSuperTagEvents({products:[],recordRanking:"N"})):o("[utilitiesSorting]","The sortBy or sortDir could not be set",setSortByReturn,setSortDirReturn)}else o("[utilitiesSorting]","No data on sorting element")}function d(){m.messaging.subscribe(n.RESULTS_SORTED,function(a){m.messaging.publish(n.WEBAPP_UNLOCK)}),l.on("click",function(b){var d=a(b.target);d.is("a")||(d=d.closest("a")),d.hasClass("disabled")||(m.messaging.publish(n.WEBAPP_LOCK),_.defer(function(){d.parent().hasClass("active")||e(d),c(d)}))}),m.messaging.subscribe(n.WEBAPP_LOCK,function(a){l.addClass("inactive disabled")}),m.messaging.subscribe(n.WEBAPP_UNLOCK,function(a){l.removeClass("inactive disabled")})}function e(a){var b=a.attr("data-sort-type");a.attr("data-sort-dir",p[b])}function f(){a(document).ready(function(){l=a("[data-sort-type]"),"undefined"==typeof Results&&m.logging.exception("[utilitiesSorting]","No Results Object Found!")})}function g(){var b=a("[data-sort-type='totalDiscountValue']"),c=Results.getSortBy(),d="totalDiscountValue";(c!=d||"asc"==b.attr("data-sort-dir")&&c==d)&&(b.parent("li").siblings().removeClass("active").end().addClass("active").end().attr("data-sort-dir","desc"),Results.setSortBy("totalDiscountValue"),Results.setSortDir("desc"))}function h(){var b=a(".colTotalDiscounts"),c=a(".colYearlySavings"),d=a(".colContractPeriod");m.modules.utilitiesResults.showYearlySavings()?(c.removeClass("hidden"),d.removeClass("col-sm-5 col-lg-2").addClass("col-sm-3 col-lg-1"),b.removeClass("col-sm-5 col-lg-3").addClass("col-sm-4 col-lg-2")):(c.addClass("hidden"),d.removeClass("col-sm-3 col-lg-1").addClass("col-sm-5 col-lg-2"),b.removeClass("col-sm-4 col-lg-2").addClass("col-sm-5 col-lg-3"))}function i(a,b){return b>a?-1:a>b?1:0;
}function j(a,b){var c,d=a.totalDiscountValue,e=b.totalDiscountValue;if(isNaN(d))return 1;if(isNaN(e))return-1;if(c=i(d,e),0===c){var f=a.yearlySavingsValue,g=b.yearlySavingsValue;c=i(f,g)}return"desc"==Results.settings.sort.sortDir&&(c*=-1),c}function k(a,b){var c,d=a.contractPeriodValue,e=b.contractPeriodValue;if(isNaN(d))return 1;if(isNaN(e))return-1;if(c=i(d,e),0===c){var f=a.totalDiscountValue,g=b.totalDiscountValue;c=i(g,f)}if(0===c){var h=a.yearlySavingsValue,j=b.yearlySavingsValue;c=i(j,h)}return"desc"==Results.settings.sort.sortDir&&(c*=-1),c}var l,m=window.meerkat,n=m.modules.events,o=(m.logging.info,m.logging.error),p={contractPeriodValue:"asc",totalDiscountValue:"desc",yearlySavingsValue:"desc"},q={contractPeriodValue:k,totalDiscountValue:j,yearlySavingsValue:null},r={utilitiesSortings:{CHANGED:"UTILITIES_SORTING_CHANGED"}};r.utilitiesSorting;m.modules.register("utilitiesSorting",{init:f,initSorting:d,events:r,resetToDefaultSort:g,toggleColumns:h,sortDiscounts:j,sortContracts:k})}(jQuery);
//# sourceMappingURL=utilities.modules.ctm.min.map