/*!
 * CTM-Platform v0.8.3
 * Copyright 2014 Compare The Market Pty Ltd
 * http://www.comparethemarket.com.au/
 */


!function(){function a(){jQuery(document).ready(function(){"undefined"!=typeof b.site&&"confirmation"===b.site.pageAction&&b.messaging.publish(c.tracking.EXTERNAL,{method:"completedApplication",object:{}})})}{var b=window.meerkat,c=b.modules.events,d=(b.logging.info,{confirmation:{}});d.confirmation}b.modules.register("confirmation",{init:a,events:d})}(jQuery),function(a){function b(){if("confirmation"===j.site.pageAction)j.modules.journeyEngine.configure(null);else{c(!1),j.modules.journeyEngine.configure({startStepId:null,steps:_.toArray(n)});var a=j.modules.transactionId.get();j.messaging.publish(k.tracking.EXTERNAL,{method:"trackQuoteEvent",object:{action:"Start",transactionID:parseInt(a,10)}})}}function c(){d()}function d(){var b={title:"Your Situation",navigationId:"situation",slideIndex:0,externalTracking:{method:"trackQuoteForms",object:j.modules.homeloan.getTrackingFieldsObject},onInitialise:function(){a("#submit_btn").on("click",function(){var a=j.modules.journeyEngine.isCurrentStepValid();a&&e()})}};n={startStep:b}}function e(){if(m===!0)return void alert("This page is still being processed. Please wait.");m=!0,j.messaging.publish(l.WEBAPP_LOCK,{source:"submitToAFG",disableFields:!0});var a=j.modules.journeyEngine.getFormData();j.modules.comms.post({url:"ajax/json/homeloan_submit.jsp",data:a,cache:!1,useDefaultErrorHandling:!1,errorLevel:"fatal",timeout:25e4,onSuccess:function(a){m=!1,j.messaging.publish(k.tracking.EXTERNAL,{method:"trackQuoteForms",object:j.modules.homeloan.getTrackingFieldsObject});var b=a.response;window.location.href=b.redirect_url+"?data="+b.json},onError:f,onComplete:function(){m=!1}})}function f(a,b,c,d,e){m=!1,j.messaging.publish(l.WEBAPP_UNLOCK,{source:"submitToAFG"}),j.modules.errorHandling.error({message:"An error occurred when attempting to store data before proceeding to step 2.",page:"homeloan.js:submitToAFG()",errorLevel:"warning",description:"Ajax request to homeloan_submit.jsp failed to return a valid response: "+c,data:e})}function g(){var b="your situation",c=a("#homeloan_details_state").val(),d=a("#homeloan_details_postcode").val(),e=a("#homeloan_contact_email").val(),f=_.isUndefined(a("#homeloan_contact_optIn:checked").val())?"N":"Y",g=j.modules.transactionId.get(),h={vertical:"homeloan",actionStep:b,transactionID:g,quoteReferenceNumber:g,postCode:d,state:c,gender:null,yearOfBirth:null,email:e,marketOptIn:f};return h}function h(){j.site.isFromBrochureSite===!0&&_.defer(function(){j.site.brochureValues.hasOwnProperty("situation")&&1===a("#homeloan_details_situation_"+j.site.brochureValues.situation).length&&a("#homeloan_details_situation").val(j.site.brochureValues.situation),j.site.brochureValues.hasOwnProperty("location")&&a("#homeloan_details_location").val(j.site.brochureValues.location)})}function i(){a(document).ready(function(){return"homeloan"!==j.site.vertical?!1:(h(),void b())})}var j=window.meerkat,k=j.modules.events,l={WEBAPP_LOCK:"WEBAPP_LOCK",WEBAPP_UNLOCK:"WEBAPP_UNLOCK"},m=!1,n=null;j.modules.register("homeloan",{init:i,events:l,initProgressBar:c,getTrackingFieldsObject:g})}(jQuery),function(a){function b(){g.on("change",function(){a(this).is(":checked")?(d.attr("required","required").valid(),e.attr("required","required").valid(),f.attr("required","required").valid()):(d.removeAttr("required").valid(),e.removeAttr("required").valid(),f.removeAttr("required").valid())})}function c(){a(document).ready(function(){d=a("#homeloan_contact_firstName"),e=a("#homeloan_contact_lastName"),f=a("#homeloan_contact_email"),g=a("#homeloan_contact_optIn"),d.removeAttr("required"),e.removeAttr("required"),f.removeAttr("required"),b()})}{var d,e,f,g,h=window.meerkat;h.modules.events,h.logging.info}h.modules.register("homeloanContactDetails",{init:c})}(jQuery);
//# sourceMappingURL=homeloan.modules.ctm.min.map