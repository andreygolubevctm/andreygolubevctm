/*!
 * CTM-Platform v0.8.3
 * Copyright 2015 Compare The Market Pty Ltd
 * http://www.comparethemarket.com.au/
 */


!function(){function a(){if(b.site&&"undefined"!=typeof b.site.urls){if("undefined"!=typeof b.site.urls.context)return"/"+b.site.urls.context;if("undefined"!=typeof b.site.urls.base)return b.site.urls.base}}{var b=window.meerkat;b.logging.info}b.modules.register("simples",{getBaseUrl:a})}(jQuery),function(a){function b(){a(document).ready(function(){v=a("nav .simples-homebutton");var b=a("[data-provide='simples-quote-actions']");b.length>0&&(b.each(function(){u=a(this),u.on("click",".action-complete",function(){return a(this).parent("li").hasClass("disabled")?!1:void d("complete")}),u.on("click",".action-unsuccessful",function(){return a(this).parent("li").hasClass("disabled")?!1:void d("unsuccessful")}),u.on("click",".action-postpone",function(){return a(this).parent("li").hasClass("disabled")?!1:void e(!1,"postpone")}),u.on("click",".action-comment",function(){return a(this).parent("li").hasClass("disabled")?!1:void f()}),u.on("click",".action-remove-pm",function(){return a(this).parent("li").hasClass("disabled")?!1:void d("remove_pm")}),u.on("click",".action-complete-pm",function(){return a(this).parent("li").hasClass("disabled")?!1:void e(!0,"complete_pm")}),u.on("click",".action-change-time",function(){return a(this).parent("li").hasClass("disabled")?!1:void e(!0,"change_time")})}),o.messaging.subscribe(o.modules.events.simplesInterface.TRANSACTION_ID_CHANGE,function(a){q=a||!1,c()}),o.messaging.subscribe(o.modules.events.simplesMessage.MESSAGE_CHANGE,function(a){r=a||!1,r.hasOwnProperty("transaction")&&(q=r.transaction.transactionId),c()}),$e=a("#simples-template-comments"),$e.length>0&&(s=_.template($e.html())),$e=a("#simples-template-postpone"),$e.length>0&&(t=_.template($e.html()))),a('input[name="health_simples_hawking"]').on("change",function(){k(a('input[name="health_simples_hawking"]:checked').val())})})}function c(){var a=!1,b=u.find(".simples-show-transactionid"),c=u.find(".simples-show-messageid"),d=u.find(".action-complete").parent("li"),e=u.find(".action-unsuccessful").parent("li"),f=u.find(".action-postpone").parent("li"),g=u.find(".action-comment").parent("li"),h=u.find(".action-complete-pm").parent("li"),j=u.find(".action-change-time").parent("li"),k=u.find(".action-remove-pm").parent("li");q!==!1?(a=!0,b.text(q),g.removeClass("disabled")):(a=!1,b.text("None"),g.addClass("disabled")),r===!1||isNaN(r.message.messageId)?(a===!1&&(a=!1),c.text("None"),d.addClass("disabled"),e.addClass("disabled"),f.addClass("disabled"),h.addClass("disabled"),j.addClass("disabled"),k.addClass("disabled")):(a=!0,c.text(r.message.messageId),d.removeClass("disabled"),e.removeClass("disabled"),k.removeClass("disabled"),r.message.hasOwnProperty("canPostpone")&&r.message.canPostpone===!0?(f.removeClass("disabled"),h.removeClass("disabled"),j.removeClass("disabled")):(f.addClass("disabled"),h.addClass("disabled"),j.addClass("disabled")),i()?(k.show(),j.show(),d.hide(),h.hide(),f.hide(),e.hide()):(k.hide(),j.hide(),d.show(),h.show(),f.show(),e.show())),a?u.removeClass("hidden"):u.addClass("hidden")}function d(b){if(b){var c=0;"complete"===b?c=2:"unsuccessful"===b?c=6:"remove_pm"===b&&(c=33,b="complete"),p=o.modules.dialogs.show({title:" ",url:"simples/ajax/message_statuses.html.jsp?parentStatusId="+c,buttons:[{label:"Cancel",className:"btn-cancel",closeWindow:!0},{label:"OK",className:"btn-cta message-savebutton",closeWindow:!1}],onOpen:function(b){p=b;var c=a("#"+p).find(".message-savebutton");c.prop("disabled",!0)},onLoad:function(){var d=a("#"+p),e=d.find(".message-savebutton");d.find("input[type=radio]").on("change",function(){e.prop("disabled",!1)}),e.on("click",function(){e.prop("disabled",!0),o.modules.loadingAnimation.showInside(e,!0);var a=d.find("input[type=radio]:checked").val();o.modules.simplesMessage.performFinish(b,{statusId:c,reasonStatusId:a},function(){v.length>0&&v[0].click(),o.modules.dialogs.close(p)})})}})}}function e(b,c){if(c){var d=0,e="";"postpone"===c?(d=4,e="Postpone this message"):"complete_pm"===c?(d=31,e="Complete as PM"):"change_time"===c&&(d=32,e="Change Time"),e=encodeURIComponent(e),o.modules.dialogs.show({title:" ",className:_.indexOf([31,32],d)>=0?"simples-messagescolumn-dialog":"simples-postpone-dialog",buttons:[{label:"Cancel",className:"btn-cancel",closeWindow:!0},{label:"Postpone",className:"btn-save btn-cta message-savebutton",closeWindow:!1}],onOpen:function(c){p=c;var f=a("#"+p),g=f.find(".message-savebutton");g.prop("disabled",!0),o.modules.dialogs.changeContent(p,o.modules.loadingAnimation.getTemplate()),o.modules.comms.get({url:"simples/ajax/message_statuses.json.jsp?parentStatusId="+d+"&heading="+e,dataType:"json",cache:!0,errorLevel:"silent"}).done(function(a){a.parentStatusId=d,h(a,t)}).fail(function(){h(null,t)}).always(function(){g.prop("disabled",!1),a("#postponehour").val("04");var c=function(a){return a.getFullYear()+"-"+("0"+(a.getMonth()+1)).slice(-2)+"-"+("0"+a.getDate()).slice(-2)},e=new Date,h=c(e);e.setMonth(e.getMonth()+6);var i=c(e),k=f.find("#postponedate_calendar");k.datepicker({startDate:h,endDate:i,clearBtn:!1,format:"yyyy-mm-dd"}).find("table").addClass("table"),f.on("changeDate",k,function(a){f.find("#postponedate").val(a.format("yyyy-mm-dd"))}),g.on("click",function(){g.prop("disabled",!0),o.modules.loadingAnimation.showInside(g,!0);var a={postponeDate:f.find("#postponedate").val(),postponeTime:f.find("#postponehour").val()+":"+f.find("#postponeminute").val(),postponeAMPM:f.find('input[name="postponeampm"]:checked').val(),statusId:d,reasonStatusId:f.find('select[name="reason"]').val(),comment:f.find("textarea").val(),assignToUser:b};return _.isString(a.postponeDate)&&0!==a.postponeDate.length&&_.isString(a.postponeAMPM)&&0!==a.postponeAMPM.length?void o.modules.simplesMessage.performFinish("postpone",a,function(){v.length>0&&v[0].click(),o.modules.dialogs.close(p)},function(){g.prop("disabled",!1),o.modules.loadingAnimation.hide(g)}):(o.modules.dialogs.show({title:" ",htmlContent:"Please check fields: date, time and AM/PM.",buttons:[{label:"OK",className:"btn-cta",closeWindow:!0}]}),g.prop("disabled",!1),void o.modules.loadingAnimation.hide(g))});var l=f.find(".personal-messages-container");l.empty(),o.modules.simplesPostponedQueue.initDateStuff();var m=document.getElementById("simplesiframe").contentWindow.meerkat.modules.simplesPostponedQueue.getMessageQueue();if(!_.isEmpty(m))for(var n=0;n<m.length;n++)l.append(a("<span/>").addClass("well").append(a("<strong/>").append(m[n].contactName)).append(":&nbsp;"+j(m[n].whenToAction)))})}})}}function f(){g(function(){o.modules.dialogs.changeContent(p,o.modules.loadingAnimation.getTemplate())}),o.modules.comms.get({url:"simples/comments/list.json",cache:!1,errorLevel:"silent",data:{transactionId:q},onSuccess:function(a){h(a,s)},onError:function(a,b,c){var d={errors:[{message:b+": "+c}]};h(d,s)}})}function g(a){p=o.modules.dialogs.show({title:" ",fullHeight:!0,onOpen:function(b){p=b,"function"==typeof a&&a()}})}function h(a,b){var c="No template found.";a=a||{},"function"==typeof b&&(c=b(a)),o.modules.dialogs.changeContent(p,c)}function i(){if(r.hasOwnProperty("messageaudits"))for(var a=0;a<r.messageaudits.length;a++){var b=r.messageaudits[a];if(b.hasOwnProperty("statusId")&&31===b.statusId)return!0}return!1}function j(a){var b=Date.parse(a)||!1;if(b!==!1){b=new Date(b);var c="am",d=b.getHours();10>d?d="0"+d:12==d?c="pm":d>12&&(c="pm",d-=12);var e=b.getMinutes()<10?"0"+b.getMinutes():b.getMinutes();return b.getDayNameShort()+" "+b.getDate()+" "+b.getMonthNameShort()+" "+d+":"+e+c}return a}function k(a){a="ON"==a?1:0,o.modules.comms.get({url:"hawking/toggle",cache:!1,errorLevel:"silent",data:{status:a},onSuccess:function(){console.log("Hawking Changed to "+a)},onError:function(){console.log("Hawking Status update FAILED for "+a)}})}function l(){o.modules.comms.get({url:"simples/hawking/get.json",cache:!1,errorLevel:"silent",onSuccess:function(a){n(a.status)},onError:function(){console.log("Failed to get Hawking Status")}})}function m(){l()}function n(b){1===b?(a("#simplesiframe").contents().find('input[name="health_simples_hawking"]').filter("[value=ON]").parent().addClass("active"),a("#simplesiframe").contents().find('input[name="health_simples_hawking"]').filter("[value=OFF]").parent().removeClass("active")):0===b?(a("#simplesiframe").contents().find('input[name="health_simples_hawking"]').filter("[value=ON]").parent().removeClass("active"),a("#simplesiframe").contents().find('input[name="health_simples_hawking"]').filter("[value=OFF]").parent().addClass("active")):console.log("Failed to set Hawking Input")}var o=window.meerkat,p=(o.logging.info,!1),q=!1,r=!1,s=!1,t=!1,u=!1,v=!1;o.modules.register("simplesActions",{init:b,setHawkingInput:m})}(jQuery),function(a){function b(){a(document).ready(function(){a('[data-provide="simples-blacklist-action"]').on("click","a",function(b){b.preventDefault(),k=a(this).data("action");var d=a("#simples-template-blacklist-"+k);d.length>0&&(j=_.template(d.html())),c()}),a("#dynamic_dom").on("click",'[data-provide="simples-blacklist-submit"]',function(a){a.preventDefault(),e()})})}function c(){i=h.modules.dialogs.show({title:" ",fullHeight:!0,onOpen:function(a){i=a,d()},onClose:function(){}})}function d(a){var b="No template found.";a=a||{},"function"==typeof j&&(a.errorMessage&&a.errorMessage.length>0,b=j(a)),h.modules.dialogs.changeContent(i,b)}function e(){if(l=a("#simples-"+k+"-blacklist"),f()){var b={action:k,value:l.find('input[name="phone"]').val().trim().replace(/\s+/g,""),channel:l.find('select[name="channel"]').val().trim(),comment:l.find('textarea[name="comment"]').val().trim()};h.modules.comms.post({url:"simples/ajax/blacklist_action.jsp",dataType:"json",cache:!1,errorLevel:"silent",timeout:5e3,data:b,onSuccess:function(a){d(a)},onError:function(a,b,c){d({errorMessage:b+": "+c})}})}}function f(){if(l===!1)return!1;var a=l.find('input[name="phone"]').val().trim().replace(/\s+/g,"");console.log(a);var b=l.find('select[name="channel"]').val().trim(),c=l.find('textarea[name="comment"]').val().trim(),d=l.find(".form-error");return""!==a&&g(a)?""===b||"phone"!==b&&"sms"!==b?(d.text("Channel has to be either [Phone] or [SMS]."),!1):""===c?(d.text("Comment length can not be zero."),!1):(d.text(""),!0):(d.text("Please enter a valid phone number."),!1)}function g(a){if(0===a.length)return!0;var b=!0,c=a.replace(/[^0-9]/g,"");if(0===c.length&&a.length>0)return!1;var d=new RegExp("^(0[234785]{1}[0-9]{8})$");return b=d.test(c)}var h=window.meerkat,i=(h.logging.info,!1),j=!1,k=!1,l=!1;h.modules.register("simplesBlackList",{init:b})}(jQuery),function(a){function b(){if(0!==i.length){var a=8,b=window.innerHeight||document.body.clientHeight||document.documentElement.clientHeight;b-=i.position().top+a,b=50>b?50:b,i.height(b)}}function c(a){try{"transactionId"===a.data.eventType&&e.messaging.publish(h.TRANSACTION_ID_CHANGE,a.data.transactionId)}catch(b){f("Error receiving postMessage",b)}}function d(){a(document).ready(b),a(window).resize(_.debounce(b)),window.addEventListener&&window.addEventListener("message",c,!1)}var e=window.meerkat,f=e.logging.info,g={simplesInterface:{TRANSACTION_ID_CHANGE:"TRANSACTION_ID_CHANGE"}},h=g.simplesInterface,i=a("#simplesiframe");e.modules.register("simplesInterface",{init:d,events:g})}(jQuery),function(a){function b(){a(document).ready(function(){f=d.modules.simples.getBaseUrl(),a(document.body).on("click",".needs-loadsafe",function(b){b.preventDefault();var d=a(this),e=!1;d.parent().parent().hasClass("dropdown")&&d.parent().parent().find(".dropdown-toggle").dropdown("toggle"),d.hasClass("needs-baseurl")&&(e=!0),c(d.attr("href"),e)})})}function c(a,b){if(a&&0!==a.length){b=b||!1,a+=a.indexOf("?")>=0?"&":"?",a+="ts="+(new Date).getTime(),b===!0&&(a=f+a);var c=f+"simples/loading.jsp?url="+encodeURIComponent(a);e.length>0?e.attr("src",c):window.location=c}}var d=window.meerkat,e=(d.logging.info,a("#simplesiframe")),f="";d.modules.register("simplesLoadsafe",{init:b,loadsafe:c})}(jQuery),function(a){function b(){a(document).ready(function(){s=m.modules.simples.getBaseUrl(),$e=a("#simples-template-messagedetail"),$e.length>0&&(q=_.template($e.html())),a(".simples-menubar .simples-homebutton").on("click.simplesMessage",function(){i(!1),m.messaging.publish(m.modules.events.simplesInterface.TRANSACTION_ID_CHANGE,!1)});var b=a(".simples-home");b.length>0&&a(".message-getnext").on("click.simplesMessage",function(b){b.preventDefault();var c=a(b.target);c.prop("disabled")!==!0&&(c.prop("disabled",!0).addClass("disabled"),l.empty(),m.modules.loadingAnimation.showInside(l),f(function(){c.prop("disabled",!1).removeClass("disabled")}))}),l=a(".simples-message-details-container");var e=0;l.length>0&&(j(!1,l),m.messaging.subscribe(m.modules.events.simplesMessage.MESSAGE_CHANGE,function(a){j(a,l),e=a.message.messageId}),l.on("click",".messagedetail-loadbutton",d),l.on("click","button[data-phone]",c),l.on("click",'button[data-provide="simples-hawking-unlock"]',function(){k(e)}))})}function c(b){b.preventDefault();var c=a(this),d=c.attr("data-phone");m.modules.loadingAnimation.showAfter(c),m.modules.comms.get({url:s+"simples/phones/call?phone="+d,cache:!1,errorLevel:"warning",onComplete:function(){m.modules.loadingAnimation.hide(c)}})}function d(b){if(b.preventDefault(),r===!1||!r.hasOwnProperty("message"))return void alert("Message details have not been stored correctly - can not load.");var c=a(b.target);c.prop("disabled",!0).addClass("disabled"),m.modules.loadingAnimation.showAfter(c),m.modules.comms.post({url:s+"simples/ajax/message_set_inprogress.jsp",dataType:"json",cache:!1,errorLevel:"silent",data:{messageId:r.message.messageId},onSuccess:function(a){if(a.hasOwnProperty("errors")&&a.errors.length>0)return alert("Could not set message to In Progress...\n"+a.errors[0].message),c.prop("disabled",!1).removeClass("disabled"),void m.modules.loadingAnimation.hide(c);var b="simples/loadQuote.jsp?brandId="+r.transaction.styleCodeId+"&verticalCode="+r.transaction.verticalCode+"&transactionId="+encodeURI(r.transaction.newestTransactionId)+"&action=amend";n(b),m.modules.simplesLoadsafe.loadsafe(b,!0)},onError:function(a,b,d){alert("Could not set message to In Progress...\n"+b+": "+d),c.prop("disabled",!1).removeClass("disabled"),m.modules.loadingAnimation.hide(c)}})}function e(a){var b=new RegExp("^(0[45]{1}[0-9]{8})$");return b.test(a)}function f(a){m.modules.comms.get({url:s+"simples/messages/next.json",cache:!1,errorLevel:"silent"}).done(function(a){a.hasOwnProperty("message")&&a.message.hasOwnProperty("messageId")&&0!==a.message.messageId?i(a):l.html(q(a))}).fail(function(a,b,c){var d={errors:[{message:b+": "+c}]};l.html(q(d))}).always(function(){"function"==typeof a&&a()})}function g(a,b,c,d){if(a){if(r===!1||!r.hasOwnProperty("message"))return void alert("Message details have not been stored correctly - can not load.");if(r.message.messageId===!1||isNaN(r.message.messageId))return void alert("No Message ID is currently known, so can not set as complete.");b=b||{},b.messageId=r.message.messageId,m.modules.comms.post({url:s+"simples/ajax/message_set_"+a+".jsp",dataType:"json",cache:!1,errorLevel:"silent",data:b,onSuccess:function(b){return b.hasOwnProperty("errors")&&b.errors.length>0?(alert("Could not set to "+a+"...\n"+b.errors[0].message),void("function"==typeof d&&d())):(i(!1),void("function"==typeof c&&c()))},onError:function(b,c,e){alert("Could not set to "+a+"...\n"+c+": "+e),"function"==typeof d&&d()}})}}function h(){return r}function i(a){window.self!==window.top&&window.top.meerkat.modules.simplesMessage.setCurrentMessage(a),r=a,m.messaging.publish(p.MESSAGE_CHANGE,r)}function j(b,c){if(c=c||!1,c!==!1&&0!==c.length){if(b===!1)a(".simples-home-buttons, .simples-notice-board").removeClass("hidden");else if(a(".simples-home-buttons, .simples-notice-board").addClass("hidden"),e(b.message.phoneNumber2)&&!e(b.message.phoneNumber1)){var d=b.message.phoneNumber1;b.message.phoneNumber1=b.message.phoneNumber2,b.message.phoneNumber2=d}c.html(q(b))}}function k(b){$hawkingWarningContainer=a(".hawking-warning-container"),$callButton=a("button[data-phone]"),m.modules.comms.get({url:s+"simples/hawking/unlock?messageId="+b,cache:!1,errorLevel:"warning"}).done(function(){$hawkingWarningContainer.html("Hawking meesage unlocked!"),$callButton.removeAttr("disabled")}).fail(function(a,b,c){$hawkingWarningContainer.html("Failed to unlock ...\n"+b+": "+c),$callButton.attr("disabled",!0)})}var l,m=window.meerkat,n=m.logging.info,o={simplesMessage:{MESSAGE_CHANGE:"MESSAGE_CHANGE"}},p=o.simplesMessage,q=!1,r=!1,s="";m.modules.register("simplesMessage",{init:b,events:o,getNextMessage:f,getCurrentMessage:h,setCurrentMessage:i,performFinish:g,renderMessageDetails:j})}(jQuery),function(a){function b(){a(document).ready(function(){if(j=a(".simples-postpone-queue-container"),0!==j.length){k=h.modules.simples.getBaseUrl(),c();var b=a("#simples-template-postponed-queue");b.length>0&&(i=_.template(b.html())),j.on("click.viewMessage",".simples-postponed-message",d),h.messaging.subscribe(h.modules.events.simplesMessage.MESSAGE_CHANGE,function(a){var b=j.find(".simples-postponed-message");b.removeClass("active"),a!==!1&&b.filter('[data-messageId="'+a.message.messageId+'"]').addClass("active")}),e()}})}function c(){Date.locale={month_names:["January","February","March","April","May","June","July","August","September","October","November","December"],month_names_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],day_of_week:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],day_of_week_short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},Date.prototype.getMonthName=function(a){return a===!0?Date.locale.month_names[this.getUTCMonth()]:Date.locale.month_names[this.getMonth()]},Date.prototype.getMonthNameShort=function(a){return a===!0?Date.locale.month_names_short[this.getUTCMonth()]:Date.locale.month_names_short[this.getMonth()]},Date.prototype.getDayName=function(a){return a===!0?Date.locale.day_of_week[this.getUTCDay()]:Date.locale.day_of_week[this.getDay()]},Date.prototype.getDayNameShort=function(a){return a===!0?Date.locale.day_of_week_short[this.getUTCDay()]:Date.locale.day_of_week_short[this.getDay()]}}function d(b){b.preventDefault();var c=a(b.target);if(c.hasClass("simples-postponed-message")||(c=c.parents(".simples-postponed-message")),l!==!0&&!c.hasClass("disabled")&&!c.hasClass("active")){var d=c.attr("data-messageId");l=!0,h.modules.loadingAnimation.showInside(c),c.addClass("disabled"),h.modules.comms.get({url:k+"simples/messages/get.json?messageId="+encodeURI(d),cache:!1,errorLevel:"silent",useDefaultErrorHandling:!1}).done(function(a){a.hasOwnProperty("message")&&a.message.hasOwnProperty("messageId")?h.modules.simplesMessage.setCurrentMessage(a):alert("Failed to load message: invalid response")}).fail(function(a,b,c){alert(a.hasOwnProperty("responseJSON")&&a.responseJSON.hasOwnProperty("errors")&&a.responseJSON.errors.length>0?"Failed to load message\n"+a.responseJSON.errors[0].message:"Unsuccessful because: "+b+": "+c)}).always(function(){l=!1,h.modules.loadingAnimation.hide(c),c.removeClass("disabled")})}}function e(){j!==!1&&0!==j.length&&(j.html("Fetching postponed queue..."),h.modules.comms.get({url:k+"simples/messages/postponed.json",cache:!1,errorLevel:"silent",useDefaultErrorHandling:!1}).done(function(a){var b="";"function"!=typeof i?b="Unsuccessful because: template not configured.":(f(a),b=i(a)),j.html(b)}).fail(function(a,b,c){j.html("Unsuccessful because: "+b+": "+c)}))}function f(a){if(m=[],_.isObject(a)&&a.hasOwnProperty("messages")&&_.isArray(a.messages)&&a.messages.length>0)for(var b=0;b<a.messages.length;b++)m.push({contactName:a.messages[b].contactName,whenToAction:a.messages[b].whenToAction})}function g(){return m}var h=window.meerkat,i=(h.logging.info,!1),j=!1,k="",l=!1,m=[];h.modules.register("simplesPostponedQueue",{init:b,initDateStuff:c,getMessageQueue:g})}(jQuery),function(a){function b(){a(document).ready(function(){a('[data-provide="simples-quote-finder"]').on("click","a",function(a){a.preventDefault(),c()}),a("#dynamic_dom").on("submit","form.simples-search-quotedetails",function(b){b.preventDefault(),l=a(this).find(":input[name=keywords]").val(),d()});var b=a("#simples-template-quotedetails");b.length>0&&(m=_.template(b.html()))})}function c(){k=j.modules.dialogs.show({title:" ",fullHeight:!0,onOpen:function(a){k=a,d()},onClose:function(){}})}function d(){if(f(),l!==!1&&""!==l){var a=g(l);return a.valid===!1?(a.errorMessage="The search term is not valid. Must be valid email or transaction ID",void f(a)):void j.modules.comms.post({url:"simples/ajax/quote_finder.jsp",dataType:"json",cache:!1,errorLevel:"silent",useDefaultErrorHandling:!1,data:a,onSuccess:function(a){var b={};"undefined"==typeof window.InspectorJSON?b.errorMessage="InspectorJSON plugin is not available.":a.hasOwnProperty("findQuotes")&&a.findQuotes.hasOwnProperty("quotes")&&(b.results=a.findQuotes.quotes,_.isArray(b.results)||(b.results=[a.findQuotes.quotes])),f(b),b.hasOwnProperty("errorMessage")===!1&&e(b.results)},onError:function(a,b,c){f({errorMessage:b+": "+c})}})}}function e(b){var c,d={};for(var e in b)b[e].hasOwnProperty("quote")?(c=b[e].id+" - Car",d[c]={},d[c]=b[e].quote):b[e].hasOwnProperty("health")?(c=b[e].id+" - Health",d[c]={},d[c]=b[e].health):b[e].hasOwnProperty("ip")?(c=b[e].id+" - IP",d[c]={},d[c]=b[e].ip):b[e].hasOwnProperty("life")?(c=b[e].id+" - Life",d[c]={},d[c]=b[e].life):b[e].hasOwnProperty("travel")?(c=b[e].id+" - Travel",d[c]={},d[c]=b[e].travel):b[e].hasOwnProperty("utilities")?(c=b[e].id+" - Utilities",d[c]={},d[c]=b[e].utilities):b[e].hasOwnProperty("home")?(c=b[e].id+" - Home & Contents",d[c]={},d[c]=b[e].home):b[e].hasOwnProperty("homeloan")?(c=b[e].id+" - Home Loan",d[c]={},d[c]=b[e].homeloan):(c=b[e].id+" - Unhandled vertical",d[c]={});"object"==typeof viewer&&viewer instanceof InspectorJSON&&viewer.destroy(),viewer=new InspectorJSON({element:a("#quote-details-container")[0],collapsed:!0,debug:!1,json:d})}function f(b){var c="No template found.";b=b||{},"function"==typeof m&&(b.results=b.results||"",b.keywords=b.keywords||l||"",b.errorMessage&&b.errorMessage.length>0||(""===b.keywords?b.errorMessage="Please enter something to search for.":""===b.results&&(b.results=j.modules.loadingAnimation.getTemplate())),c=m(b)),j.modules.dialogs.changeContent(k,c,function(){a("#"+k+" .modal-header").empty().prepend(a("#"+k+" #simples-search-modal-header"))})}function g(b){var c={valid:!1,term:a.trim(b),type:!1};return b.length>0&&(i(b)?c=a.extend(c,{valid:!0,type:"transactionid"}):h(b)&&(c=a.extend(c,{valid:!0,type:"email"}))),c}function h(a){var b=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);return b.test(a)}function i(a){try{var b=parseInt(String(a),10);return!isNaN(b)}catch(c){return!1}}var j=window.meerkat,k=(j.logging.info,!1),l=!1,m=!1;j.modules.register("simplesQuoteFinder",{init:b})}(jQuery),function(a,b){function c(){a(document).ready(function(){d();var b=a("#simples-template-search");b.length>0&&(o=_.template(b.html())),b=a("#simples-template-moreinfo"),b.length>0&&(p=_.template(b.html())),b=a("#simples-template-comments"),b.length>0&&(q=_.template(b.html()))})}function d(){a("#simples-search-navbar").on("submit",function(b){b.preventDefault(),s=a(this).find(":input[name=keywords]").val(),h()}),a("#dynamic_dom").on("submit","form.simples-search",function(b){b.preventDefault(),s=a(this).find(":input[name=keywords]").val(),g()}),a("#dynamic_dom").on("click",".search-quotes-results .btn[data-action]",e),a("#dynamic_dom").on("click",".comment-hideshow",function(b){b.preventDefault();var c=a(this);c.addClass("hidden"),c.siblings(".comment-inputfields").slideToggle(200)}),a("#dynamic_dom").on("click",".comment-addcomment",j)}function e(b){b.preventDefault();var c,d=a(this),e=d.attr("data-action"),g=d.parents(".search-quotes-result-row");if("amend"===e){c=g.attr("data-id");{g.attr("data-vertical")}_.defer(function(){l.modules.dialogs.close(n)})}else if("moreinfo"===e)if(g.hasClass("open"))g.removeClass("open"),d.text(d.attr("data-originaltext")),g.find("div.moreinfo-container").slideUp(200);else{g.addClass("open"),d.attr("data-originaltext",d.text()),d.text("Less details"),g.parent().children().not(".open").removeClass("bg-success"),g.addClass("bg-success"),g.find("div.moreinfo-container").remove(),g.append('<div class="moreinfo-container"></div>');var h=g.find("div.moreinfo-container");c=g.attr("data-id");var i=g.attr("data-index"),j=r[i]||!1;f(c,h,j)}}function f(b,c,d){return"undefined"==typeof b||0===b.length?void c.html("Could not get more info: transaction ID not known"):(d=d||{},c.html(l.modules.loadingAnimation.getTemplate()),c.slideDown(200),void l.modules.comms.get({url:"simples/transactions/details.json",cache:!1,errorLevel:"silent",data:{transactionId:b},onSuccess:function(b){var e="";"function"!=typeof p?e="Could not get more info: template not configured.":(a.extend(!0,b,d),e=p(b)),c.html(e)},onError:function(a,b,d){c.html("Could not get more info: "+b+" "+d)}}))}function g(){r=!1,i(),s!==!1&&""!==s&&(a("#simples-search-navbar").find(":input[name=keywords]").val(s),l.modules.comms.post({url:"simples/ajax/search_quotes.jsp",dataType:"json",cache:!1,errorLevel:"silent",useDefaultErrorHandling:!1,data:{simples:!0,search_terms:s},onSuccess:function(a){var b={};a.hasOwnProperty("search_results")&&a.search_results.hasOwnProperty("quote")&&(b.results=a.search_results.quote,_.isArray(b.results)||(b.results=[a.search_results.quote]),r=b.results),i(b)},onError:function(a,b,c){i({errorMessage:b+": "+c})}}))}function h(){l.modules.dialogs.show({title:" ",fullHeight:!0,onOpen:function(a){n=a,g()},onClose:function(){}})}function i(b){var c="No template found.";b=b||{},"function"==typeof o&&(b.results=b.results||"",b.keywords=b.keywords||s||"",b.errorMessage&&b.errorMessage.length>0||(""===b.keywords?b.errorMessage="Please enter something to search for.":""===b.results&&(b.results=l.modules.loadingAnimation.getTemplate())),c=o(b)),l.modules.dialogs.changeContent(n,c,function(){a("#"+n+" .modal-header").empty().prepend(a("#"+n+" #simples-search-modal-header"))})}function j(c){c.preventDefault();var d=a(this).parents(".comment-container"),e=d.attr("data-id"),f=d.find("textarea"),g=d.find(".comment-error");if(e===b||0===e.length)return void g.text("Transaction ID not found or not defined.");if(!f.val||0===f.val().length)return void g.text("Comment length can not be zero.");var h=d.find(".comment-addcomment");h.prop("disabled",!0),l.modules.loadingAnimation.showInside(h,!0),g.text(""),k(e,f.val(),function(a){h.prop("disabled",!1),l.modules.loadingAnimation.hide(h),f.val(""),d.find(".comment-hideshow").removeClass("hidden"),d.find(".comment-inputfields").slideUp(200),"function"==typeof q&&d.html(q(a))},function(a,b,c){h.prop("disabled",!1),l.modules.loadingAnimation.hide(h),g.text("Error: "+b+" "+c)})}function k(a,b,c,d){return a&&0!==a.length?void l.modules.comms.post({url:"simples/ajax/comment_add_then_get.jsp",dataType:"json",cache:!1,errorLevel:"silent",data:{transactionId:a,comment:b},onSuccess:function(a){a&&a.errors&&a.errors.length>0?"function"==typeof d&&d(a,"",a.errors[0].message):"function"==typeof c&&c(a)},onError:function(a,b,c){"function"==typeof d&&d(a,b,c)}}):void alert("transactionId must be defined.")}var l=window.meerkat,m=(l.logging.info,{}),n=!1,o=!1,p=!1,q=!1,r=!1,s="";l.modules.register("simplesSearch",{init:c,events:m})}(jQuery),function(a,b){function c(){0!==a('[data-provide="simples-tickler"]').length&&(h.messaging.subscribe(h.modules.events.simplesInterface.TRANSACTION_ID_CHANGE,function(a){j=a===b?0:a}),d(k))}function d(a){var b=1e3*a;clearInterval(g),g=setInterval(f,b),i("Tickler started @ "+a+" second interval.")}function e(){clearInterval(g),i("Tickler stopped.")}function f(){h.modules.comms.get({url:"simples/tickle.json",cache:!1,errorLevel:"silent",useDefaultErrorHandling:!1,timeout:5e3,data:{transactionId:j},onError:function(a){401===a.status?(alert("Oh bother, it looks like your session is no longer active. Please click OK and log in again."),window.top.location.href="simples.jsp"):alert("Something bad happened when trying to keep your session active. If this occurs again please restart your browser.")}})}var g,h=window.meerkat,i=h.logging.info,j=0,k=1500;h.modules.register("simplesTickler",{init:c,start:d,stop:e})}(jQuery),function(a){function b(){a(document).ready(function(){if(g=a("[data-provide='simples-user-stats']"),0!==g.length){var b=a("#simples-template-user-stats");b.length>0&&(f=_.template(b.html())),j=e.modules.simples.getBaseUrl(),d()}})}function c(a){if(h=a,i!==!1&&clearInterval(i),h!==!1&&h>0){var b=1e3*h;i=window.setInterval(d,b)}return h}function d(){g.each(function(){var b=a(this);0===b.find("table").length&&b.hide()});var b=e.modules.comms.get({url:j+"simples/users/stats_today.json",cache:!1,errorLevel:"silent",useDefaultErrorHandling:!1}).done(function(b){var c="";c="function"!=typeof f?"Unsuccessful because: template not configured.":f(b),g.each(function(){var b=a(this),d=!1;0===b.find("table").length&&(d=!0),b.html(c),d&&b.slideDown(200)})}).fail(function(b,c,d){g.each(function(){a(this).html("Unsuccessful because: "+c+": "+d)})});return b}var e=window.meerkat,f=!1,g=!1,h=60,i=!1,j="";e.modules.register("simplesUserStats",{init:b,setInterval:c,refresh:d})}(jQuery),function(a){function b(){a(document).ready(function(){var b=a("[data-provide='simples-consultant-status']");if(0!==b.length){h=d.modules.simples.getBaseUrl(),b.each(function(){a(this);e=a(".simples-status-refresh"),g=a(".simples-status"),c()});var i=a("#simples-template-consultantstatus");i.length>0&&(f=_.template(i.html()))}})}function c(){d.modules.loadingAnimation.showAfter(e),d.modules.comms.get({url:h+"simples/users/list_online.json",cache:!1,errorLevel:"silent",useDefaultErrorHandling:!1,onSuccess:function(a){var b="";b="function"!=typeof f?"Unsuccessful because: template not configured.":f(a),g.html(b)},onError:function(a,b,c){g.html("Unsuccessful because: "+b+": "+c)},onComplete:function(){d.modules.loadingAnimation.hide(e)}})}var d=window.meerkat,e=(d.logging.info,!1),f=!1,g=!1,h="";d.modules.register("simplesUserStatus",{init:b})}(jQuery);
//# sourceMappingURL=simples.modules.ctm.min.map