/*!
 * CTM-Platform v0.8.3
 * Copyright 2015 Compare The Market Pty Ltd
 * http://www.comparethemarket.com.au/
 */


!function(a,b){function c(){if("submit"===k.site.pageAction)k.modules.journeyEngine.configure(null);else{d(!1),k.modules.journeyEngine.configure({startStepId:null,steps:_.toArray(n)});var a=k.modules.transactionId.get();k.messaging.publish(l.tracking.EXTERNAL,{method:"trackQuoteEvent",object:{action:"Start",transactionID:parseInt(a,10),vertical:"meerkat",verticalFilter:"competition"}})}}function d(a){e()}function e(){var a={title:"Enter",navigationId:"enter",slideIndex:0,externalTracking:{method:"trackQuoteForms",object:k.modules.competition.getTrackingFieldsObject},onInitialise:function(){}},b={title:"Submit",navigationId:"submit",slideIndex:0,externalTracking:{method:"trackQuoteForms",object:k.modules.competition.getTrackingFieldsObject},onInitialise:function(){},onBeforeEnter:function(){}};n={startStep:a,submitStep:b}}function f(b){b.addClass("disabled"),k.modules.loadingAnimation.showInside(b,!0);var c=k.modules.journeyEngine.getSerializedFormData(a("#mainForm")),d=a("#competition_returnUrl").val();c+="&quoteType="+k.site.vertical,k.modules.comms.post({url:"ajax/write/competition.jsp",data:c,cache:!1,dataType:"json",useDefaultErrorHandling:!0,errorLevel:"silent",timeout:3e4,onSuccess:function(a){var b="";a.promocode&&(b="?promocode="+a.promocode),window.location=d+b}})}function g(){var b=!0;return a("#mainForm").each(function(c,d){$element=a(d);var e=$element.valid();e===!1&&(b=!1)}),b}function h(){try{var b=k.modules.transactionId.get(),c=(a("#competition_contact_email").val(),a("#competition_contact_optIn").is(":checked")?"Y":"N",k.modules.journeyEngine.getCurrentStepIndex()),d=(k.modules.journeyEngine.getFurtherestStepIndex(),"");switch(c){case 0:d="enter";break;case 1:d="submit"}var e={vertical:"meerkat",verticalFilter:"competition",actionStep:d,transactionID:b,quoteReferenceNumber:b,postCode:null,state:null,email:null,emailID:null,marketOptIn:null,okToCall:null};return e}catch(f){return!1}}function i(){a(document).ready(function(){return"competition"!==k.site.vertical?!1:(c(),void j())})}function j(){a(".btn-next").on("click",function(b){b.preventDefault();var c=a(this);g()&&f(c)})}var k=window.meerkat,l=k.modules.events,m={competition:{},WEBAPP_LOCK:"WEBAPP_LOCK",WEBAPP_UNLOCK:"WEBAPP_UNLOCK"},n=null;k.modules.register("competition",{init:i,events:m,getTrackingFieldsObject:h})}(jQuery),function(a,b){function c(){h.on("change",function(){a(this).is(":checked")?(e.attr("required","required").valid(),f.attr("required","required").valid(),g.attr("required","required").valid()):(e.removeAttr("required").valid(),f.removeAttr("required").valid(),g.removeAttr("required").valid())})}function d(){a(document).ready(function(){e=a("#competition_contact_firstName"),f=a("#competition_contact_lastName"),g=a("#competition_contact_email"),h=a("#competition_contact_optIn"),e.removeAttr("required"),f.removeAttr("required"),g.removeAttr("required"),c()})}var e,f,g,h,i=window.meerkat;i.modules.events,i.logging.info;i.modules.register("competitionStart",{init:d})}(jQuery);
//# sourceMappingURL=competition.modules.ctm.min.map