/*!
 * CTM-Platform v0.8.3
 * Copyright 2015 Compare The Market Pty Ltd
 * http://www.comparethemarket.com.au/
 */


!function(a,b){function c(){a(document).ready(function(){return"carlmi"!==i.site.vertical&&"homelmi"!==i.site.vertical?!1:(e(),"confirmation"===i.site.pageAction?!1:(d(),void(("amend"===i.site.pageAction||"latest"===i.site.pageAction||"load"===i.site.pageAction||"start-again"===i.site.pageAction)&&i.modules.form.markInitialFieldsWithValue(a("#mainform")))))})}function d(){}function e(){f(!1);var b=null;i.site.isFromBrochureSite===!0?b=l.startStep.navigationId:i.site.journeyStage.length>0&&"latest"===i.site.pageAction?b=l.resultsStep.navigationId:i.site.journeyStage.length>0&&"amend"===i.site.pageAction&&(b=l.startStep.navigationId),a(document).ready(function(){i.modules.journeyEngine.configure({startStepId:b,steps:_.toArray(l)});var a=i.modules.transactionId.get();i.site.isNewQuote===!1?i.messaging.publish(j.tracking.EXTERNAL,{method:"trackQuoteEvent",object:{action:"Retrieve",transactionID:parseInt(a,10),vertical:i.site.vertical}}):i.messaging.publish(j.tracking.EXTERNAL,{method:"trackQuoteEvent",object:{action:"Start",transactionID:parseInt(a,10),vertical:i.site.vertical}})})}function f(a){g(),h(),a&&i.modules.journeyProgressBar.render(!0)}function g(){var b={title:"Select Brands",navigationId:"start",slideIndex:0,onInitialise:function(){if(i.site.brands.length)for(var b=i.site.brands.split(","),c=0;c<b.length;c++)a("input[id=product"+b[c]+"_check]").prop("checked",!0)},validation:{validate:!0,customValidation:function(b){var c=0;a("input[name="+i.site.vertical+"_brand]").each(function(){a(this).prop("checked")&&c++}),b(c>0)}}},c={title:"Compare Features",navigationId:"results",slideIndex:1,onInitialise:function(a){i.modules.lmiResults.initPage()},onBeforeEnter:function(b){b.isForward===!0&&(i.modules.resultsTracking.setResultsEventMode("Load"),a("#resultsPage").addClass("hidden"))},onAfterEnter:function(a){a.isForward===!0&&i.modules.lmiResults.get()}};l={startStep:b,resultsStep:c}}function h(){i.modules.journeyProgressBar.configure([{label:"Select Brands",navigationId:l.startStep.navigationId},{label:"Compare Features",navigationId:l.resultsStep.navigationId}])}var i=window.meerkat,j=i.modules.events,k={lmi:{},WEBAPP_LOCK:"WEBAPP_LOCK",WEBAPP_UNLOCK:"WEBAPP_UNLOCK"},l=null;i.modules.register("lmi",{init:c,events:k,initProgressBar:f})}(jQuery),function(a,b){function c(){a(document).ready(function(){f=a("#startForm input[type='checkbox']"),d()})}function d(){a(document).on("change","#startForm input[type='checkbox']",e)}function e(a){var b=f.filter(":not(:checked)"),c=f.filter(":checked");c.length>=12?b.attr("disabled","disabled"):f.removeAttr("disabled"),f.removeClass("has-error")}var f;meerkat.modules.register("lmiForm",{init:c,events:{}})}(jQuery),function(a){function b(){d(),Features.init(),p.modules.compare.initCompare(),e(),f()}function c(){f(),t!==p.modules.deviceMediaState.get()&&(Results.view.calculateResultsContainerWidth(),Features.clearSetHeights(),Features.balanceVisibleRowsHeight()),Results.pagination.refresh()}function d(){try{Results.init({url:"ajax/json/features/results.jsp?vertical="+p.site.vertical,runShowResultsPage:!1,paths:{results:{list:"results.products.product"},productId:"productId",productName:"policyName",productBrandCode:"brandCode",availability:{product:"productAvailable"}},show:{savings:!1,featuresCategories:!1,nonAvailablePrices:!0,nonAvailableProducts:!1,unavailableCombined:!1},availability:{product:["equals","Y"]},render:{templateEngine:"_",features:{mode:"populate",headers:!1,numberOfXSColumns:1},dockCompareBar:!1},displayMode:"features",pagination:{mode:"page",touchEnabled:Modernizr.touch},sort:{sortBy:"productName"},animation:{results:{individual:{active:!1},delay:500,options:{easing:"swing",duration:1e3}},shuffle:{active:!0,options:{easing:"swing",duration:1e3}},filter:{reposition:{options:{easing:"swing"}}}},elements:{features:{values:".content",extras:".children"}},templates:{pagination:{pageText:"Product {{=currentPage}} of {{=totalPages}}"}},dictionary:{valueMap:[{key:"Y",value:"<span class='icon icon-tick'></span>"},{key:"N",value:"<span class='icon icon-cross'></span>"},{key:"R",value:"Restricted / Conditional"},{key:"AI",value:"Additional Information"},{key:"O",value:"Optional"},{key:"L",value:"Limited"},{key:"SCH",value:"As shown in schedule"},{key:"NA",value:"Non Applicable"},{key:"E",value:"Excluded"},{key:"NE",value:"No Exclusion"},{key:"NS",value:"No Sub Limit"},{key:"OTH",value:""}]},rankings:{paths:{rank_productId:"productId"},filterUnavailableProducts:!1},incrementTransactionId:!1})}catch(a){Results.onError("Sorry, an error occurred initialising page","results.tag","meerkat.modules.lmiResults.initResults(); "+a.message,a)}}function e(){p.messaging.subscribe(q.affix.AFFIXED,function(){a("#resultsPage").css("margin-top","35px")}),p.messaging.subscribe(q.affix.UNAFFIXED,function(){a("#resultsPage").css("margin-top","0")}),p.messaging.subscribe(r.RESULTS_ERROR,function(){_.delay(function(){p.modules.journeyEngine.gotoPath("previous")},1e3)}),a(Results.settings.elements.resultsContainer).on("featuresDisplayMode",function(){console.log("BUILDING HERE"),Features.buildHtml()}),a(Results.settings.elements.resultsContainer).on("noFilteredResults",function(){Results.view.show()}),a(document).on("resultsLoaded",k),a(document).on("resultsReturned",function(){p.modules.utils.scrollPageTo(a("header")),a(".featuresHeaders .expandable.expanded").removeClass("expanded").addClass("collapsed")}),a(document).on("resultsFetchStart",function(){p.modules.journeyEngine.loadingShow("getting your quotes"),a("#resultsPage").removeClass("hidden"),Results.pagination.hide()}),a(document).on("resultsFetchFinish",function(){a(Results.settings.elements.page).show(),p.modules.journeyEngine.loadingHide(),Results.pagination.show()}),a(document).on("populateFeaturesStart",function(){p.modules.performanceProfiling.startTest("results")}),a(Results.settings.elements.resultsContainer).on("populateFeaturesEnd",function(){var a,b=p.modules.performanceProfiling.endTest("results");a=800>b?p.modules.performanceProfiling.PERFORMANCE.HIGH:8e3>b&&p.modules.performanceProfiling.isIE8()===!1?p.modules.performanceProfiling.PERFORMANCE.MEDIUM:p.modules.performanceProfiling.PERFORMANCE.LOW,Results.setPerformanceMode(a)}),a(document).on("resultPageChange",function(a){var b=a.pageData;if(null===b.measurements)return!1;Results.getFilteredResults().length,b.measurements.columnsPerPage}),a(document).on("FeaturesRendered",function(){a(Features.target+" .expandable > "+Results.settings.elements.features.values).on("mouseenter",function(){var b=a(this).attr("data-featureId"),c=a(Features.target+' [data-featureId="'+b+'"]');c.addClass(Results.settings.elements.features.expandableHover.replace(/[#\.]/g,""))}).on("mouseleave",function(){var b=a(this).attr("data-featureId"),c=a(Features.target+' [data-featureId="'+b+'"]');c.removeClass(Results.settings.elements.features.expandableHover.replace(/[#\.]/g,""))})})}function f(){g(),p.messaging.subscribe(q.device.STATE_ENTER_XS,function(){"results"===p.modules.journeyEngine.getCurrentStep().navigationId&&g()}),p.messaging.subscribe(q.device.STATE_LEAVE_XS,function(){h(),Results.pagination.setCurrentPageNumber(1),Results.pagination.resync()})}function g(){"xs"===p.modules.deviceMediaState.get()&&"features"===Results.getDisplayMode()&&(Results.view.startColumnWidthTracking(a(window),Results.settings.render.features.numberOfXSColumns,!1),Results.pagination.setCurrentPageNumber(1),Results.pagination.resync())}function h(){Results.view.stopColumnWidthTracking()}function i(){t=p.modules.deviceMediaState.get()}function j(){Results.get()}function k(){g(),n(!1)}function l(){}function m(){p.messaging.publish(q.resultsTracking.TRACK_QUOTE_RESULTS_LIST,{additionalData:{},onAfterEventMode:"Load"})}function n(b){if("undefined"==typeof b&&(b=!0),null!==Results.getDisplayMode()&&"features"!==Results.getDisplayMode()){var c=u===!0;Results.setDisplayMode("features",c),g(),_.defer(function(){Results.pagination.gotoPage(1),"xs"===p.modules.deviceMediaState.get()&&Results.view.setColumnWidth(a(window),Results.settings.render.features.numberOfXSColumns,!1),Results.pagination.setupNativeScroll()}),Results.pagination.show(!0),a("header .xs-results-pagination").removeClass("hidden"),u=!1,a(document.body).removeClass("priceMode"),a(window).scrollTop(0),b&&(p.modules.resultsTracking.setResultsEventMode("Refresh"),m())}}function o(){s=a("#resultsPage"),p.messaging.subscribe(q.RESULTS_RANKING_READY,m)}var p=window.meerkat,q=p.modules.events,r=(p.logging.info,{RESULTS_ERROR:"RESULTS_ERROR"});q.lmiResults={FEATURES_CALL_ACTION:"FEATURES_CALL_ACTION",FEATURES_CALL_ACTION_MODAL:"FEATURES_CALL_ACTION_MODAL",FEATURES_SUBMIT_CALLBACK:"FEATURES_SUBMIT_CALLBACK"};var s,t,u=!1;p.modules.register("lmiResults",{init:o,initPage:b,onReturnToPage:c,get:j,stopColumnWidthTracking:h,recordPreviousBreakpoint:i,switchToFeaturesMode:n,showNoResults:l,publishExtraSuperTagEvents:m})}(jQuery);
//# sourceMappingURL=lmi.modules.ctm.min.map