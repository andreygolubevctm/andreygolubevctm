/*!
 * CTM-Platform v0.8.3
 * Copyright 2015 Compare The Market Pty Ltd
 * http://www.comparethemarket.com.au/
 */


!function(a,b){function c(){a(document).ready(function(){return"roadside"!==k.site.vertical?!1:(e(),d(),void(("amend"===k.site.pageAction||"latest"===k.site.pageAction||"load"===k.site.pageAction||"start-again"===k.site.pageAction)&&k.modules.form.markInitialFieldsWithValue(a("#mainform"))))})}function d(){}function e(){f(!1);var b=null;k.site.isFromBrochureSite===!0&&(b=n.startStep.navigationId),a(document).ready(function(){k.modules.journeyEngine.configure({startStepId:b,steps:_.toArray(n)}),k.site.isNewQuote===!1?k.messaging.publish(l.tracking.EXTERNAL,{method:"trackQuoteEvent",object:{action:"Retrieve",vertical:k.site.vertical}}):k.messaging.publish(l.tracking.EXTERNAL,{method:"trackQuoteEvent",object:{action:"Start",vertical:k.site.vertical}})})}function f(a){g(),h(),a&&k.modules.journeyProgressBar.render(!0)}function g(){var b={title:"Your Car",navigationId:"start",slideIndex:0,externalTracking:{method:"trackQuoteForms",object:k.modules.roadside.getTrackingFieldsObject},onInitialise:function(a){}},c={title:"Roadside Quotes",navigationId:"results",slideIndex:1,externalTracking:{method:"trackQuoteForms",object:k.modules.roadside.getTrackingFieldsObject},onInitialise:function(a){k.modules.roadsideResults.initPage(),k.modules.roadsideMoreInfo.initMoreInfo(),k.modules.showMoreQuotesPrompt.initPromptBar(),k.modules.roadsideSorting.initSorting(),k.modules.partnerTransfer.initTransfer()},onBeforeEnter:function(b){Results.removeSelectedProduct(),k.modules.resultsTracking.setResultsEventMode("Load"),a("#resultsPage").addClass("hidden"),k.modules.roadsideSorting.resetToDefaultSort()},onAfterEnter:function(a){a.isForward===!0&&k.modules.roadsideResults.get()},onAfterLeave:function(a){a.isBackward&&k.modules.showMoreQuotesPrompt.disablePromptBar()}};n={startStep:b,results:c}}function h(){k.modules.journeyProgressBar.configure([{label:"Your Car",navigationId:n.startStep.navigationId},{label:"Roadside Quotes",navigationId:n.results.navigationId}])}function i(){var a=Results.getSelectedProduct(),b=k.modules.transactionId.get();k.modules.partnerTransfer.trackHandoverEvent({product:a,type:"ONLINE",quoteReferenceNumber:b,productID:a.productId,productName:a.provider,productBrandCode:a.brandCode},{type:"A",productId:a.productId})}function j(b){try{var c=k.modules.journeyEngine.getCurrentStepIndex(),d=k.modules.journeyEngine.getFurtherestStepIndex(),e=a("#roadside_riskAddress_state").val(),f=a("#roadside_vehicle_year").val(),g=a("#roadside_vehicle_makeDes").val(),h="";switch(c){case 0:h="roadside your car";break;case 1:h=b===!0?"roadside more info":"roadside results"}var i={actionStep:h,quoteReferenceNumber:k.modules.transactionId.get(),email:null,emailID:null,yearOfManufacture:null,makeOfCar:null,state:null,marketOptIn:null,okToCall:null};return d>k.modules.journeyEngine.getStepIndex("start")&&_.extend(i,{yearOfManufacture:f,makeOfCar:g,state:e,marketOptIn:null,okToCall:null}),i}catch(j){return{}}}var k=window.meerkat,l=k.modules.events,m=(k.logging.info,{roadside:{},WEBAPP_LOCK:"WEBAPP_LOCK",WEBAPP_UNLOCK:"WEBAPP_UNLOCK"}),n=null;k.modules.register("roadside",{init:c,events:m,initProgressBar:f,getTrackingFieldsObject:j,trackHandover:i})}(jQuery),function(a,b){function c(){var b={container:n,hideAction:"fadeOut",showAction:"fadeIn",modalOptions:{className:"modal-breakpoint-wide modal-tight bridgingContainer",openOnHashChange:!1,leftBtn:{label:"All Products",icon:'<span class="icon icon-arrow-left"></span>',callback:function(b){a(b.currentTarget).closest(".modal").modal("hide")}}},runDisplayMethod:e,onBeforeShowBridgingPage:null,onBeforeShowTemplate:null,onBeforeShowModal:i,onAfterShowModal:h,onAfterShowTemplate:null,onBeforeHideTemplate:null,onAfterHideTemplate:null,onClickApplyNow:g,onBeforeApply:null,onApplySuccess:null,retrieveExternalCopy:f,additionalTrackingData:{productName:null}};k.modules.moreInfo.initMoreInfo(b)}function d(){j=a(window).scrollTop()}function e(a){k.modules.moreInfo.showModal(),k.modules.address.appendToHash("moreinfo")}function f(b){return a.Deferred(function(c){b.termsLink=a(b.subTitle).attr("href");var d=[];for(var e in b.info)d.push([b.info[e].desc,e]);return b.sortOrder=d.sort(),k.modules.moreInfo.setDataResult(b),c.resolveWith(this,[b]).promise()})}function g(b,c){Results.model.setSelectedProduct(a(".btn-more-info-apply").attr("data-productId")),k.modules.roadside.trackHandover(),k.modules.journeyEngine.gotoPath("next")}function h(){k.messaging.publish(l.tracking.EXTERNAL,{method:"trackQuoteForms",object:_.bind(k.modules.roadside.getTrackingFieldsObject,this,!0)})}function i(a){var b={additionalTrackingData:{productName:a.des}};k.modules.moreInfo.updateSettings(b)}var j,k=window.meerkat,l=k.modules.events,m={roadsideMoreInfo:{}},n=(m.roadsideMoreInfo,a(".bridgingContainer"));k.modules.register("roadsideMoreInfo",{initMoreInfo:c,events:m,runDisplayMethod:e,setScrollPosition:d,retrieveExternalCopy:f})}(jQuery),function(a){function b(){c(),f()}function c(){try{Results.init({url:"ajax/json/sar_quote_results.jsp",runShowResultsPage:!1,paths:{results:{list:"results.price"},productId:"productId",productName:"des",productBrandCode:"provider",price:{premium:"price"},availability:{product:"available"},info:{keyService:"info.keyService.value",roadCall:"info.roadCall.value"}},show:{nonAvailableProducts:!1,unavailableCombined:!0},availability:{product:["equals","Y"]},render:{templateEngine:"_",dockCompareBar:!1},displayMode:"price",pagination:{touchEnabled:!1},sort:{sortBy:"price.premium",sortDir:"asc"},animation:{results:{individual:{active:!1},delay:500,options:{easing:"swing",duration:1e3}},shuffle:{active:!0,options:{easing:"swing",duration:1e3}},filter:{reposition:{options:{easing:"swing"}}}},rankings:{triggers:["RESULTS_DATA_READY"],callback:e,forceIdNumeric:!1,filterUnavailableProducts:!0}})}catch(a){Results.onError("Sorry, an error occurred initialising page","results.tag","meerkat.modules.utilitiesResults.initResults(); "+a.message,a)}}function d(a){return _.isArray(a)&&a.length>0&&_.isArray(a[0])?a=[{productAvailable:"N"}]:(_.each(a,function(a,b){a.brandCode=a.provider}),a)}function e(a,b){var c={};return c["rank_productId"+b]=a.productId,c}function f(){n.messaging.subscribe(Results.model.moduleEvents.RESULTS_MODEL_UPDATE_BEFORE_FILTERSHOW,function(){Results.model.returnedProducts=d(Results.model.returnedProducts),Results.model.sortedProducts=Results.model.returnedProducts}),n.messaging.subscribe(o.affix.AFFIXED,function(){m.css("margin-top","8px")}),n.messaging.subscribe(o.affix.UNAFFIXED,function(){m.css("margin-top","0")}),a(Results.settings.elements.resultsContainer).on("noFilteredResults",function(){Results.view.show()}),n.messaging.subscribe(p.RESULTS_ERROR,function(){_.delay(function(){n.modules.journeyEngine.gotoPath("previous")},1e3)}),a(document).on("resultsReturned",function(){n.modules.utils.scrollPageTo(a("header"))}),a(document).on("resultsFetchStart",function(){n.modules.journeyEngine.loadingShow("...getting your quotes..."),m.removeClass("hidden"),Results.pagination.hide()}),a(document).on("resultsFetchFinish",function(){a(Results.settings.elements.page).show(),n.modules.journeyEngine.loadingHide(),a(document.body).addClass("priceMode");var b=0;a.each(Results.model.returnedProducts,function(){"Y"===this.available&&b++}),0!==b||Results.model.hasValidationErrors||j()}),a(Results.settings.elements.resultsContainer).on("noResults",function(){j()}),a(Results.settings.elements.resultsContainer).on("click",".result-row",h),a(document.body).on("click",".btn-apply",g)}function g(b){b.preventDefault();var c=a(b.target);c.hasClass("result-row")===!1&&(c=c.parents(".result-row")),"undefined"!=typeof c.attr("data-available")&&"Y"===c.attr("data-available")&&(c.attr("data-productId")&&Results.setSelectedProduct(c.attr("data-productId")),n.modules.roadside.trackHandover(),n.modules.moreInfo.setProduct(Results.getResult("productId",c.attr("data-productId"))),n.modules.roadsideMoreInfo.retrieveExternalCopy(Results.getSelectedProduct()).done(function(){n.modules.journeyEngine.gotoPath("next",c.find(".btn-apply"))}))}function h(b){if(a(Results.settings.elements.resultsContainer).hasClass("priceMode")!==!1&&"xs"===n.modules.deviceMediaState.get()){var c=a(b.target);c.hasClass("result-row")===!1&&(c=c.parents(".result-row")),"undefined"!=typeof c.attr("data-available")&&"Y"===c.attr("data-available")&&(n.modules.moreInfo.setProduct(Results.getResult("productId",c.attr("data-productId"))),n.modules.roadsideMoreInfo.runDisplayMethod())}}function i(){Results.get()}function j(){n.modules.dialogs.show({htmlContent:a("#no-results-content")[0].outerHTML})}function k(b){b="undefined"==typeof b?{}:b,n.messaging.publish(o.resultsTracking.TRACK_QUOTE_RESULTS_LIST,{additionalData:a.extend({sortBy:Results.getSortBy()+"-"+Results.getSortDir()},b),onAfterEventMode:"Refresh"})}function l(){a(document).ready(function(){m=a("#resultsPage"),n.messaging.subscribe(o.RESULTS_RANKING_READY,k)})}var m,n=window.meerkat,o=n.modules.events,p=(n.logging.info,{RESULTS_ERROR:"RESULTS_ERROR"});n.modules.register("roadsideResults",{init:l,initPage:b,get:i,showNoResults:j,publishExtraSuperTagEvents:k})}(jQuery),function(a,b){function c(a){var b=a.attr("data-sort-type"),c=a.attr("data-sort-dir");if("undefined"!=typeof b&&"undefined"!=typeof c){b===Results.getSortBy()&&c===Results.getSortDir()&&(c="asc"===c?"desc":"asc",a.attr("data-sort-dir",c)),Results.setSortByMethod(m[b]);var d=Results.sortBy(b,c);d?(h.parent("li").removeClass("active"),a.parent("li").addClass("active"),i.modules.resultsTracking.setResultsEventMode("Refresh"),i.modules.roadsideResults.publishExtraSuperTagEvents({products:[],recordRanking:"N"})):k("[roadsideSorting]","The sortBy or sortDir could not be set",setSortByReturn,setSortDirReturn)}else k("[roadsideSorting]","No data on sorting element"),i.messaging.publish(j.WEBAPP_UNLOCK)}function d(){i.messaging.subscribe(j.RESULTS_SORTED,function(a){i.messaging.publish(j.WEBAPP_UNLOCK)}),h.on("click",function(b){var d=a(b.target);d.is("a")||(d=d.closest("a")),d.hasClass("disabled")||(i.messaging.publish(j.WEBAPP_LOCK),_.defer(function(){d.parent().hasClass("active")||e(d),c(d)}))}),i.messaging.subscribe(j.WEBAPP_LOCK,function(a){h.addClass("inactive disabled")}),i.messaging.subscribe(j.WEBAPP_UNLOCK,function(a){h.removeClass("inactive disabled")})}function e(a){var b=a.attr("data-sort-type");a.attr("data-sort-dir",l[b])}function f(){a(document).ready(function(){h=a("[data-sort-type]")})}function g(){var b=a("[data-sort-type='price.premium']"),c=Results.getSortBy(),d="price.premium";(c!=d||"desc"==b.attr("data-sort-dir")&&c==d)&&(b.parent("li").siblings().removeClass("active").end().addClass("active").end().attr("data-sort-dir","desc"),Results.setSortBy("price.premium"),Results.setSortDir("desc"))}var h,i=window.meerkat,j=i.modules.events,k=(i.logging.info,i.logging.error),l={"price.premium":"asc","info.roadCall":"desc","info.keyService":"desc"},m={"price.premium":null,"info.roadCall":null,"info.keyService":null},n={roadsideSorting:{CHANGED:"ROADSIDE_SORTING_CHANGED"}};n.roadsideSorting;i.modules.register("roadsideSorting",{init:f,initSorting:d,events:n,resetToDefaultSort:g})}(jQuery),function(a,b){function c(){a(document).ready(function(){"roadside"===h.site.vertical&&(f=h.site.vehicleSelectionDefaults.data,g=a("#roadside_vehicle_make"),d(),e("makes"))})}function d(){var b=a("#"+g.attr("id")+"Des");g.on("change",function(){""!==a(this).val()&&b.val(a(this).find("option:selected").text())})}function e(b){if("undefined"!=typeof f&&"undefined"!=typeof f.makes){var c,d=h.site.vehicleSelectionDefaults,e=[];d.hasOwnProperty(b)&&""!==d[b]&&(c=d[b]),e.push(a("<option/>",{text:"Please choose...",value:""})),e.push(a("<optgroup/>",{label:"Top Makes"})),e.push(a("<optgroup/>",{label:"All Makes"}));for(var i in f.makes)if(f.makes.hasOwnProperty(i)){var j,k=f.makes[i];j=a("<option/>",{text:k.label,value:k.code}),c==k.code&&j.prop("selected",!0),k.isTopMake===!0?j.appendTo(e[1],e[2]):e[2].append(j)}for(var l=0;l<e.length;l++)g.append(e[l]);""!==c&&g.trigger("change")}}var f,g,h=window.meerkat,i=(h.modules.events,h.logging.info,{roadsideVehicleMake:{}});i.roadsideVehicleMake;h.modules.register("roadsideVehicleMake",{init:c,events:i})}(jQuery);
//# sourceMappingURL=roadside.modules.ctm.min.map