/*!
 * CTM-Platform v0.8.3
 * Copyright 2015 Compare The Market Pty Ltd
 * http://www.comparethemarket.com.au/
 */


!function(a,b){function c(){d(!1);var b=null;a(document).ready(function(){f.modules.journeyEngine.configure({startStepId:b,steps:_.toArray(steps)})})}function d(a){e()}function e(){var b={title:"Login",navigationId:"login",slideIndex:0,onAfterEnter:function(){f.site.loggedIn&&f.modules.journeyEngine.gotoPath("next")},validation:{validate:!0,customValidation:function(a){return f.site.loggedIn?void a(!0):void f.modules.retrievequotesLogin.doLoginAndRetrieve().done(function(b,c,d){if("undefined"!=typeof b&&null!==b&&b.previousQuotes)f.site.responseJson=b,a(!0);else{try{a(!1)}catch(e){}f.modules.retrievequotesLogin.handleLoginFailure(d,c,"")}}).fail(function(b,c,d){try{a(!1)}catch(e){}f.modules.retrievequotesLogin.handleLoginFailure(b,c,d)})}}},c={title:"Your Quotes",navigationId:"quotes",slideIndex:1,onBeforeEnter:function(){f.modules.retrievequotesListQuotes.renderQuotes()},onAfterEnter:function(){""===a.trim(a("#quote-result-list").html())&&f.modules.retrievequotesListQuotes.noResults()}};steps={startStep:b,resultsStep:c}}var f=window.meerkat,g=(f.modules.events,{retrievequotesComponent:{},WEBAPP_LOCK:"WEBAPP_LOCK",WEBAPP_UNLOCK:"WEBAPP_UNLOCK"});f.modules.register("retrievequotesComponent",{init:c,events:g})}(jQuery),function(a,b){function c(){d()}function d(){a(document).on("click",".forgot-password",e).on("click",".reset-password",f)}function e(){var b=_.template(a("#forgot-password-template").html())();g=h.modules.dialogs.show({htmlContent:b,hashId:"forgot-password",buttons:[{label:"Back",className:"btn-close-dialog"},{label:"Reset Password",className:"btn-secondary reset-password"}],onOpen:function(b){h.modules.validation.setupDefaultValidationOnForm(a("#forgot-password-form"));var c=a("#login_email").val();a("#login_forgotten_email").val(c)}})}function f(){var b=a("#login_forgotten_email");if(b.valid()){var c=a(".reset-password");h.modules.loadingAnimation.showInside(c,!0);var d=h.modules.comms.post({errorLevel:"warning",url:"ajax/json/forgotten_password.jsp",data:{email:b.val()}}),e="We could not send your password reset email at this time",f=function(b){b=b||e;var c=_.template(a("#reset-password-failure-template").html(),{message:b});h.modules.dialogs.show({title:"Reset Password Error",htmlContent:c,hashId:"forgot-password",buttons:[{label:"OK",className:"btn-secondary btn-close-dialog"}]})};d.done(function(c){if("string"==typeof c&&(c=JSON.parse(c)),"undefined"!=typeof c.result){var d=c.result;if("OK"===d){var g=_.template(a("#reset-password-success-template").html(),{email:b.val()},{variable:"data"});h.modules.dialogs.show({title:"Reset Password",htmlContent:g,hashId:"forgot-password",buttons:[{label:"OK",className:"btn-secondary btn-close-dialog"}]})}else{var i=c.message||e,j={login_forgotten_email:i};a("#forgot-password-form").validate().showErrors(j)}}else f()}).fail(function(){f()}).always(function(){h.modules.dialogs.close(g),h.modules.loadingAnimation.hide(c)})}}var g,h=window.meerkat;h.modules.events;h.modules.register("retrievequotesComponentForgotPassword",{init:c})}(jQuery),function(a,b){function c(){d(),a(document).ready(function(){var b=a("#retrieve-quotes-container-template");b.length&&(w=_.template(b.html())),y={quote:a("#retrieve-car-template").html(),health:a("#retrieve-health-template").html(),life:a("#retrieve-life-template").html(),ip:a("#retrieve-ip-template").html(),homeloan:a("#retrieve-homeloan-template").html(),home:a("#retrieve-home-template").html(),utilities:a("#retrieve-utilities-template").html()}})}function d(){a(document).on("click","#logout-user",f).on("click","#new-quote",h).on("click",".btn-latest",j).on("click",".btn-amend",m).on("click",".btn-pending",e).on("click",".btn-start-again",l).on("click",".btn-start-again-fresh",k)}function e(a){var b=i(a.target),c=b.vertical+"_quote.jsp?action=confirmation&PendingID="+encodeURIComponent(b.pendingID);window.location.href=c}function f(a){x.modules.utils.scrollPageTo("html, body"),x.modules.journeyEngine.loadingShow("Logging you out...");var b=x.modules.comms.get({url:"generic/logout_user.json",errorLevel:"silent",dataType:"json"}),c=function(){x.modules.dialogs.show({title:"Unable to log out",htmlContent:"Sorry, we could not log you out at this time",buttons:[{label:"OK",className:"btn-close-dialog"}]}),x.modules.journeyEngine.loadingHide()};b.done(function(a){return"string"==typeof a&&(a=JSON.parse(a)),a.success&&a.success===!0?void(window.location.href="retrieve_quotes.jsp"):void c()}).fail(function(){c()})}function g(){x.modules.dialogs.show({htmlContent:a("#new-quote-template").html(),buttons:[!1],onOpen:function(b){a("#"+b).find(".btn-close-dialog, .modal-footer").remove()}})}function h(b){x.modules.dialogs.show({htmlContent:a("#new-quote-template").html(),className:"new-quote-dialog"})}function i(b){var c=a(b);"undefined"==typeof c.attr("data-vertical")&&(c=c.closest("a"));var d={$element:c,vertical:c.attr("data-vertical"),transactionId:c.attr("data-transactionid")};return"Y"===c.attr("data-inpast")&&(d.inPast="Y"),c.attr("data-pendingid")&&(d.pendingID=c.attr("data-pendingid")),d}function j(b){var c=i(b.target);x.modules.dialogs.show({title:"Enter New Commencement Date",htmlContent:a("#new-commencement-date-template").html(),buttons:[{label:"Cancel",className:"btn-close-dialog"},{label:"Get Latest Results",className:"btn-cta btn-submit"}],onOpen:function(b){x.modules.datepicker.setDefaults(),x.modules.datepicker.initModule(),a(document).on("click","#"+b+" .btn-submit",function(){var d=a("#newCommencementDate").val();x.modules.dialogs.close(b),n(c.vertical,"latest",c.transactionId,d)})}})}function k(a){var b=i(a.target);n(b.vertical,"start-again-fresh",b.transactionId)}function l(a){var b=i(a.target);n(b.vertical,"start-again",b.transactionId)}function m(a){var b=i(a.target);n(b.vertical,"amend",b.transactionId)}function n(a,b,c,d){"quote"===a&&(a="car"),x.modules.utils.scrollPageTo("html, body"),x.modules.journeyEngine.loadingShow("Retrieving your quote...");var e={vertical:a,action:b,transactionId:c};d&&(e.newDate=d);var f=x.modules.comms.post({url:"ajax/json/load_quote.jsp",errorLevel:"silent",dataType:"json",data:e}),g=function(a){a=a||"A problem occurred when trying to load your quote.",x.modules.dialogs.show({title:"Unable to load your quote",htmlContent:"<p>"+a+"</p>",buttons:[{label:"OK",className:"btn-secondary btn-close-dialog"}]}),x.modules.journeyEngine.loadingHide()};f.done(function(a){if("string"==typeof a&&(a=JSON.parse(a)),a&&a.result){var b=a.result;if(b.destUrl)return void(window.location.href=b.destUrl+"&ts="+Number(new Date));if(b.showToUser&&b.error)return void g(b.error)}g()}).fail(function(){g()})}function o(){a("#quote-result-list").html(w(x.site.responseJson))}function p(a,b){if(!a)return"";try{var c=_.template(y[a]);return c(b)}catch(d){return x.modules.errorHandling.error({errorLevel:"silent",page:"retrievequotesListQuotes.js",description:"Unable to render template ["+a+"]",message:"Unable to render template",data:{vertical:a,providedData:b}}),""}}function q(a){for(var b=_.keys(a),c=0;c<b.length;c++)if("id"!=b[c])return b[c];return!1}function r(a){return"M"==a?"Male":"Female"}function s(a){var b;switch(a){case 5:b=1;break;case 4:b=2;break;case 3:b=3;break;case 2:b=4;break;case 1:b=5;break;case 0:b=6}return 6==b?"Rating 6 No NCD":"undefined"==typeof b?"":"Rating "+b+" ("+a+" Years) NCD"}function t(a){if("undefined"==typeof a||"undefined"==typeof a.benefitsExtras)return"";for(var b=Object.keys(a.benefitsExtras),c=[],d=0;d<b.length;d++)"Y"==a.benefitsExtras[b[d]]&&c.push(b[d]);return c.join(", ")}function u(a){switch(a){case"F":return"A First Home Buyer";case"E":return"An Existing Home Owner"}return""}function v(a){switch(a){case"FH":return"Buy my first home";case"APL":return"Buy another property to live in";case"IP":return"Buy an investment property";case"REP":return"Renovate my existing property";case"CD":return"Consolidate my debt";case"CL":return"Compare better home loan options"}return""}var w,x=window.meerkat,y=(x.modules.events,{});x.modules.register("retrievequotesListQuotes",{init:c,renderQuotes:o,renderTemplate:p,getVerticalFromObject:q,noResults:g,getGenderString:r,carFormatNcd:s,healthBenefitsList:t,getHomeloanSituation:u,getHomeloanGoal:v})}(jQuery),function(a,b){function c(){d(),a(document).ready(function(a){j=a("#failed-login-template"),j.length&&(n=_.template(j.html()))})}function d(){a(document).on("click","#js-too-many-attempts",function(){k.modules.dialogs.close(i),a(document).find(".forgot-password").trigger("click")})}function e(){var b=k.modules.form.getData(a("#loginForm"));return k.modules.comms.post({url:"ajax/json/retrieve_quotes.jsp",data:b,async:!1,errorLevel:"warning",useDefaultErrorHandling:!1,cache:!1,dataType:"json"})}function f(b,c,d){k.modules.journeyEngine.unlockJourney(),k.modules.address.setHash("login");var e=b.responseText;if(!e)return g({url:b.url},"No responseText for request"),!1;var f={};try{f=a.parseJSON(e)}catch(i){g(i,"Could not decode responseText to JSON")}h(f)}function g(a,b){k.messaging.publish(l.WEBAPP_UNLOCK,{source:"retrievequotesLogin"}),k.modules.errorHandling.error({message:"An error occurred when attempting to login. Please try again.",page:"retrievequotesLogin.js:doLoginAndRetrieve()",errorLevel:"warning",description:b,data:a})}function h(a){var b={};a.length&&"undefined"!=typeof a[0].error?"exceeded-attempts"==a[0].error?b.suspended=!0:b.errorMessage=a[0].error:b.errorMessage="The email address or password that you entered was incorrect.",i=k.modules.dialogs.show({title:"A Problem Occurred",htmlContent:n(b),buttons:[{label:"Ok",className:"btn-default",closeWindow:!0}]})}var i,j,k=window.meerkat,l=k.modules.events,m=(k.logging.info,{retrievequotesLogin:{}}),n=(m.retrievequotesLogin,function(){return""});k.modules.register("retrievequotesLogin",{init:c,events:m,doLoginAndRetrieve:e,handleLoginFailure:f})}(jQuery);
//# sourceMappingURL=retrievequotes.modules.ctm.min.map