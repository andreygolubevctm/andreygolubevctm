/*!
 * CTM-Platform v0.8.3
 * Copyright 2015 Compare The Market Pty Ltd
 * http://www.comparethemarket.com.au/
 */


!function(a,b){function c(){a(document).ready(function(){if("car"!==m.site.vertical)return!1;if(e(),"confirmation"===m.site.pageAction)return!1;d(),("amend"===m.site.pageAction||"latest"===m.site.pageAction||"load"===m.site.pageAction||"start-again"===m.site.pageAction)&&m.modules.form.markInitialFieldsWithValue(a("#mainform"));var b=a("#quote-accessories-template");b.length>0&&(l=_.template(b.html())),b=a("#more-info-template"),b.length>0&&(templateMoreInfo=_.template(b.html())),b=a("#calldirect-template"),b.length>0&&(templateCallDirect=_.template(b.html()))})}function d(){}function e(){if("confirmation"===m.site.pageAction)m.modules.journeyEngine.configure(null);else{f(!1);var b=null;b=m.site.isFromBrochureSite===!0?p.startStep.navigationId:m.site.journeyStage.length>0&&"latest"===m.site.pageAction?p.resultsStep.navigationId:m.site.journeyStage.length>0&&"amend"===m.site.pageAction?p.startStep.navigationId:m.modules.emailLoadQuote.getStartStepOverride(b),a(document).ready(function(){_.defer(function(){m.modules.journeyEngine.configure({startStepId:b,steps:_.toArray(p)});var a=m.modules.transactionId.get();m.site.isNewQuote===!1?m.messaging.publish(n.tracking.EXTERNAL,{method:"trackQuoteEvent",object:{action:"Retrieve",transactionID:parseInt(a,10),vertical:m.site.vertical}}):m.messaging.publish(n.tracking.EXTERNAL,{method:"trackQuoteEvent",object:{action:"Start",transactionID:parseInt(a,10),vertical:m.site.vertical}})})})}}function f(a){g(),h(),a&&m.modules.journeyProgressBar.render(!0)}function g(){var b={title:"Your Car",navigationId:"start",slideIndex:0,externalTracking:{method:"trackQuoteForms",object:m.modules.car.getTrackingFieldsObject},onInitialise:function(b){var c=a(".slide-feature-emailquote");a("#quote_privacyoptin").is(":checked")&&c.addClass("privacyOptinChecked"),a("#quote_privacyoptin").on("change",function(b){a(this).is(":checked")?c.addClass("privacyOptinChecked"):c.removeClass("privacyOptinChecked")})},validation:{validate:!0,customValidation:function(b){a("#quote_vehicle_selection").find("select").each(function(){return a(this).is("[disabled]")?void b(!1):void 0}),b(!0)}}},c={title:"Car Details",navigationId:"options",slideIndex:1,externalTracking:{method:"trackQuoteForms",object:m.modules.car.getTrackingFieldsObject},tracking:{touchType:"H",touchComment:"OptionsAccs",includeFormData:!0},onInitialise:function(){m.modules.carYoungDrivers.initCarYoungDrivers()},onAfterEnter:function(b){$annualKilometers=a(".annual_kilometres_number"),$annualKilometers.on("keyup",function(b,c){$this=a(this),j($this,b)}),$annualKilometers.trigger("keyup")},onBeforeLeave:function(b){if($annualKilometers=a(".annual_kilometres_number"),$annualKilometers.length>0){var c=k($annualKilometers.val());$annualKilometers.val(c)}}},d={title:"Driver Details",navigationId:"details",slideIndex:2,externalTracking:{method:"trackQuoteForms",object:m.modules.car.getTrackingFieldsObject},tracking:{touchType:"H",touchComment:"DriverDtls",includeFormData:!0},onAfterEnter:function(b){$annualKilometersYoungest=a(".annual_kilometres_number_youngest"),$annualKilometersYoungest.on("keyup",function(b,c){$this=a(this),j($this,b)}),$annualKilometersYoungest.trigger("keyup")},onBeforeLeave:function(b){if($annualKilometersYoungest=a(".annual_kilometres_number_youngest"),$annualKilometersYoungest.length>0){var c=k($annualKilometersYoungest.val());$annualKilometersYoungest.val(c)}}},e={title:"Address & Contact",navigationId:"address",slideIndex:3,externalTracking:{method:"trackQuoteForms",object:m.modules.car.getTrackingFieldsObject},tracking:{touchType:"H",touchComment:"AddressCon",includeFormData:!0},onInitialise:function(b){var c=a("#quote_drivers_regular_firstname"),d=a("#quote_drivers_regular_surname"),e=a("#quote_contact_phoneinput"),f=a("#quote_contact_email"),g=a("#quote_contact_competition_optin"),h=m.modules.splitTest.isActive(2);g.length&&h&&g.on("change",function(){a(this).is(":checked")?(c.rules("add",{required:!0,messages:{required:"Please enter your First Name to be eligible for the competition"}}),d.rules("add",{required:!0,messages:{required:"Please enter your Last Name to be eligible for the competition"}}),e.rules("add",{required:!0,messages:{required:"Please enter your Contact Number to be eligible for the competition"}}),f.rules("add",{required:!0,messages:{required:"Please enter your Email Address to be eligible for the competition"}})):(c.rules("remove","required"),d.rules("remove","required"),e.rules("remove","required"),f.rules("remove","required"),c.valid(),d.valid(),e.valid(),f.valid())})},onAfterEnter:function(b){$telNumber=a(".contact_telno"),$streetNo=a(".typeahead-streetNum"),$postcode=a("#quote_riskAddress_nonStdPostCode"),$postcode.on("keyup",function(){$postcode.length>0&&a(this).val(k(a(this).val()))}),$telNumber.on("keyup",function(b,c){$telNumber.length>0&&a(this).val(trimNonPhoneNumbers(a(this).val()))}),$streetNo.on("keyup",function(){$streetNo.length>0&&a(this).val(k(a(this).val()))}),$postcode.trigger("keyup"),$telNumber.trigger("keyup"),$streetNo.trigger("keyup")},onBeforeLeave:function(a){}},f={title:"Results",navigationId:"results",slideIndex:4,externalTracking:{method:"trackQuoteForms",object:m.modules.car.getTrackingFieldsObject},onInitialise:function(a){m.modules.carResults.initPage(),m.modules.carMoreInfo.initMoreInfo(),m.modules.carEditDetails.initEditDetails()},onBeforeEnter:function(b){m.modules.journeyProgressBar.hide(),a("#resultsPage").addClass("hidden"),m.modules.carFilters.updateFilters()},onAfterEnter:function(b){m.modules.carResults.get(),m.modules.carFilters.show(),a(".header-wrap .quoteSnapshot").removeClass("hidden")},onBeforeLeave:function(b){b.isBackward===!0&&(m.modules.transactionId.getNew(3),a(".header-wrap .quoteSnapshot").addClass("hidden"))},onAfterLeave:function(a){m.modules.journeyProgressBar.show(),m.modules.carFilters.hide(),m.modules.carEditDetails.hide()}};p={startStep:b,optionsStep:c,detailsStep:d,addressStep:e,resultsStep:f}}function h(){m.modules.journeyProgressBar.configure([{label:"Your Car",navigationId:p.startStep.navigationId},{label:"Car Details",navigationId:p.optionsStep.navigationId},{label:"Driver Details",navigationId:p.detailsStep.navigationId},{label:"Address & Contact",navigationId:p.addressStep.navigationId},{label:"Your Quotes",navigationId:p.resultsStep.navigationId}])}function i(b){try{b=b||!1;var c=a("#quote_drivers_regular_dob").val();c.length>4&&(c=c.substring(c.length-4));var d=null,e=a("input[name=quote_drivers_regular_gender]:checked").val();if(!_.isUndefined(e))switch(e){case"M":d="Male";break;case"F":d="Female"}var f=null,g=a("input[name=quote_contact_marketing]:checked").val();_.isUndefined(g)||(f=g);var h=null,i=a("input[name=quote_contact_oktocall]:checked").val();_.isUndefined(i)||(h=i);var j=a("#quote_riskAddress_postCode").val(),k=a("#quote_riskAddress_state").val(),l=a("#quote_vehicle_year").val(),n=a("#quote_vehicle_make option:selected").text(),o=a("#quote_contact_email").val(),p=a("#quote_options_commencementDate").val(),q=m.modules.transactionId.get(),r=m.modules.journeyEngine.getCurrentStepIndex(),s=m.modules.journeyEngine.getFurtherestStepIndex(),t="";switch(r){case 0:t="your car";break;case 1:t="car details";break;case 2:t="driver details";break;case 3:t="address contact";break;case 4:t=b===!0?"more info":"car results"}var u={vertical:m.site.vertical,actionStep:t,transactionID:q,quoteReferenceNumber:q,yearOfManufacture:null,makeOfCar:null,gender:null,yearOfBirth:null,postCode:null,state:null,email:null,emailID:null,marketOptIn:null,okToCall:null,commencementDate:null};return s>m.modules.journeyEngine.getStepIndex("start")&&_.extend(u,{yearOfManufacture:l,makeOfCar:n}),s>m.modules.journeyEngine.getStepIndex("details")&&_.extend(u,{yearOfBirth:c,gender:d}),s>m.modules.journeyEngine.getStepIndex("address")&&_.extend(u,{postCode:j,state:k,email:o,marketOptIn:f,okToCall:h,commencementDate:p}),u}catch(v){return!1}}function j(a,b){var c=a.val(),d=k(c),e=d.length;if(c.length>7)a.val(c.substring(0,7));else if(e>3){var f=d.substring(e-3,e),g=d.substring(0,e-3);a.val(g+","+f)}else a.val(d)}function k(a){return a.replace(/\D/g,"")}var l,m=window.meerkat,n=m.modules.events,o=(m.logging.info,{car:{},WEBAPP_LOCK:"WEBAPP_LOCK",WEBAPP_UNLOCK:"WEBAPP_UNLOCK"}),p=null;m.modules.register("car",{init:c,events:o,initProgressBar:f,getTrackingFieldsObject:i})}(jQuery),function(a,b){function c(){a(document).ready(function(){d.modules.commencementDate.initCommencementDate({dateField:"#quote_options_commencementDate",getResults:d.modules.carResults.get,updateData:function(b){_.extend(b,{youngDriver:a("input[name=quote_drivers_young_exists]:checked").val()})}})})}var d=window.meerkat;d.modules.events,d.logging.info;d.modules.register("carCommencementDate",{init:c})}(jQuery),function(a,b){function c(){var b=n.modules.performanceProfiling.isMobile(),c=-1!==_.indexOf(["lg","md"],n.modules.deviceMediaState.get());!b&&c&&(a(p.marketing).rules("remove","validateOkToEmailRadio"),a(p.marketing).rules("add","required"),a(p.oktocall).rules("remove","validateOkToCallRadio"),a(p.oktocall).rules("add","required"))}function d(){$mkt=a(p.marketing),$otc=a(p.oktocall),$mkt.is(":checked")||$mkt.filter("input[value=N]").prop("checked",!0).change(),$otc.is(":checked")||$otc.filter("input[value=N]").prop("checked",!0).change()}function e(){a(p.oktocall).on("change",g),a(p.marketing).on("change",i),a(p.privacy).on("change",j),a(p.phone).on("change",f),a(p.email).on("change",h)}function f(){a(p.oktocall).closest(".row-content").hasClass("has-error")&&_.defer(function(){a(p.oktocall).valid()})}function g(){"Y"!==l(p.oktocall)&&($row=a(p.phoneRow),$row.find(".has-error").removeClass("has-error"),$row.find(".error-field").empty().hide())}function h(){a(p.marketing).closest(".row-content").hasClass("has-error")&&_.defer(function(){a(p.marketing).valid()})}function i(){"Y"!==l(p.marketing)&&($row=a(p.emailRow),$row.find(".has-error").removeClass("has-error"),$row.find(".error-field").empty().hide())}function j(){var b=l(p.privacy);a(p.fsg).val(b),a(p.terms).val(b)}function k(){n.logging.debug("optin data",{oktocall:l(p.oktocall),privacy:l(p.privacy),marketing:l(p.marketing),fsg:a(p.fsg).val(),terms:a(p.terms).val()})}function l(b){var c=a(b);return"radio"===c.first().attr("type")?"Y"===c.filter(":checked").val()?"Y":"N":c.is(":checked")?"Y":"N"}function m(){a(document).ready(function(){return"car"!==n.site.vertical?!1:(e(),c(),void k())})}var n=window.meerkat,o=(n.modules.events,n.logging.info,{}),p={fsg:"#quote_fsg",marketing:"#quote_contactFieldSet input[name='quote_contact_marketing']",oktocall:"#quote_contactFieldSet input[name='quote_contact_oktocall']",privacy:"#quote_privacyoptin",terms:"#quote_terms",phone:"#quote_contact_phoneinput",phoneRow:"#contactNoRow",emailRow:"#contactEmailRow",email:"#quote_contact_email"};n.modules.register("carContactOptins",{init:m,events:o,validateOptins:d,dump:k})}(jQuery),function(a,b){function c(){d(),e()}function d(){q.on("show.bs.dropdown",function(){var b=a("#edit-details-template");b.length>0&&(templateCallback=_.template(b.html()));var c={youngDriver:a("input[name=quote_drivers_young_exists]:checked").val()};f(templateCallback(c))}).on("click",".closeDetailsDropdown",function(a){g(),a.stopPropagation()}).on("click",".dropdown-container",function(a){a.stopPropagation()})}function e(){n.messaging.subscribe(o.WEBAPP_LOCK,function(a){g(),q.children(".activator").addClass("inactive").addClass("disabled")}),n.messaging.subscribe(o.WEBAPP_UNLOCK,function(a){q.children(".activator").removeClass("inactive").removeClass("disabled")}),n.messaging.subscribe(o.device.STATE_ENTER_XS,function(){g()}),n.messaging.subscribe(o.device.STATE_LEAVE_XS,function(){g()})}function f(a){"xs"==n.modules.deviceMediaState.get()?r=h(a):i(a)}function g(){q.hasClass("open")&&q.find(".activator").dropdown("toggle").end().find(".edit-details-wrapper").empty(),null!==r&&a("#"+r).modal("hide")}function h(b){var c=n.modules.dialogs.show({htmlContent:'<div class="edit-details-wrapper"></div>',hashId:"edit-details",className:"edit-details-modal",closeOnHashChange:!0,onOpen:function(c){var d=a(".edit-details-wrapper",a("#"+c));d.html(b),n.modules.contentPopulation.render("#"+c+" .edit-details-wrapper"),a(".accordion-collapse").on("show.bs.collapse",function(){a(this).prev(".accordion-heading").addClass("active-panel")}).on("hide.bs.collapse",function(){a(this).prev(".accordion-heading").removeClass("active-panel")}),d.show()}});return c}function i(b){var c=a("#edit-details-dropdown .edit-details-wrapper");c.html(b),n.modules.contentPopulation.render("#edit-details-dropdown .edit-details-wrapper"),c.find(".accordion-collapse").addClass("in").end().show()}function j(a){var b,c=a.val();switch(c){case"5":b=1;break;case"4":b=2;break;case"3":b=3;break;case"2":b=4;break;case"1":b=5;break;case"0":b=6}return 6==b?"Rating 6 No NCD":"undefined"==typeof b?"":"Rating "+b+" ("+c+" Years) NCD"}function k(a){var b,c=a.val(),d="";switch(c){case"H":b=21;break;case"7":b=25;break;case"A":b=30;break;case"D":b=40}return"3"==c?d="No Restrictions":"undefined"!=typeof b&&(d="Restricted to "+b+" or older"),d}function l(a){var b=a.find(":checked").val(),c=" Accident/Hail Damage";return"Y"===b?c:"N"===b?"No"+c:""}function m(a){var b="";return b=n.modules.carVehicleSelection.isSplitTest()?a.find("input:checked").parent().text():a.text()}var n=window.meerkat,o=n.modules.events,p=(n.logging.info,{carEditDetails:{}}),q=(p.carEditDetails,a("#edit-details-dropdown")),r=null;n.modules.register("carEditDetails",{initEditDetails:c,events:p,driverOptin:k,formatNcd:j,formatDamage:l,formatRedbookCode:m,hide:g})}(jQuery),function(a,b){function c(){if(s.removeClass("active"),t.removeClass("active"),"undefined"!=typeof Results.settings&&Results.settings.hasOwnProperty("displayMode")===!0)switch(Results.getDisplayMode()){case"price":s.addClass("active");break;case"features":t.addClass("active")}var b=a("#quote_paymentType").val();"undefined"==typeof b?u.find(".dropdown-toggle span").text(u.find(".dropdown-menu a:first").text()):u.find(".dropdown-toggle span").text(u.find('.dropdown-menu a[data-value="'+b+'"]').text());var c=a("#quote_excess").val();"undefined"==typeof c?v.find(".dropdown-toggle span").text(v.find(".dropdown-menu a:first").text()):v.find(".dropdown-toggle span").text(v.find('.dropdown-menu a[data-value="'+c+'"]').text())}function d(b){b.preventDefault();var c=a(b.target),d=c.parents(".dropdown"),e=c.attr("data-value");d.find(".dropdown-toggle span").text(c.text()),c.parent().siblings().removeClass("active"),c.parent().addClass("active"),d.hasClass("filter-frequency")?e!==D.frequency&&(D.frequency=e,a("#quote_paymentType").val(D.frequency),Results.setFrequency(e),w.messaging.publish(z.CHANGED)):d.hasClass("filter-excess")&&e!==D.excess&&(D.excess=e,a("#quote_excess").val(e),w.messaging.publish(z.CHANGED,{excess:e}))}function e(){D={display:Results.getDisplayMode(),frequency:a("#quote_paymentType").val(),excess:a("#quote_excess").val()}}function f(){u.find("li.active").removeClass("active"),u.find("a[data-value="+D.frequency+"]").each(function(){a(this).parent().addClass("active")}),v.find("li.active").removeClass("active"),_.isEmpty(D.excess)||v.find("a[data-value="+D.excess+"]").each(function(){a(this).parent().addClass("active")})}function g(){r.slideUp(200,function(){r.addClass("hidden")})}function h(){r.removeClass("hidden").hide().slideDown(200),e(),f()}function i(){r.find("li.dropdown, .dropdown-toggle").addClass("disabled"),s.addClass("disabled"),s.find("a").addClass("disabled"),t.addClass("disabled"),t.find("a").addClass("disabled"),a(".slide-feature-filters").find("a").addClass("disabled").addClass("inactive")}function j(){w.modules.compare.isCompareOpen()===!1&&(r.find("li.dropdown.filter-excess, .filter-excess .dropdown-toggle").removeClass("disabled"),s.removeClass("disabled"),s.find("a").removeClass("disabled"),t.removeClass("disabled"),t.find("a").removeClass("disabled"),a(".slide-feature-filters").find("a").removeClass("inactive").removeClass("disabled")),r.find("li.dropdown.filter-frequency, .filter-frequency .dropdown-toggle").removeClass("disabled")}function k(){a(document).on("resultsFetchStart",function(){i()}),a(document).on("pagination.scrolling.start",function(){C=!0,i()}),a(document).on("resultsFetchFinish",function(){j()}),a(document).on("pagination.scrolling.end",function(){C=!1,j()}),w.messaging.subscribe(x.compare.EXIT_COMPARE,j),a(document.body).on("mousewheel DOMMouseScroll onmousewheel",function(a){C&&(a.preventDefault(),a.stopPropagation())}),s.on("click",function(b){b.preventDefault(),a(this).hasClass("disabled")||(w.modules.carResults.switchToPriceMode(!0),c(),w.modules.session.poke())}),t.on("click",function(b){b.preventDefault(),a(this).hasClass("disabled")||(w.modules.carResults.switchToFeaturesMode(!0),c(),w.modules.session.poke())}),r.on("click",".dropdown-menu a",d)}function l(){var b=_.template(a("#car-xsFilterBar-template").html()),c=a("#quote_excess").val(),d=b({startingValue:_.isEmpty(c)?0:c});return B=w.modules.dialogs.show({title:a(this).attr("title"),htmlContent:d,hashId:"xsFilterBar",rightBtn:{label:"Save Changes",className:"btn-sm btn-save",callback:n},closeOnHashChange:!0,onOpen:m}),!1}function m(){"undefined"!=typeof Results.settings&&Results.settings.hasOwnProperty("displayMode")===!0&&(a("#xsFilterBarSortRow input:checked").prop("checked",!1),a("#xsFilterBarSortRow #xsFilterBar_sort_"+Results.getDisplayMode()).prop("checked",!0).change()),a("#xsFilterBarFreqRow input:checked").prop("checked",!1),a("#xsFilterBarFreqRow #xsFilterBar_freq_"+a("#quote_paymentType").val()).prop("checked",!0).change();try{w.modules.sliders.init()}catch(b){}}function n(){var b=a("#quote_paymentType"),d=a("#quote_excess"),e={display:a("#xsFilterBarSortRow input:checked").val(),freq:a("#xsFilterBarFreqRow input:checked").val(),excess:a("#xsFilterBarExcessRow input[name=xsFilterBar_excess]").val()};0===Number(e.excess)&&(e.excess=""),b.val(e.freq),d.val(e.excess),e.display!==D.display&&("features"===e.display?w.modules.carResults.switchToFeaturesMode(!0):"price"===e.display&&w.modules.carResults.switchToPriceMode(!0)),w.modules.dialogs.close(B),w.modules.navMenu.close(),c(),D.frequency!==e.freq&&(D.frequency=e.freq,Results.setFrequency(D.frequency),w.messaging.publish(z.CHANGED)),D.excess!==e.excess&&(D.excess=e.excess,w.messaging.publish(z.CHANGED,{excess:e.excess}))}function o(){var b=!a("#navbar-filter").hasClass("hidden");b&&A===!0&&(e(),l())}function p(a){A=_.isUndefined(a)?"xs"===w.modules.deviceMediaState.get():a.isXS===!0,A===!1&&w.modules.dialogs.isDialogOpen(B)&&w.modules.dialogs.close(B)}function q(){r=a("#navbar-filter"),0!==r.length&&(s=r.find(".filter-pricemode"),t=r.find(".filter-featuresmode"),u=r.find(".filter-frequency"),v=r.find(".filter-excess"),k(),a(document).ready(function(){var b;b=v.find(".dropdown-menu"),a("#filter_excessOptions option").each(function(){b.append('<li><a href="javascript:;" data-value="'+this.value+'">'+this.text+"</a></li>")}),b=u.find(".dropdown-menu"),a("#filter_paymentType option").each(function(){b.append('<li><a href="javascript:;" data-value="'+this.value+'">'+this.text+"</a></li>")}),a("#navbar-main .slide-feature-filters a").on("click",function(b){b.preventDefault(),a(this).hasClass("disabled")||o()}),w.messaging.subscribe(x.device.STATE_ENTER_XS,_.bind(p,this,{isXS:!0})),w.messaging.subscribe(x.device.STATE_LEAVE_XS,_.bind(p,this,{isXS:!1})),p()}))}var r,s,t,u,v,w=window.meerkat,x=w.modules.events,y=(w.logging.info,{carFilters:{CHANGED:"CAR_FILTERS_CHANGED"}}),z=y.carFilters,A=!1,B=!1,C=!1,D={display:!1,frequency:!1,excess:!1};w.modules.register("carFilters",{init:q,events:y,updateFilters:c,hide:g,show:h,disable:i,enable:j,onRequestModal:o})}(jQuery),function(a,b){function c(){var b={container:K,hideAction:"fadeOut",showAction:"fadeIn",modalOptions:{className:"modal-breakpoint-wide modal-tight bridgingContainer",openOnHashChange:!1,leftBtn:{label:"All Products",icon:'<span class="icon icon-arrow-left"></span>',callback:function(b){a(b.currentTarget).closest(".modal").modal("hide")}}},runDisplayMethod:r,onBeforeShowBridgingPage:o,onBeforeShowTemplate:B,onBeforeShowModal:B,onAfterShowModal:A,onAfterShowTemplate:p,onBeforeHideTemplate:null,onAfterHideTemplate:q,onClickApplyNow:t,onBeforeApply:null,onApplySuccess:C,retrieveExternalCopy:s,additionalTrackingData:{productName:null},onBreakpointChangeCallback:_.bind(f,this,".paragraphedContent",".moreInfoRightColumn",K)};H.modules.moreInfo.initMoreInfo(b),j(),d()}function d(){a(document).on("click",".bridgingContainer .btn-call-actions",function(b){var c=a(this);k(b,c)}).on("click",".call-modal .btn-call-actions",function(b){var c=a(this);l(b,c)}).on("click",".btn-submit-callback",function(b){var c=a(this);m(b,c)}),a(".slide-feature-closeMoreInfo a").off().on("click",function(){H.modules.moreInfo.close()})}function e(){setupDefaultValidationOnForm(a("#getcallback"));var b=a("#quote_CrClientName");b.length&&!b.val().length&&b.val(a("#quote_drivers_regular_firstname").val()+" "+a("#quote_drivers_regular_surname").val());var c=a("#quote_CrClientTelinput");c.length&&!c.val().length&&c.val(a("#quote_contact_phone").val()),c.attr("data-msg-required","Please enter your contact number")}function f(a,b,c){("lg"==H.modules.deviceMediaState.get()||"md"==H.modules.deviceMediaState.get())&&g(a,b,c)}function g(b,c,d){if("xs"!=H.modules.deviceMediaState.get()&&a(c,d).length){a(b,d).css("min-height","0px"),a(c,d).css("min-height","0px");var e=a(b,d).outerHeight(),f=a(c,d).outerHeight();e>=f?(a(c,d).css("min-height",e+"px"),a(b,d).css("min-height",e+"px")):(a(c,d).css("min-height",f+"px"),a(b,d).css("min-height",f+"px"))}}function h(a,b){v(b);var c=b;if("undefined"==typeof L[c.productId]){var d=H.site.tracking.brandCode.toUpperCase();return i(a,{message:d+" - Car Vertical - Call direct",phonecallme:"CallDirect"},b)}}function i(b,c,d){"undefined"!=typeof d&&null!==d&&"undefined"!=typeof d.vdn&&!_.isEmpty(d.vdn)&&d.vdn>0&&(c.vdn=d.vdn);var e=(H.site.tracking.brandCode.toUpperCase(),{state:a("#quote_riskAddress_state").val(),brand:d.productId.split("-")[0],productId:d.productId});a.extend(e,{clientNumber:d.leadNo,clientName:a("#quote_CrClientName").val()||"",phoneNumber:a("#quote_CrClientTelinput").val()||"",partnerReference:H.modules.transactionId.get()});var f=a.extend(e,c),g=a(b.target);return H.modules.loadingAnimation.showInside(g,!0),H.modules.comms.post({url:"leadfeed/car/getacall.json",data:f,dataType:"json",cache:!1,errorLevel:"GetaCall"===c.phonecallme?"warning":"silent",onSuccess:function(b){if("GetaCall"==c.phonecallme){H.modules.dialogs.show({title:"Call back request recorded",htmlContent:"<p><strong>Thank you!</strong></p><p>Your Call request has been sent to the insurer's message centre who will be in touch as soon as possible.</p>",hashId:"call-back-success",openOnHashChange:!1,closeOnHashChange:!0,onOpen:function(a){var b=H.modules.sessionCamHelper.getMoreInfoStep(G+"-submitted");H.modules.sessionCamHelper.updateVirtualPage(b)},onClose:function(b){var c=H.modules.sessionCamHelper.getMoreInfoStep(G);H.modules.sessionCamHelper.updateVirtualPage(c),a(".modal").modal("hide"),H.modules.moreInfo.isBridgingPageOpen()&&H.modules.moreInfo.close()}})}},onComplete:function(){"CallDirect"==c.phonecallme&&(L[d.productId]=!0),H.modules.loadingAnimation.hide(g)}})}function j(){H.messaging.subscribe(I.ADDRESS_CHANGE,function(a){"xs"!=H.modules.deviceMediaState.get()&&-1==a.hash.indexOf("results/moreinfo")&&H.modules.moreInfo.hideTemplate(K)}),H.messaging.subscribe(I.device.STATE_ENTER_XS,function(){H.modules.moreInfo.isBridgingPageOpen()&&H.modules.moreInfo.close(),"undefined"!=typeof E&&a("#"+E).modal("hide")}),H.messaging.subscribe(I.device.STATE_LEAVE_XS,function(){H.modules.moreInfo.isModalOpen()&&H.modules.moreInfo.close(),"undefined"!=typeof E&&a("#"+E).modal("hide")}),H.messaging.subscribe(I.errorHandling.OK_CLICKED,function(){(H.modules.moreInfo.isBridgingPageOpen()||H.modules.moreInfo.isModalOpen())&&H.modules.moreInfo.close()}),H.messaging.subscribe(I.transactionId.CHANGED,function(){O=!0}),H.messaging.subscribe(I.carResults.FEATURES_CALL_ACTION,function(a){k(a.event,a.element)}),H.messaging.subscribe(I.carResults.FEATURES_CALL_ACTION_MODAL,function(a){l(a.event,a.element)}),H.messaging.subscribe(I.carResults.FEATURES_SUBMIT_CALLBACK,function(a){m(a.event,a.element)})}function k(b,c){b.preventDefault(),b.stopPropagation();var d=c,f=a("#car-call-modal-template");f.length>0&&(templateCallback=_.template(f.html()));var i=Results.getResultByProductId(d.attr("data-productId"));if("Y"===i.available){G=d.attr("data-callback-toggle");var j=H.modules.sessionCamHelper.getMoreInfoStep(G),k=templateCallback(i),l={htmlContent:k,hashId:"call",className:"call-modal "+i.brandCode,closeOnHashChange:!0,openOnHashChange:!1,onOpen:function(c){a("."+G).show(),g(".paragraphedContent:visible",".sidebar-right",a("#"+c)),e(),d.hasClass("btn-calldirect")?h(b,i):w(i),H.modules.sessionCamHelper.updateVirtualPage(j)},onClose:function(a){H.modules.sessionCamHelper.setMoreInfoModal()}};"xs"==H.modules.deviceMediaState.get()&&(l.title="Reference no. "+i.leadNo),E=H.modules.dialogs.show(l)}}function l(b,c){"xs"!=H.modules.deviceMediaState.get()&&b.preventDefault(),b.stopPropagation();var d=c,e=Results.getResultByProductId(d.attr("data-productId"));G=d.attr("data-callback-toggle");var f=H.modules.sessionCamHelper.getMoreInfoStep(G);switch(G){case"calldirect":a(".callback").hide(),a(".calldirect").show(),h(b,e);break;case"callback":a(".calldirect").hide(),a(".callback").show(),w(e)}g(".paragraphedContent:visible",".sidebar-right",d.closest(".modal.in")),H.modules.sessionCamHelper.updateVirtualPage(f)}function m(a,b){a.preventDefault();var c=b,d=Results.getResultByProductId(c.attr("data-productId"));if(c.closest("form").valid()){var e=H.site.tracking.brandCode.toUpperCase();i(a,{message:e+" - Car Vertical - Call me now",phonecallme:"GetaCall"},d),x(d)}else _.delay(function(){g(".paragraphedContent:visible",".sidebar-right",c.closest(".modal.in"))},200);return!1}function n(){F=a(window).scrollTop()}function o(){n(),"xs"!=H.modules.deviceMediaState.get()&&a(".resultsContainer, #navbar-filter, #navbar-compare").hide()}function p(){A(),("lg"==H.modules.deviceMediaState.get()||"md"==H.modules.deviceMediaState.get())&&g(".paragraphedContent",".moreInfoRightColumn",K)}function q(){a(".resultsContainer, #navbar-filter, #navbar-compare").show(),a(window).scrollTop(F)}function r(a){"xs"!=H.modules.deviceMediaState.get()?H.modules.moreInfo.showTemplate(K):H.modules.moreInfo.showModal(),H.modules.address.appendToHash("moreinfo")}function s(a){return H.modules.comms.get({url:"ajax/json/get_scrapes.jsp",cache:!0,data:{type:"carBrandScrapes",code:a.productId,group:"car"},errorLevel:"silent",onSuccess:function(a){H.modules.moreInfo.setDataResult(a)}})}function t(b,c){var d=0===b.service.search(/agis_/i);if(N===!0&&M.length>0&&!d){var e=a("#special-conditions-template");e.length>0&&(templateCallback=_.template(e.html()));var f=H.modules.moreInfo.getOpenProduct();f.specialConditionsRule=M;var g=templateCallback(f);H.modules.dialogs.show({htmlContent:g,hashId:"special-conditions",title:"Special Conditions Confirmation",closeOnHashChange:!0,openOnHashChange:!1,onOpen:function(d){a(".btn-proceed-to-insurer",a("#"+d)).off("click.proceed").on("click.proceed",function(a){return a.preventDefault(),u(b,d,c)}),a(".btn-back",a("#"+d)).off("click.goback").on("click.goback",function(b){a(".modal").modal("hide"),H.modules.moreInfo.isBridgingPageOpen()&&H.modules.moreInfo.close()})},onClose:function(a){H.modules.moreInfo.applyCallback(!1)}});return!1}return u(b,!1,c)}function u(b,c,d){if(c&&a("#"+c).modal("hide"),E&&a("#"+E).modal("hide"),_.isEmpty(b.quoteUrl))return H.modules.errorHandling.error({errorLevel:"warning",message:"An error occurred. Sorry about that!<br /><br /> To purchase this policy, please contact the provider "+(""!==b.telNo?" on "+b.telNo:"directly")+" quoting "+b.leadNo+", or select another policy.",page:"carMoreInfo.js:proceedToInsurer",description:"Insurer did not provide quoteUrl in results object.",data:b}),!1;var e=b.leadfeedinfo.split("||"),f=!1;return _.isEmpty(e[0])||(f={data:{vertical:H.site.vertical,phonecallme:"NoSaleCall",productId:b.productId,clientName:e[0],phoneNumber:e[1],clientNumber:b.leadNo,partnerReference:H.modules.transactionId.get(),brand:b.productId.split("-")[0],state:a("#quote_riskAddress_state").val()},settings:{errorLevel:"silent"}}),H.modules.partnerTransfer.transferToPartner({encodeTransferURL:!0,product:b,applyNowCallback:d,productName:b.headline.name,productBrandCode:b.brandCode,brand:b.productDes,noSaleLead:f}),!0}function v(a){O===!0&&(O=!1,y("CrCallDir",a))}function w(a){y("CrCallBac",a)}function x(a){y("CrCallBacSub",a)}function y(a,b){H.modules.partnerTransfer.trackHandoverEvent({product:b,type:a,quoteReferenceNumber:b.leadNo,productID:b.productId,productName:b.headline.name,productBrandCode:b.brandCode},!1,!1)}function z(){H.messaging.publish(I.tracking.EXTERNAL,{method:"trackQuoteForms",object:_.bind(H.modules.car.getTrackingFieldsObject,this,!0)})}function A(){var a={additionalTrackingData:{productName:H.modules.moreInfo.getOpenProduct().headline.name}};H.modules.moreInfo.updateSettings(a),z()}function B(b){"undefined"!=typeof b&&"undefined"!=typeof b.scrapes&&b.scrapes.length>0&&a.each(b.scrapes,function(b,c){""!==c.html&&a(c.cssSelector).html(c.html)}),a(".contentRow li").each(function(){a(this).prepend('<span class="icon icon-angle-right"></span>')})}function C(a){}function D(a,b){N=a,M=b}var E,F,G,H=window.meerkat,I=H.modules.events,J={carMoreInfo:{}},K=(J.carMoreInfo,a(".bridgingContainer")),L={},M="",N=!1,O=!0;H.modules.register("carMoreInfo",{initMoreInfo:c,events:J,setSpecialConditionDetail:D,runDisplayMethod:r,setScrollPosition:n})}(jQuery),function(a,b){function c(){m.messaging.subscribe(n.car.DROPDOWN_CHANGED,d),a(document).ready(function(){r.container=a("#rego-lookup-form"),!_.isUndefined(m.modules.regoLookup)&&r.container&&(r.button=r.container.find(".rego-lookup-button").first(),r.state=r.container.find(".rego-lookup-state").first(),r.stateRow=r.state.closest(".row-content"),r.rego=r.container.find(".rego-lookup-number").first(),r.regoRow=r.rego.closest(".row-content"),r.feedback=r.container.find(".rego-lookup-feedback").first(),r.state.off().on("change",e),r.rego.off().on("keyup",f),r.button.off().on("click",h))})}function d(){l(!1),r.state.prop("selectedIndex",0),r.rego.val(""),k(r.state,r.stateRow,q.NEUTRAL),k(r.rego,r.regoRow,q.NEUTRAL)}function e(a){a=a||!1,m.messaging.publish(p.REGO_LOOKUP_FORM_IN_USE);var b=r.state.val(),c=!0;return _.isEmpty(b)?(k(r.state,r.stateRow,a===!0?q.FAIL:q.NEUTRAL),c=!1):k(r.state,r.stateRow,q.PASS),c===!0?{state:b}:c}function f(b){b=b||!1,m.messaging.publish(p.REGO_LOOKUP_FORM_IN_USE);var c=a.trim(r.rego.val()),d=!0;return _.isEmpty(c)?(k(r.rego,r.regoRow,b===!0?q.FAIL:q.NEUTRAL),d=!1):k(r.rego,r.regoRow,q.PASS),d===!0?{plateNumber:c}:d}function g(){var a=e(!0),b=f(!0);return a!==!1&&b!==!1?(l(!1),_.extend({},a,b)):!1}function h(a){a=a||!1,_.isObject(a)&&a.preventDefault();var b=g();b!==!1?("xs"==m.modules.deviceMediaState.get()?m.modules.loadingAnimation.showInside(r.button):m.modules.loadingAnimation.showAfter(r.button),m.messaging.publish(p.REGO_LOOKUP_STARTED),r.feedback.empty(),m.modules.regoLookup.get(b,{useDefaultErrorHandling:!1,onSuccess:_.bind(i,this,b),onError:_.bind(j,this,b)})):l("Please ensure you enter the state and registration number of your vehicle")}function i(a,b){if(m.modules.loadingAnimation.hide(r.button),_.has(b,"vehicle_data")&&_.isObject(b.vehicle_data)){var c=b.vehicle_data;if(_.has(c,"exception"))switch(c.exception){case"invalid_state":l("An invalid state has been selected. Please try again.");break;case"rego_not_found":l("Sorry, no registration details found for state '"+a.state+"' and registration no. '"+a.plateNumber+"'");
break;default:case"service_error":case"dao_error":case"request_limit_exceeded":case"daily_limit_exceeded":case"daily_limit_undefined":case"daily_usage_error":case"service_turned_off":case"service_toggle_undefined":case"transaction_unverified":l("Sorry, this service is presently unavailable. Please locate your vehicle using the options below.")}else m.messaging.publish(p.REGO_LOOKUP_COMPLETE,c,_.bind(m.modules.journeyEngine.gotoPath,this,"options"))}}function j(a,b){m.modules.loadingAnimation.hide(r.button),l("Sorry, this service is experiencing some difficulties. Please try again or perhaps locate your vehicle using the options below."),m.modules.errorHandling.error({errorLevel:"silent",page:"Rego Lookup ("+m.site.vertical+")",title:"Rego Lookup Ajax Error",message:"Fatal ajax call for rego lookup",description:"Status: "+b.status+", statusText: "+b.statusText,data:a,id:m.modules.transactionId.get()})}function k(a,b,c){(c===q.NEUTRAL||c===q.PASS)&&(a.removeClass("has-error"),b.removeClass("has-error")),(c===q.NEUTRAL||c===q.FAIL)&&(a.removeClass("has-success"),b.removeClass("has-success")),c===q.FAIL&&(a.addClass("has-error"),b.addClass("has-error")),c===q.PASS&&(a.addClass("has-success"),b.addClass("has-success"))}function l(a){r.feedback.empty().append(a)}var m=window.meerkat,n=m.modules.events,o={regoLookup:{REGO_LOOKUP_FORM_IN_USE:"REGO_LOOKUP_FORM_IN_USE",REGO_LOOKUP_STARTED:"REGO_LOOKUP_STARTED",REGO_LOOKUP_COMPLETE:"REGO_LOOKUP_COMPLETE"}},p=o.regoLookup,q={NEUTRAL:0,PASS:!0,FAIL:!1},r={container:null,button:null,state:null,stateRow:null,rego:null,regoRow:null,feedback:null};m.modules.register("carRegoLookup",{init:c,events:o})}(jQuery),function(a){function b(){d(),Features.init(),s.modules.compare.initCompare(),e(),f()}function c(){f(),w!==s.modules.deviceMediaState.get()&&(Results.view.calculateResultsContainerWidth(),Features.clearSetHeights(),Features.balanceVisibleRowsHeight()),Results.pagination.refresh()}function d(){try{var a="price";s.modules.splitTest.isActive(18)&&(a="features"),Results.init({url:"ajax/json/car_quote_results.jsp",runShowResultsPage:!1,paths:{productId:"productId",productName:"headline.name",productBrandCode:"brandCode",price:{annually:"headline.lumpSumTotal",annual:"headline.lumpSumTotal",monthly:"headline.instalmentTotal"},availability:{product:"available",price:{annually:"headline.lumpSumTotal",annual:"headline.lumpSumTotal",monthly:"headline.instalmentTotal"}}},show:{savings:!1,featuresCategories:!1,nonAvailablePrices:!0,nonAvailableProducts:!1,unavailableCombined:!0},availability:{product:["equals","Y"],price:["notEquals",-1]},render:{templateEngine:"_",features:{mode:"populate",headers:!1,numberOfXSColumns:1},dockCompareBar:!1},displayMode:a,pagination:{mode:"page",touchEnabled:Modernizr.touch},sort:{sortBy:"price.annually"},frequency:"annual",animation:{results:{individual:{active:!1},delay:500,options:{easing:"swing",duration:1e3}},shuffle:{active:!0,options:{easing:"swing",duration:1e3}},filter:{reposition:{options:{easing:"swing"}}}},elements:{features:{values:".content",extras:".children"}},templates:{pagination:{pageText:"Product {{=currentPage}} of {{=totalPages}}"}},dictionary:{valueMap:[{key:"Y",value:"<span class='icon icon-tick'></span>"},{key:"N",value:"<span class='icon icon-cross'></span>"},{key:"R",value:"Restricted / Conditional"},{key:"AI",value:"Additional Information"},{key:"O",value:"Optional"},{key:"L",value:"Limited"},{key:"SCH",value:"As shown in schedule"},{key:"NA",value:"Non Applicable"},{key:"E",value:"Excluded"},{key:"NE",value:"No Exclusion"},{key:"NS",value:"No Sub Limit"},{key:"OTH",value:""}]},rankings:{paths:{rank_productId:"productId",rank_premium:"headline.lumpSumTotal"},filterUnavailableProducts:!1},incrementTransactionId:!1})}catch(b){Results.onError("Sorry, an error occurred initialising page","results.tag","meerkat.modules.carResults.initResults(); "+b.message,b)}}function e(){a(document.body).on("click","a.offerTerms",n),a(Results.settings.elements.resultsContainer).on("click",".result-row",q),s.messaging.subscribe(t.affix.AFFIXED,function(){a("#resultsPage").css("margin-top","35px")}),s.messaging.subscribe(t.affix.UNAFFIXED,function(){a("#resultsPage").css("margin-top","0")}),s.messaging.subscribe(t.carFilters.CHANGED,function(a){a&&a.hasOwnProperty("excess")?(Results.settings.incrementTransactionId=!0,j(),Results.settings.incrementTransactionId=!1):s.modules.resultsTracking.setResultsEventMode("Refresh"),s.modules.session.poke()}),s.messaging.subscribe(u.RESULTS_ERROR,function(){_.delay(function(){s.modules.journeyEngine.gotoPath("previous")},1e3)}),a(Results.settings.elements.resultsContainer).on("featuresDisplayMode",function(){Features.buildHtml()}),a(Results.settings.elements.resultsContainer).on("noFilteredResults",function(){Results.view.show()}),a(document).on("resultsLoaded",k),a(document).on("resultsReturned",function(){s.modules.utils.scrollPageTo(a("header")),a(".featuresHeaders .expandable.expanded").removeClass("expanded").addClass("collapsed")}),a(document).on("resultsFetchStart",function(){s.modules.journeyEngine.loadingShow("getting your quotes"),a("#resultsPage, .loadingDisclaimerText").removeClass("hidden"),"ctm"==s.site.tracking.brandCode&&s.modules.splitTest.isActive(4)?a("#resultsPage, .loadingQuoteText").removeClass("hidden"):a("#resultsPage, .loadingDisclaimerText").addClass("originalDisclaimer"),Results.pagination.hide()}),a(document).on("resultsFetchFinish",function(){a(Results.settings.elements.page).show(),s.modules.journeyEngine.loadingHide(),a(".loadingDisclaimerText").addClass("hidden"),"ctm"==s.site.tracking.brandCode&&s.modules.splitTest.isActive(4)?a(".loadingQuoteText").addClass("hidden"):a(".loadingDisclaimerText").addClass("originalDisclaimer"),"price"!==Results.getDisplayMode()?Results.pagination.show():a(document.body).removeClass("priceMode").addClass("priceMode");var b=0;a.each(Results.model.returnedProducts,function(){"Y"===this.available&&"CURR"!==this.productId&&b++}),0===b&&_.isArray(Results.model.returnedProducts)&&Results.model.returnedProducts.length>0&&l(),s.messaging.publish(t.commencementDate.RESULTS_RENDER_COMPLETED)}),a(document).on("populateFeaturesStart",function(){s.modules.performanceProfiling.startTest("results")}),a(Results.settings.elements.resultsContainer).on("populateFeaturesEnd",function(){var a,b=s.modules.performanceProfiling.endTest("results");a=800>b?s.modules.performanceProfiling.PERFORMANCE.HIGH:8e3>b&&s.modules.performanceProfiling.isIE8()===!1?s.modules.performanceProfiling.PERFORMANCE.MEDIUM:s.modules.performanceProfiling.PERFORMANCE.LOW,Results.setPerformanceMode(a)}),a(document).on("resultPageChange",function(a){var b=a.pageData;if(null===b.measurements)return!1;var c=Results.getFilteredResults().length,d=b.measurements.columnsPerPage;d*b.measurements.numberOfPages-c}),a(document).on("FeaturesRendered",function(){a(Features.target+" .expandable > "+Results.settings.elements.features.values).off("mouseenter mouseleave").on("mouseenter",function(){var b=a(this).attr("data-featureId"),c=a(Features.target+' [data-featureId="'+b+'"]');c.addClass(Results.settings.elements.features.expandableHover.replace(/[#\.]/g,""))}).on("mouseleave",function(){var b=a(this).attr("data-featureId"),c=a(Features.target+' [data-featureId="'+b+'"]');c.removeClass(Results.settings.elements.features.expandableHover.replace(/[#\.]/g,""))})}),a(document.body).on("click","#results_v3 .btnContainer .btn-call-actions",function(b){var c=a(this);s.messaging.publish(t.carResults.FEATURES_CALL_ACTION,{event:b,element:c})}),a(document.body).on("click","#results_v3 .call-modal .btn-call-actions",function(b){var c=a(this);s.messaging.publish(t.carResults.FEATURES_CALL_ACTION_MODAL,{event:b,element:c})}),a(document.body).on("click","#results_v3 .btn-submit-callback",function(b){var c=a(this);s.messaging.publish(t.carResults.FEATURES_SUBMIT_CALLBACK,{event:b,element:c})})}function f(){g(),s.messaging.subscribe(t.device.STATE_ENTER_XS,function(){"results"===s.modules.journeyEngine.getCurrentStep().navigationId&&g()}),s.messaging.subscribe(t.device.STATE_LEAVE_XS,function(){h(),Results.pagination.setCurrentPageNumber(1),Results.pagination.resync()})}function g(){"xs"===s.modules.deviceMediaState.get()&&"features"===Results.getDisplayMode()&&(Results.view.startColumnWidthTracking(a(window),Results.settings.render.features.numberOfXSColumns,!1),Results.pagination.setCurrentPageNumber(1),Results.pagination.resync())}function h(){Results.view.stopColumnWidthTracking()}function i(){w=s.modules.deviceMediaState.get()}function j(){s.modules.carContactOptins.validateOptins(),Results.get()}function k(){switch(g(),Results.getDisplayMode()){case"features":p(!1);break;default:x=!0,o(!1)}}function l(){s.modules.hasOwnProperty("carFilters")&&s.modules.carFilters.disable()}function m(){var b=a("#navbar-filter .dropdown.filter-excess span:first-child"),c="default";b.length&&(c=b.text().toLowerCase(),c=-1!==c.indexOf("please")?null:c),s.messaging.publish(t.resultsTracking.TRACK_QUOTE_RESULTS_LIST,{additionalData:{paymentPlan:a("#navbar-filter .dropdown.filter-frequency span:first-child").text(),preferredExcess:c},onAfterEventMode:"Load"})}function n(b){s.modules.carMoreInfo.setScrollPosition(),b.preventDefault();var c=a(b.target),d=c.next(".offerTerms-content"),e=c.closest(".resultInsert, .more-info-content, .call-modal").find(".companyLogo"),f=c.closest(".resultInsert, .more-info-content, .call-modal").find(".productTitle, .productName");s.modules.dialogs.show({title:e.clone().wrap("<p>").addClass("hidden-xs").parent().html()+"<div class='hidden-xs heading'>"+f.html()+"</div><div class='heading'>Offer terms</div>",hashId:"offer-terms",className:"offer-terms-modal",openOnHashChange:!1,closeOnHashChange:!0,htmlContent:e.clone().wrap("<p>").removeClass("hidden-xs").addClass("hidden-sm hidden-md hidden-lg").parent().html()+"<h2 class='visible-xs heading'>"+f.html()+"</h2>"+d.html()})}function o(b){"undefined"==typeof b&&(b=!0),null!==Results.getDisplayMode()&&"price"!==Results.getDisplayMode()&&(Results.pagination.hide(),a("header .xs-results-pagination").addClass("hidden"),Results.setDisplayMode("price"),h(),a(document.body).addClass("priceMode"),a(window).scrollTop(0),b&&(s.modules.resultsTracking.setResultsEventMode("Refresh"),m()))}function p(b){if("undefined"==typeof b&&(b=!0),null!==Results.getDisplayMode()&&"features"!==Results.getDisplayMode()){var c=x===!0;Results.setDisplayMode("features",c),g(),_.defer(function(){Results.pagination.gotoPage(1),"xs"===s.modules.deviceMediaState.get()&&Results.view.setColumnWidth(a(window),Results.settings.render.features.numberOfXSColumns,!1),Results.pagination.setupNativeScroll()}),Results.pagination.show(!0),a("header .xs-results-pagination").removeClass("hidden"),x=!1,a(document.body).removeClass("priceMode"),a(window).scrollTop(0),b&&(s.modules.resultsTracking.setResultsEventMode("Refresh"),m())}}function q(b){if(a(Results.settings.elements.resultsContainer).hasClass("priceMode")!==!1&&"xs"===s.modules.deviceMediaState.get()){var c=a(b.target);c.hasClass("result-row")===!1&&(c=c.parents(".result-row")),"undefined"!=typeof c.attr("data-available")&&"Y"===c.attr("data-available")&&(s.modules.moreInfo.setProduct(Results.getResult("productId",c.attr("data-productId"))),s.modules.carMoreInfo.runDisplayMethod())}}function r(){v=a("#resultsPage"),s.messaging.subscribe(t.RESULTS_RANKING_READY,m),s.messaging.subscribe(t.compare.AFTER_ENTER_COMPARE_MODE,function(){a(".filter-excess, .filter-excess a").addClass("disabled"),a(".filter-featuresmode, .filter-pricemode").addClass("hidden")}),s.messaging.subscribe(t.compare.EXIT_COMPARE,function(){a(".filter-excess, .filter-excess a").removeClass("disabled"),a(".filter-featuresmode, .filter-pricemode").removeClass("hidden")})}var s=window.meerkat,t=s.modules.events,u=(s.logging.info,{RESULTS_ERROR:"RESULTS_ERROR"});t.carResults={FEATURES_CALL_ACTION:"FEATURES_CALL_ACTION",FEATURES_CALL_ACTION_MODAL:"FEATURES_CALL_ACTION_MODAL",FEATURES_SUBMIT_CALLBACK:"FEATURES_SUBMIT_CALLBACK"};var v,w,x=!1;s.modules.register("carResults",{init:r,initPage:b,onReturnToPage:c,get:j,stopColumnWidthTracking:h,recordPreviousBreakpoint:i,switchToPriceMode:o,switchToFeaturesMode:p,showNoResults:l,publishExtraSuperTagEvents:m})}(jQuery),function(a,b){function c(a){var b=!1;switch(a){case"buttonLabel":b="Save Quote";break;case"saveAgain":b='Click \'Save Quote\' to update your saved quote <a href="javascript:;" class="btn btn-save saved-continue-link btn-save-quote">Save Quote</a>';break;case"saveSuccess":b='<div class="col-xs-12"><h4>Your quote has been saved.</h4><p>To retrieve your quote <a href="'+d.site.urls.base+'retrieve_quotes.jsp" class="btn-cancel saved-continue-link btn-link">click here</a>.</p><a href="javascript:;" class="btn btn-cancel">Close</a></div>'}return b}var d=window.meerkat,e=(d.modules.events,d.logging.info,d.messaging,{});d.modules.register("carSaveQuote",{events:e,getCopy:c})}(jQuery),function(a,b){function c(b){a(h.selector).remove();var c="N",d=!_.isEmpty(b.alarm),f=!_.isEmpty(b.immobiliser);if(d&&f?c="B":d?c="A":f&&(c="I"),"N"!==c)a(h.selectorParent).empty(),a(h.visibleRow).hide(),a(h.hiddenRow).empty().append(a("<input/>",{type:"hidden",name:"quote_vehicle_securityOption",id:"quote_vehicle_securityOption",value:c})).append(a("<input/>",{type:"hidden",name:"quote_vehicle_securityOptionCheck",id:"quote_vehicle_securityOptionCheck",value:"Y"})).show();else{if(a(h.hiddenRow).empty(),j.find("option:selected").removeAttr("selected"),j.find("select:first").attr("selectedIndex",0),a(h.selectorParent).empty().append(j),i===!0){i=!1;var g=e.site.vehicleSelectionDefaults.securityOption;_.isEmpty(g)||a(h.selector).find("option").each(function(){var b=a(this);b.val()==g&&b.prop("selected",!0)})}a(h.visibleRow).show()}}function d(){a(document).ready(function(){return"car"!==e.site.vertical?!1:(j=a(h.selector).clone(),j.find("option:selected").removeAttr("selected"),j.find("select:first").prop("selectedIndex",0),void e.messaging.subscribe(f.carVehicleOptions.UPDATED_VEHICLE_DATA,c))})}var e=window.meerkat,f=e.modules.events,g=(e.logging.info,{carVehicleOptions:{UPDATED_VEHICLE_DATA:"UPDATED_VEHICLE_DATA"}}),h={selector:"#securityOptionRow .select:first, #securityOptionRow .fieldrow_legend:first",selectorParent:"#securityOptionRow .row-content",visibleRow:"#securityOptionRow",hiddenRow:"#securityOptionHiddenRow"},i=!0,j=null;e.modules.register("carSecurityOptions",{init:d,events:g,onUpdatedVehicleData:c})}(jQuery),function(a,b){function c(){e.messaging.subscribe(f.car.DROPDOWN_CHANGED,function(){_.defer(d)}),e.messaging.subscribe(h.RENDER_CAR_SNAPSHOT,function(){_.defer(d)}),e.messaging.subscribe(f.journeyEngine.READY,function(){_.defer(d)})}function d(){var b=1;if(!e.modules.splitTest.isActive(13)){b=0;var c=a("#quote_vehicle_make"),d=a(".quoteSnapshot");""!==c.val()?d.removeClass("hidden"):d.addClass("hidden")}for(var f=e.modules.journeyEngine.getStepsTotalNum(),g=b;f>g;g++){var h="";h=4==g?".header-wrap":".journeyEngineSlide:eq("+g+")",e.modules.contentPopulation.render(h+" .snapshot")}}var e=window.meerkat,f=e.modules.events,g=(e.logging.info,{carSnapshot:{RENDER_CAR_SNAPSHOT:"RENDER_CAR_SNAPSHOT"}}),h=g.carSnapshot;e.modules.register("carSnapshot",{init:c,events:g})}(jQuery),function(a,b){function c(b){if(O===!1){var c=a(G.factory.button);D.modules.loadingAnimation.showAfter(c);var f=D.modules.carVehicleSelection.isSplitTest()?a(G.redbook).find("input:checked"):a(G.redbook),g={redbookCode:f?f.val():null};O=!0,D.modules.comms.get({url:"rest/car/vehicleAccessories/list.json",data:g,cache:!0,useDefaultErrorHandling:!1,numberOfAttempts:3,errorLevel:"fatal",onSuccess:function(a){J=a,e(),D.messaging.publish(F.carVehicleOptions.UPDATED_VEHICLE_DATA,J),x(),_.isFunction(b)&&b()},onError:d,onComplete:function(){O=!1,D.modules.loadingAnimation.hide(c)}})}}function d(a,b,c,d,e){D.modules.errorHandling.error({message:"Sorry, we cannot seem to retrieve a list of accessories for your vehicles at this time. Please come back to us later and try again.",page:"carVehicleOptions.js:getVehicleData()",errorLevel:"warning",description:"Failed to retrieve a list of accessories for RedBook Code: "+c,data:e})}function e(){var a=["alarm","immobiliser","options","standard"];_.isObject(J)||(J={});for(var b=0;b<a.length;b++)J.hasOwnProperty(a[b])&&_.isArray(J[a[b]])||(J[a[b]]=[])}function f(){var b=k(J.options),c=l(J.standard),d=_.template(a(G.factory.template).html()),e=d({optionalAccessories:b,standardAccessories:c});return I.factory=D.modules.dialogs.show({title:a(this).attr("title"),htmlContent:e,hashId:"factory-options",tabs:[{title:"Add Factory/Dealer Options",xsTitle:"Factory/Dealer Options",targetSelector:".quote-factory-options"},{title:"View Included Standard Accessories",xsTitle:"Standard Accessories",targetSelector:".quote-standard-accessories"}],buttons:[{label:"Save Changes",className:"btn-save",action:_.bind(u,this,{type:"factory"})}],rightBtn:{label:"Save Changes",className:"btn-sm btn-save",callback:_.bind(u,this,{type:"factory"})},closeOnHashChange:!0,openOnHashChange:!1,onClose:function(){D.modules.sessionCamHelper.updateVirtualPage(C()),y({type:"factory"})},onOpen:function(b){_.isArray(J.options)&&J.options.length?a(".quote-factory-options .no-items-found").addClass("hidden"):a(".quote-factory-options .items-found").addClass("hidden"),_.isArray(J.standard)&&J.standard.length?a(".quote-standard-accessories .no-items-found").addClass("hidden"):a(".quote-standard-accessories .items-found").addClass("hidden"),a("#"+b).on("click",".nav-tabs a",function(c){c.preventDefault(),c.stopPropagation();var d=C();d.navigationId+="-FactoryDealerOptions-"+a(this).attr("data-target").split("-")[2],D.modules.sessionCamHelper.updateVirtualPage(d),a(this).tab("show"),a("#"+b+" .modal-title-label").html(a(this).attr("title"))}),a(".nav-tabs a:first").click(),H&&_.defer(function(){a(function(){a("html.lt-ie9 form#quote_vehicle_factoryOptionsDialogForm").on("change.checkedForIE",".checkbox input, .compareCheckbox input",function(){var b=a(this);b.is(":checked")?b.addClass("checked"):b.removeClass("checked")}),a("html.lt-ie9 form#quote_vehicle_factoryOptionsDialogForm .checkbox input").change()})})}}),!1}function g(){var b=l(J.standard),c=(m(),_.template(a(G.accessories.template).html())),d=(L.accessories.accs,a(G.accessories.saveditems).children()),e=[],f=[];a.each(d,function(b,c){c=a(this);var d=c.attr("itemIndex"),g=c.attr("itemPrice");e.push(parseInt(d)),f.push(g)}),a.each(K,function(a,b){var c=e.indexOf(a),d=!1;c>=0&&(d=!0),b.checked=d,b.priceDropdown='<option value="">Please choose&hellip;</option>',selectedDropdown="","0"==f[c]&&(selectedDropdown="selected"),b.priceDropdown+='<option value="" disabled="true">---</option>',b.priceDropdown+='<option value="0" '+selectedDropdown+">Included in purchase price</option>",b.priceDropdown+='<option value="" disabled="true">---</option>';for(var g=Math.ceil(b.standard*(b.min/100)),h=g,i=Math.floor(b.standard*(b.max/100));i>=h;)selectedDropdown="",f[c]==h&&(selectedDropdown="selected"),b.priceDropdown+='<option value="'+h+'" '+selectedDropdown+">$"+h+"</option>",h+=g;h-=g,h!=i&&(selectedDropdown="",f[c]==i&&(selectedDropdown="selected"),b.priceDropdown+='<option value="'+i+'" '+selectedDropdown+">$"+i+"</option>")});var g=c({standardAccessories:b,vehicleNonStandardAccessories:K}),i=".quote-optional-accessories-listed",j=".quote-standard-accessories";return I.accessories=D.modules.dialogs.show({title:a(this).attr("title"),htmlContent:g,hashId:"accessories",tabs:[{title:"Add Non-Standard Accessories",xsTitle:"Non-Standard Accessories",targetSelector:i},{title:"View Included Standard Accessories",xsTitle:"Standard Accessories",targetSelector:j}],buttons:[{label:"Save Changes",className:"btn-save",action:_.bind(u,this,{type:"accessories"})}],rightBtn:{label:"Save Changes",className:"btn-sm btn-save",callback:_.bind(u,this,{type:"accessories"})},closeOnHashChange:!0,openOnHashChange:!1,onClose:function(){D.modules.sessionCamHelper.updateVirtualPage(C()),y({type:"accessories"})},onOpen:function(b){var c=a("#injectIntoHeader");c.remove(),a(".modal-header").append(c),a("#quote_vehicle_accessoriesDialog").parent().css({"padding-top":"5px"}),_.isArray(K)&&K.length?a(".quote-optional-accessories-listed .no-items-found").addClass("hidden"):a(".quote-optional-accessories-listed .items-found").addClass("hidden"),_.isArray(J.standard)&&J.standard.length?a(".quote-standard-accessories .no-items-found").addClass("hidden"):a(".quote-standard-accessories .items-found").addClass("hidden"),a("#"+b).on("click",".nav-tabs a",function(d){a(this).attr("data-target")==j?c.hide():c.show(),d.preventDefault(),d.stopPropagation();var e=C();e.navigationId+="-NonStandardAccessories-"+a(this).attr("data-target").split("-")[1],D.modules.sessionCamHelper.updateVirtualPage(e),a(this).tab("show"),a("#"+b+" .modal-title-label").html(a(this).attr("title"))}),a(".nav-tabs a:first").click(),h()}}),!1}function h(){a(".nonStandardAccessoryCheckbox").on("change",function(){var b=a(this),c=b.attr("itemIndex"),d=a('select[itemIndex="'+c+'"]');b.prop("checked")?d.prop("disabled",!1):(d.prop("disabled",!0),d.val(""))}),a(".nonStandardAccessorySelect").on("change",function(){var b=a(this);""===b.val()?b.parent().addClass("has-error"):b.parent().removeClass("has-error")});for(var b=0;b<M.accessories.length;b++){var c=M.accessories[b],d=a(G.accessories.addeditems),e=d.find("li.added-item-"+c.position).first();e.data("info",c),e.find("a:first").on("click",_.bind(j,this,c))}D.modules.checkboxIE8.support()}function i(b){return a("<li/>").addClass("added-item-"+b.position).data("info",b).append(a("<span/>").append(b.label)).append(a("<a/>",{title:"remove accessory"}).addClass("icon-cross").on("click",_.bind(j,this,b))).append(a("<span/>").append(b.price===!1?"Included":"$"+b.price))}function j(b){a(G.accessories.addeditems).find(".added-item-"+b.position).remove(),a(G.accessories.type).find("option").each(function(){return parseInt(a(this).val(),10)>b.position?(a(this).before(a("<option/>",{text:b.label,value:b.position+"_"+b.code})),!1):void 0})}function k(b){for(var c=a("<ul/>"),d=0;d<b.length;d++){var e=b[d],f="tmp_fact_"+d+"_chk",g="tmp_quote_opts_opt"+("0"+d).slice(-2),h=a("<input/>",{type:"checkbox",name:g,id:f,value:e.code});-1!==_.indexOf(M.factory,f)&&h.attr("checked",!0),c.append(a("<li/>").append(a("<div/>").addClass("checkbox").append(h).append(a("<label/>").attr("for",f).append(z(e.label)))))}return c.html()}function l(b){for(var c=a("<ul/>"),d=0;d<b.length;d++){var e=b[d];c.append(a("<li/>",{text:z(e.label)}))}return c.html()}function m(){for(var b=a("<ul/>"),c=0;c<M.accessories.length;c++)b.append(i(M.accessories[c]));return b.html()}function n(a){for(var b=0;b<K.length;b++)if(K[b].code===a)return K[b];return!1}function o(a){return J.options.hasOwnProperty(a)?J.options[a]:!1}function p(){a(G.factory.inputs).empty(),a(G.factory.saveditems).empty(),a(G.accessories.inputs).empty(),a(G.accessories.saveditems).empty();var b=L.factory,c=L.accessories;if(!_.isUndefined(b)&&!_.isEmpty(b))for(var d in b.opts)if(b.opts.hasOwnProperty(d)){var e=String(parseInt(d.substring(3),10)),f="tmp_fact_"+e+"_chk",g=o(e);g.position=("0"+e).slice(-2),g!==!1&&(M.factory.push("tmp_fact_"+e+"_chk"),a(G.factory.inputs).append(w({id:f.slice(4),name:"quote_opts_opt"+("0"+e).slice(-2),value:g.code})),s({type:"factory",item:g}))}if(!_.isUndefined(c)&&!_.isEmpty(c))for(var h in c.accs)if(c.accs.hasOwnProperty(h)){var i=c.accs[h],j=n(i.sel),k={included:"Y"===i.inc,position:parseInt(h.substring(3),10),price:i.hasOwnProperty("prc")?String(i.prc):"0",code:i.sel,label:j.label};M.accessories.push(k),v(k)}y({type:"factory"}),y({type:"accessories"})}function q(b){if(a(".saved-item-"+b.type+"-"+b.position).remove(),"factory"==b.type){for(var c=0;c<M.factory.length;c++)M.factory[c]=="tmp_fact_"+parseInt(b.position,10)+"_chk"&&M.factory.splice(c,1);_.isEmpty(M.factory)&&y({type:"factory"})}else{for(var d=0;d<M.accessories.length;d++)M.accessories[d].code==b.code&&M.accessories.splice(d,1);_.isEmpty(M.accessories)&&y({type:"accessories"})}}function r(b){var c=a("<li/>").addClass("saved-item-"+b.type+"-"+b.position).attr("itemIndex",b.position).attr("itemPrice",b.price).append(a("<span/>").append(b.label)).append(a("<a/>",{title:"remove "+("factory"==b.type?"factory option":"accessory")}).addClass("icon-cross").on("click",_.bind(q,this,b)));return _.isNull(b.price)||c.append(a("<span/>").append("0"===b.price?"Included":"$"+b.price)),c}function s(b){var c={type:b.type,position:"",label:"",price:null,code:"",item:null};"accessories"==b.type?(c.position=b.item.position,c.label=b.item.label,c.price=b.item.price,c.code=b.item.code,c.item=b.item,a(G.accessories.saveditems).append(r(c))):(c.position=b.item.position,c.label=b.item.label,c.code=b.item.code,c.item=b.item,a(G.factory.saveditems).append(r(c)))}function t(){N===!1?(M.factory=[],M.accessories=[],M.accessories=[],a(G.factory.inputs).empty(),a(G.factory.saveditems).empty(),a(G.accessories.inputs).empty(),a(G.accessories.saveditems).empty(),y({type:"factory"}),y({type:"accessories"}),c()):(N=!1,c(p))}function u(b){if("accessories"==b.type){var c=[],d=!0;a(".nonStandardAccessoryCheckbox:checked").each(function(){var b=a(this),e=b.attr("itemIndex"),f=b.siblings().text(),g=a('select[itemIndex="'+e+'"]'),h=g.val();""===h?(d=!1,g.parent().addClass("has-error")):g.parent().removeClass("has-error");var i={position:e,label:f,code:b.val(),included:"0"==g.val()?!0:!1,price:h};c.push(i)}),d?(M[b.type]=[],a(G[b.type].inputs).empty(),a(G[b.type].saveditems).empty(),_.each(c,function(a){M.accessories.push(a),v(a)}),D.modules.dialogs.close(I[b.type])):a(".has-error select").first().focus()}else M[b.type]=[],a(G[b.type].inputs).empty(),a(G[b.type].saveditems).empty(),a(G[b.type].checkboxes).find(":checked").each(function(b,c){var d=a(this);M.factory.push(d.attr("id"));var e=d.attr("name").slice(4),f=d.attr("id").slice(4),g=f.split("_")[1],h=o(g);h.position=("0"+g).slice(-2),a(G.factory.inputs).append(w({id:f,name:e,value:d.val()}).addClass("saved-item-factory-"+("0"+h.position).slice(-2))),s({type:"factory",item:h})}),D.modules.dialogs.close(I[b.type])}function v(b){a(G.accessories.inputs).append(w({name:"quote_accs_acc"+b.position+"_sel",id:"acc_"+b.position+"_chk",value:b.code}).addClass("saved-item-accessories-"+("0"+b.position).slice(-2))).append(w({name:"quote_accs_acc"+b.position+"_inc",value:b.included===!0?"Y":"N"}).addClass("saved-item-accessories-"+("0"+b.position).slice(-2))),b.included===!1&&a(G.accessories.inputs).append(w({name:"quote_accs_acc"+b.position+"_prc",value:b.price}).addClass("saved-item-accessories-"+("0"+b.position).slice(-2))),s({type:"accessories",item:b})}function w(b){var c={type:"hidden"};return _.extend(c,b),a("<input/>",c)}function x(){_.isArray(J.options)&&J.options.length?a("#quote_vehicle_factoryOptionsFieldSet").removeClass("hidden"):a("#quote_vehicle_factoryOptionsFieldSet").addClass("hidden")}function y(b){var c=a(G[b.type].radio+" input:radio").is(":checked");_.isEmpty(M[b.type])?(a(G[b.type].button).css({display:"none"}),a(G[b.type].radio).css({display:"block"}),a(G[b.type].radio+" input:radio").prop("checked",!1).change(),c===!0&&(a(G[b.type].radio+" input:radio:last").prop("checked",!0).change(),a(G[b.type].yn).val("N"))):(a(G[b.type].radio+" input:radio").prop("checked",!1),a(G[b.type].radio+" input:radio:first").prop("checked",!0).change(),a(G[b.type].yn).val("Y"),a(G[b.type].radio).css({display:"none"}),a(G[b.type].button).css({display:"block"}))}function z(b){return a("<div />").html(b).text()}function A(a,b){b.preventDefault(),b.stopPropagation(),a.callback()}function B(){a(document).ready(function(){if("car"!==D.site.vertical)return!1;H=D.modules.performanceProfiling.isIE8(),D.messaging.subscribe(E.car.VEHICLE_CHANGED,t),K=[],_.isObject(D.site.nonStandardAccessoriesList)&&D.site.nonStandardAccessoriesList.hasOwnProperty("items")&&_.isArray(D.site.nonStandardAccessoriesList.items)&&(K=D.site.nonStandardAccessoriesList.items),_.extend(L,userOptionPreselections);for(var b=["factory","accessories"],c=0;c<b.length;c++){var d=b[c],e=a(G[d].yn).val();_.isEmpty(e)&&!_.isEmpty(L[d])&&(a(G[d].yn).val("Y"),e="Y"),_.isEmpty(e)||(a(G[d].radio+" input:radio").prop("checked",!1).change(),a(G[d].radio+" input:radio[value="+e+"]").prop("checked",!0).change())}a(G.factory.radio+" label:first").on("click",_.bind(A,this,{type:"factory",callback:f})),a(G.accessories.radio+" label:first").on("click",_.bind(A,this,{type:"accessories",callback:g})),a(G.factory.radio+" label:last").on("click",function(){a(G.factory.yn).val("N")}),a(G.accessories.radio+" label:last").on("click",function(){a(G.accessories.yn).val("N")}),a(G.factory.button).on("click",f),a(G.accessories.button).on("click",g)})}function C(){return null==P&&(P=D.modules.journeyEngine.getCurrentStep()),_.extend({},P)}var D=window.meerkat,E=D.modules.events,F=(D.logging.info,{car:{VEHICLE_CHANGED:"VEHICLE_CHANGED"},carVehicleOptions:{UPDATED_VEHICLE_DATA:"UPDATED_VEHICLE_DATA"}}),G={factory:{radio:"#quote_vehicle_factoryOptionsRadioBtns",yn:"#quote_vehicle_factoryOptions",button:"#quote_vehicle_factoryOptionsButton",template:"#quote-factoryoptions-template",checkboxes:"#quote_vehicle_factoryOptionsDialog .quote-factory-options",inputs:"#quote_vehicle_options_inputs_container .factory:first",saveditems:"#quote_vehicle_factoryOptionsSelections .added-items ul"},accessories:{radio:"#quote_vehicle_accessoriesRadioBtns",yn:"#quote_vehicle_accessories",button:"#quote_vehicle_accessoriesButton",template:"#quote-nonstandard-accessories-template",inputs:"#quote_vehicle_options_inputs_container .accessories:first",wrapper:"#quote_vehicle_accessoriesDialog .quote-optional-accessories-listed",type:"#quote_vehicle_accessoriesDialog .ac-type",included:"#quote_vehicle_accessoriesDialog .ac-included",price:"#quote_vehicle_accessoriesDialog .ac-price",add:"#quote_vehicle_accessoriesDialog .ac-add",clear:"#quote_vehicle_accessoriesDialog .ac-clear",addeditems:"#quote_vehicle_accessoriesDialog .quote-optional-accessories-listed .added-items ul",saveditems:"#quote_vehicle_accessoriesSelections .added-items ul"},redbook:"#quote_vehicle_redbookCode"};G.accessories.wrapper="#quote_vehicle_accessoriesDialog .quote-optional-accessories-listed";var H=!1,I={factory:{},accessories:{}},J={},K=[],L={},M={factory:[],accessories:[]},N=!0,O=!1,P=null;D.modules.register("carVehicleOptions",{init:B,events:F,onVehicleChanged:t})}(jQuery),function(a,b){function c(){M!==!1&&(M.abort(),m())}function d(b){if(I===!1){H=b;var c=a(C[b]),d=c;d.closest(".form-group").hasClass("hidden")?(d=d.closest(".form-group").prev().find("select"),z.modules.loadingAnimation.showAfter(d)):z.modules.loadingAnimation.showAfter(d);for(var g={},i=0;i<_.indexOf(F,b);i++){var j=F[i];_.indexOf(F,b)>_.indexOf(F,"bodies")&&"bodies"==j?g.body=a(C[j]).val():g[j.substring(0,j.length-1)]=a(C[j]).val()}r(c),y()&&x(b)?c.empty():(c.attr("selectedIndex",0),c.empty().append(a("<option/>",{value:""}).append(D.resetOptionHTML))),l(b,!0),I=!0,_.defer(function(){M=z.modules.comms.get({url:"rest/car/"+b+"/list.json",data:g,cache:!0,useDefaultErrorHandling:!1,numberOfAttempts:3,errorLevel:"fatal",onSuccess:function(a){return M=!1,f(b,a),h(b),!0},onError:e,onComplete:function(){return M=!1,I=!1,z.modules.loadingAnimation.hide(d),u(),k(b),!0}})})}}function e(b,c,d,e,f){M=!1,I=!1,z.modules.loadingAnimation.hide(a(C[H]));var g=i(H);if(g!==!1){var h=a(C[g]);h.find("option:selected").prop("selected",!1)}return l(H,!1),a(C[H]).empty().append(a("<option/>",{text:D.errorInOptionHTML+H,value:""})).prop("disabled",!1).blur(),z.modules.errorHandling.error({message:"Sorry, we cannot seem to retrieve a list of "+H+" for your vehicles at this time. Please come back to us later and try again.",page:"vehicleSelection.js:getVehicleSelectorData()",errorLevel:"warning",
description:"Failed to retrieve a list of "+H+": "+d,data:f}),!1}function f(a,b){g(a);for(var c=_.indexOf(F,a);c<F.length;c++)b.hasOwnProperty(F[c])&&G.hasOwnProperty(F[c])&&(G[F[c]]=b[F[c]])}function g(a){for(var b=_.isUndefined(a)?0:_.indexOf(F,a),c=b;c<F.length;c++)G[F[c]]={}}function h(b){if(G.hasOwnProperty(b)){H=b;var c=!1,e=z.modules.performanceProfiling.isIos()&&"xs"==z.modules.deviceMediaState.get();if(G[b]&&_.isArray(G[b])){var f=null;J===!0&&E.hasOwnProperty(b)&&""!==E[b]&&(f=E[b]),c=1===G[b].length,$selector=a(C[b]),$selector.empty();var g=[];(!y()||y()&&!x(b))&&g.push(a("<option/>",{text:D.pleaseChooseOptionHTML,value:""}));var i=!1;if("models"==b&&G[b][0].hasOwnProperty("isTopModel")&&G[b][0].isTopModel===!0&&(i=!0),"makes"==b||i){var m=b.charAt(0).toUpperCase()+b.slice(1);g.push(a("<optgroup/>",{label:"Top "+m})),g.push(a("<optgroup/>",{label:"All "+m}))}else(!y()||y()&&!x(b))&&e&&c!==!0&&g.push(a("<optgroup/>",{label:b.charAt(0).toUpperCase()+b.slice(1)}));for(var n in G[b])if(G[b].hasOwnProperty(n)){if("function"==typeof G[b][n])continue;var o=G[b][n],p=null;if(y()&&x(b)){var t="quote_vehicle_redbookCode";p=a("<div/>",{"class":"radioCustom"}).append(a("<input/>",{type:"radio",id:t+"_"+o.code,name:t,value:o.code,required:"required","data-autosave":"true","data-msg-required":"Please select a vehicle type"})).append(a("<label/>",{"for":t+"_"+o.code,text:o.label}))}else p=a("<option/>",{text:o.label,value:o.code});f===!0||c!==!0&&(_.isNull(f)||f!=o.code)||(y()&&x(b)?p.find("input").prop("checked",!0):p.prop("selected",!0),f=!0),"makes"==b||"models"==b&&i?o[i?"isTopModel":"isTopMake"]===!0?p.appendTo(g[1],g[2]):g[2].append(p):(!y()||y()&&!x(b))&&e&&c!==!0?g[1].append(p):g.push(p)}for(var u=0;u<g.length;u++)$selector.append(g[u]);y()&&x(b)&&q($selector,b),$selector.prop("disabled",!1),$selector.is(":visible")||a(C[b+"Row"]).removeClass("hidden"),"makes"===b&&k(b),r($selector),c!==!0&&_.isNull(f)||(s($selector),$selector.blur()),l(b,!1);var v=j(b);z.messaging.publish(B.car.DROPDOWN_CHANGED),v!==!1&&(_.isArray(G[v])&&!_.isEmpty(G[v])?h(v):c===!0&&(I=!1,d(v)))}else y()&&x(b)?(a(C[H+"Row"]).addClass("hidden"),a(C[H]).empty()):a(C[H]).empty().append(a("<option/>",{text:D.notFoundOptionHTML,value:""}))}}function i(a){var b=_.indexOf(F,a)-1;return F.hasOwnProperty(b)?F[b]:!1}function j(a){var b=_.indexOf(F,a)+1;return F.hasOwnProperty(b)?F[b]:!1}function k(b){var c=_.indexOf(F,b);if(c>-1)for(var d=0;d<F.length;d++)if(C.hasOwnProperty(F[d])){var e=a(C[F[d]]);d>c&&(y()&&x(F[d])?(a(C[F[d]+"Row"]).addClass("hidden"),e.empty()):(e.attr("selectedIndex",0),e.empty().append(a("<option/>",{value:""}).append(D.resetOptionHTML)),d>=3&&e.closest(".fieldrow").addClass("hidden")),r(e),e.prop("disabled",!0),1===c&&(a(C.marketValue).val(""),a(C.variant).val(""),a(C.modelDes).val(""),a(C.registrationYear).val("")))}}function l(b,c){c=c||!1;for(var d=0;d<=_.indexOf(F,b);d++)a(C[F[d]]).prop("disabled",c)}function m(){H=i(H),$el=a(C[H]),r($el),$el.prop("selectedIndex",0),l(H,!1)}function n(){H=F[0];var b=a(C[H]);b.prop("selectedIndex",0),r(b),k(H),_.defer(function(){z.messaging.publish(A.carSnapshot.RENDER_CAR_SNAPSHOT)})}function o(b){J=!1;var c=j(b.field),e=_.isEmpty(a(C[b.field]).val());e===!0&&(r(a(C[b.field])),k(b.field));var f=t("makes",a(C.makes).val());f!==!1?a(C.makeDes).val(f.label):a("span[data-source='#quote_vehicle_make']").text("");var g=t("models",a(C.models).val());g!==!1&&a(C.modelDes).val(g.label);var h=t("years",a(C.years).val());if(h!==!1&&a(C.registrationYear).val(h.code),e===!1&&c!==!1&&(k(c),d(c)),"types"===b.field){var i=a(C.types);(y()&&i.find("input:checked")||!y()&&!_.isEmpty(i.val()))&&(s(i),u())}z.messaging.publish(B.car.DROPDOWN_CHANGED)}function p(){for(var b=0;b<F.length;b++)F.hasOwnProperty(b)&&(y()&&x(F[b])?q(a(C[F[b]]),F[b]):a(C[F[b]]).off().on("change",_.bind(o,this,{field:F[b]})))}function q(a,b){a.find("input[type=radio]").off().on("change",_.bind(o,this,{field:b}))}function r(a){a.removeClass("has-success has-error"),a.closest(".form-group").find(".row-content").removeClass("has-success has-error").end().find(".error-field").remove()}function s(a){a.addClass("has-success"),a.closest(".form-group").find(".row-content").addClass("has-success")}function t(a,b){if(!_.isEmpty(b))for(var c=0;c<G[a].length;c++)if(b==G[a][c].code)return G[a][c];return!1}function u(){var b=y()?a(C.types).find("input:checked"):a(C.types),c=b?b.val():null;if(!_.isEmpty(c)){var d=t("makes",a(C.makes).val());d!==!1&&a(C.makeDes).val(d.label);var e=t("models",a(C.models).val());e!==!1&&a(C.modelDes).val(e.label);var f=t("years",a(C.years).val());f!==!1&&a(C.registrationYear).val(f.code);var g=t("types",c);g!==!1&&(a(C.marketValue).val(g.marketValue),a(C.variant).val(g.label)),y()?_.defer(function(){z.messaging.publish(B.car.VEHICLE_CHANGED)}):z.messaging.publish(B.car.VEHICLE_CHANGED)}}function v(b,c){J=!0,g(),E=_.extend({},b),G=_.extend({},b.data),p(),h("makes"),u(),!y()&&z.modules.performanceProfiling.isIE8()&&a(document).on("focus","#quote_vehicle_redbookCode",function(){var b=a(this);b.data("width",b.width()),b.width("auto"),b.data("width-auto",a(this).width()),b.data("width-auto")<b.data("width")?b.width(b.data("width")):b.width(b.data("width-auto")+15)}).on("blur","#quote_vehicle_redbookCode",function(){var b=a(this);b.width(b.data("width"))}),_.isFunction(c)&&c()}function w(){z.messaging.subscribe(A.regoLookup.REGO_LOOKUP_FORM_IN_USE,n),z.messaging.subscribe(A.regoLookup.REGO_LOOKUP_STARTED,c),z.messaging.subscribe(A.regoLookup.REGO_LOOKUP_COMPLETE,v),a(document).ready(function(){if("car"!==z.site.vertical)return!1;L=z.modules.splitTest.isActive(8);for(var b=0;b<F.length;b++)a(C[F[b]]).attr("tabindex",b+1);v(z.site.vehicleSelectionDefaults)})}function x(a){return _.indexOf(K,a)>-1}function y(){return L}var z=window.meerkat,A=z.modules.events,B=(z.logging.info,{car:{VEHICLE_CHANGED:"VEHICLE_CHANGED",DROPDOWN_CHANGED:"DROPDOWN_CHANGED"}}),C={makes:"#quote_vehicle_make",makeDes:"#quote_vehicle_makeDes",makesRow:"#quote_vehicle_makeRow",models:"#quote_vehicle_model",modelDes:"#quote_vehicle_modelDes",modelsRow:"#quote_vehicle_modelRow",years:"#quote_vehicle_year",registrationYear:"#quote_vehicle_registrationYear",yearsRow:"#quote_vehicle_yearRow",bodies:"#quote_vehicle_body",bodiesDes:"#quote_vehicle_bodyDes",bodiesRow:"#quote_vehicle_bodyRow",transmissions:"#quote_vehicle_trans",transmissionsRow:"#quote_vehicle_transRow",fuels:"#quote_vehicle_fuel",fuelsRow:"#quote_vehicle_fuelRow",types:"#quote_vehicle_redbookCode",typesRow:"#quote_vehicle_redbookCodeRow",marketValue:"#quote_vehicle_marketValue",variant:"#quote_vehicle_variant"},D={pleaseChooseOptionHTML:"Please choose...",resetOptionHTML:"&nbsp;",notFoundOptionHTML:"No match for above choices",errorInOptionHTML:"Error finding "},E={},F=["makes","models","years","bodies","transmissions","fuels","types"],G={},H=!1,I=!1,J=!0,K=["types"],L=!1,M=!1;z.modules.register("carVehicleSelection",{init:w,events:B,isSplitTest:y})}(jQuery),function(a,b){function c(){var b=j.modules.utils.returnAge(a(m.reg_dob).val(),!0),c=j.modules.utils.returnAge(a(m.yng_dob).val(),!0),e=Math.min(b,c);20>=e?a(m.age_row).slideUp():24>=e?(a(m.age_row).slideDown(),d(["H"])):29>=e?(a(m.age_row).slideDown(),d(["H","7"])):39>=e?(a(m.age_row).slideDown(),d(["H","7","A"])):(a(m.age_row).slideDown(),d(["H","7","A","D"]))}function d(b){var c=a(m.restrict),d=c.val();c.empty();for(var e=0;e<o.length;e++){var f=o[e];if(n.hasOwnProperty(f)&&("0"===f||"3"===f||_.indexOf(b,f)>=0)){var g=n[f].clone();f===d&&g.prop("selected",!0),c.append(g)}}}function e(){var b=a(m.restrict);b.find("option").each(function(){var b=a(this),c=_.isEmpty(b.val())?0:b.val();n[c]=b.clone(),n[c].prop("selected",!1)})}function f(){var b=a(m.labels).find("input:checked");return _.isEmpty(b)?!1:"Y"===b.val()}function g(b){b=b||!1;var c=a(m.labels).find("input:checked");_.isEmpty(c)||(f()?a(m.toggle).slideDown("fast",function(){if(b){var a=i();a.navigationId+="-youngdriver",j.modules.sessionCamHelper.updateVirtualPage(a)}}):a(m.toggle).slideUp("fast",function(){var c=a(this);c.find(":text").val(""),c.find(":radio").prop("checked",!1).change(),a(m.yng_dob).val("").change(),c.find(".has-success").removeClass("has-success"),c.find(".has-error").removeClass("has-error"),c.find(".error-field").remove(),b&&j.modules.sessionCamHelper.updateVirtualPage(i())}))}function h(){j.modules.sessionCamHelper.addStepToIgnoreList("details"),j.messaging.subscribe(k.journeyEngine.STEP_CHANGED,function(a){"details"==a.navigationId&&_.defer(_.bind(g,this,!0))}),a(document).ready(function(){return"car"!==j.site.vertical?!1:(a(m.labels+" label input").on("click",function(a){_.defer(_.bind(g,this,!0))}),a(m.reg_dob+","+m.yng_dob).on("change",c),e(),g(),setTimeout(function(){if("details"==j.modules.journeyEngine.getCurrentStep().navigationId){var a=i();f()&&(a.navigationId+="-youngdriver"),j.modules.sessionCamHelper.updateVirtualPage(a)}},250),void c())})}function i(){return null==p&&(p=j.modules.journeyEngine.getCurrentStep()),_.extend({},p)}var j=window.meerkat,k=j.modules.events,l=(j.logging.info,{}),m={toggle:"#quote_drivers_youngToggleArea",labels:"#quote_drivers_youngDriverRow .row-content",restrict:"#quote_options_driverOption",reg_dob:"#quote_drivers_regular_dob",yng_dob:"#quote_drivers_young_dob",age_row:"#quote_restricted_ageRow"},n={},o=["0","3","H","7","A","D"],p=null;j.modules.register("carYoungDrivers",{initCarYoungDrivers:h,events:l,getSessionCamStep:i})}(jQuery);
//# sourceMappingURL=car.modules.ctm.min.map