/*!
 * CTM-Platform v0.8.3
 * Copyright 2014 Compare The Market Pty Ltd
 * http://www.comparethemarket.com.au/
 */


!function(a){function b(){a(document).ready(function(){if("car"!==j.site.vertical)return!1;if(d(),"confirmation"===j.site.pageAction)return!1;c(),("amend"===j.site.pageAction||"latest"===j.site.pageAction||"load"===j.site.pageAction||"start-again"===j.site.pageAction)&&j.modules.form.markInitialFieldsWithValue(a("#mainform"));var b=a("#quote-accessories-template");b.length>0&&(i=_.template(b.html())),b=a("#more-info-template"),b.length>0&&(templateMoreInfo=_.template(b.html())),b=a("#calldirect-template"),b.length>0&&(templateCallDirect=_.template(b.html()))})}function c(){}function d(){if("confirmation"===j.site.pageAction)j.modules.journeyEngine.configure(null);else{e(!1);var a=null;j.site.isFromBrochureSite===!0?a=m.startStep.navigationId:j.site.journeyStage.length>0&&"latest"===j.site.pageAction?a=m.resultsStep.navigationId:j.site.journeyStage.length>0&&"amend"===j.site.pageAction&&(a=m.startStep.navigationId),_.defer(function(){j.modules.journeyEngine.configure({startStepId:a,steps:_.toArray(m)});var b=j.modules.transactionId.get();j.site.isNewQuote===!1?j.messaging.publish(k.tracking.EXTERNAL,{method:"trackQuoteEvent",object:{action:"Retrieve",transactionID:parseInt(b,10),vertical:j.site.vertical}}):j.messaging.publish(k.tracking.EXTERNAL,{method:"trackQuoteEvent",object:{action:"Start",transactionID:parseInt(b,10),vertical:j.site.vertical}})})}}function e(a){f(),g(),a&&j.modules.journeyProgressBar.render(!0)}function f(){var b={title:"Your Car",navigationId:"start",slideIndex:0,externalTracking:{method:"trackQuoteForms",object:j.modules.car.getTrackingFieldsObject},onInitialise:function(){var b=a(".slide-feature-emailquote");a("#quote_privacyoptin").is(":checked")&&b.addClass("privacyOptinChecked"),a("#quote_privacyoptin").on("change",function(){a(this).is(":checked")?b.addClass("privacyOptinChecked"):b.removeClass("privacyOptinChecked")}),j.modules.carSnapshot.init()}},c={title:"Car Details",navigationId:"options",slideIndex:1,externalTracking:{method:"trackQuoteForms",object:j.modules.car.getTrackingFieldsObject},tracking:{touchType:"H",touchComment:"OptionsAccs",includeFormData:!0},onAfterEnter:function(){j.modules.contentPopulation.render(".journeyEngineSlide:eq(1) .snapshot")}},d={title:"Driver Details",navigationId:"details",slideIndex:2,externalTracking:{method:"trackQuoteForms",object:j.modules.car.getTrackingFieldsObject},tracking:{touchType:"H",touchComment:"DriverDtls",includeFormData:!0},onAfterEnter:function(){j.modules.contentPopulation.render(".journeyEngineSlide:eq(2) .snapshot")},onBeforeLeave:function(){}},e={title:"Address & Contact",navigationId:"address",slideIndex:3,externalTracking:{method:"trackQuoteForms",object:j.modules.car.getTrackingFieldsObject},tracking:{touchType:"H",touchComment:"AddressCon",includeFormData:!0},onAfterEnter:function(){j.modules.contentPopulation.render(".journeyEngineSlide:eq(3) .snapshot")},onBeforeLeave:function(){}},f={title:"Results",navigationId:"results",slideIndex:4,externalTracking:{method:"trackQuoteForms",object:j.modules.car.getTrackingFieldsObject},onInitialise:function(){j.modules.carResults.initPage(),j.modules.carMoreInfo.initMoreInfo(),j.modules.carEditDetails.initEditDetails()},onBeforeEnter:function(){j.modules.journeyProgressBar.hide(),a("#resultsPage").addClass("hidden"),j.modules.carFilters.updateFilters()},onAfterEnter:function(){j.modules.carResults.get(),j.modules.carFilters.show()},onAfterLeave:function(){j.modules.journeyProgressBar.show(),j.modules.carFilters.hide(),j.modules.carEditDetails.hide()}};m={startStep:b,optionsStep:c,detailsStep:d,addressStep:e,resultsStep:f}}function g(){j.modules.journeyProgressBar.configure([{label:"Your Car",navigationId:m.startStep.navigationId},{label:"Car Details",navigationId:m.optionsStep.navigationId},{label:"Driver Details",navigationId:m.detailsStep.navigationId},{label:"Address & Contact",navigationId:m.addressStep.navigationId}])}function h(b){try{b=b||!1;var c=a("#quote_drivers_regular_dob").val();c.length>4&&(c=c.substring(c.length-4));var d=null,e=a("input[name=quote_drivers_regular_gender]:checked");if(!_.isEmpty(e))switch(e.val()){case"M":d="Male";break;case"F":d="Female"}var f=null;switch(a("#quote_contact_marketing").val()){case"Y":f="Yes";break;case"N":f="No"}var g=null,h=a("#quote_contact_oktocall:checked");g=_.isEmpty(h)?"No":"Yes";var i=a("#quote_riskAddress_postCode").val(),k=a("#quote_riskAddress_state").val(),l=a("#quote_vehicle_year").val(),m=a("#quote_vehicle_make option:selected").text(),n=a("#quote_contact_email").val(),o=j.modules.transactionId.get(),p=j.modules.journeyEngine.getCurrentStepIndex(),q=j.modules.journeyEngine.getFurtherestStepIndex(),r="";switch(p){case 0:r="your car";break;case 1:r="car details";break;case 2:r="driver details";break;case 3:r="address contact";break;case 4:r=b===!0?"more info":"car results"}var s={vertical:j.site.vertical,actionStep:r,transactionID:o,quoteReferenceNumber:o,yearOfManufacture:null,makeOfCar:null,gender:null,yearOfBirth:null,postCode:null,state:null,email:null,emailID:null,marketOptIn:null,okToCall:null};return q>j.modules.journeyEngine.getStepIndex("start")&&_.extend(s,{yearOfManufacture:l,makeOfCar:m}),q>j.modules.journeyEngine.getStepIndex("details")&&_.extend(s,{yearOfBirth:c,gender:d}),q>j.modules.journeyEngine.getStepIndex("address")&&_.extend(s,{postCode:i,state:k,email:n,marketOptIn:f,okToCall:g}),s}catch(t){return!1}}var i,j=window.meerkat,k=j.modules.events,l=(j.logging.info,{car:{},WEBAPP_LOCK:"WEBAPP_LOCK",WEBAPP_UNLOCK:"WEBAPP_UNLOCK"}),m=null;j.modules.register("car",{init:b,events:l,initProgressBar:e,getTrackingFieldsObject:h})}(jQuery),function(a){function b(){_.extend(c.site,{commencementDateRange:commencementDateSettings}),a(document).ready(function(){return"car"!==c.site.vertical?!1:void a(e.calendar).datepicker({clearBtn:!1,format:"dd/mm/yyyy"}).datepicker("setStartDate",c.site.commencementDateRange.min).datepicker("setEndDate",c.site.commencementDateRange.max).datepicker("update",c.site.commencementDate).on("changeDate",function(b){a(e.input).val(b.format())})})}var c=window.meerkat,d=(c.modules.events,c.logging.info,{}),e={input:"#quote_options_commencementDate",calendar:"#quote_options_commencementDate_calendar"};c.modules.register("carCommencementDate",{init:b,events:d})}(jQuery),function(a){function b(){a(j.oktocall).on("change",c),a(j.privacy).on("change",d)}function c(){a(j.oktocall).is(":checked")===!1&&($row=a(j.phoneRow),$row.find(".has-error").removeClass("has-error"),$row.find(".error-field").empty().hide())}function d(){var b=f(j.privacy);a(j.ctmoktocall).val(b),a(j.fsg).val(b),a(j.marketing).val(b),a(j.terms).val(b)}function e(){h.logging.debug("optin data",{oktocall:f(j.oktocall),privacy:f(j.privacy),marketing:a(j.marketing).val(),ctmoktocall:a(j.ctmoktocall).val(),fsg:a(j.fsg).val(),terms:a(j.terms).val()})}function f(b){return a(b).is(":checked")?"Y":"N"}function g(){a(document).ready(function(){return"car"!==h.site.vertical?!1:(b(),void e())})}var h=window.meerkat,i=(h.modules.events,h.logging.info,{}),j={ctmoktocall:"#quote_contact_ctmoktocall",fsg:"#quote_fsg",marketing:"#quote_contact_marketing",oktocall:"#quote_contact_oktocall",privacy:"#quote_privacyoptin",terms:"#quote_terms",phone:"#quote_contact_phone",phoneRow:"#contactNoRow"};h.modules.register("carContactOptins",{init:g,events:i,dump:e})}(jQuery),function(a){function b(){c(),d()}function c(){o.on("show.bs.dropdown",function(){var b=a("#edit-details-template");b.length>0&&(templateCallback=_.template(b.html()));var c={youngDriver:a("input[name=quote_drivers_young_exists]:checked").val()};e(templateCallback(c))}).on("click",".dropdown-container",function(a){a.stopPropagation()})}function d(){l.messaging.subscribe(m.WEBAPP_LOCK,function(){f(),o.children(".activator").addClass("inactive").addClass("disabled")}),l.messaging.subscribe(m.WEBAPP_UNLOCK,function(){o.children(".activator").removeClass("inactive").removeClass("disabled")}),l.messaging.subscribe(m.device.STATE_ENTER_XS,function(){f()}),l.messaging.subscribe(m.device.STATE_LEAVE_XS,function(){f()})}function e(a){"xs"==l.modules.deviceMediaState.get()?p=g(a):h(a)}function f(){o.hasClass("open")&&o.find(".activator").dropdown("toggle").end().find(".edit-details-wrapper").empty(),null!==p&&a("#"+p).modal("hide")}function g(b){var c=l.modules.dialogs.show({htmlContent:'<div class="edit-details-wrapper"></div>',hashId:"edit-details",className:"edit-details-modal",closeOnHashChange:!0,onOpen:function(c){var d=a(".edit-details-wrapper",a("#"+c));d.html(b),l.modules.contentPopulation.render("#"+c+" .edit-details-wrapper"),a(".accordion-collapse").on("show.bs.collapse",function(){a(this).prev(".accordion-heading").addClass("active-panel")}).on("hide.bs.collapse",function(){a(this).prev(".accordion-heading").removeClass("active-panel")}),d.show()}});return c}function h(b){var c=a("#edit-details-dropdown .edit-details-wrapper");c.html(b),l.modules.contentPopulation.render("#edit-details-dropdown .edit-details-wrapper"),c.find(".accordion-collapse").addClass("in").end().show()}function i(a){var b,c=a.val();switch(c){case"5":b=1;break;case"4":b=2;break;case"3":b=3;break;case"2":b=4;break;case"1":b=5;break;case"0":b=6}return 6==b?"Rating 6 No NCD":"undefined"==typeof b?"":"Rating "+b+" ("+c+" Years) NCD"}function j(a){var b,c=a.val(),d="";switch(c){case"H":b=21;break;case"7":b=25;break;case"A":b=30;break;case"D":b=40}return"3"==c?d="No Restrictions":"undefined"!=typeof b&&(d="Restricted to "+b+" or older"),d}function k(a){var b=a.find(":checked").val(),c=" Accident/Hail Damage";return"Y"===b?c:"N"===b?"No"+c:""}var l=window.meerkat,m=l.modules.events,n=(l.logging.info,{carEditDetails:{}}),o=(n.carEditDetails,a("#edit-details-dropdown")),p=null;l.modules.register("carEditDetails",{initEditDetails:b,events:n,driverOptin:j,formatNcd:i,formatDamage:k,hide:f})}(jQuery),function(a,b){function c(){if(q.removeClass("active"),r.removeClass("active"),"undefined"!=typeof Results.settings&&Results.settings.hasOwnProperty("displayMode")===!0)switch(Results.getDisplayMode()){case"price":q.addClass("active");break;case"features":r.addClass("active")}var c=a("#quote_paymentType").val();s.find(".dropdown-toggle span").text(c===b?s.find(".dropdown-menu a:first").text():s.find('.dropdown-menu a[data-value="'+c+'"]').text());var d=a("#quote_excess").val();t.find(".dropdown-toggle span").text(d===b?t.find(".dropdown-menu a:first").text():t.find('.dropdown-menu a[data-value="'+d+'"]').text())}function d(b){b.preventDefault();var c=a(b.target),d=c.parents(".dropdown"),e=c.attr("data-value");d.find(".dropdown-toggle span").text(c.text()),d.hasClass("filter-frequency")?(a("#quote_paymentType").val(e),Results.setFrequency(e),u.messaging.publish(x.CHANGED)):d.hasClass("filter-excess")&&(a("#quote_excess").val(e),u.messaging.publish(x.CHANGED,{excess:e}))}function e(){p.slideUp(200,function(){p.addClass("hidden")})}function f(){p.removeClass("hidden"),p.hide(),p.slideDown(200)}function g(){p.find("li.dropdown, .dropdown-toggle").addClass("disabled"),q.addClass("disabled"),q.find("a").addClass("disabled"),r.addClass("disabled"),r.find("a").addClass("disabled"),a(".slide-feature-filters").find("a").addClass("disabled").addClass("inactive")}function h(){p.find("li.dropdown, .dropdown-toggle").removeClass("disabled"),q.removeClass("disabled"),q.find("a").removeClass("disabled"),r.removeClass("disabled"),r.find("a").removeClass("disabled"),a(".slide-feature-filters").find("a").removeClass("inactive").removeClass("disabled")}function i(){a(document).on("resultsFetchStart",function(){g()}),a(document).on("pagination.scrolling.start",function(){g()}),a(document).on("resultsFetchFinish",function(){h()}),a(document).on("pagination.scrolling.end",function(){h()}),q.on("click",function(b){b.preventDefault(),a(this).hasClass("disabled")||(u.modules.carResults.switchToPriceMode(!0),c())}),r.on("click",function(b){b.preventDefault(),a(this).hasClass("disabled")||(u.modules.carResults.switchToFeaturesMode(!0),c())}),p.on("click",".dropdown-menu a",d)}function j(){var b=_.template(a("#car-xsFilterBar-template").html()),c=a("#quote_excess").val(),d=b({startingValue:_.isEmpty(c)?0:c});return z=u.modules.dialogs.show({title:a(this).attr("title"),htmlContent:d,hashId:"xsFilterBar",buttons:[{label:"Save Changes",className:"btn-save",action:l}],rightBtn:{label:"Save Changes",className:"btn-sm btn-save",callback:l},closeOnHashChange:!0,onOpen:k}),!1}function k(){"undefined"!=typeof Results.settings&&Results.settings.hasOwnProperty("displayMode")===!0&&(a("#xsFilterBarSortRow input:checked").prop("checked",!1),a("#xsFilterBarSortRow #xsFilterBar_sort_"+Results.getDisplayMode()).prop("checked",!0).change()),a("#xsFilterBarFreqRow input:checked").prop("checked",!1),a("#xsFilterBarFreqRow #xsFilterBar_freq_"+a("#quote_paymentType").val()).prop("checked",!0).change();try{u.modules.sliders.init()}catch(b){}}function l(){var b=a("#quote_paymentType"),d=a("#quote_excess"),e={freq:b.val(),excess:d.val()};e.excess=_.isEmpty(e.excess)?"0":e.excess;var f={freq:a("#xsFilterBarFreqRow input:checked").val(),excess:a("#xsFilterBarExcessRow input[name=xsFilterBar_excess]").val()};if(b.val(f.freq),d.val(f.excess),"undefined"!=typeof Results.settings&&Results.settings.hasOwnProperty("displayMode")===!0)switch(a("#xsFilterBarSortRow input:checked").val()){case"features":u.modules.carResults.switchToFeaturesMode(!0);break;default:u.modules.carResults.switchToPriceMode(!0)}u.modules.dialogs.close(z),u.modules.navMenu.close(),c(),e.freq!==f.freq&&(Results.setFrequency(f.freq),u.messaging.publish(x.CHANGED)),e.excess!==f.excess&&u.messaging.publish(x.CHANGED,{excess:f.excess})}function m(){var b=!a("#navbar-filter").hasClass("hidden");b&&y===!0&&j()}function n(a){y=_.isUndefined(a)?"xs"===u.modules.deviceMediaState.get():a.isXS===!0,y===!1&&u.modules.dialogs.isDialogOpen(z)&&u.modules.dialogs.close(z)}function o(){p=a("#navbar-filter"),0!==p.length&&(q=p.find(".filter-pricemode"),r=p.find(".filter-featuresmode"),s=p.find(".filter-frequency"),t=p.find(".filter-excess"),i(),a(document).ready(function(){var b;b=t.find(".dropdown-menu"),a("#filter_excessOptions option").each(function(){b.append('<li><a href="javascript:;" data-value="'+this.value+'">'+this.text+"</a></li>")}),b=s.find(".dropdown-menu"),a("#filter_paymentType option").each(function(){b.append('<li><a href="javascript:;" data-value="'+this.value+'">'+this.text+"</a></li>")}),a("#navbar-main .slide-feature-filters a").on("click",function(b){b.preventDefault(),a(this).hasClass("disabled")||m()}),u.messaging.subscribe(v.device.STATE_ENTER_XS,_.bind(n,this,{isXS:!0})),u.messaging.subscribe(v.device.STATE_LEAVE_XS,_.bind(n,this,{isXS:!1})),n()}))}var p,q,r,s,t,u=window.meerkat,v=u.modules.events,w=(u.logging.info,{carFilters:{CHANGED:"CAR_FILTERS_CHANGED"}}),x=w.carFilters,y=!1,z=!1;u.modules.register("carFilters",{init:o,events:w,updateFilters:c,hide:e,show:f,disable:g,enable:h,onRequestModal:m})}(jQuery),function(a){function b(){var b={container:B,hideAction:"fadeOut",showAction:"fadeIn",modalOptions:{className:"modal-breakpoint-wide modal-tight bridgingContainer",openOnHashChange:!1,leftBtn:{label:"All Products",icon:'<span class="icon icon-arrow-left"></span>',callback:function(b){a(b.currentTarget).closest(".modal").modal("hide")}}},runDisplayMethod:l,onBeforeShowBridgingPage:i,onBeforeShowTemplate:v,onBeforeShowModal:v,onAfterShowModal:null,onAfterShowTemplate:j,onBeforeHideTemplate:null,onAfterHideTemplate:k,onClickApplyNow:n,onBeforeApply:null,onApplySuccess:w,retrieveExternalCopy:m};y.modules.moreInfo.initMoreInfo(b),h(),c()}function c(){a(document).on("click",".bridgingContainer .btn-call-actions",function(b){b.preventDefault(),b.stopPropagation();var c=a(this),g=a("#car-call-modal-template");g.length>0&&(templateCallback=_.template(g.html()));var h=y.modules.moreInfo.getOpenProduct();if("Y"===h.available){var i=templateCallback(h),j={htmlContent:i,hashId:"call",className:"call-modal",closeOnHashChange:!0,openOnHashChange:!1,onOpen:function(g){a("."+c.attr("data-callback-toggle")).show(),e(".paragraphedContent:visible",".sidebar-right",a("#"+g)),d(),c.hasClass("btn-calldirect")?f(b):q()}};"xs"==y.modules.deviceMediaState.get()&&(j.title="Reference no. "+h.leadNo),y.modules.dialogs.show(j)}}).on("click",".call-modal .btn-call-actions",function(b){b.preventDefault(),b.stopPropagation();var c=a(this);switch(c.attr("data-callback-toggle")){case"calldirect":a(".callback").hide(),a(".calldirect").show(),f(b);break;case"callback":a(".calldirect").hide(),a(".callback").show(),q()}e(".paragraphedContent:visible",".sidebar-right",c.closest(".modal.in"))}).on("click",".btn-submit-callback",function(b){return b.preventDefault(),a(this).closest("form").valid()&&(g(b,{message:"CTM - Car Vertical - Call me now",phonecallme:"GetaCall"}),r()),!1})}function d(){setupDefaultValidationOnForm(a("#getcallback"));var b=a("#quote_CrClientName");b.length&&!b.val().length&&b.val(a("#quote_drivers_regular_firstname").val()+" "+a("#quote_drivers_regular_surname").val());var c=a("#quote_CrClientTelinput");c.length&&!c.val().length&&c.val(a("#quote_contact_phone").val()),c.attr("data-msg-required","Please enter your contact number")}function e(b,c,d){if("xs"!=y.modules.deviceMediaState.get()&&a(c,d).length){var e=a(b,d).outerHeight(),f=a(c,d).outerHeight();e>=f?a(c,d).css("min-height",e+"px"):a(b,d).css("min-height",f+"px")}}function f(a){var b=y.modules.moreInfo.getOpenProduct();if("undefined"==typeof C[b.productId])return p(),g(a,{message:"CTM - Car Vertical - Call direct",phonecallme:"CallDirect"})}function g(b,c){var d=y.modules.moreInfo.getOpenProduct();"undefined"!=typeof d.vdn&&!_.isEmpty(d.vdn)&&d.vdn>0&&(c.vdn=d.vdn);var e={source:"CTMCAR",leadNo:d.leadNo,client:a("#quote_CrClientName").val()||"",clientTel:a("#quote_CrClientTelinput").val()||"",state:a("#quote_riskAddress_state").val(),brand:d.productId.split("-")[0],transactionId:y.modules.transactionId.get()},f=a.extend(e,c),g=a(b.target);return y.modules.loadingAnimation.showInside(g,!0),y.modules.comms.post({url:"ajax/write/lead_feed_save.jsp",data:f,dataType:"json",cache:!1,errorLevel:"warning",onSuccess:function(){if("CallDirect"==c.phonecallme);else if("GetaCall"==c.phonecallme){y.modules.dialogs.show({title:"Call back request recorded",htmlContent:"<p><strong>Thank you!</strong></p><p>Your Call request has been sent to the insurer's message centre who will be in touch as soon as possible.</p>",hashId:"call-back-success",openOnHashChange:!1,closeOnHashChange:!0,onClose:function(){a(".modal").modal("hide"),y.modules.moreInfo.isBridgingPageOpen()&&y.modules.moreInfo.close()}})}},onComplete:function(){"CallDirect"==c.phonecallme&&(C[d.productId]=!0),y.modules.loadingAnimation.hide(g)}})}function h(){y.messaging.subscribe(z.ADDRESS_CHANGE,function(a){"xs"!=y.modules.deviceMediaState.get()&&-1==a.hash.indexOf("results/moreinfo")&&y.modules.moreInfo.hideTemplate(B)}),y.messaging.subscribe(z.device.STATE_ENTER_XS,function(){y.modules.moreInfo.isBridgingPageOpen()&&y.modules.moreInfo.close()}),y.messaging.subscribe(z.device.STATE_LEAVE_XS,function(){y.modules.moreInfo.isModalOpen()&&y.modules.moreInfo.close()}),y.messaging.subscribe(z.errorHandling.OK_CLICKED,function(){(y.modules.moreInfo.isBridgingPageOpen()||y.modules.moreInfo.isModalOpen())&&y.modules.moreInfo.close()})}function i(){u(),"xs"!=y.modules.deviceMediaState.get()&&a(".resultsContainer, #navbar-filter").hide()}function j(){("lg"==y.modules.deviceMediaState.get()||"md"==y.modules.deviceMediaState.get())&&e(".paragraphedContent",".moreInfoRightColumn",B)}function k(){a(".resultsContainer, #navbar-filter").show()}function l(){"xs"!=y.modules.deviceMediaState.get()?y.modules.moreInfo.showTemplate(B):y.modules.moreInfo.showModal(),y.modules.address.appendToHash("moreinfo")}function m(a){return y.modules.comms.get({url:"ajax/json/get_scrapes.jsp",cache:!0,data:{type:"carBrandScrapes",code:a.productId,group:"car"},errorLevel:"silent",onSuccess:function(a){y.modules.moreInfo.setDataResult(a)}})}function n(b,c){if(E===!0&&D.length>0){var d=a("#special-conditions-template");d.length>0&&(templateCallback=_.template(d.html()));var e=y.modules.moreInfo.getOpenProduct();e.specialConditionsRule=D;{var f=templateCallback(e);y.modules.dialogs.show({htmlContent:f,hashId:"special-conditions",title:"Special Conditions Confirmation",closeOnHashChange:!0,openOnHashChange:!1,onOpen:function(d){a(".btn-proceed-to-insurer",a("#"+d)).off("click.proceed").on("click.proceed",function(){o(b,d,c)}),a(".btn-back",a("#"+d)).off("click.goback").on("click.goback",function(){a(".modal").modal("hide"),y.modules.moreInfo.isBridgingPageOpen()&&y.modules.moreInfo.close()})},onClose:function(){y.modules.moreInfo.applyCallback(!1)}})}}else o(b,!1,c)}function o(b,c,d){if(c&&a("#"+c).modal("hide"),_.isEmpty(b.quoteUrl))return void y.modules.errorHandling.error({errorLevel:"warning",message:"An error occurred. Sorry about that!<br /><br /> To purchase this policy, please contact the provider "+(""!==b.telNo?" on "+b.telNo:"directly")+" quoting "+b.leadNo+", or select another policy.",page:"carMoreInfo.js:proceedToInsurer",description:"Insurer did not provide quoteUrl in results object.",data:b});var e="transferring.jsp?url="+escape(b.quoteUrl)+"&trackCode="+b.trackCode+"&brand="+escape(b.productDes)+"&msg="+a("#transferring_"+b.productId).text()+"&transactionId="+y.modules.transactionId.get();if(a("html").hasClass("ie")){var f="location=1,menubar=1,resizable=1,scrollbars=1,status=1,titlebar=1,toolbar=1,top=0,left=0,height="+screen.availHeight+",width="+screen.availWidth;window.open(e,"_blank",f)}else window.open(e,"_blank");t(b),d(!0)}function p(){var a=0;for(var b in C)C.hasOwnProperty(b)&&a++;a>1||s("CrCallDir")}function q(){s("CrCallBac")}function r(){s("CrCallBacSub")}function s(a){var b=y.modules.moreInfo.getOpenProduct();y.messaging.publish(z.tracking.EXTERNAL,{method:"trackBridgingClick",object:{vertical:y.site.vertical,type:a,quoteReferenceNumber:b.leadNo,transactionID:y.modules.transactionId.get(),productID:b.productId}})}function t(a){var b=y.modules.transactionId.get();y.messaging.publish(z.tracking.EXTERNAL,{method:"trackHandover",object:{quoteReferenceNumber:a.leadNo,transactionID:b,productID:a.productId,brandCode:a.brandCode}}),y.messaging.publish(z.tracking.EXTERNAL,{method:"trackHandoverType",object:{type:"ONLINE",quoteReferenceNumber:a.leadNo,transactionID:b,productID:a.productId,brandCode:a.brandCode,vertical:y.site.vertical}})}function u(){y.messaging.publish(z.tracking.EXTERNAL,{method:"trackQuoteForms",object:_.bind(y.modules.car.getTrackingFieldsObject,this,!0)})}function v(b){"undefined"!=typeof b&&"undefined"!=typeof b.scrapes&&b.scrapes.length>0&&a.each(b.scrapes,function(b,c){""!==c.html&&a(c.cssSelector).html(c.html)}),a(".contentRow li").each(function(){a(this).prepend('<span class="icon icon-angle-right"></span>')})}function w(){}function x(a,b){E=a,D=b}var y=window.meerkat,z=y.modules.events,A={carMoreInfo:{}},B=(A.carMoreInfo,a(".bridgingContainer")),C={},D="",E=!1;y.modules.register("carMoreInfo",{initMoreInfo:b,events:A,setSpecialConditionDetail:x,runDisplayMethod:l})}(jQuery),function(a){function b(){d(),Features.init(),Compare.init(),e(),f()}function c(){f(),t!==u.modules.deviceMediaState.get()&&(Results.view.calculateResultsContainerWidth(),Features.clearSetHeights(),Features.balanceVisibleRowsHeight()),Results.pagination.refresh()}function d(){try{var a="price";"undefined"!=typeof u.site&&"undefined"!=typeof u.site.resultOptions&&(a="features"==u.site.resultOptions.displayMode?"features":"price"),Results.init({url:"ajax/json/car_quote_results.jsp",runShowResultsPage:!1,paths:{productId:"productId",price:{annually:"headline.lumpSumTotal",annual:"headline.lumpSumTotal",monthly:"headline.instalmentTotal"},availability:{product:"available",price:{annually:"headline.lumpSumTotal",annual:"headline.lumpSumTotal",monthly:"headline.instalmentTotal"}}},show:{savings:!1,featuresCategories:!1,nonAvailablePrices:!0,nonAvailableProducts:!1,unavailableCombined:!0},availability:{product:["equals","Y"],price:["notEquals",-1]},render:{templateEngine:"_",features:{mode:"populate",headers:!1,numberOfXSColumns:1},dockCompareBar:!1},displayMode:a,paginationMode:"page",paginationTouchEnabled:Modernizr.touch,sort:{sortBy:"price.annually"},frequency:"annual",animation:{results:{individual:{active:!1},delay:500,options:{easing:"swing",duration:1e3}},shuffle:{active:!1,options:{easing:"swing",duration:1e3}},filter:{reposition:{options:{easing:"swing"}}}},elements:{features:{values:".content",extras:".children"}},templates:{pagination:{pageText:"Product {{=currentPage}} of {{=totalPages}}"}},dictionary:{valueMap:[{key:"Y",value:"<span class='icon icon-tick'></span>"},{key:"N",value:"<span class='icon icon-cross'></span>"},{key:"R",value:"Restricted / Conditional"},{key:"AI",value:"Additional Information"},{key:"O",value:"Optional"},{key:"L",value:"Limited"},{key:"SCH",value:"As shown in schedule"},{key:"NA",value:"Non Applicable"},{key:"E",value:"Excluded"},{key:"NE",value:"No Exclusion"},{key:"NS",value:"No Sub Limit"},{key:"OTH",value:""}]},rankings:{paths:{rank_productId:"productId",rank_premium:"headline.lumpSumTotal"}}})}catch(b){Results.onError("Sorry, an error occurred initialising page","results.tag","meerkat.modules.carResults.init(); "+b.message,b)}}function e(){a(document.body).on("click","a.offerTerms",n),a(Results.settings.elements.resultsContainer).on("click",".result-row",q),u.messaging.subscribe(v.affix.AFFIXED,function(){a("#resultsPage").css("margin-top","35px")}),u.messaging.subscribe(v.affix.UNAFFIXED,function(){a("#resultsPage").css("margin-top","0")}),u.messaging.subscribe(v.carFilters.CHANGED,function(a){a&&a.hasOwnProperty("excess")&&j()}),a(Results.settings.elements.resultsContainer).on("featuresDisplayMode",function(){Features.buildHtml()}),a(Results.settings.elements.resultsContainer).on("noFilteredResults",function(){Results.view.show()}),a(document).on("resultsLoaded",k),a(document).on("resultsReturned",function(){u.modules.utilities.scrollPageTo(a("header")),a(".featuresHeaders .expandable.expanded").removeClass("expanded").addClass("collapsed")}),a(document).on("resultsFetchStart",function(){u.modules.journeyEngine.loadingShow("getting your quotes"),a("#resultsPage, .loadingDisclaimerText").removeClass("hidden"),Results.pagination.hide()}),a(document).on("resultsFetchFinish",function(){a(Results.settings.elements.page).show(),u.modules.journeyEngine.loadingHide(),a(".loadingDisclaimerText").addClass("hidden"),"price"!==Results.getDisplayMode()?Results.pagination.show():a(document.body).removeClass("priceMode").addClass("priceMode");var b=0;a.each(Results.model.returnedProducts,function(){"Y"===this.available&&"CURR"!==this.productId&&b++}),0===b&&l()}),a(document).on("populateFeaturesStart",function(){u.modules.performanceProfiling.startTest("results")}),a(Results.settings.elements.resultsContainer).on("populateFeaturesEnd",function(){var a,b=u.modules.performanceProfiling.endTest("results");a=800>b?u.modules.performanceProfiling.PERFORMANCE.HIGH:8e3>b&&u.modules.performanceProfiling.isIE8()===!1?u.modules.performanceProfiling.PERFORMANCE.MEDIUM:u.modules.performanceProfiling.PERFORMANCE.LOW,Results.setPerformanceMode(a)}),a(document).on("resultPageChange",function(a){var b=a.pageData;if(null===b.measurements)return!1;{var c=Results.getFilteredResults().length,d=b.measurements.columnsPerPage;d*b.measurements.numberOfPages-c}}),a(document).on("FeaturesRendered",function(){a(Features.target+" .expandable > "+Results.settings.elements.features.values).on("mouseenter",function(){var b=a(this).attr("data-featureId"),c=a(Features.target+' [data-featureId="'+b+'"]');c.addClass(Results.settings.elements.features.expandableHover.replace(/[#\.]/g,""))}).on("mouseleave",function(){var b=a(this).attr("data-featureId"),c=a(Features.target+' [data-featureId="'+b+'"]');c.removeClass(Results.settings.elements.features.expandableHover.replace(/[#\.]/g,""))})})}function f(){g(),u.messaging.subscribe(v.device.STATE_ENTER_XS,function(){"results"===u.modules.journeyEngine.getCurrentStep().navigationId&&g()}),u.messaging.subscribe(v.device.STATE_LEAVE_XS,function(){h(),Results.pagination.setCurrentPageNumber(1),Results.pagination.resync()})}function g(){"xs"===u.modules.deviceMediaState.get()&&"features"===Results.getDisplayMode()&&(Results.view.startColumnWidthTracking(a(window),Results.settings.render.features.numberOfXSColumns,!1),Results.pagination.setCurrentPageNumber(1),Results.pagination.resync())}function h(){Results.view.stopColumnWidthTracking()}function i(){t=u.modules.deviceMediaState.get()}function j(){Results.get()}function k(){switch(g(),Results.getDisplayMode()){case"features":p(!1);break;default:x=!0,o(!1)}}function l(){u.modules.dialogs.show({htmlContent:a("#no-results-content")[0].outerHTML})}function m(){var b=Results.getDisplayMode();0===b.indexOf("f")&&(b=b.slice(0,-1));var c={vertical:u.site.vertical,actionStep:u.site.vertical+" results",display:b,paymentPlan:a("#navbar-filter .dropdown.filter-frequency span:first-child").text(),preferredExcess:a("#navbar-filter .dropdown.filter-excess span:first-child").text(),event:w};-1!==c.preferredExcess.toLowerCase().indexOf("please")&&(c.preferredExcess=""),u.messaging.publish(v.tracking.EXTERNAL,{method:"trackQuoteList",object:c}),w="Refresh"}function n(b){b.preventDefault();var c=a(b.target),d=c.next(".offerTerms-content");u.modules.dialogs.show({title:"Offer terms",hashId:"offer-terms",openOnHashChange:!1,closeOnHashChange:!0,htmlContent:d.html()})}function o(b){"undefined"==typeof b&&(b=!0),null!==Results.getDisplayMode()&&(Results.pagination.hide(),a("header .xs-results-pagination").addClass("hidden"),Results.setDisplayMode("price"),h(),a(document.body).addClass("priceMode"),a(window).scrollTop(0),b&&m())}function p(b){if("undefined"==typeof b&&(b=!0),null!==Results.getDisplayMode()){var c=x===!0;Results.setDisplayMode("features",c),g(),_.defer(function(){Results.pagination.gotoPage(1),"xs"===u.modules.deviceMediaState.get()&&Results.view.setColumnWidth(a(window),Results.settings.render.features.numberOfXSColumns,!1),Results.pagination.setupNativeScroll()}),Results.pagination.show(!0),a("header .xs-results-pagination").removeClass("hidden"),x=!1,a(document.body).removeClass("priceMode"),a(window).scrollTop(0),b&&m()}}function q(b){if(a(Results.settings.elements.resultsContainer).hasClass("priceMode")!==!1&&"xs"===u.modules.deviceMediaState.get()){var c=a(b.target);c.hasClass("result-row")===!1&&(c=c.parents(".result-row")),"undefined"!=typeof c.attr("data-available")&&"Y"===c.attr("data-available")&&(u.modules.moreInfo.setProduct(Results.getResult("productId",c.attr("data-productId"))),u.modules.carMoreInfo.runDisplayMethod())}}function r(){s=a("#resultsPage"),u.messaging.subscribe(v.RESULTS_RANKING_READY,m)}var s,t,u=window.meerkat,v=u.modules.events,w=(u.logging.info,"Load"),x=!1;u.modules.register("carResults",{init:r,initPage:b,onReturnToPage:c,get:j,stopColumnWidthTracking:h,recordPreviousBreakpoint:i,switchToPriceMode:o,switchToFeaturesMode:p,showNoResults:l,publishExtraSuperTagEvents:m})}(jQuery),function(){function a(a){var c=!1;switch(a){case"buttonLabel":c="Save Quote";break;case"saveAgain":c='Click \'Save Quote\' to update your saved quote <a href="javascript:;" class="btn btn-save saved-continue-link btn-save-quote">Save Quote</a>';break;case"saveSuccess":c='<div class="col-lg-1 col-sm-2"><h4>Your quote has been saved.</h4><p>To retrieve your quote <a href="'+b.site.urls.base+'retrieve_quotes.jsp" class="btn-cancel saved-continue-link btn-link">click here</a>.</p></div><div class="col-lg-1 col-sm-2"><a href="javascript:;" class="btn btn-cancel btn-block">Close</a></div>'}return c}var b=window.meerkat,c=(b.modules.events,b.logging.info,b.messaging,{});b.modules.register("carSaveQuote",{events:c,getCopy:a})}(jQuery),function(a){function b(b){var c="N",e=!_.isEmpty(b.alarm),f=!_.isEmpty(b.immobiliser);
if(e&&f?c="B":e?c="A":f&&(c="I"),"N"!==c)a(g.selectorParent).empty(),a(g.visibleRow).hide(),a(g.hiddenRow).empty().append(a("<input/>",{type:"hidden",name:"quote_vehicle_securityOption",id:"quote_vehicle_securityOption",value:c})).append(a("<input/>",{type:"hidden",name:"quote_vehicle_securityOptionCheck",id:"quote_vehicle_securityOptionCheck",value:"Y"})).show();else{if(a(g.hiddenRow).empty(),i.find("option:selected").removeAttr("selected"),i.find("select:first").attr("selectedIndex",0),a(g.selectorParent).empty().append(i),h===!0){h=!1;var j=d.site.vehicleSelectionDefaults.securityOption;_.isEmpty(j)||a(g.selector).find("option").each(function(){var b=a(this);b.val()==j&&b.prop("selected",!0)})}a(g.visibleRow).show()}}function c(){a(document).ready(function(){return"car"!==d.site.vertical?!1:(d.messaging.subscribe(e.carVehicleOptions.UPDATED_VEHICLE_DATA,b),i=a(g.selector).clone(),i.find("option:selected").removeAttr("selected"),i.find("select:first").attr("selectedIndex",0),void a(g.selector).remove())})}var d=window.meerkat,e=d.modules.events,f=(d.logging.info,{carVehicleOptions:{UPDATED_VEHICLE_DATA:"UPDATED_VEHICLE_DATA"}}),g={selector:"#securityOptionRow .select:first, #securityOptionRow .fieldrow_legend:first",selectorParent:"#securityOptionRow .row-content",visibleRow:"#securityOptionRow",hiddenRow:"#securityOptionHiddenRow"},h=!0,i=null;d.modules.register("carSecurityOptions",{init:c,events:f,onUpdatedVehicleData:b})}(jQuery),function(a){function b(){d.messaging.subscribe(e.car.SELECTION_RENDERED,function(a){c(a.type)})}function c(b){var c=a(".quoteSnapshot");"fuels"==b||"types"==b?(c.removeClass("hidden"),d.modules.contentPopulation.render(".journeyEngineSlide:eq(0) .snapshot")):(c.addClass("hidden"),d.modules.contentPopulation.empty(".journeyEngineSlide:eq(0) .snapshot"))}{var d=window.meerkat,e=d.modules.events,f=(d.logging.info,{carSnapshot:{}});f.example}d.modules.register("carSnapshot",{init:b,events:f})}(jQuery),function(a){function b(b){if(P===!1){var d=a(H.factory.button);E.modules.loadingAnimation.showAfter(d);var e={redbookCode:a(H.redbook).val()};P=!0,E.modules.comms.get({url:"ajax/json/car_vehicle_options.jsp",data:e,cache:!0,useDefaultErrorHandling:!1,numberOfAttempts:3,errorLevel:"fatal",onSuccess:function(a){K=a,E.messaging.publish(G.carVehicleOptions.UPDATED_VEHICLE_DATA,K),z(),_.isFunction(b)&&b()},onError:c,onComplete:function(){P=!1,E.modules.loadingAnimation.hide(d)}})}}function c(a,b,c,d,e){E.modules.errorHandling.error({message:"Sorry, we cannot seem to retrieve a list of accessories for your vehicles at this time. Please come back to us later and try again.",page:"carVehicleOptions.js:getVehicleData()",errorLevel:"warning",description:"Failed to retrieve a list of accessories for RedBook Code: "+c,data:e})}function d(){var b=l(K.options),c=n(K.standard),d=_.template(a(H.factory.template).html()),e=d({optionalAccessories:b,standardAccessories:c});return J.factory=E.modules.dialogs.show({title:a(this).prop("title"),htmlContent:e,hashId:"factory-options",tabs:[{title:"Add Factory/Dealer Options",xsTitle:"Factory/Dealer Options",targetSelector:".quote-factory-options"},{title:"View Included Standard Accessories",xsTitle:"Standard Accessories",targetSelector:".quote-standard-accessories"}],buttons:[{label:"Save Changes",className:"btn-save",action:_.bind(w,this,{type:"factory"})}],rightBtn:{label:"Save Changes",className:"btn-sm btn-save",callback:_.bind(w,this,{type:"factory"})},closeOnHashChange:!0,openOnHashChange:!1,onClose:_.bind(A,this,{type:"factory"}),onOpen:function(b){_.isArray(K.options)&&K.options.length?a(".quote-factory-options .no-items-found").addClass("hidden"):a(".quote-factory-options .items-found").addClass("hidden"),_.isArray(K.standard)&&K.standard.length?a(".quote-standard-accessories .no-items-found").addClass("hidden"):a(".quote-standard-accessories .items-found").addClass("hidden"),a("#"+b).on("click",".nav-tabs a",function(c){c.preventDefault(),c.stopPropagation(),a(this).tab("show"),a("#"+b+" .modal-title-label").html(a(this).prop("title"))}),a(".nav-tabs a:first").click(),I&&_.defer(function(){a(function(){a("html.lt-ie9 form#quote_vehicle_factoryOptionsDialogForm").on("change.checkedForIE",".checkbox input, .compareCheckbox input",function(){var b=a(this);b.is(":checked")?b.addClass("checked"):b.removeClass("checked")}),a("html.lt-ie9 form#quote_vehicle_factoryOptionsDialogForm .checkbox input").change()})})}}),!1}function e(){var b=m(L),c=n(K.standard),d=o(),e=_.template(a(H.accessories.template).html()),g=e({optionalAccessories:b,standardAccessories:c,selectedAccessories:d});return J.accessories=E.modules.dialogs.show({title:a(this).prop("title"),htmlContent:g,hashId:"accessories",tabs:[{title:"Add Non-Standard Accessories",xsTitle:"Non-Standard Accessories",targetSelector:".quote-optional-accessories"},{title:"View Included Standard Accessories",xsTitle:"Standard Accessories",targetSelector:".quote-standard-accessories"}],buttons:[{label:"Save Changes",className:"btn-save",action:_.bind(w,this,{type:"accessories"})}],rightBtn:{label:"Save Changes",className:"btn-sm btn-save",callback:_.bind(w,this,{type:"accessories"})},closeOnHashChange:!0,openOnHashChange:!1,onClose:_.bind(A,this,{type:"accessories"}),onOpen:function(b){_.isArray(L)&&L.length?a(".quote-optional-accessories .no-items-found").addClass("hidden"):a(".quote-optional-accessories .items-found").addClass("hidden"),_.isArray(K.standard)&&K.standard.length?a(".quote-standard-accessories .no-items-found").addClass("hidden"):a(".quote-standard-accessories .items-found").addClass("hidden"),a("#"+b).on("click",".nav-tabs a",function(c){c.preventDefault(),c.stopPropagation(),a(this).tab("show"),a("#"+b+" .modal-title-label").html(a(this).prop("title"))}),a(".nav-tabs a:first").click(),f()}}),!1}function f(){a(H.accessories.add).find("button:first").on("click",h),a(H.accessories.clear).find("button:first").on("click",g),a(H.accessories.included).find("label.btn").off().on("click",function(){a(this).change(),"N"==a(this).find("input:first").val()?_.defer(function(){a(H.accessories.included).hide(),a(H.accessories.price).show()}):a(H.accessories.price).hide(),_.defer(function(){a(H.accessories.add+","+H.accessories.clear).show()})});for(var b=0;b<N.accessories.length;b++){var c=N.accessories[b],d=a(H.accessories.addeditems),e=d.find("li.added-item-"+c.position).first();e.data("info",c),e.find("a:first").on("click",_.bind(j,this,c))}}function g(){a(H.accessories.price+","+H.accessories.add+","+H.accessories.clear).hide(),a(H.accessories.included).show(),$type=a(H.accessories.type),$included=a(H.accessories.included),$price=a(H.accessories.price),$included.find(".active").removeClass("active").end().find("input:checked").prop("checked",!1).change().end().find(".error-field").empty().end().removeClass("has-error"),$type.find("select:first").prop("selectedIndex",0).end().find("option").prop("selected",!1).end().removeClass("has-error").end().find(".error-field").empty(),$price.removeClass("has-error").find(".error-field").empty().end().find("input").val("")}function h(){var b=k();b!==!1&&(a(H.accessories.type).find("option").each(function(){0===a(this).val().indexOf(b.position)&&a(this).remove()}),a(H.accessories.addeditems).append(i(b)),g())}function i(b){return a("<li/>").addClass("added-item-"+b.position).data("info",b).append(a("<span/>").append(b.info.label)).append(a("<a/>",{title:"remove accessory"}).addClass("icon-cross").on("click",_.bind(j,this,b))).append(a("<span/>").append(b.price===!1?"included":"$"+b.price))}function j(b){a(H.accessories.addeditems).find(".added-item-"+b.position).remove(),a(H.accessories.type).find("option").each(function(){return parseInt(a(this).val(),10)>b.position?(a(this).before(a("<option/>",{text:b.info.label,value:b.position+"_"+b.info.code})),!1):void 0})}function k(){var b=a(H.accessories.type).find("option:selected"),c=a(H.accessories.included+" .active").find("input"),d=a(H.accessories.price).find("input").val(),e=!_.isEmpty(b)&&!_.isEmpty(b.val()),f=!_.isEmpty(c)&&!_.isEmpty(c.val()),g=!_.isEmpty(d)&&!isNaN(d)&&d>0;if($type=a(H.accessories.type),e===!1?($type.addClass("has-error"),$type.find(".error-field").empty().append("Select an accessory")):($type.removeClass("has-error"),$type.find(".error-field").empty()),$included=a(H.accessories.included),f===!1?($included.addClass("has-error"),$included.find(".error-field").empty().append("Is included in purchase price?")):($included.removeClass("has-error"),$included.find(".error-field").empty()),$price=a(H.accessories.price),g===!1?($price.addClass("has-error"),$price.find(".error-field").empty().append("Enter the accessory purchase price")):($price.removeClass("has-error"),$included.find(".error-field").empty()),e===!0&&f===!0){var h=b.val();if(b=h.substring(3).replace(/^\s+|\s+$/gm,""),position=String(h.substring(0,2)),c="Y"==c.val(),d=""===d||isNaN(d)?!1:d,c===!0||d!==!1){for(var i=!1,j=0;j<L.length;j++)L[j].code==b&&(i={position:position,included:c,price:d,info:L[j]},j=L.length+1);if(i!==!1){if(c===!1){var k=Math.ceil(i.info.standard*(i.info.min/100)),l=Math.floor(i.info.standard*(i.info.max/100));if(Number(d)<k||Number(d)>l)return $price.addClass("has-error"),$price.find(".error-field").empty().append("Please enter a value between $"+k+" and $"+l),!1}return i}}}return!1}function l(b){for(var c=a("<ul/>"),d=0;d<b.length;d++){var e=b[d],f="tmp_fact_"+d+"_chk",g="tmp_quote_opts_opt"+("0"+d).slice(-2),h=a("<input/>",{type:"checkbox",name:g,id:f,value:e.code});-1!==_.indexOf(N.factory,f)&&h.prop("checked",!0),c.append(a("<li/>").append(a("<div/>").addClass("checkbox").append(h).append(a("<label/>").prop("for",f).append(B(e.label)))))}return c.html()}function m(b){function c(a){for(var b=0;b<N.accessories.length;b++)if(a==N.accessories[b].info.code)return!0;return!1}var d=a("<select/>"),e=[];e.push(a("<option/>",{text:"please choose...",value:""}));for(var f=0;f<b.length;f++){var g=b[f],h=a("<option/>",{text:g.label,value:("0"+f).slice(-2)+"_"+String(g.code).replace("/","/ ")});c(g.code)||e.push(h)}for(var i=0;i<e.length;i++)d.append(e[i]);return d.html()}function n(b){for(var c=a("<ul/>"),d=0;d<b.length;d++){var e=b[d];c.append(a("<li/>",{text:B(e.label)}))}return c.html()}function o(){for(var b=a("<ul/>"),c=0;c<N.accessories.length;c++)b.append(i(N.accessories[c]));return b.html()}function p(a){for(var b=0;b<L.length;b++)if(L[b].code===a)return L[b];return!1}function q(a){return K.options.hasOwnProperty(a)?K.options[a]:!1}function r(){a(H.factory.inputs).empty(),a(H.factory.saveditems).empty(),a(H.accessories.inputs).empty(),a(H.accessories.saveditems).empty();var b=M.factory,c=M.accessories;if(!_.isUndefined(b)&&!_.isEmpty(b))for(var d in b.opts)if(b.opts.hasOwnProperty(d)){var e=String(parseInt(d.substring(3),10)),f="tmp_fact_"+e+"_chk",g=q(e);g.position=("0"+e).slice(-2),g!==!1&&(N.factory.push("tmp_fact_"+e+"_chk"),a(H.factory.inputs).append(y({id:f.slice(4),name:"quote_opts_opt"+("0"+e).slice(-2),value:g.code})),u({type:"factory",item:g}))}if(!_.isUndefined(c)&&!_.isEmpty(c))for(var h in c.accs)if(c.accs.hasOwnProperty(h)){var i=c.accs[h],j={included:"Y"===i.inc,position:h.substring(3),price:i.hasOwnProperty("prc")?String(i.prc):!1,info:p(i.sel)};N.accessories.push(j),x(j)}A({type:"factory"}),A({type:"accessories"})}function s(b){if(a(".saved-item-"+b.type+"-"+b.position).remove(),"factory"==b.type){for(var c=0;c<N.factory.length;c++)N.factory[c]=="tmp_fact_"+parseInt(b.position,10)+"_chk"&&N.factory.splice(c,1);_.isEmpty(N.factory)&&A({type:"factory"})}else{for(var d=0;d<N.accessories.length;d++)N.accessories[d].info.code==b.code&&N.accessories.splice(d,1);_.isEmpty(N.accessories)&&A({type:"accessories"})}}function t(b){var c=a("<li/>").addClass("saved-item-"+b.type+"-"+("0"+b.position).slice(-2)).data("info",b).append(a("<span/>").append(b.label)).append(a("<a/>",{title:"remove "+("factory"==b.type?"factory option":"accessory")}).addClass("icon-cross").on("click",_.bind(s,this,b)));return _.isNull(b.price)||c.append(a("<span/>").append(b.price===!1?"included":"$"+b.price)),c}function u(b){var c={type:b.type,position:"",label:"",price:null,code:"",item:null};"accessories"==b.type?(c.position=b.item.position,c.label=b.item.info.label,c.price=b.item.price,c.code=b.item.info.code,c.item=b.item,a(H.accessories.saveditems).append(t(c))):(c.position=b.item.position,c.label=b.item.label,c.code=b.item.code,c.item=b.item,a(H.factory.saveditems).append(t(c)))}function v(){O===!1?(N.factory=[],N.accessories=[],N.accessories=[],a(H.factory.inputs).empty(),a(H.factory.saveditems).empty(),a(H.accessories.inputs).empty(),a(H.accessories.saveditems).empty(),A({type:"factory"}),A({type:"accessories"}),b()):(O=!1,b(r))}function w(b){N[b.type]=[],a(H[b.type].inputs).empty(),a(H[b.type].saveditems).empty(),"accessories"==b.type?a(H[b.type].addeditems).find("li").each(function(){var b=a(this).data("info");N.accessories.push(b),x(b)}):a(H[b.type].checkboxes).find(":checked").each(function(){var b=a(this);N.factory.push(b.prop("id"));var c=b.prop("name").slice(4),d=b.prop("id").slice(4),e=d.split("_")[1],f=q(e);f.position=("0"+e).slice(-2),a(H.factory.inputs).append(y({id:d,name:c,value:b.val()}).addClass("saved-item-factory-"+("0"+f.position).slice(-2))),u({type:"factory",item:f})}),E.modules.dialogs.close(J[b.type])}function x(b){a(H.accessories.inputs).append(y({name:"quote_accs_acc"+b.position+"_sel",id:"acc_"+b.position+"_chk",value:b.info.code}).addClass("saved-item-accessories-"+("0"+b.position).slice(-2))).append(y({name:"quote_accs_acc"+b.position+"_inc",value:b.included===!0?"Y":"N"}).addClass("saved-item-accessories-"+("0"+b.position).slice(-2))),b.included===!1&&a(H.accessories.inputs).append(y({name:"quote_accs_acc"+b.position+"_prc",value:b.price}).addClass("saved-item-accessories-"+("0"+b.position).slice(-2))),u({type:"accessories",item:b})}function y(b){var c={type:"hidden"};return _.extend(c,b),a("<input/>",c)}function z(){_.isArray(K.options)&&K.options.length?a("#quote_vehicle_factoryOptionsFieldSet").removeClass("hidden"):a("#quote_vehicle_factoryOptionsFieldSet").addClass("hidden")}function A(b){var c=a(H[b.type].radio+" input:radio").is(":checked");_.isEmpty(N[b.type])?(a(H[b.type].button).css({display:"none"}),a(H[b.type].radio).css({display:"block"}),a(H[b.type].radio+" input:radio").prop("checked",!1).change(),c===!0&&(a(H[b.type].radio+" input:radio:last").prop("checked",!0).change(),a(H[b.type].yn).val("N"))):(a(H[b.type].radio+" input:radio").prop("checked",!1),c===!0&&(a(H[b.type].radio+" input:radio:first").prop("checked",!0).change(),a(H[b.type].yn).val("Y")),a(H[b.type].radio).css({display:"none"}),a(H[b.type].button).css({display:"block"}))}function B(b){return a("<div />").html(b).text()}function C(a,b){b.preventDefault(),b.stopPropagation(),a.callback()}function D(){a(document).ready(function(){if("car"!==E.site.vertical)return!1;I=E.modules.performanceProfiling.isIE8(),E.messaging.subscribe(F.car.VEHICLE_CHANGED,v);for(var b=["factory","accessories"],c=0;c<b.length;c++){var f=b[c],g=a(H[f].yn).val();_.isEmpty(g)||(a(H[f].radio+" input:radio").prop("checked",!1).change(),a(H[f].radio+" input:radio[value="+g+"]").prop("checked",!0).change())}L=E.site.nonStandardAccessoriesList.items,_.extend(M,userOptionPreselections),a(H.factory.radio+" label:first").on("click",_.bind(C,this,{type:"factory",callback:d})),a(H.accessories.radio+" label:first").on("click",_.bind(C,this,{type:"accessories",callback:e})),a(H.factory.radio+" label:last").on("click",function(){a(H.factory.yn).val("N")}),a(H.accessories.radio+" label:last").on("click",function(){a(H.accessories.yn).val("N")}),a(H.factory.button).on("click",d),a(H.accessories.button).on("click",e)})}var E=window.meerkat,F=E.modules.events,G=(E.logging.info,{car:{VEHICLE_CHANGED:"VEHICLE_CHANGED"},carVehicleOptions:{UPDATED_VEHICLE_DATA:"UPDATED_VEHICLE_DATA"}}),H={factory:{radio:"#quote_vehicle_factoryOptionsRadioBtns",yn:"#quote_vehicle_factoryOptions",button:"#quote_vehicle_factoryOptionsButton",template:"#quote-factoryoptions-template",checkboxes:"#quote_vehicle_factoryOptionsDialog .quote-factory-options",inputs:"#quote_vehicle_options_inputs_container .factory:first",saveditems:"#quote_vehicle_factoryOptionsSelections .added-items ul"},accessories:{radio:"#quote_vehicle_accessoriesRadioBtns",yn:"#quote_vehicle_accessories",button:"#quote_vehicle_accessoriesButton",template:"#quote-nonstandard-accessories-template",inputs:"#quote_vehicle_options_inputs_container .accessories:first",wrapper:"#quote_vehicle_accessoriesDialog .quote-optional-accessories",type:"#quote_vehicle_accessoriesDialog .ac-type",included:"#quote_vehicle_accessoriesDialog .ac-included",price:"#quote_vehicle_accessoriesDialog .ac-price",add:"#quote_vehicle_accessoriesDialog .ac-add",clear:"#quote_vehicle_accessoriesDialog .ac-clear",addeditems:"#quote_vehicle_accessoriesDialog .quote-optional-accessories .added-items ul",saveditems:"#quote_vehicle_accessoriesSelections .added-items ul"},redbook:"#quote_vehicle_redbookCode"},I=!1,J={factory:{},accessories:{}},K={},L=[],M={},N={factory:[],accessories:[]},O=!0,P=!1;E.modules.register("carVehicleOptions",{init:D,events:G,onVehicleChanged:v})}(jQuery),function(a){function b(b){if(x===!1){w=b;var e=a(r[b]);p.modules.loadingAnimation.showAfter(e);for(var g={},h=0;h<_.indexOf(u,b);h++){var i=u[h];_.indexOf(u,b)>_.indexOf(u,"bodies")&&"bodies"==i?g.body=a(r[i]).val():g[i.substring(0,i.length-1)]=a(r[i]).val()}x=!0,p.modules.comms.get({url:"car/"+b+"/list.json",data:g,cache:!0,useDefaultErrorHandling:!1,numberOfAttempts:3,errorLevel:"fatal",onSuccess:function(a){d(b,a),f(b)},onError:c,onComplete:function(){x=!1,p.modules.loadingAnimation.hide(e),n()}})}}function c(b,c,d,e,f){x=!1,p.modules.loadingAnimation.hide(a(r[w]));var h=g(w);if(h!==!1){var i=a(r[h]);i.find("option:selected").prop("selected",!1)}a(r[w]).empty().append(a("<option/>",{text:s.errorInOptionHTML+w,value:""})).prop("disabled",null),p.modules.errorHandling.error({message:"Sorry, we cannot seem to retrieve a list of "+w+" for your vehicles at this time. Please come back to us later and try again.",page:"vehicleSelection.js:getVehicleSelectorData()",errorLevel:"warning",description:"Failed to retrieve a list of "+w+": "+d,data:f})}function d(a,b){e(a);for(var c=_.indexOf(u,a);c<u.length;c++)b.hasOwnProperty(u[c])&&v.hasOwnProperty(u[c])&&(v[u[c]]=b[u[c]])}function e(a){for(var b=_.isUndefined(a)?0:_.indexOf(u,a),c=b;c<u.length;c++)v[u[c]]={}}function f(c){if(v.hasOwnProperty(c)){w=c;var d=!1,e=p.modules.performanceProfiling.isIos()&&"xs"==p.modules.deviceMediaState.get();if(_.isArray(v[c])&&v[c]){var g=null;y===!0&&t.hasOwnProperty(c)&&""!==t[c]&&(g=t[c]),d=1===v[c].length,$selector=a(r[c]),$selector.empty();var j=[];j.push(a("<option/>",{text:s.pleaseChooseOptionHTML,value:""})),"makes"==c?(j.push(a("<optgroup/>",{label:"Top Makes"})),j.push(a("<optgroup/>",{label:"All Makes"}))):e&&d!==!0&&j.push(a("<optgroup/>",{label:c.charAt(0).toUpperCase()+c.slice(1)}));for(var k in v[c])if(v[c].hasOwnProperty(k)){var m=v[c][k],n=a("<option/>",{text:m.label,value:m.code});g===!0||d!==!0&&(_.isNull(g)||g!=m.code)||(n.attr("selected",!0),g=!0),"makes"==c?m.isTopMake===!0?n.appendTo(j[1],j[2]):j[2].append(n):e&&d!==!0?j[1].append(n):j.push(n)}for(var o=0;o<j.length;o++)$selector.append(j[o]);$selector.removeAttr("disabled"),$selector.is(":visible")||a(r[c+"Row"]).removeClass("hidden"),i(c),d===!0?$selector.trigger("blur"):l($selector);var u=h(c);p.messaging.publish(q.car.SELECTION_RENDERED,{type:c}),u!==!1&&(_.isArray(v[u])&&!_.isEmpty(v[u])?f(u):d===!0&&(x=!1,b(u)))}else a(r[w]).empty().append(a("<option/>",{text:s.notFoundOptionHTML,value:""}))}}function g(a){var b=_.indexOf(u,a)-1;return u.hasOwnProperty(b)?u[b]:!1}function h(a){var b=_.indexOf(u,a)+1;return u.hasOwnProperty(b)?u[b]:!1}function i(b){var c=_.indexOf(u,b);if(c>-1)for(var d=c+1;d<u.length;d++)if(r.hasOwnProperty(u[d])){var e=a(r[u[d]]);e.attr("selectedIndex",0),e.empty().append(a("<option/>",{text:s.resetOptionHTML,value:""})),l(e),e.attr("disabled",!0)}}function j(c){y=!1;var d=h(c.field),e=_.isEmpty(a(r[c.field]).val()),f=m("makes",a(r.makes).val());f!==!1&&a(r.makeDes).val(f.label);var g=m("models",a(r.models).val());g!==!1&&a(r.modelDes).val(g.label);var j=m("years",a(r.years).val());j!==!1&&a(r.registrationYear).val(j.code),e===!0?i(c.field):d!==!1&&b(d),"types"!==c.field||_.isEmpty(a(r.types).val())||n()}function k(){for(var b=0;b<u.length;b++)u.hasOwnProperty(b)&&a(r[u[b]]).on("change",_.bind(j,this,{field:u[b]}))}function l(a){a.removeClass("has-success has-error"),a.parent().removeClass("has-success has-error")}function m(a,b){if(!_.isEmpty(b))for(var c=0;c<v[a].length;c++)if(b==v[a][c].code)return v[a][c];return!1}function n(){var b=a(r.types).val();if(!_.isEmpty(b)){var c=m("makes",a(r.makes).val());c!==!1&&a(r.makeDes).val(c.label);var d=m("models",a(r.models).val());d!==!1&&a(r.modelDes).val(d.label);var e=m("years",a(r.years).val());e!==!1&&a(r.registrationYear).val(e.code);var f=m("types",b);f!==!1&&(a(r.marketValue).val(f.value),a(r.variant).val(f.label)),p.messaging.publish(q.car.VEHICLE_CHANGED)}}function o(){a(document).ready(function(){return"car"!==p.site.vertical?!1:(e(),_.extend(t,p.site.vehicleSelectionDefaults),_.extend(v,p.site.vehicleSelectionDefaults.data),k(),f("makes"),void n())})}var p=window.meerkat,q=(p.modules.events,p.logging.info,{car:{VEHICLE_CHANGED:"VEHICLE_CHANGED",SELECTION_RENDERED:"SELECTION_RENDERED"}}),r={makes:"#quote_vehicle_make",makeDes:"#quote_vehicle_makeDes",makesRow:"#quote_vehicle_makeRow",models:"#quote_vehicle_model",modelDes:"#quote_vehicle_modelDes",modelsRow:"#quote_vehicle_modelRow",years:"#quote_vehicle_year",registrationYear:"#quote_vehicle_registrationYear",yearsRow:"#quote_vehicle_yearRow",bodies:"#quote_vehicle_body",bodiesDes:"#quote_vehicle_bodyDes",bodiesRow:"#quote_vehicle_bodyRow",transmissions:"#quote_vehicle_trans",transmissionsRow:"#quote_vehicle_transRow",fuels:"#quote_vehicle_fuel",fuelsRow:"#quote_vehicle_fuelRow",types:"#quote_vehicle_redbookCode",typesRow:"#quote_vehicle_redbookCodeRow",marketValue:"#quote_vehicle_marketValue",variant:"#quote_vehicle_variant"},s={pleaseChooseOptionHTML:"Please choose...",resetOptionHTML:" ",notFoundOptionHTML:"No match for above choices",errorInOptionHTML:"Error finding "},t={},u=["makes","models","years","bodies","transmissions","fuels","types"],v={},w=!1,x=!1,y=!0;p.modules.register("carVehicleSelection",{init:o,events:q})}(jQuery),function(a){function b(){var b=g.modules.utilities.returnAge(a(i.reg_dob).val(),!0),d=g.modules.utilities.returnAge(a(i.yng_dob).val(),!0),e=Math.min(b,d);20>=e?a(i.age_row).slideUp():24>=e?(a(i.age_row).slideDown(),c(["H"])):29>=e?(a(i.age_row).slideDown(),c(["H","7"])):39>=e?(a(i.age_row).slideDown(),c(["H","7","A"])):(a(i.age_row).slideDown(),c(["H","7","A","D"]))}function c(b){var c=a(i.restrict),d=c.val();c.empty();for(var e=0;e<k.length;e++){var f=k[e];if(j.hasOwnProperty(f)&&("0"===f||"3"===f||_.indexOf(b,f)>=0)){var g=j[f].clone();f===d&&g.prop("selected",!0),c.append(g)}}}function d(){var b=a(i.restrict);b.find("option").each(function(){var b=a(this),c=_.isEmpty(b.val())?0:b.val();j[c]=b.clone(),j[c].removeAttr("selected")})}function e(){var b=a(i.labels).find("input:checked");_.isEmpty(b)||("Y"===b.val()?a(i.toggle).slideDown():a(i.toggle).slideUp("fast",function(){var b=a(this);b.find(":text").val(""),b.find(":radio").prop("checked",!1).change(),a(i.yng_dob).val("").change(),b.find(".has-success").removeClass("has-success"),b.find(".has-error").removeClass("has-error"),b.find(".error-field").remove()}))}function f(){a(document).ready(function(){return"car"!==g.site.vertical?!1:(a(i.labels+" label").on("click",e),a(i.reg_dob+","+i.yng_dob).on("change",b),d(),e(),void b())})}var g=window.meerkat,h=(g.modules.events,g.logging.info,{}),i={toggle:"#quote_drivers_youngToggleArea",labels:"#quote_drivers_youngDriverRow .row-content",restrict:"#quote_options_driverOption",reg_dob:"#quote_drivers_regular_dob",yng_dob:"#quote_drivers_young_dob",age_row:"#quote_restricted_ageRow"},j={},k=["0","3","H","7","A","D"];g.modules.register("carYoungDrivers",{init:f,events:h})}(jQuery);
//# sourceMappingURL=car.modules.ctm.min.map