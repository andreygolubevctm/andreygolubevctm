!function(e,t){function a(){e(document).ready(function(){o()})}function n(t){return"Y"===e("#"+t+"_elasticSearch").val()}function o(){var t=e("input.typeahead"),a=null;t.each(function(){var t,o=e(this),r=o.attr("id"),u=r.match(/(_)[a-zA-Z]{1,}$/g),c=r.replace(u,""),h=n(c);o.data("addressfieldid",c),h?(t="address/search.json",a={name:o.attr("name"),remote:{beforeSend:function(a,n){i(o),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.type="POST",n.hasContent=!0,n.url=t;var l=e("#"+c+"_autofilllessSearch"),s=l.val();n.data=e.param({query:decodeURI(s)})},filter:function(e){return l(o),e},url:t,error:function(t,a){d.modules.errorHandling.error({page:"autocomplete.js",errorLevel:"warning",title:"Address lookup failed",message:"<p>Sorry, we are having troubles connecting to our address servers.</p><p>Please manually enter your address.</p>",description:"Could not connect to the elastic search.json",data:t}),e("#"+c+"_nonStd").trigger("click").prop("checked",!0),l(o)}},limit:150}):"countrySelectionList"==o.attr("data-varname")?a=d.modules.travelCountrySelector.getCountrySelectorParams(o):(t=o.attr("data-source-url"),a={name:o.attr("name"),remote:{beforeSend:function(){i(o)},filter:function(e){return l(o),e},url:o.attr("data-source-url")+"%QUERY"},limit:150}),a=s(o,a),o.typeahead(a),o.hasClass("input-lg")&&o.prev(".tt-hint").addClass("hint-lg"),o.hasClass("input-sm")&&o.prev(".tt-hint").addClass("hint-sm"),o.hasClass("blur-on-select")&&o.bind("typeahead:selected",function(e,t,a){t.hasOwnProperty("value")&&"Type your address..."===t.value||e&&e.target&&e.target.blur&&e.target.blur()})})}function i(e){e.hasClass("show-loading")&&d.modules.loadingAnimation.showInside(e.parent(".twitter-typeahead"))}function l(e){e.hasClass("show-loading")&&d.modules.loadingAnimation.hide(e.parent(".twitter-typeahead"))}function s(t,a){if(t&&t.hasClass("typeahead-address")){var o=t.data("addressfieldid"),i=n(o);a.remote.url=t.attr("id"),a.remote.replace=r,a.valueKey="value",a.template=_.template("<p>{{= highlight }}</p>"),(t.hasClass("typeahead-autofilllessSearch")||t.hasClass("typeahead-streetSearch"))&&(a.remote.filter=function(a){return l(t),i&&e.each(a,function(e,t){t.hasOwnProperty("text")&&t.hasOwnProperty("payload")&&(t.value=t.text,t.highlight=t.text,t.dpId=t.payload)}),a.push({value:"Type your address...",highlight:"Can't find your address? <u>Click here.</u>"}),a},t.bind("typeahead:selected",function(e,a,n){if(a.hasOwnProperty("value")&&"Type your address..."===a.value){var l="";i||e.target&&e.target.id&&(l=e.target.id.replace("_streetSearch","")),d.messaging.publish(c.CANT_FIND_ADDRESS,{fieldgroup:l})}else i&&(d.messaging.publish(c.ELASTIC_SEARCH_COMPLETE,{dpid:a.dpId,addressFieldId:o}),t.valid())}))}return a}function r(t,a){var n=e("#"+t);return t="",n.trigger("getSearchURL"),n.data("source-url")&&(t=n.data("source-url")),t}var d=window.meerkat,u=(d.modules.events,d.logging.info,{autocomplete:{CANT_FIND_ADDRESS:"EVENT_CANT_FIND_ADDRESS",ELASTIC_SEARCH_COMPLETE:"ELASTIC_SEARCH_COMPLETE",INIT:"INIT"}}),c=u.autocomplete;d.modules.register("autocomplete",{init:a,events:u,autocompleteBeforeSend:i,autocompleteComplete:l})}(jQuery),function(e,t){function a(t){var a=e.extend({},C,t);f="xs"===p.modules.deviceMediaState.get()?!0:!1;var i="mkDialog_"+v;_.isUndefined(a.id)?(a.id=i,v++):h(a.id)&&n(a.id),null!=a.hashId&&p.modules.address.appendToHash(a.hashId);var d=_.template(a.templates.dialogWindow);(null!=a.url||null!=a.externalUrl)&&(a.htmlContent=p.modules.loadingAnimation.getTemplate());var u=d(a);e("#dynamic_dom").append(u);var c=e("#"+a.id);c.modal({show:!0,backdrop:a.buttons&&a.buttons.length>0?"static":!0,keyboard:!1}),c.css("z-index",parseInt(c.eq(0).css("z-index"))+10*y.length);var m=e(".modal-backdrop");if(m.eq(m.length-1).css("z-index",parseInt(m.eq(0).css("z-index"))+10*y.length),c.on("hidden.bs.modal",function(t){if("undefined"!=typeof t.target){var a=e(t.target);0!==a.length&&a.hasClass("modal")!==!1&&o(a.attr("id"))}}),c.on("shown.bs.tab",function(e){r(a.id)}),c.find("button").on("click",function(t){var n=a.buttons[e(t.currentTarget).attr("data-index")];_.isUndefined(n)||(n.closeWindow===!0&&e(t.currentTarget).closest(".modal").modal("hide"),"function"==typeof n.action&&n.action(t))}),c.find(".navbar-nav button").off().on("click",function(t){var n=a[e(t.currentTarget).attr("data-button")];"undefined"!=typeof n&&"function"==typeof n.callback&&n.callback(t)}),null!=a.url&&p.modules.comms.get({url:a.url,cache:a.cacheUrl,errorLevel:"warning",onSuccess:function(e){l(a.id,e),"function"==typeof a.onLoad&&a.onLoad(a.id)}}),null!=a.externalUrl){var g='<iframe class="displayNone" id="'+a.id+'_iframe" width="100%" height="100%" frameborder="0" scrolling="no" allowtransparency="true" src="'+a.externalUrl+'"></iframe>';s(a.id,g),e("#"+a.id+"_iframe").on("load",function(){e(this).show(),p.modules.loadingAnimation.hide(e("#"+a.id))})}return window.setTimeout(function(){r(a.id)},0),"function"==typeof a.onOpen&&a.onOpen(a.id),y.push(a),a.id}function n(t){e("#"+t).modal("hide")}function o(t){y.length>1&&_.defer(function(){y.length>0&&y[0].id!==t&&e(document.body).addClass("modal-open")});var a=u(t);null!==a&&"function"==typeof a.onClose&&a.onClose(t),a.destroyOnClose===!0?d(t):p.modules.address.removeFromHash(a.hashId)}function i(t){e("#dynamic_dom .modal").each(function(t,a){r(e(a).attr("id"))})}function l(t,a,n){e("#"+t+" .modal-body").html(a),"function"==typeof n&&n(),i()}function s(t,a){e("#"+t+" .modal-body").append(a),i()}function r(t){f="xs"===p.modules.deviceMediaState.get()?!0:!1;var a=e("#"+t);if(0===a.find(".modal-header").outerHeight(!0))window.setTimeout(function(){r(t)},20);else{var n,o,i,l=a.find(".modal-content"),s=a.find(".modal-body"),d=a.find(".modal-dialog");n=e(window).height(),f||(n-=60),o=n,o-=a.find(".modal-header").outerHeight(!0),o-=a.find(".modal-footer").outerHeight(!0),o-=a.find(".modal-closebar").outerHeight(!0),f?(l.css("height",n),a.find(".modal-body").css("max-height","none").css("height",o),i=0,d.css("top",i)):(l.css("max-height",n),"true"===a.attr("data-fullheight")?(l.css("height",n),s.css("height",o)):(l.css("height","auto"),s.css("height","auto")),a.find(".modal-body").css("max-height",o),i=n/2-d.height()/2,l.height()<n&&(i/=2),d.css("top",i))}}function d(t){if(t&&0!==t.length){var a=e("#"+t);a.find("button").off().end().remove();var n=u(t);if(null!=n){if(null!=n.hashId){p.modules.address.removeFromHash(n.hashId);var o=_.findWhere(b,{hashId:n.hashId});null==o&&b.push(n)}y.splice(n.index,1)}}}function u(e){var t=c(e);return null!==t?(y[t].index=t,y[t]):null}function c(e){for(var t=0;t<y.length;t++)if(y[t].id==e)return t;return null}function h(e){return!_.isNull(c(e))}function m(){e(document).ready(function(){e(document).on("click",".btn-close-dialog",function(){e(this).closest(".modal").modal("hide")}),Modernizr.touch&&(e(document).on("touchmove",".modal",function(e){e.preventDefault()}),e(document).on("touchmove",".modal .modal-body",function(e){e.stopPropagation()}))});var t=this;p.messaging.subscribe(g.dynamicContentLoading.PARSED_DIALOG,function(t){var n,o=t.element.attr("data-dialog-hash-id"),i=null;""!==o&&(i=o),n="url"===t.contentType?{title:t.element.attr("data-title"),url:t.contentValue,cacheUrl:t.element.attr("data-cache")?!0:!1}:"externalUrl"===t.contentType?{title:t.element.attr("data-title"),externalUrl:t.contentValue}:{title:e(t.contentValue).attr("data-title"),htmlContent:t.contentValue};var l=e.extend({hashId:i,closeOnHashChange:!0,className:t.element.attr("data-class")},n);a(l)});var n=_.debounce(i,300);e(window).resize(n),p.messaging.subscribe(g.ADDRESS_CHANGE,function(e){for(var a=y.length-1;a>=0;a--){var n=y[a];n.closeOnHashChange===!0&&-1==_.indexOf(e.hashArray,n.hashId)&&t.close(n.id)}for(var o=0;o<e.hashArray.length;o++){var i=_.findWhere(y,{hashId:e.hashArray[o]});if(null==i){var l=_.findWhere(b,{hashId:e.hashArray[o]});null!=l&&l.openOnHashChange===!0&&p.modules.dialogs.show(l)}}},window)}var f,p=window.meerkat,g=p.modules.events,v=(p.logging.info,0),b=[],y=[],C={title:"",htmlContent:null,url:null,cacheUrl:!1,buttons:[],className:"",leftBtn:{label:"Back",icon:"",className:"btn-sm btn-close-dialog",callback:null},rightBtn:{label:"",icon:"",className:"",callback:null},tabs:[],htmlHeaderContent:"",hashId:null,destroyOnClose:!0,closeOnHashChange:!1,openOnHashChange:!0,fullHeight:!1,templates:{dialogWindow:'<div id="{{= id }}" class="modal" tabindex="-1" role="dialog" aria-labelledby="{{= id }}_title" aria-hidden="true"{{ if(fullHeight===true){ }} data-fullheight="true"{{ } }}><div class="modal-dialog {{= className }}"><div class="modal-content"><div class="modal-closebar">	<a href="javascript:;" class="btn btn-close-dialog"><span class="icon icon-cross"></span></a></div><div class="navbar navbar-default xs-results-pagination visible-xs"><div class="container"><ul class="nav navbar-nav"><li><button data-button="leftBtn" class="btn btn-back {{= leftBtn.className }}">{{= leftBtn.icon }} {{= leftBtn.label }}</button></li><li class="navbar-text modal-title-label">	{{= title }}</li>{{ if(rightBtn.label != "" || rightBtn.icon != "") { }}<li class="right"><button data-button="rightBtn" class="btn btn-save {{= rightBtn.className }}">{{= rightBtn.label }} {{= rightBtn.icon }}</button></li>{{ } }}</ul></div></div>{{ if(title != "" || tabs.length > 0 || htmlHeaderContent != "" ) { }}<div class="modal-header">{{ if (tabs.length > 0) { }}<ul class="nav nav-tabs tab-count-{{= tabs.length }}">{{ _.each(tabs, function(tab, iterator) { }}<li><a href="javascript:;" data-target="{{= tab.targetSelector }}" title="{{= tab.xsTitle }}">{{= tab.title }}</a></li>{{ }); }}</ul>{{ } else if(title != "" ){ }}<h4 class="modal-title hidden-xs" id="{{= id }}_title">{{= title }}</h4>{{ } else if(htmlHeaderContent != "") { }}{{= htmlHeaderContent }}{{ } }}</div>{{ } }}<div class="modal-body">{{= htmlContent }}</div>{{ if(typeof buttons !== "undefined" && buttons.length > 0 ){ }}<div class="modal-footer {{ if(buttons.length > 1 ){ }} mustShow {{ } }}">{{ _.each(buttons, function(button, iterator) { }}<button data-index="{{= iterator }}" type="button" class="btn {{= button.className }} ">{{= button.label }}</button>{{ }); }}</div>{{ } }}</div></div></div>'},onOpen:function(e){},onClose:function(e){},onLoad:function(e){}};p.modules.register("dialogs",{init:m,show:a,changeContent:l,close:n,isDialogOpen:h,resizeDialog:r})}(jQuery),function(e,t){function a(){e(document).ready(function(){e('[data-provide="payment-ipp"]').each(function(){var t=e(this);b=t.find(".payment-ipp-tokenisation"),y=e("#health_payment_credit_type"),v=t.find(".payment-ipp-maskedNumber"),v.prop("readonly",!0),v.css("cursor","pointer"),v.on("click",function(){i()})})})}function n(){e('[data-provide="payment-ipp"]').removeClass("hidden")}function o(){e('[data-provide="payment-ipp"]').addClass("hidden")}function i(){v.is(":visible")&&d()&&(r(C),c()||l())}function l(){return w===!0||c()?!1:(w=!0,v.val("Loading..."),h(),void g.modules.comms.post({url:"ajax/json/ipp/ipp_payment.jsp?ts="+(new Date).getTime(),dataType:"json",cache:!1,errorLevel:"silent",data:{transactionId:g.modules.transactionId.get()},onSuccess:s,onError:function(e,t,a){u("IPP Token Session Request http")},onComplete:function(){w=!1}}))}function s(e){if(c())return!1;if(!e||!e.result||e.result.success!==!0)return void u("IPP Token Session Request fail");var t=e.result.url+"?SessionId="+e.result.refId+"&sst="+e.result.sst+"&cardType="+m()+"&registerError=false&resultPage=0",a='<p class="message"></p>';htmlContent=a+'<iframe width="100%" height="110" frameBorder="0" src="'+t+'" tabindex="" id="cc-frame"></iframe>',g.modules.dialogs.changeContent(p,htmlContent)}function r(e){_=(new Date).getTime(),("undefined"==typeof e||0===e.length)&&(e=g.modules.loadingAnimation.getTemplate()),p=g.modules.dialogs.show({htmlContent:e,title:"Credit Card Number",buttons:[{label:"Cancel",className:"btn-default",closeWindow:!0}],onOpen:function(e){g.modules.tracking.recordSupertag("trackCustomPage","Payment gateway popup")},onClose:function(){u("User closed process")}})}function d(){return y.valid()}function u(e){if(""===b.val()){g.modules.dialogs.changeContent(p,"<p>We're sorry but our system is down and we are unable to process your credit card details right now.</p><p>Continue with your application and we can collect your details after you join.</p>");var t=", "+Math.round(((new Date).getTime()-_)/1e3)+" seconds";b.val("fail, "+e+t),v.val("Try again or continue"),C=""}}function c(){return""===C?!1:!0}function h(){b.val(""),v.val(""),C=""}function m(){switch(y.find("option:selected").val()){case"v":return"Visa";case"a":return"Amex";case"m":return"Mastercard";case"d":return"Diners";default:return"Unknown"}}function f(e){e.transactionId=g.modules.transactionId.get(),g.modules.comms.post({url:"ajax/json/ipp/ipp_log.jsp?ts="+(new Date).getTime(),data:e,dataType:"json",cache:!1,errorLevel:"silent",onSuccess:function(t){return t&&t.result&&t.result.success===!0?(b.val(e.sessionid),v.val(e.maskedcardno),C="",void g.modules.dialogs.close(p)):void u("IPP Token Log false")},onError:function(e,t,a){u("IPP Token Log http")}})}var p,g=window.meerkat,v=[],b=[],y=[],C="",w=!1,_=0;g.modules.register("healthPaymentIPP",{init:a,show:n,hide:o,fail:u,register:f})}(jQuery);