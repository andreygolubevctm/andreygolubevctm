!function(e,t){function a(){e(document).ready(function(){l()})}function n(t){return"Y"===e("#"+t+"_elasticSearch").val()}function l(){var t=e("input.typeahead"),a=null;t.each(function(){var t,l=e(this),s=l.attr("id"),c=s.match(/(_)[a-zA-Z]{1,}$/g),u=s.replace(c,""),h=n(u);l.data("addressfieldid",u),h?(t="address/search.json",a={name:l.attr("name"),remote:{beforeSend:function(a,n){o(l),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.type="POST",n.hasContent=!0,n.url=t;var i=e("#"+u+"_autofilllessSearch"),r=i.val();n.data=e.param({query:decodeURI(r)})},filter:function(e){return i(l),e},url:t,error:function(t,a){d.modules.errorHandling.error({page:"autocomplete.js",errorLevel:"warning",title:"Address lookup failed",message:"<p>Sorry, we are having troubles connecting to our address servers.</p><p>Please manually enter your address.</p>",description:"Could not connect to the elastic search.json",data:t}),e("#"+u+"_nonStd").trigger("click").prop("checked",!0),i(l)}},limit:150}):"countrySelectionList"==l.attr("data-varname")?a=d.modules.travelCountrySelector.getCountrySelectorParams(l):(t=l.attr("data-source-url"),a={name:l.attr("name"),remote:{beforeSend:function(){o(l)},filter:function(e){return i(l),e},url:l.attr("data-source-url")+"%QUERY"},limit:150}),a=r(l,a),l.typeahead(a),l.hasClass("input-lg")&&l.prev(".tt-hint").addClass("hint-lg"),l.hasClass("input-sm")&&l.prev(".tt-hint").addClass("hint-sm"),l.hasClass("blur-on-select")&&l.bind("typeahead:selected",function(e,t,a){t.hasOwnProperty("value")&&"Type your address..."===t.value||e&&e.target&&e.target.blur&&e.target.blur()})})}function o(e){e.hasClass("show-loading")&&d.modules.loadingAnimation.showInside(e.parent(".twitter-typeahead"))}function i(e){e.hasClass("show-loading")&&d.modules.loadingAnimation.hide(e.parent(".twitter-typeahead"))}function r(t,a){if(t&&t.hasClass("typeahead-address")){var l=t.data("addressfieldid"),o=n(l);a.remote.url=t.attr("id"),a.remote.replace=s,a.valueKey="value",a.template=_.template("<p>{{= highlight }}</p>"),(t.hasClass("typeahead-autofilllessSearch")||t.hasClass("typeahead-streetSearch"))&&(a.remote.filter=function(a){return i(t),o&&e.each(a,function(e,t){t.hasOwnProperty("text")&&t.hasOwnProperty("payload")&&(t.value=t.text,t.highlight=t.text,t.dpId=t.payload)}),a.push({value:"Type your address...",highlight:"Can't find your address? <u>Click here.</u>"}),a},t.bind("typeahead:selected",function(e,a,n){if(a.hasOwnProperty("value")&&"Type your address..."===a.value){var i="";o||e.target&&e.target.id&&(i=e.target.id.replace("_streetSearch","")),d.messaging.publish(u.CANT_FIND_ADDRESS,{fieldgroup:i})}else o&&(d.messaging.publish(u.ELASTIC_SEARCH_COMPLETE,{dpid:a.dpId,addressFieldId:l}),t.valid())}))}return a}function s(t,a){var n=e("#"+t);return t="",n.trigger("getSearchURL"),n.data("source-url")&&(t=n.data("source-url")),t}var d=window.meerkat,c=(d.modules.events,d.logging.info,{autocomplete:{CANT_FIND_ADDRESS:"EVENT_CANT_FIND_ADDRESS",ELASTIC_SEARCH_COMPLETE:"ELASTIC_SEARCH_COMPLETE",INIT:"INIT"}}),u=c.autocomplete;d.modules.register("autocomplete",{init:a,events:c,autocompleteBeforeSend:o,autocompleteComplete:i})}(jQuery),function(e,t){function a(){}function n(t){e("[data-source]",e(t)).each(function(){e(this).empty()})}function l(t){e("[data-source]",e(t)).each(function(){var t="",a=e(this),n=e(a.attr("data-source")),l=e(a.attr("data-alternate-source"));if(n.length){if(sourceType=n.get(0).tagName.toLowerCase(),dataType=a.attr("data-type"),callback=a.attr("data-callback"),callback)try{var i=callback.split(".");if(i.length){for(var r=i.pop(),s=window,d=0;d<i.length;d++)s=s[i[d]];t=s[r].apply(s,[n])}else t=callback.apply(window,[n])}catch(c){o.modules.errorHandling.error({message:"Unable to perform render Content Population Callback properly.",page:"contentPopulation.js:render()",errorLevel:"silent",description:"Unable to perform contentPopulation callback labelled: "+callback,data:{error:c.toString(),sourceElement:a.attr("data-source")}}),t=""}else if(dataType){var u;switch(dataType){case"checkboxgroup":u=n.parent().find(":checked").next("label"),u.length&&(t=u.text()||"");break;case"radiogroup":u=n.find(":checked").parent("label"),u.length&&(t=u.text()||"");break;case"list":var h=n.find("li");h.length>0?h.each(function(){t+="<li>"+e(this).find("span:eq(0)").text()+"</li>"}):t+="<li>None selected</li>";break;case"optional":t=n.val()||l.val()||"",""!==t&&e(".noDetailsEntered").remove();break;case"object":}}else switch(sourceType){case"select":var f=n.find("option:selected");""===f.val()?t="":(t=f.text()||"",""===t&&l.length&&(f=l.find("option:selected"),t=""===f.val()?"":f.text()||""));break;case"input":t=n.val()||l.val()||"";break;default:t=n.html()||l.html()||""}a.html(t)}})}var o=window.meerkat,i=(o.modules.events,o.logging.info,{contentPopulation:{}});i.contentPopulation;o.modules.register("contentPopulation",{init:a,events:i,render:l,empty:n})}(jQuery),function(e,t){function a(t){var a=e.extend({},C,t);m="xs"===g.modules.deviceMediaState.get()?!0:!1;var o="mkDialog_"+b;_.isUndefined(a.id)?(a.id=o,b++):h(a.id)&&n(a.id),null!=a.hashId&&g.modules.address.appendToHash(a.hashId);var d=_.template(a.templates.dialogWindow);(null!=a.url||null!=a.externalUrl)&&(a.htmlContent=g.modules.loadingAnimation.getTemplate());var c=d(a);e("#dynamic_dom").append(c);var u=e("#"+a.id);u.modal({show:!0,backdrop:a.buttons&&a.buttons.length>0?"static":!0,keyboard:!1}),u.css("z-index",parseInt(u.eq(0).css("z-index"))+10*y.length);var f=e(".modal-backdrop");if(f.eq(f.length-1).css("z-index",parseInt(f.eq(0).css("z-index"))+10*y.length),u.on("hidden.bs.modal",function(t){if("undefined"!=typeof t.target){var a=e(t.target);0!==a.length&&a.hasClass("modal")!==!1&&l(a.attr("id"))}}),u.on("shown.bs.tab",function(e){s(a.id)}),u.find("button").on("click",function(t){var n=a.buttons[e(t.currentTarget).attr("data-index")];_.isUndefined(n)||(n.closeWindow===!0&&e(t.currentTarget).closest(".modal").modal("hide"),"function"==typeof n.action&&n.action(t))}),u.find(".navbar-nav button").off().on("click",function(t){var n=a[e(t.currentTarget).attr("data-button")];"undefined"!=typeof n&&"function"==typeof n.callback&&n.callback(t)}),null!=a.url&&g.modules.comms.get({url:a.url,cache:a.cacheUrl,errorLevel:"warning",onSuccess:function(e){i(a.id,e),"function"==typeof a.onLoad&&a.onLoad(a.id)}}),null!=a.externalUrl){var p='<iframe class="displayNone" id="'+a.id+'_iframe" width="100%" height="100%" frameborder="0" scrolling="no" allowtransparency="true" src="'+a.externalUrl+'"></iframe>';r(a.id,p),e("#"+a.id+"_iframe").on("load",function(){e(this).show(),g.modules.loadingAnimation.hide(e("#"+a.id))})}return window.setTimeout(function(){s(a.id)},0),"function"==typeof a.onOpen&&a.onOpen(a.id),y.push(a),a.id}function n(t){e("#"+t).modal("hide")}function l(t){y.length>1&&_.defer(function(){y.length>0&&y[0].id!==t&&e(document.body).addClass("modal-open")});var a=c(t);null!==a&&"function"==typeof a.onClose&&a.onClose(t),a.destroyOnClose===!0?d(t):g.modules.address.removeFromHash(a.hashId)}function o(t){e("#dynamic_dom .modal").each(function(t,a){s(e(a).attr("id"))})}function i(t,a,n){e("#"+t+" .modal-body").html(a),"function"==typeof n&&n(),o()}function r(t,a){e("#"+t+" .modal-body").append(a),o()}function s(t){m="xs"===g.modules.deviceMediaState.get()?!0:!1;var a=e("#"+t);if(0===a.find(".modal-header").outerHeight(!0))window.setTimeout(function(){s(t)},20);else{var n,l,o,i=a.find(".modal-content"),r=a.find(".modal-body"),d=a.find(".modal-dialog");n=e(window).height(),m||(n-=60),l=n,l-=a.find(".modal-header").outerHeight(!0),l-=a.find(".modal-footer").outerHeight(!0),l-=a.find(".modal-closebar").outerHeight(!0),m?(i.css("height",n),a.find(".modal-body").css("max-height","none").css("height",l),o=0,d.css("top",o)):(i.css("max-height",n),"true"===a.attr("data-fullheight")?(i.css("height",n),r.css("height",l)):(i.css("height","auto"),r.css("height","auto")),a.find(".modal-body").css("max-height",l),o=n/2-d.height()/2,i.height()<n&&(o/=2),d.css("top",o))}}function d(t){if(t&&0!==t.length){var a=e("#"+t);a.find("button").off().end().remove();var n=c(t);if(null!=n){if(null!=n.hashId){g.modules.address.removeFromHash(n.hashId);var l=_.findWhere(v,{hashId:n.hashId});null==l&&v.push(n)}y.splice(n.index,1)}}}function c(e){var t=u(e);return null!==t?(y[t].index=t,y[t]):null}function u(e){for(var t=0;t<y.length;t++)if(y[t].id==e)return t;return null}function h(e){return!_.isNull(u(e))}function f(){e(document).ready(function(){e(document).on("click",".btn-close-dialog",function(){e(this).closest(".modal").modal("hide")}),Modernizr.touch&&(e(document).on("touchmove",".modal",function(e){e.preventDefault()}),e(document).on("touchmove",".modal .modal-body",function(e){e.stopPropagation()}))});var t=this;g.messaging.subscribe(p.dynamicContentLoading.PARSED_DIALOG,function(t){var n,l=t.element.attr("data-dialog-hash-id"),o=null;""!==l&&(o=l),n="url"===t.contentType?{title:t.element.attr("data-title"),url:t.contentValue,cacheUrl:t.element.attr("data-cache")?!0:!1}:"externalUrl"===t.contentType?{title:t.element.attr("data-title"),externalUrl:t.contentValue}:{title:e(t.contentValue).attr("data-title"),htmlContent:t.contentValue};var i=e.extend({hashId:o,closeOnHashChange:!0,className:t.element.attr("data-class")},n);a(i)});var n=_.debounce(o,300);e(window).resize(n),g.messaging.subscribe(p.ADDRESS_CHANGE,function(e){for(var a=y.length-1;a>=0;a--){var n=y[a];n.closeOnHashChange===!0&&-1==_.indexOf(e.hashArray,n.hashId)&&t.close(n.id)}for(var l=0;l<e.hashArray.length;l++){var o=_.findWhere(y,{hashId:e.hashArray[l]});if(null==o){var i=_.findWhere(v,{hashId:e.hashArray[l]});null!=i&&i.openOnHashChange===!0&&g.modules.dialogs.show(i)}}},window)}var m,g=window.meerkat,p=g.modules.events,b=(g.logging.info,0),v=[],y=[],C={title:"",htmlContent:null,url:null,cacheUrl:!1,buttons:[],className:"",leftBtn:{label:"Back",icon:"",className:"btn-sm btn-close-dialog",callback:null},rightBtn:{label:"",icon:"",className:"",callback:null},tabs:[],htmlHeaderContent:"",hashId:null,destroyOnClose:!0,closeOnHashChange:!1,openOnHashChange:!0,fullHeight:!1,templates:{dialogWindow:'<div id="{{= id }}" class="modal" tabindex="-1" role="dialog" aria-labelledby="{{= id }}_title" aria-hidden="true"{{ if(fullHeight===true){ }} data-fullheight="true"{{ } }}><div class="modal-dialog {{= className }}"><div class="modal-content"><div class="modal-closebar">	<a href="javascript:;" class="btn btn-close-dialog"><span class="icon icon-cross"></span></a></div><div class="navbar navbar-default xs-results-pagination visible-xs"><div class="container"><ul class="nav navbar-nav"><li><button data-button="leftBtn" class="btn btn-back {{= leftBtn.className }}">{{= leftBtn.icon }} {{= leftBtn.label }}</button></li><li class="navbar-text modal-title-label">	{{= title }}</li>{{ if(rightBtn.label != "" || rightBtn.icon != "") { }}<li class="right"><button data-button="rightBtn" class="btn btn-save {{= rightBtn.className }}">{{= rightBtn.label }} {{= rightBtn.icon }}</button></li>{{ } }}</ul></div></div>{{ if(title != "" || tabs.length > 0 || htmlHeaderContent != "" ) { }}<div class="modal-header">{{ if (tabs.length > 0) { }}<ul class="nav nav-tabs tab-count-{{= tabs.length }}">{{ _.each(tabs, function(tab, iterator) { }}<li><a href="javascript:;" data-target="{{= tab.targetSelector }}" title="{{= tab.xsTitle }}">{{= tab.title }}</a></li>{{ }); }}</ul>{{ } else if(title != "" ){ }}<h4 class="modal-title hidden-xs" id="{{= id }}_title">{{= title }}</h4>{{ } else if(htmlHeaderContent != "") { }}{{= htmlHeaderContent }}{{ } }}</div>{{ } }}<div class="modal-body">{{= htmlContent }}</div>{{ if(typeof buttons !== "undefined" && buttons.length > 0 ){ }}<div class="modal-footer {{ if(buttons.length > 1 ){ }} mustShow {{ } }}">{{ _.each(buttons, function(button, iterator) { }}<button data-index="{{= iterator }}" type="button" class="btn {{= button.className }} ">{{= button.label }}</button>{{ }); }}</div>{{ } }}</div></div></div>'},onOpen:function(e){},onClose:function(e){},onLoad:function(e){}};g.modules.register("dialogs",{init:f,show:a,changeContent:i,close:n,isDialogOpen:h,resizeDialog:s})}(jQuery);