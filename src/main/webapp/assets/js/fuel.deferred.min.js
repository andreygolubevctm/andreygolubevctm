!function(e,t){function n(){}function o(t){e("[data-source]",e(t)).each(function(){e(this).empty()})}function a(t){e("[data-source]",e(t)).each(function(){var t="",n=e(this),o=e(n.attr("data-source")),a=e(n.attr("data-alternate-source"));if(o.length){if(sourceType=o.get(0).tagName.toLowerCase(),dataType=n.attr("data-type"),callback=n.attr("data-callback"),callback)try{var i=callback.split(".");if(i.length){for(var s=i.pop(),l=window,u=0;u<i.length;u++)l=l[i[u]];t=l[s].apply(l,[o])}else t=callback.apply(window,[o])}catch(d){r.modules.errorHandling.error({message:"Unable to perform render Content Population Callback properly.",page:"contentPopulation.js:render()",errorLevel:"silent",description:"Unable to perform contentPopulation callback labelled: "+callback,data:{error:d.toString(),sourceElement:n.attr("data-source")}}),t=""}else if(dataType){var c;switch(dataType){case"checkboxgroup":c=o.parent().find(":checked").next("label"),c.length&&(t=c.text()||"");break;case"radiogroup":c=o.find(":checked").parent("label"),c.length&&(t=c.text()||"");break;case"list":var m=o.find("li");m.length>0?m.each(function(){t+="<li>"+e(this).find("span:eq(0)").text()+"</li>"}):t+="<li>None selected</li>";break;case"optional":t=o.val()||a.val()||"",""!==t&&e(".noDetailsEntered").remove();break;case"object":}}else switch(sourceType){case"select":var g=o.find("option:selected");""===g.val()?t="":(t=g.text()||"",""===t&&a.length&&(g=a.find("option:selected"),t=""===g.val()?"":g.text()||""));break;case"input":t=o.val()||a.val()||"";break;default:t=o.html()||a.html()||""}n.html(t)}})}var r=window.meerkat,i=(r.modules.events,r.logging.info,{contentPopulation:{}});i.contentPopulation;r.modules.register("contentPopulation",{init:n,events:i,render:a,empty:o})}(jQuery),function(e,t){function n(){o(!1);var t=null;e(document).ready(function(){r.modules.journeyEngine.configure({startStepId:t,steps:_.toArray(steps)})})}function o(e){a()}function a(){var t={title:"Login",navigationId:"login",slideIndex:0,onAfterEnter:function(){r.site.loggedIn&&r.modules.journeyEngine.gotoPath("next")},validation:{validate:!0,customValidation:function(t){return r.site.loggedIn?void t(!0):void r.modules.retrievequotesLogin.doLoginAndRetrieve().done(function(e,n,o){if("undefined"!=typeof e&&null!==e&&e.previousQuotes)r.site.responseJson=e,t(!0);else{try{t(!1)}catch(a){}r.modules.retrievequotesLogin.handleLoginFailure(o,n,"")}}).fail(function(e,n,o){try{t(!1)}catch(a){}r.modules.retrievequotesLogin.handleLoginFailure(e,n,o)}).always(function(){r.modules.loadingAnimation.hide(e(".btn-login"))})}}},n={title:"Your Quotes",navigationId:"quotes",slideIndex:1,onBeforeEnter:function(){r.modules.retrievequotesListQuotes.renderQuotes()},onAfterEnter:function(){""===e.trim(e("#quote-result-list").html())&&r.modules.retrievequotesListQuotes.noResults()}};steps={startStep:t,resultsStep:n}}var r=window.meerkat,i=(r.modules.events,{retrievequotesComponent:{},WEBAPP_LOCK:"WEBAPP_LOCK",WEBAPP_UNLOCK:"WEBAPP_UNLOCK"});r.modules.register("retrievequotesComponent",{init:n,events:i})}(jQuery),function(e,t){function n(){o()}function o(){e(document).on("click",".forgot-password",a).on("click",".reset-password",r)}function a(){var t=_.template(e("#forgot-password-template").html())();i=s.modules.dialogs.show({htmlContent:t,hashId:"forgot-password",buttons:[{label:"Back",className:"btn-close-dialog"},{label:"Reset Password",className:"btn-secondary reset-password"}],onOpen:function(t){s.modules.validation.setupDefaultValidationOnForm(e("#forgot-password-form"));var n=e("#login_email").val();e("#login_forgotten_email").val(n)}})}function r(){var t=e("#login_forgotten_email");if(t.valid()){var n=e(".reset-password");s.modules.loadingAnimation.showInside(n,!0);var o=s.modules.comms.post({errorLevel:"warning",url:"ajax/json/forgotten_password.jsp",data:{email:t.val()}}),a="We could not send your password reset email at this time",r=function(t){t=t||a;var n=_.template(e("#reset-password-failure-template").html(),{message:t});s.modules.dialogs.show({title:"Reset Password Error",htmlContent:n,hashId:"forgot-password",buttons:[{label:"OK",className:"btn-secondary btn-close-dialog"}]})};o.done(function(n){if("string"==typeof n&&(n=JSON.parse(n)),"undefined"!=typeof n.result){var o=n.result;if("OK"===o){var i=_.template(e("#reset-password-success-template").html(),{email:t.val()},{variable:"data"});s.modules.dialogs.show({title:"Reset Password",htmlContent:i,hashId:"forgot-password",buttons:[{label:"OK",className:"btn-secondary btn-close-dialog"}]})}else{var l=n.message||a,u={login_forgotten_email:l};e("#forgot-password-form").validate().showErrors(u)}}else r()}).fail(function(){r()}).always(function(){s.modules.dialogs.close(i),s.modules.loadingAnimation.hide(n)})}}var i,s=window.meerkat;s.modules.events;s.modules.register("retrievequotesComponentForgotPassword",{init:n})}(jQuery),function(e,t){function n(){o(),e(document).ready(function(){var t=e("#retrieve-quotes-container-template");t.length&&(R=_.template(t.html())),C={quote:e("#retrieve-car-template").html(),health:e("#retrieve-health-template").html(),life:e("#retrieve-life-template").html(),ip:e("#retrieve-ip-template").html(),homeloan:e("#retrieve-homeloan-template").html(),home:e("#retrieve-home-template").html(),utilities:e("#retrieve-utilities-template").html()}})}function o(){e(document).on("click","#logout-user",r).on("click","#new-quote",s).on("click",".btn-latest",u).on("click",".btn-amend",m).on("click",".btn-pending",a).on("click",".btn-start-again",c).on("click",".btn-start-again-fresh",d)}function a(e){var t=l(e.target),n=t.vertical+"_quote.jsp?action=confirmation&PendingID="+encodeURIComponent(t.pendingID);window.location.href=n}function r(e){P.modules.utils.scrollPageTo("html, body"),P.modules.journeyEngine.loadingShow("Logging you out...");var t=P.modules.comms.get({url:"generic/logout_user.json",errorLevel:"silent",dataType:"json"}),n=function(){P.modules.dialogs.show({title:"Unable to log out",htmlContent:"Sorry, we could not log you out at this time",buttons:[{label:"OK",className:"btn-close-dialog"}]}),P.modules.journeyEngine.loadingHide()};t.done(function(e){return"string"==typeof e&&(e=JSON.parse(e)),e.success&&e.success===!0?void(window.location.href="retrieve_quotes.jsp"):void n()}).fail(function(){n()})}function i(){P.modules.dialogs.show({htmlContent:e("#new-quote-template").html(),buttons:[!1],onOpen:function(t){e("#"+t).find(".btn-close-dialog, .modal-footer").remove()}})}function s(t){P.modules.dialogs.show({htmlContent:e("#new-quote-template").html(),className:"new-quote-dialog"})}function l(t){var n=e(t);"undefined"==typeof n.attr("data-vertical")&&(n=n.closest("a"));var o={$element:n,vertical:n.attr("data-vertical"),transactionId:n.attr("data-transactionid")};return"Y"===n.attr("data-inpast")&&(o.inPast="Y"),n.attr("data-pendingid")&&(o.pendingID=n.attr("data-pendingid")),o}function u(t){var n=l(t.target);P.modules.dialogs.show({title:"Enter New Commencement Date",htmlContent:e("#new-commencement-date-template").html(),buttons:[{label:"Cancel",className:"btn-close-dialog"},{label:"Get Latest Results",className:"btn-cta btn-submit"}],onOpen:function(t){P.modules.datepicker.setDefaults(),P.modules.datepicker.initModule(),e(document).on("click","#"+t+" .btn-submit",function(){var o=e("#newCommencementDate").val();P.modules.dialogs.close(t),g(n.vertical,"latest",n.transactionId,o)})}})}function d(e){var t=l(e.target);g(t.vertical,"start-again-fresh",t.transactionId)}function c(e){var t=l(e.target);g(t.vertical,"start-again",t.transactionId)}function m(e){var t=l(e.target);g(t.vertical,"amend",t.transactionId)}function g(e,t,n,o){"quote"===e&&(e="car"),P.modules.utils.scrollPageTo("html, body"),P.modules.journeyEngine.loadingShow("Retrieving your quote...");var a={vertical:e,action:t,transactionId:n};o&&(a.newDate=o);var r=P.modules.comms.post({url:"ajax/json/load_quote.jsp",errorLevel:"silent",dataType:"json",data:a}),i=function(e){e=e||"A problem occurred when trying to load your quote.",P.modules.dialogs.show({title:"Unable to load your quote",htmlContent:"<p>"+e+"</p>",buttons:[{label:"OK",className:"btn-secondary btn-close-dialog"}]}),P.modules.journeyEngine.loadingHide()};r.done(function(e){if("string"==typeof e&&(e=JSON.parse(e)),e&&e.result){var t=e.result;if(t.destUrl)return void(window.location.href=t.destUrl+"&ts="+Number(new Date));if(t.showToUser&&t.error)return void i(t.error)}i()}).fail(function(){i()})}function f(){e("#quote-result-list").html(R(P.site.responseJson))}function p(e,t){if(!e)return"";try{var n=_.template(C[e]);return n(t)}catch(o){return P.modules.errorHandling.error({errorLevel:"silent",page:"retrievequotesListQuotes.js",description:"Unable to render template ["+e+"]",message:"Unable to render template",data:{vertical:e,providedData:t}}),""}}function v(e){for(var t=_.keys(e),n=0;n<t.length;n++)if("id"!=t[n])return t[n];return!1}function h(e){return"M"==e?"Male":"Female"}function b(e){var t;switch(e){case 5:t=1;break;case 4:t=2;break;case 3:t=3;break;case 2:t=4;break;case 1:t=5;break;case 0:t=6}return 6==t?"Rating 6 No NCD":"undefined"==typeof t?"":"Rating "+t+" ("+e+" Years) NCD"}function y(e){if("undefined"==typeof e||"undefined"==typeof e.benefitsExtras)return"";for(var t=Object.keys(e.benefitsExtras),n=[],o=0;o<t.length;o++)"Y"==e.benefitsExtras[t[o]]&&n.push(t[o]);return n.join(", ")}function w(e){switch(e){case"F":return"A First Home Buyer";case"E":return"An Existing Home Owner"}return""}function k(e){switch(e){case"FH":return"Buy my first home";case"APL":return"Buy another property to live in";case"IP":return"Buy an investment property";case"REP":return"Renovate my existing property";case"CD":return"Consolidate my debt";case"CL":return"Compare better home loan options"}return""}var R,P=window.meerkat,C=(P.modules.events,{});P.modules.register("retrievequotesListQuotes",{init:n,renderQuotes:f,renderTemplate:p,getVerticalFromObject:v,noResults:i,getGenderString:h,carFormatNcd:b,healthBenefitsList:y,getHomeloanSituation:w,getHomeloanGoal:k})}(jQuery),function(e,t){function n(){o(),e(document).ready(function(e){u=e("#failed-login-template"),u.length&&(g=_.template(u.html()))})}function o(){e(document).on("click","#js-too-many-attempts",function(){d.modules.dialogs.close(l),e(document).find(".forgot-password").trigger("click")})}function a(){d.modules.loadingAnimation.showInside(e(".btn-login"),!0);var t=d.modules.form.getData(e("#loginForm"));return d.modules.comms.post({url:"ajax/json/retrieve_quotes.jsp",data:t,async:!1,errorLevel:"warning",useDefaultErrorHandling:!1,cache:!1,dataType:"json"})}function r(t,n,o){d.modules.journeyEngine.unlockJourney(),d.modules.address.setHash("login");var a=t.responseText;if(!a)return i({url:t.url},"No responseText for request"),!1;var r={};try{r=e.parseJSON(a)}catch(l){i(l,"Could not decode responseText to JSON")}s(r)}function i(e,t){d.messaging.publish(c.WEBAPP_UNLOCK,{source:"retrievequotesLogin"}),d.modules.errorHandling.error({message:"An error occurred when attempting to login. Please try again.",page:"retrievequotesLogin.js:doLoginAndRetrieve()",errorLevel:"warning",description:t,data:e})}function s(e){var t={};e.length&&"undefined"!=typeof e[0].error?"exceeded-attempts"==e[0].error?t.suspended=!0:t.errorMessage=e[0].error:t.errorMessage="The email address or password that you entered was incorrect.",l=d.modules.dialogs.show({title:"A Problem Occurred",htmlContent:g(t),buttons:[{label:"Ok",className:"btn-default",closeWindow:!0}]})}var l,u,d=window.meerkat,c=d.modules.events,m=(d.logging.info,{retrievequotesLogin:{}}),g=(m.retrievequotesLogin,function(){return""});d.modules.register("retrievequotesLogin",{init:n,events:m,doLoginAndRetrieve:a,handleLoginFailure:r})}(jQuery),function(e,t){function n(){e(document).ready(function(){return"fuel"!==u.site.vertical?!1:(u.modules.fuelPrefill.setHashArray(),a(),o(),void(("amend"===u.site.pageAction||"latest"===u.site.pageAction||"load"===u.site.pageAction||"start-again"===u.site.pageAction)&&u.modules.form.markInitialFieldsWithValue(e("#mainform"))))})}function o(){}function a(){r(!1);var t=null;u.site.isFromBrochureSite===!0&&1===u.modules.address.getWindowHashAsArray().length?(t=m.startStep.navigationId,g=!0):u.site.journeyStage.length>0&&"latest"===u.site.pageAction?t=m.resultsStep.navigationId:u.site.journeyStage.length>0&&"amend"===u.site.pageAction&&(t=m.startStep.navigationId),e(document).ready(function(){u.modules.journeyEngine.configure({startStepId:t,steps:_.toArray(m)});var e=u.modules.transactionId.get();u.site.isNewQuote===!1?u.messaging.publish(d.tracking.EXTERNAL,{method:"trackQuoteEvent",object:{action:"Retrieve",transactionID:parseInt(e,10),vertical:u.site.vertical}}):u.messaging.publish(d.tracking.EXTERNAL,{method:"trackQuoteEvent",object:{action:"Start",transactionID:parseInt(e,10),vertical:u.site.vertical}})})}function r(e){i(),s(),e&&u.modules.journeyProgressBar.render(!0)}function i(){var t={title:"Fuel Details",navigationId:"start",slideIndex:0,validation:{validate:!0},externalTracking:{method:"trackQuoteForms",object:u.modules.fuel.getTrackingFieldsObject},onInitialise:function(){u.modules.fuelPrefill.initFuelPrefill()},onAfterEnter:function(){g&&(u.modules.journeyEngine.gotoPath("next"),g=!1)}},n={title:"Fuel Prices",navigationId:"results",slideIndex:1,externalTracking:{method:"trackQuoteForms",object:u.modules.fuel.getTrackingFieldsObject},additionalHashInfo:function(){var t=e("#fuel_hidden").val(),n=e("#fuel_location").val().replace(/\s/g,"+");return n+"/"+t},onInitialise:function(e){u.modules.fuelResults.initPage(),u.modules.showMoreQuotesPrompt.initPromptBar(),u.modules.fuelSorting.initSorting(),u.modules.fuelResultsMap.initFuelResultsMap(),u.modules.fuelCharts.initFuelCharts()},onAfterEnter:function(e){u.modules.fuelResults.get(),u.modules.fuelResultsMap.resetMap()},onAfterLeave:function(e){e.isBackward&&u.modules.showMoreQuotesPrompt.disablePromptBar()}};m={startStep:t,resultsStep:n}}function s(){u.modules.journeyProgressBar.configure([{label:"Fuel Details",navigationId:m.startStep.navigationId},{label:"Fuel Prices",navigationId:m.resultsStep.navigationId}])}function l(t){try{var n=u.modules.journeyEngine.getCurrentStepIndex(),o=u.modules.journeyEngine.getFurtherestStepIndex(),a=e("#fuel_location").val().split(" "),r="";switch(n){case 0:r="fuel details";break;case 1:r=t===!0?"fuel more info":"fuel results"}var i={actionStep:r,quoteReferenceNumber:u.modules.transactionId.get()};return o>u.modules.journeyEngine.getStepIndex("start")&&_.extend(i,{state:a[a.length-1],postcode:a[a.length-2]}),i}catch(s){return{}}}var u=window.meerkat,d=u.modules.events,c=(u.logging.info,{fuel:{},WEBAPP_LOCK:"WEBAPP_LOCK",WEBAPP_UNLOCK:"WEBAPP_UNLOCK"}),m=null,g=!1;u.modules.register("fuel",{init:n,events:c,initProgressBar:r,getTrackingFieldsObject:l})}(jQuery),function(e,t){function n(){google.load("visualization","1",{packages:["corechart","line"],callback:l})}function o(){return g}function a(){e(document).ready(function(){r(),c=_.template(e("#price-chart-template").html())})}function r(){e(".openPriceHistory").click(function(){n()}),v.messaging.subscribe(h.device.RESIZE_DEBOUNCED,function(){"undefined"!=typeof google&&f&&p&&e(".fuelChart").length&&(g=new google.visualization.LineChart(document.getElementById("linechart_material")),g.draw(f,p))})}function i(e){return e.filter(function(e,t,n){for(var o=0;o<n.length;o++){if("undefined"==typeof n[o].amountObj&&(n[o].amountObj={},n[o].amountObj[n[o].type]=n[o].amount),o==t)return!0;if(n[o].period==e.period)return n[o].amountObj[e.type]=e.amount,!1}return!0})}function s(){var t="Average daily prices <span class='hidden-xs'>for selected fuel types in and</span> around ",n=e("#fuel_location").val();return t+=isNaN(n.substring(1,5))?n:"the postcode: "+n}function l(){d(function(t){v.modules.loadingAnimation.showInside(e("#linechart_material"),!0);var n=e("#fuel_hidden").val().split(",");-1!=n.indexOf("3")&&-1==n.indexOf("9")&&n.push("9"),v.modules.comms.post({url:"ajax/json/fuel_price_monthly_averages.jsp",cache:!0,data:v.modules.form.getSerializedData(e("#mainform")),errorLevel:"warning",onSuccess:function(e){f=new google.visualization.DataTable,f.addColumn("date","Date"),f.addColumn("number",y(n[0])),n[1]&&f.addColumn("number",y(n[1])),n[2]&&f.addColumn("number",y(n[2]));for(var t=i(e.results.prices),o=[],a=0;a<t.length;a++){var r=[new Date(t[a].period),Number(t[a].amountObj[n[0]])/10];n[1]&&r.push(Number(t[a].amountObj[n[1]])/10),n[2]&&r.push(Number(t[a].amountObj[n[2]])/10),o.push(r)}f.addRows(o),p={height:400,legend:{position:"bottom"},axisTitlesPosition:"out",hAxis:{title:"Collected Date",format:"EEE, MMM d"},tooltip:{trigger:"focus"},fontName:"Source Sans Pro",explorer:{axis:"horizontal",actions:["dragToZoom","rightClickToReset"],keepInBounds:!0},vAxis:{title:"Price Per Litre",format:"###.#",gridlines:{color:"#b2b2b2",count:-1}},chartArea:{top:0},colors:["#1c3e93","#0db14b","#b2b2b2"]},g=new google.visualization.LineChart(document.getElementById("linechart_material")),g.draw(f,p),u(n)}})})}function u(t){for(var n=e("#fuel_location").val().split(" "),o="",a=0;a<t.length;a++)o+=":"+y(t[a]);v.messaging.publish(h.tracking.EXTERNAL,{method:"trackCustomPage",object:{customPage:"Fuel:PriceHistory"+o,state:n[n.length-1],postcode:n[n.length-2]}})}function d(e){var t={htmlContent:c({}),hashId:"chart",className:"fuelChart",onOpen:e,title:s()};m=v.modules.dialogs.show(t)}var c,m,g,f,p,v=window.meerkat,h=v.modules.events,b=(v.logging.info,{fuelCharts:{}}),y=(b.fuelCharts,function(e){var t=["Unknown","Unknown","Unleaded","Diesel","LPG","Premium Unleaded 95","E10","Premium Unleaded 98","Bio-Diesel 20","Premium Diesel"];return t[e]});v.modules.register("fuelCharts",{initFuelCharts:a,events:b,getChart:o})}(jQuery),function(e,t){function n(){e(document).ready(function(){r=e("#checkboxes-all input"),o()})}function o(){e(document).on("change","#checkboxes-all input",a)}function a(t){var n=r.filter(":not(:checked)"),o=r.filter(":checked");o.length>=2?n.attr("disabled","disabled"):r.removeAttr("disabled");var a=o.map(function(){return this.value}).get().join(",");e("#fuel_hidden").val(a),e("label[for='fuel_hidden']").remove(),r.removeClass("has-error")}var r,i=window.meerkat,s=i.modules;s.events,i.logging.info;i.modules.register("fuelDetails",{init:n})}(jQuery),function(e,t){function n(){a(),r()}function o(){d=c.modules.address.getWindowHashAsArray()}function a(){s()}function r(){e(document).on("resultsAnimated",i)}function i(){if(g===!1&&d.length>=4&&d[3].match(/^(map-)/g)){var t=d[3].replace("map-","");c.modules.fuelResultsMap.openMap(e(document).find("a[data-siteid='"+t+"']").first()),g=!0}}function s(){("undefined"!=typeof c.site.formData||d.length>=3)&&(l(),u())}function l(){var t;if("undefined"!=typeof d[2]?t=d[2]:"undefined"!=typeof c.site.formData&&"undefined"!=typeof c.site.formData.fuelType&&(t=c.site.formData.fuelType),"undefined"!=typeof t){var n=t.match(/\d,?\d?/g);if(n){var o=t.split(",").slice(0,2);e("#checkboxes-all .checkbox-custom").each(function(){for(var t=0;t<o.length;t++){var n=e(this);n.val()===o[t]&&n.trigger("click")}})}else{var a;switch(t){case"P":a="petrol";break;case"D":a="diesel";break;case"L":a="lpg";break;default:return}e("#checkboxes-"+a).find(".checkbox-custom").slice(0,2).trigger("click")}}}function u(){var t;"undefined"!=typeof d[1]&&"?stage="!==d[1].substr(0,7)?t=d[1].replace(/\+/g," "):"undefined"!=typeof c.site.formData&&"undefined"!=typeof c.site.formData.location&&(t=c.site.formData.location),"undefined"!==t&&e("#fuel_location").val(t)}var d,c=window.meerkat,m=c.modules,g=(m.events,c.logging.info,!1);c.modules.register("fuelPrefill",{initFuelPrefill:n,setHashArray:o})}(jQuery),function(e,t){function n(){o(),r()}function o(){try{var e="price";Results.init({url:"ajax/json/fuel_price_results.jsp",runShowResultsPage:!1,paths:{results:{list:"results.price",general:"results.general"},productId:"productId",productName:"name",productBrandCode:"provider",price:{premium:"priceText"},availability:{product:"available"},sort:{city:"city"}},show:{nonAvailableProducts:!1,unavailableCombined:!0},availability:{product:["equals","Y"],price:["notEquals",-1]},render:{templateEngine:"_",dockCompareBar:!1},displayMode:e,pagination:{mode:"page",touchEnabled:Modernizr.touch},sort:{sortBy:"price.premium",city:"sort.city"},animation:{results:{individual:{active:!1},delay:500,options:{easing:"swing",duration:1e3}},shuffle:{active:!0,options:{easing:"swing",duration:1e3}},filter:{reposition:{options:{easing:"swing"}}}},elements:{features:{values:".content",extras:".children"}},templates:{pagination:{pageText:"Product {{=currentPage}} of {{=totalPages}}"}},rankings:{triggers:["RESULTS_DATA_READY"],callback:a,forceIdNumeric:!1,filterUnavailableProducts:!0},incrementTransactionId:!1})}catch(t){Results.onError("Sorry, an error occurred initialising page","results.tag","meerkat.modules.fuel.initResults(); "+t.message,t)}}function a(e,t){var n={};return n["rank_premium"+t]=e.price,n["rank_productId"+t]=e.productId,n}function r(){v.messaging.subscribe(b.affix.AFFIXED,function(){e("#resultsPage").css("margin-top","35px")}),v.messaging.subscribe(b.affix.UNAFFIXED,function(){e("#resultsPage").css("margin-top","0")}),v.messaging.subscribe(y.RESULTS_ERROR,function(){_.delay(function(){v.modules.journeyEngine.gotoPath("previous")},1e3)}),e(Results.settings.elements.resultsContainer).on("noFilteredResults",function(){Results.view.show()}),e(document).on("resultsReturned",function(){v.modules.utils.scrollPageTo(e("header")),l()}),e(document).on("resultsFetchStart",function(){e("#resultsPage, .loadingDisclaimerText").removeClass("hidden")}),e(document).on("resultsFetchFinish",function(){e(".loadingDisclaimerText").addClass("hidden"),e(document.body).removeClass("priceMode").addClass("priceMode");var t=0;return e.each(Results.model.returnedProducts,function(){"Y"===this.available&&"CURR"!==this.productId&&t++}),0===t&&!Results.model.hasValidationErrors&&Results.model.isBlockedQuote?void g():0===t&&_.isArray(Results.model.returnedProducts)?(m(),void _.delay(function(){v.modules.journeyEngine.gotoPath("previous")},1e3)):"regional"==Results.getReturnedGeneral().source?(Results.view.showNoResults(),void c()):void e(Results.settings.elements.page).show()}),e(Results.settings.elements.resultsContainer).on("click",".result-row",i)}function i(t){if(e(Results.settings.elements.resultsContainer).hasClass("priceMode")!==!1&&"xs"===v.modules.deviceMediaState.get()){var n=e(t.target);n.hasClass("result-row")===!1&&(n=n.parents(".result-row"));var o=n.find(".map-open");v.modules.fuelResultsMap.openMap(o)}}function s(){Results.get(),u()}function l(){var t=Results.getReturnedGeneral();"undefined"!=typeof t.timeDiff&&e("#provider-disclaimer .time").text(t.timeDiff)}function u(){var t=[];e("#checkboxes-all :checked").each(function(){var n="<strong>"+e.trim(e(this).next("label").text())+"</strong>";t.push(n)});var n=t.join(" &amp; "),o=e("#fuel_location").val(),a={fuelTypes:n,location:o},r=_.template(e("#snapshot-template").html(),a,{variable:"data"});e("#resultsSummaryPlaceholder").html(r)}function d(){v.messaging.subscribe(b.RESULTS_RANKING_READY,p)}function c(){var t=e("#regional-results-template"),n="";if(t.length>0){var o=_.template(t.html());Results.sortBy(Results.settings.sort.city,"asc"),n=o(Results.getSortedResults())}n.length?v.modules.dialogs.show({title:"Regional Price Average",htmlContent:n}):m(),_.delay(function(){v.modules.journeyEngine.gotoPath("previous")},1e3)}function m(){v.modules.dialogs.show({htmlContent:e("#no-results-content")[0].outerHTML})}function g(){v.modules.dialogs.show({htmlContent:e("#blocked-ip-address")[0].outerHTML})}function f(e){return"Last updated "+v.modules.utils.getTimeAgo(e)+" ago"}function p(t){t="undefined"==typeof t?{}:t,v.messaging.publish(b.resultsTracking.TRACK_QUOTE_RESULTS_LIST,{additionalData:e.extend({sortBy:Results.getSortBy()+"-"+Results.getSortDir()},t),onAfterEventMode:"Refresh"})}var v=window.meerkat,h=v.modules,b=h.events,y=(v.logging.info,{});v.modules.register("fuelResults",{init:d,initPage:n,events:y,publishExtraSuperTagEvents:p,get:s,getFormattedTimeAgo:f})}(jQuery),function(e,t){function n(){if("undefined"==typeof w){var e=document.createElement("script");e.type="text/javascript",e.src="https://maps.googleapis.com/maps/api/js?key="+L+"&v=3.exp&signed_in=false&callback=meerkat.modules.fuelResultsMap.initCallback",e.onerror=function(e,t,n){y(e+":"+n,"fuelResultsMap.js:initGoogleAPI")},document.body.appendChild(e)}}function o(){try{var e={zoom:15,minZoom:11,center:l(R,P),mapTypeId:google.maps.MapTypeId.ROAD,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}};g(),w=new google.maps.Map(document.getElementById("map-canvas"),e),k=new google.maps.InfoWindow,u()}catch(t){y(t,"fuelResultsMap.js:initCallback")}}function a(){e(document).ready(function(e){r(),C=_.template(e("#map-marker-template").html()),S=_.template(e("#google-map-canvas-template").html())})}function r(){e(document).on("click",".map-open",function(){i(e(this))})}function i(t){if(R=t.data("lat"),P=t.data("lng"),Results.setSelectedProduct(t.attr("data-productid")),"undefined"==typeof w)n();else{_.keys(D).length||u(),e("#"+E).modal("show"),k.close();var o=Results.getSelectedProduct();j=o.siteid,x.modules.address.appendToHash("map-"+j),o&&(m(D[o.siteid],o),s(l(R,P)))}x.messaging.publish(I.tracking.EXTERNAL,{method:"trackQuoteForms",object:_.bind(x.modules.fuel.getTrackingFieldsObject,this,!0)})}function s(e){w.panTo(e)}function l(e,t){return new google.maps.LatLng(parseFloat(e),parseFloat(t))}function u(){for(var e,t,n,o=d(Results.getFilteredResults()),a=new google.maps.LatLngBounds,r=Results.getSelectedProduct(),i=0;i<o.length;i++){var u=l(o[i].lat,o[i]["long"]),g=c(u,o[i]);D[o[i].siteid]=g,o[i].siteid==r.siteid&&(m(g,o[i]),e=g,t=u,n=o[i]),a.extend(u)}w.fitBounds(a),e&&t&&n&&(s(t),m(e,n))}function d(e){return e.filter(function(e,t,n){for(var o=0;o<n.length;o++){if(o==t)return!0;if(n[o].siteid==e.siteid)return n[o].price2Text?(n[o].price3Text=e.priceText,n[o].price3=e.price,n[o].fuel3Text=e.fuelText):(n[o].price2Text=e.priceText,n[o].price2=e.price,n[o].fuel2Text=e.fuelText),!1}return!0})}function c(e,t,n){var o=new google.maps.Marker({map:w,position:e,icon:"brand/ctm/graphics/fuel/map-pin.png",animation:google.maps.Animation.DROP});return google.maps.event.addListener(o,"click",function(){m(o,t)}),o}function m(e,t){var n="";C?(n=C(t),k.setContent(n),k.open(w,e),x.messaging.publish(I.tracking.EXTERNAL,{method:"trackProductView",object:{productID:t.productId||null,productBrandCode:t.provider||null,productName:(t.name||"")+" "+(t.fuelText||"")}})):y("","An error occurred displaying information for this fuel provider.")}function g(){var t={htmlContent:S(Results.getSelectedProduct()),hashId:"map-"+Results.getSelectedProduct().siteid,className:"googleMap",closeOnHashChange:!1,destroyOnClose:!1,onClose:f,onOpen:p,fullHeight:!0};E=x.modules.dialogs.show(t),A&&google.maps.event.removeListener(A),A=google.maps.event.addDomListener(window,"resize",function(){"undefined"!=typeof google&&e("#"+E).length&&(x.modules.dialogs.resizeDialog(E),p(),google.maps.event.trigger(w,"resize"),w.setCenter(l(R,P)))})}function f(){j&&x.modules.address.removeFromHash("map-"+j)}function p(){_.defer(function(){var t="xs"===x.modules.deviceMediaState.get()?!0:!1,n=e(".googleMap .modal-body"),o=t?n.css("height"):n.css("max-height");e("#google-map-container").css("height",o)})}function v(){k&&k.close(),h()}function h(){var e=_.keys(D);if(e.length){for(var t=0;t<e.length;t++)D[e[t]].setMap(null);D={}}}function b(){return w}function y(e,t){x.modules.errorHandling.error({errorLevel:"warning",message:"An error occurred with loading the Google Map. Please reload the page and try again.",page:t,description:"[Google Maps] Error Initialising Map",data:{error:e.toString()},id:x.modules.transactionId.get()})}var w,k,R,P,C,E,j,S,A,x=window.meerkat,I=x.modules.events,T=(x.logging.info,{fuelResultsMap:{}}),L=(T.fuelResultsMap,"AIzaSyC8ygWPujOpSI1O-7jsiyG3_YIDlPoIP6U"),D={};x.modules.register("fuelResultsMap",{initFuelResultsMap:a,events:T,initCallback:o,resetMap:v,getMap:b,openMap:i})}(jQuery),function(e,t){function n(){o(),e(document).ready(function(){l=e("#sign-up-form"),u.modules.validation.setupDefaultValidationOnForm(l)})}function o(){e(document).on("click","#fuel_signup_terms, #fuel_signup_privacyoptin",a).on("click",".fuel-sign-up",r)}function a(t){var n=e(t.target),o=n.prop("checked")?"Y":"";e("#"+n.attr("id")+"Hidden").val(o).valid()}function r(){if(l.valid()){var t=u.modules.comms.post({errorLevel:"warning",url:"ajax/write/fuel_signup.jsp",dataType:"xml",data:l.serialize()});t.done(function(t){var n=e(t).find("resultcode").text();"0"===n?i():s()}).fail(s)}}function i(){for(var t=l.serializeArray(),n={},o=0;o<t.length;o++){var a=t[o],r=a.name.match(/[a-zA-Z]{1,}$/g)[0];n[r]=a.value}var i=_.template(e("#signup-success-template").html(),n,{variable:"data"});l.html(i)}function s(){l.find(".form-submit-error-message").removeClass("hidden")}var l,u=window.meerkat,d=u.modules;d.events,u.logging.info;u.modules.register("fuelSignup",{init:n})}(jQuery),function(e,t){function n(e){var t=e.attr("data-sort-type"),n=e.attr("data-sort-dir");if("undefined"!=typeof t&&"undefined"!=typeof n){t===Results.getSortBy()&&n===Results.getSortDir()&&(n="asc"===n?"desc":"asc",e.attr("data-sort-dir",n)),Results.setSortByMethod(m[t]);var o=Results.sortBy(t,n);o?(s.parent("li").removeClass("active"),e.parent("li").addClass("active"),l.modules.resultsTracking.setResultsEventMode("Refresh"),l.modules.fuelResults.publishExtraSuperTagEvents({products:[],recordRanking:"N"})):d("[fuelSorting]","The sortBy or sortDir could not be set",setSortByReturn,setSortDirReturn)}else d("[fuelSorting]","No data on sorting element"),l.messaging.publish(u.WEBAPP_UNLOCK)}function o(){l.messaging.subscribe(u.RESULTS_SORTED,function(e){l.messaging.publish(u.WEBAPP_UNLOCK)}),s.on("click",function(t){var o=e(t.target);o.is("a")||(o=o.closest("a")),o.hasClass("disabled")||(l.messaging.publish(u.WEBAPP_LOCK),_.defer(function(){o.parent().hasClass("active")||a(o),n(o)}))}),l.messaging.subscribe(u.WEBAPP_LOCK,function(e){s.addClass("inactive disabled")}),l.messaging.subscribe(u.WEBAPP_UNLOCK,function(e){s.removeClass("inactive disabled")})}function a(e){var t=e.attr("data-sort-type");e.attr("data-sort-dir",c[t])}function r(){e(document).ready(function(){s=e("[data-sort-type]")})}function i(){var t=e("[data-sort-type='price.premium']"),n=Results.getSortBy(),o="price.premium";(n!=o||"desc"==t.attr("data-sort-dir")&&n==o)&&(t.parent("li").siblings().removeClass("active").end().addClass("active").end().attr("data-sort-dir","desc"),Results.setSortBy("price.premium"),Results.setSortDir("desc"))}var s,l=window.meerkat,u=l.modules.events,d=(l.logging.info,l.logging.error),c={"price.premium":"asc"},m={"price.premium":null},g={fuelSorting:{CHANGED:"FUEL_SORTING_CHANGED"}};g.fuelSorting;l.modules.register("fuelSorting",{init:r,initSorting:o,events:g,resetToDefaultSort:i})}(jQuery);