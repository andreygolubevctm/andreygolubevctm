!function(e,t){function a(){e(document).ready(function(){o()})}function n(t){return"Y"===e("#"+t+"_elasticSearch").val()}function o(){var t=e("input.typeahead"),a=null;t.each(function(){var t,o=e(this),d=o.attr("id"),u=d.match(/(_)[a-zA-Z]{1,}$/g),c=d.replace(u,""),h=n(c);o.data("addressfieldid",c),h?(t="address/search.json",a={name:o.attr("name"),remote:{beforeSend:function(a,n){l(o),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.type="POST",n.hasContent=!0,n.url=t;var i=e("#"+c+"_autofilllessSearch"),s=i.val();n.data=e.param({query:decodeURI(s)})},filter:function(e){return i(o),e},url:t,error:function(t,a){r.modules.errorHandling.error({page:"autocomplete.js",errorLevel:"warning",title:"Address lookup failed",message:"<p>Sorry, we are having troubles connecting to our address servers.</p><p>Please manually enter your address.</p>",description:"Could not connect to the elastic search.json",data:t}),e("#"+c+"_nonStd").trigger("click").prop("checked",!0),i(o)}},limit:150}):"countrySelectionList"==o.attr("data-varname")?a=r.modules.travelCountrySelector.getCountrySelectorParams(o):(t=o.attr("data-source-url"),a={name:o.attr("name"),remote:{beforeSend:function(){l(o)},filter:function(e){return i(o),e},url:o.attr("data-source-url")+"%QUERY"},limit:150}),a=s(o,a),o.typeahead(a),o.hasClass("input-lg")&&o.prev(".tt-hint").addClass("hint-lg"),o.hasClass("input-sm")&&o.prev(".tt-hint").addClass("hint-sm"),o.hasClass("blur-on-select")&&o.bind("typeahead:selected",function(e,t,a){t.hasOwnProperty("value")&&"Type your address..."===t.value||e&&e.target&&e.target.blur&&e.target.blur()})})}function l(e){e.hasClass("show-loading")&&r.modules.loadingAnimation.showInside(e.parent(".twitter-typeahead"))}function i(e){e.hasClass("show-loading")&&r.modules.loadingAnimation.hide(e.parent(".twitter-typeahead"))}function s(t,a){if(t&&t.hasClass("typeahead-address")){var o=t.data("addressfieldid"),l=n(o);a.remote.url=t.attr("id"),a.remote.replace=d,a.valueKey="value",a.template=_.template("<p>{{= highlight }}</p>"),(t.hasClass("typeahead-autofilllessSearch")||t.hasClass("typeahead-streetSearch"))&&(a.remote.filter=function(a){return i(t),l&&e.each(a,function(e,t){t.hasOwnProperty("text")&&t.hasOwnProperty("payload")&&(t.value=t.text,t.highlight=t.text,t.dpId=t.payload)}),a.push({value:"Type your address...",highlight:"Can't find your address? <u>Click here.</u>"}),a},t.bind("typeahead:selected",function(e,a,n){if(a.hasOwnProperty("value")&&"Type your address..."===a.value){var i="";l||e.target&&e.target.id&&(i=e.target.id.replace("_streetSearch","")),r.messaging.publish(c.CANT_FIND_ADDRESS,{fieldgroup:i})}else l&&(r.messaging.publish(c.ELASTIC_SEARCH_COMPLETE,{dpid:a.dpId,addressFieldId:o}),t.valid())}))}return a}function d(t,a){var n=e("#"+t);return t="",n.trigger("getSearchURL"),n.data("source-url")&&(t=n.data("source-url")),t}var r=window.meerkat,u=(r.modules.events,r.logging.info,{autocomplete:{CANT_FIND_ADDRESS:"EVENT_CANT_FIND_ADDRESS",ELASTIC_SEARCH_COMPLETE:"ELASTIC_SEARCH_COMPLETE",INIT:"INIT"}}),c=u.autocomplete;r.modules.register("autocomplete",{init:a,events:u,autocompleteBeforeSend:l,autocompleteComplete:i})}(jQuery),function(e,t){function a(t){var a=e.extend({},C,t);m="xs"===g.modules.deviceMediaState.get()?!0:!1;var l="mkDialog_"+b;_.isUndefined(a.id)?(a.id=l,b++):h(a.id)&&n(a.id),null!=a.hashId&&g.modules.address.appendToHash(a.hashId);var r=_.template(a.templates.dialogWindow);(null!=a.url||null!=a.externalUrl)&&(a.htmlContent=g.modules.loadingAnimation.getTemplate());var u=r(a);e("#dynamic_dom").append(u);var c=e("#"+a.id);c.modal({show:!0,backdrop:a.buttons&&a.buttons.length>0?"static":!0,keyboard:!1}),c.css("z-index",parseInt(c.eq(0).css("z-index"))+10*y.length);var f=e(".modal-backdrop");if(f.eq(f.length-1).css("z-index",parseInt(f.eq(0).css("z-index"))+10*y.length),c.on("hidden.bs.modal",function(t){if("undefined"!=typeof t.target){var a=e(t.target);0!==a.length&&a.hasClass("modal")!==!1&&o(a.attr("id"))}}),c.on("shown.bs.tab",function(e){d(a.id)}),c.find("button").on("click",function(t){var n=a.buttons[e(t.currentTarget).attr("data-index")];_.isUndefined(n)||(n.closeWindow===!0&&e(t.currentTarget).closest(".modal").modal("hide"),"function"==typeof n.action&&n.action(t))}),c.find(".navbar-nav button").off().on("click",function(t){var n=a[e(t.currentTarget).attr("data-button")];"undefined"!=typeof n&&"function"==typeof n.callback&&n.callback(t)}),null!=a.url&&g.modules.comms.get({url:a.url,cache:a.cacheUrl,errorLevel:"warning",onSuccess:function(e){i(a.id,e),"function"==typeof a.onLoad&&a.onLoad(a.id)}}),null!=a.externalUrl){var p='<iframe class="displayNone" id="'+a.id+'_iframe" width="100%" height="100%" frameborder="0" scrolling="no" allowtransparency="true" src="'+a.externalUrl+'"></iframe>';s(a.id,p),e("#"+a.id+"_iframe").on("load",function(){e(this).show(),g.modules.loadingAnimation.hide(e("#"+a.id))})}return window.setTimeout(function(){d(a.id)},0),"function"==typeof a.onOpen&&a.onOpen(a.id),y.push(a),a.id}function n(t){e("#"+t).modal("hide")}function o(t){y.length>1&&_.defer(function(){y.length>0&&y[0].id!==t&&e(document.body).addClass("modal-open")});var a=u(t);null!==a&&"function"==typeof a.onClose&&a.onClose(t),a.destroyOnClose===!0?r(t):g.modules.address.removeFromHash(a.hashId)}function l(t){e("#dynamic_dom .modal").each(function(t,a){d(e(a).attr("id"))})}function i(t,a,n){e("#"+t+" .modal-body").html(a),"function"==typeof n&&n(),l()}function s(t,a){e("#"+t+" .modal-body").append(a),l()}function d(t){m="xs"===g.modules.deviceMediaState.get()?!0:!1;var a=e("#"+t);if(0===a.find(".modal-header").outerHeight(!0))window.setTimeout(function(){d(t)},20);else{var n,o,l,i=a.find(".modal-content"),s=a.find(".modal-body"),r=a.find(".modal-dialog");n=e(window).height(),m||(n-=60),o=n,o-=a.find(".modal-header").outerHeight(!0),o-=a.find(".modal-footer").outerHeight(!0),o-=a.find(".modal-closebar").outerHeight(!0),m?(i.css("height",n),a.find(".modal-body").css("max-height","none").css("height",o),l=0,r.css("top",l)):(i.css("max-height",n),"true"===a.attr("data-fullheight")?(i.css("height",n),s.css("height",o)):(i.css("height","auto"),s.css("height","auto")),a.find(".modal-body").css("max-height",o),l=n/2-r.height()/2,i.height()<n&&(l/=2),r.css("top",l))}}function r(t){if(t&&0!==t.length){var a=e("#"+t);a.find("button").off().end().remove();var n=u(t);if(null!=n){if(null!=n.hashId){g.modules.address.removeFromHash(n.hashId);var o=_.findWhere(v,{hashId:n.hashId});null==o&&v.push(n)}y.splice(n.index,1)}}}function u(e){var t=c(e);return null!==t?(y[t].index=t,y[t]):null}function c(e){for(var t=0;t<y.length;t++)if(y[t].id==e)return t;return null}function h(e){return!_.isNull(c(e))}function f(){e(document).ready(function(){e(document).on("click",".btn-close-dialog",function(){e(this).closest(".modal").modal("hide")}),Modernizr.touch&&(e(document).on("touchmove",".modal",function(e){e.preventDefault()}),e(document).on("touchmove",".modal .modal-body",function(e){e.stopPropagation()}))});var t=this;g.messaging.subscribe(p.dynamicContentLoading.PARSED_DIALOG,function(t){var n,o=t.element.attr("data-dialog-hash-id"),l=null;""!==o&&(l=o),n="url"===t.contentType?{title:t.element.attr("data-title"),url:t.contentValue,cacheUrl:t.element.attr("data-cache")?!0:!1}:"externalUrl"===t.contentType?{title:t.element.attr("data-title"),externalUrl:t.contentValue}:{title:e(t.contentValue).attr("data-title"),htmlContent:t.contentValue};var i=e.extend({hashId:l,closeOnHashChange:!0,className:t.element.attr("data-class")},n);a(i)});var n=_.debounce(l,300);e(window).resize(n),g.messaging.subscribe(p.ADDRESS_CHANGE,function(e){for(var a=y.length-1;a>=0;a--){var n=y[a];n.closeOnHashChange===!0&&-1==_.indexOf(e.hashArray,n.hashId)&&t.close(n.id)}for(var o=0;o<e.hashArray.length;o++){var l=_.findWhere(y,{hashId:e.hashArray[o]});if(null==l){var i=_.findWhere(v,{hashId:e.hashArray[o]});null!=i&&i.openOnHashChange===!0&&g.modules.dialogs.show(i)}}},window)}var m,g=window.meerkat,p=g.modules.events,b=(g.logging.info,0),v=[],y=[],C={title:"",htmlContent:null,url:null,cacheUrl:!1,buttons:[],className:"",leftBtn:{label:"Back",icon:"",className:"btn-sm btn-close-dialog",callback:null},rightBtn:{label:"",icon:"",className:"",callback:null},tabs:[],htmlHeaderContent:"",hashId:null,destroyOnClose:!0,closeOnHashChange:!1,openOnHashChange:!0,fullHeight:!1,templates:{dialogWindow:'<div id="{{= id }}" class="modal" tabindex="-1" role="dialog" aria-labelledby="{{= id }}_title" aria-hidden="true"{{ if(fullHeight===true){ }} data-fullheight="true"{{ } }}><div class="modal-dialog {{= className }}"><div class="modal-content"><div class="modal-closebar">	<a href="javascript:;" class="btn btn-close-dialog"><span class="icon icon-cross"></span></a></div><div class="navbar navbar-default xs-results-pagination visible-xs"><div class="container"><ul class="nav navbar-nav"><li><button data-button="leftBtn" class="btn btn-back {{= leftBtn.className }}">{{= leftBtn.icon }} {{= leftBtn.label }}</button></li><li class="navbar-text modal-title-label">	{{= title }}</li>{{ if(rightBtn.label != "" || rightBtn.icon != "") { }}<li class="right"><button data-button="rightBtn" class="btn btn-save {{= rightBtn.className }}">{{= rightBtn.label }} {{= rightBtn.icon }}</button></li>{{ } }}</ul></div></div>{{ if(title != "" || tabs.length > 0 || htmlHeaderContent != "" ) { }}<div class="modal-header">{{ if (tabs.length > 0) { }}<ul class="nav nav-tabs tab-count-{{= tabs.length }}">{{ _.each(tabs, function(tab, iterator) { }}<li><a href="javascript:;" data-target="{{= tab.targetSelector }}" title="{{= tab.xsTitle }}">{{= tab.title }}</a></li>{{ }); }}</ul>{{ } else if(title != "" ){ }}<h4 class="modal-title hidden-xs" id="{{= id }}_title">{{= title }}</h4>{{ } else if(htmlHeaderContent != "") { }}{{= htmlHeaderContent }}{{ } }}</div>{{ } }}<div class="modal-body">{{= htmlContent }}</div>{{ if(typeof buttons !== "undefined" && buttons.length > 0 ){ }}<div class="modal-footer {{ if(buttons.length > 1 ){ }} mustShow {{ } }}">{{ _.each(buttons, function(button, iterator) { }}<button data-index="{{= iterator }}" type="button" class="btn {{= button.className }} ">{{= button.label }}</button>{{ }); }}</div>{{ } }}</div></div></div>'},onOpen:function(e){},onClose:function(e){},onLoad:function(e){}};g.modules.register("dialogs",{init:f,show:a,changeContent:i,close:n,isDialogOpen:h,resizeDialog:d})}(jQuery);